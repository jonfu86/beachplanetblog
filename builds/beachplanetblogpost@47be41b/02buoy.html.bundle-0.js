BUNDLE=[["02buoy.html.bundle-1-0.js"]],"undefined"!=typeof window&&(document._montageTiming={},document._montageTiming.loadStartTime=Date.now(),window.addEventListener("DOMContentLoaded",function(){var e=1e3;document._montageStartBootstrappingTimeout=setTimeout(function(){document._montageStartBootstrappingTimeout=null;var e=document.documentElement;e.classList?e.classList.add("montage-app-bootstrapping"):e.className=e.className+" montage-app-bootstrapping",document._montageTiming.bootstrappingStartTime=Date.now()},e)})),function(e){"undefined"!=typeof require?e.call("undefined"!=typeof global?global:this,require,exports,module):e({},{},{})}(function(e,t){global=this,t.initMontage=function(){var e=t.getPlatform();e.bootstrap(function(i,a,s){var u=e.getParams(),r={location:i.getLocation()},l=s.resolve(r.location,u.montageLocation);r.moduleTypes=["html","meta"],r.makeLoader=function(e){return t.ReelLoader(e,i.makeLoader(e))},r.makeCompiler=function(e){return t.MetaCompiler(e,t.SerializationCompiler(e,t.TemplateCompiler(e,i.makeCompiler(e))))};var o=s.resolve(r.location,u["package"]||"."),c=u.applicationHash;if("object"==typeof BUNDLE){var m={},d=function(e){return m[e]=m[e]||a.defer()};global.bundleLoaded=function(e){d(e).resolve()};var p=a.defer();r.preloaded=p.promise;var v=a.resolve();BUNDLE.forEach(function(e){v=v.then(function(){return a.all(e.map(function(e){return n.load(e),d(e).promise}))})}),p.resolve(v.then(function(){delete BUNDLE,delete bundleLoaded}))}var h;if("remoteTrigger"in u){var g=a.defer();window.postMessage({type:"montageReady"},"*");var f=function(e){if(u.remoteTrigger===e.origin&&(e.source===window||e.source===window.parent))switch(e.data.type){case"montageInit":window.removeEventListener("message",f),g.resolve([e.data.location,e.data.injections]);break;case"isMontageReady":window.postMessage({type:"montageReady"},"*")}};window.addEventListener("message",f),h=g.promise.spread(function(e,t){var a=i.loadPackage({location:e,hash:c},r);return t&&(a=a.then(function(i){e=s.resolve(e,".");var a,u,n=t.packageDescriptions,r=t.packageDescriptionLocations,l=t.mappings,o=t.dependencies;if(n)for(u=n.length,a=0;u>a;a++)i.injectPackageDescription(n[a].location,n[a].description);if(r)for(u=r.length,a=0;u>a;a++)i.injectPackageDescriptionLocation(r[a].location,r[a].descriptionLocation);if(l)for(u=l.length,a=0;u>a;a++)i.injectMapping(l[a].dependency,l[a].name);if(o)for(u=o.length,a=0;u>a;a++)i.injectDependency(o[a].name,o[a].version);return i})),a})}else{if("autoPackage"in u)i.injectPackageDescription(o,{dependencies:{montage:"*"}},r);else if(".json"===o.slice(o.length-5)){var b=o;o=s.resolve(o,"."),i.injectPackageDescriptionLocation(o,b,r)}h=i.loadPackage({location:o,hash:c},r)}h.then(function(t){t.loadPackage({location:l,hash:u.montageHash}).then(function(e){var t;return t=u.promiseLocation?s.resolve(i.getLocation(),u.promiseLocation):s.resolve(l,"packages/mr/packages/q"),[e,e.loadPackage({location:t,hash:u.promiseHash})]}).spread(function(i,n){i.inject("core/mini-url",s),i.inject("core/promise",{Promise:a}),n.inject("q",a),r.lint=function(e){i.async("core/jshint").then(function(t){t.JSHINT(e.text)||(console.warn("JSHint Error: "+e.location),t.JSHINT.errors.forEach(function(e){e&&(console.warn("Problem at line "+e.line+" character "+e.character+": "+e.reason),e.evidence&&console.warn("    "+e.evidence))}))}).done()},self.require=self.mr=t,e.initMontage(i,t,u)})}).done()})};var i=/((.*)\.reel)\/\2$/,a=function(e,t){return t};t.SerializationCompiler=function(e,t){return function(e){if(t(e),e.factory){var s=e.factory;return e.factory=function(e,t,u){s.call(this,e,t,u);for(var n in t){var r=t[n];if(r instanceof Object)if(r.hasOwnProperty("_montage_metadata")&&!r._montage_metadata.isInstance)r._montage_metadata.aliases.push(n),r._montage_metadata.objectName=n;else if(!Object.isSealed(r)){var l=u.id.replace(i,a);Object.defineProperty(r,"_montage_metadata",{value:{require:e,module:l,moduleId:l,property:n,objectName:n,aliases:[n],isInstance:!1}})}}},e}}};var s=/([^\/]+)\.reel$/;t.ReelLoader=function(e,t){return function(e,i){var a=s.exec(e);return a?(i.redirect=e+"/"+a[1],i):t(e,i)}};var u=/\.meta/;t.MetaCompiler=function(e,t){return function(e){var i=(e.location||"").match(u);return i?(e.exports=JSON.parse(e.text),e):t(e)}},t.TemplateCompiler=function(e,t){return function(e){if(e.location){var i=e.location.match(/(.*\/)?(?=[^\/]+\.html(?:\.load\.js)?$)/);return i?(e.dependencies=e.dependencies||[],e.exports={directory:i[1],content:e.text},Object.defineProperty(e.exports,"root",{get:function(){return"object"==typeof console&&console.warn("'root' property is deprecated on template modules.  Use 'directory' instead of root[1]"),i}}),e):(t(e),void 0)}}},t.getPlatform=function(){if("undefined"!=typeof window&&window&&window.document)return n;if("undefined"!=typeof process)return e("./node.js");throw Error("Platform not supported.")};var n={makeResolve:function(){var e=document.querySelector("head"),t=document.createElement("base"),i=document.createElement("a");return t.href="",function(a,s){var u=e.querySelector("base");if(u||(e.appendChild(t),u=t),a+="",!/^[\w\-]+:/.test(a))throw Error("Can't resolve from a relative location: "+JSON.stringify(a)+" "+JSON.stringify(s));var n=u.href;u.href=a,i.href=s;var r=i.href;return u.href=n,u===t&&e.removeChild(u),r}},load:function(e){var t=document.createElement("script");t.src=e,t.onload=function(){t.parentNode.removeChild(t)},document.getElementsByTagName("head")[0].appendChild(t)},getParams:function(){var e,t,i,a,s,u,n;if(!this._params){this._params={};var r=document.getElementsByTagName("script");for(e=0;r.length>e;e++)if(a=r[e],s=!1,a.src&&(i=a.src.match(/^(.*)montage.js(?:[\?\.]|$)/i))&&(this._params.montageLocation=i[1],s=!0),a.hasAttribute("data-montage-location")&&(this._params.montageLocation=a.getAttribute("data-montage-location"),s=!0),s){if(a.dataset)for(n in a.dataset)this._params[n]=a.dataset[n];else if(a.attributes){var l=/-([a-z])/g,o=function(e,t){return t.toUpperCase()};for(t=0;a.attributes.length>t;t++)u=a.attributes[t],i=u.name.match(/^data-(.*)$/),i&&(this._params[i[1].replace(l,o)]=u.value)}a.parentNode.removeChild(a);break}}return this._params},bootstrap:function(e){function t(){document.removeEventListener("DOMContentLoaded",t,!0),r=!0,s()}function i(e){if(!g[e]&&h[e]){var t=g[e]={};g[e]=h[e](i,t)||t}return g[e]}function a(){o=i("mini-url"),l=i("promise"),u=i("require"),delete global.bootstrap,s()}function s(){r&&u&&e(u,l,o)}var u,r,l,o,c=this.getParams(),m=this.makeResolve();/interactive|complete/.test(document.readyState)?t():document.addEventListener("DOMContentLoaded",t,!0);var d={require:"packages/mr/require.js","require/browser":"packages/mr/browser.js",promise:"packages/mr/packages/q/q.js"};if("undefined"==typeof BUNDLE){var p=m(window.location,c.montageLocation);for(var v in d)n.load(m(p,d[v]))}var h={};global.bootstrap=function(e,t){h[e]=t,delete d[e];for(var e in d)return;delete global.bootstrap,a()},global.bootstrap("mini-url",function(e,t){t.resolve=m});var g={}},initMontage:function(e,t,i){var a=["core/core","core/event/event-manager","core/serialization/deserializer/montage-reviver","core/logger","core/deprecate"],s=e("core/promise").Promise;return s.all(a.map(e.deepLoad)).then(function(){a.forEach(e),e("core/core").Montage;var u,n,r=e("core/event/event-manager").EventManager,l=e("core/serialization/deserializer/montage-reviver").MontageReviver,o=e("core/logger").logger,c=e("core/deprecate");o("Promise stacktrace support",function(e){s.longStackSupport=!!e}),u=(new r).initWithWindow(window),"function"==typeof global.montageWillLoad&&global.montageWillLoad();var m,d,p=t.packageDescription.applicationPrototype;return p?(m=l.parseObjectLocationId(p),d=t.async(m.moduleId)):d=e.async("core/application"),d.then(function(e){var a=e[m?m.objectName:"Application"];n=new a,Object.defineProperty(window.document,"application",{get:c.deprecateMethod(null,function(){return e.application},'document.application is deprecated, use require("montage/core/application").application instead.')}),u.application=n,n.eventManager=u,n._load(t,function(){i.module&&t.async(i.module).done(),"function"==typeof global.montageDidLoad&&global.montageDidLoad()})})}).done()}};"undefined"!=typeof window?global.__MONTAGE_LOADED__?console.warn("Montage already loaded!"):(global.__MONTAGE_LOADED__=!0,t.initMontage()):t.getPlatform()}),function(e){if("undefined"!=typeof bootstrap)"undefined"!=typeof window?bootstrap("require",function(t,i){var a=t("promise"),s=t("mini-url");e(i,a,s),t("require/browser")}):bootstrap("require",function(t,i){var a=t("promise").Promise,s=t("mini-url");e(i,a,s)});else{if("undefined"==typeof process)throw Error("Can't support require on this platform");var t=require("q"),i=require("url");e(exports,t,i),require("./node")}}(function(e,t,i){function a(t,a){if(a=a||{},"string"==typeof t&&(t={location:t}),t.main&&(t.location=a.mainPackageLocation),t.name&&a.registry&&a.registry[t.name]&&(t.location=a.registry[t.name]),!t.location&&a.packagesDirectory&&t.name&&(t.location=i.resolve(a.packagesDirectory,t.name+"/")),!t.location)return t;if(/\/$/.test(t.location)||(t.location+="/"),!e.isAbsolute(t.location)){if(!a.location)throw Error("Dependency locations must be fully qualified: "+JSON.stringify(t));t.location=i.resolve(a.location,t.location)}return t.name&&(a.registry[t.name]=t.location),t}function s(t,s,u){/\/$/.test(t)||(t+="/");var r=Object.create(u);r.name=s.name,r.location=t||e.getLocation(),r.packageDescription=s,r.useScriptInjection=s.useScriptInjection,void 0!==s.production&&(r.production=s.production);var o=r.modules=r.modules||{},c=r.registry;void 0===r.name||c[r.name]||(c[r.name]=r.location);var m=s.overlay||{};"string"==typeof s.browser?m.browser={redirects:{"":s.browser}}:"object"==typeof s.browser&&(m.browser={redirects:s.browser}),r.overlays=r.overlays||e.overlays,r.overlays.forEach(function(e){if(m[e]){var t=m[e];for(var i in t)s[i]=t[i]}}),delete s.overlay,r.packagesDirectory=i.resolve(t,"node_modules/"),void 0!==s.main&&(o[""]={id:"",redirect:l(n(s.main,"")),location:r.location});var d=s.redirects;void 0!==d&&Object.keys(d).forEach(function(e){o[e]={id:e,redirect:l(n(d[e],e)),location:i.resolve(t,e)}});var p=s.mappings||{};return[s.dependencies,r.production?null:s.devDependencies].forEach(function(e){e&&Object.keys(e).forEach(function(t){p[t]||(p[t]={name:t,version:e[t]})})}),Object.keys(p).forEach(function(e){p[e]=a(p[e],r,e)}),r.mappings=p,r}function u(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function n(e,t){e+="";var i=e.split("/"),a=[];if(i.length&&"."===i[0]||".."===i[0]){var s=t.split("/");s.pop(),i.unshift.apply(i,s)}for(var u=0,n=i.length;n>u;u++){var r=i[u];""===r||"."===r||(".."===r?a.length&&a.pop():a.push(r))}return a.join("/")}if(!this)throw Error("Require does not work in strict mode.");e.makeRequire=function(s){function r(e){var t=e.toLowerCase();return u(g,t)||(g[t]={id:e,display:(s.name||s.location)+"#"+e,require:h}),g[t]}function c(e,t){var a=r(e);a.exports=t,a.location=i.resolve(s.location,e),a.directory=i.resolve(a.location,"./"),a.injected=!0,delete a.redirect,delete a.mappingRedirect}function m(e,i,a){var s=r(e);return a=a||{},u(a,e)?void 0:(a[e]=!0,f(e,i).then(function(){return t.all(s.dependencies.map(function(t){t=n(t,e);var i=r(t),s=i.dependees=i.dependees||{};return s[e]=!0,m(t,e,a)}))},function(e){s.error=e}))}function d(e,t){var a=r(e);if(a.id!==e)throw Error("Can't require module "+JSON.stringify(a.id)+" by alternate spelling "+JSON.stringify(e));if(a.error){var s=Error("Can't require module "+JSON.stringify(a.id)+" via "+JSON.stringify(t)+" because "+a.error.message);throw s.cause=a.error,s}if(void 0!==a.redirect)return d(a.redirect,t);if(void 0!==a.mappingRedirect)return a.mappingRequire(a.mappingRedirect,t);if(void 0!==a.exports)return a.exports;if(void 0===a.factory)throw Error("Can't require module "+JSON.stringify(e)+" via "+JSON.stringify(t));a.directory=i.resolve(a.location,"./"),a.exports={};var u;try{u=a.factory.call(void 0,v(e),a.exports,a)}catch(n){throw delete a.exports,n}return void 0!==u&&(a.exports=u),a.exports}function p(e,t,i){var a=s.location;if(t.location===a)return e;var n=!!i;if(i=i||{},u(i,a))return null;i[a]=!0;for(var r in s.mappings){var l=s.mappings[r];if(a=l.location,s.hasPackage(a)){var o=s.getPackage(a),c=o.identify(e,t,i);if(null!==c)return""===c?r:r+"/"+c}}if(n)return null;throw Error("Can't identify "+e+" from "+t.location)}function v(t){var i=function(e){var i=n(e,t);return d(i,t)};return i.async=function(e){var a=n(e,t);return r(e),m(a,t).then(function(){return i(a)})},i.resolve=function(e){return l(n(e,t))},i.getModule=r,i.getModuleDescriptor=r,i.load=f,i.deepLoad=m,i.loadPackage=function(t,i){return i?e.loadPackage(t,i):s.loadPackage(t,s)},i.hasPackage=function(e){return s.hasPackage(e)},i.getPackage=function(e){return s.getPackage(e)},i.isMainPackage=function(){return i.location===s.mainPackageLocation},i.injectPackageDescription=function(t,i){e.injectPackageDescription(t,i,s)},i.injectPackageDescriptionLocation=function(t,i){e.injectPackageDescriptionLocation(t,i,s)},i.injectMapping=function(e,t){e=a(e,s,t),t=t||e.name,s.mappings[t]=e},i.injectDependency=function(e){i.injectMapping({name:e},e)},i.identify=p,i.inject=c,s.exposedConfigs.forEach(function(e){i[e]=s[e]}),i.config=s,i.read=s.read,i}var h;s=s||{},s.location=i.resolve(s.location||e.getLocation(),"./"),s.paths=s.paths||[s.location],s.mappings=s.mappings||{},s.exposedConfigs=s.exposedConfigs||e.exposedConfigs,s.moduleTypes=s.moduleTypes||[],s.makeLoader=s.makeLoader||e.makeLoader,s.load=s.load||s.makeLoader(s),s.makeCompiler=s.makeCompiler||e.makeCompiler,s.compile=s.compile||s.makeCompiler(s),s.parseDependencies=s.parseDependencies||e.parseDependencies,s.read=s.read||e.read;var g=s.modules=s.modules||{},f=o(function(e){var i=r(e);return t.fcall(function(){return void 0===i.factory&&void 0===i.exports&&void 0===i.redirect?t.fcall(s.load,e,i):void 0}).then(function(){s.compile(i);var e=i.dependencies=i.dependencies||[];void 0!==i.redirect&&e.push(i.redirect),void 0!==i.extraDependencies&&Array.prototype.push.apply(i.dependencies,i.extraDependencies)})});return h=v("")},e.injectPackageDescription=function(e,i,a){var s=a.descriptions=a.descriptions||{};s[e]=t.resolve(i)},e.injectPackageDescriptionLocation=function(e,t,i){var a=i.descriptionLocations=i.descriptionLocations||{};a[e]=t},e.loadPackageDescription=function(t,a){var s=t.location,u=a.descriptions=a.descriptions||{};if(void 0===u[s]){var n,r=a.descriptionLocations=a.descriptionLocations||{};n=r[s]?r[s]:i.resolve(s,"package.json"),u[s]=(a.read||e.read)(n).then(function(e){try{return JSON.parse(e)}catch(t){throw t.message=t.message+" in "+JSON.stringify(n),t}})}return u[s]},e.loadPackage=function(t,i){if(t=a(t,i),!t.location)throw Error("Can't find dependency: "+JSON.stringify(t));var u=t.location;i=Object.create(i||null);var n=i.loadingPackages=i.loadingPackages||{},r=i.packages={};i.registry=i.registry||Object.create(null),i.mainPackageLocation=u,i.hasPackage=function(e){if(e=a(e,i),!e.location)return!1;var t=e.location;return!!r[t]},i.getPackage=function(e){if(e=a(e,i),!e.location)throw Error("Can't find dependency: "+JSON.stringify(e)+" from "+i.location);var t=e.location;if(!r[t])throw n[t]?Error("Dependency has not finished loading: "+JSON.stringify(e)):Error("Dependency was not loaded: "+JSON.stringify(e));return r[t]},i.loadPackage=function(t,u){if(t=a(t,u),!t.location)throw Error("Can't find dependency: "+JSON.stringify(t)+" from "+i.location);var l=t.location;return n[l]||(n[l]=e.loadPackageDescription(t,i).then(function(t){var a=s(l,t,i),u=e.makeRequire(a);return r[l]=u,u})),n[l]};var l=i.loadPackage(t);return l.location=u,l.async=function(e,t){return l.then(function(i){return i.async(e,t)})},l},e.resolve=n;var r=/\.([^\/\.]+)$/;e.extension=function(e){var t=r.exec(e);return t?t[1]:void 0},e.isAbsolute=function(e){return/^[\w\-]+:/.test(e)},e.parseDependencies=function(e){var t={};return(e+"").replace(/(?:^|[^\w\$_.])require\s*\(\s*["']([^"']*)["']\s*\)/g,function(e,i){t[i]=!0}),Object.keys(t)},e.DependenciesCompiler=function(t,i){return function(a){return a.dependencies||void 0===a.text||(a.dependencies=t.parseDependencies(a.text)),i(a),a&&!a.dependencies&&(a.dependencies=a.text||a.factory?e.parseDependencies(a.text||a.factory):[]),a}},e.ShebangCompiler=function(e,t){return function(e){e.text&&(e.text=e.text.replace(/^#!/,"//#!")),t(e)}},e.LintCompiler=function(e,i){return function(a){try{i(a)}catch(s){throw e.lint&&t.nextTick(function(){e.lint(a)}),s}}},e.exposedConfigs=["paths","mappings","location","packageDescription","packages","modules"],e.makeCompiler=function(t){return e.JsonCompiler(t,e.ShebangCompiler(t,e.DependenciesCompiler(t,e.LintCompiler(t,e.Compiler(t)))))},e.JsonCompiler=function(e,t){return function(e){var i=(e.location||"").match(/\.json$/);return i?(e.exports=JSON.parse(e.text),e):t(e)}},e.MappingsLoader=function(t,i){return t.mappings=t.mappings||{},t.name=t.name,function(a,s){var u=t.mappings,n=Object.keys(u),r=n.length;if(e.isAbsolute(a))return i(a,s);void 0!==t.name&&0===a.indexOf(t.name)&&"/"===a.charAt(t.name.length)&&console.warn("Package reflexive module ignored:",a);var l,o;for(l=0;r>l;l++)if(o=n[l],a===o||0===a.indexOf(o)&&"/"===a.charAt(o.length)){var c=u[o],m=a.slice(o.length+1);return t.loadPackage(c,t).then(function(e){return s.mappingRedirect=m,s.mappingRequire=e,e.deepLoad(m,t.location)})}return i(a,s)}},e.LocationLoader=function(t,a){return function(s,u){var n=s,r=e.extension(s);(!r||"js"!==r&&"json"!==r&&-1===t.moduleTypes.indexOf(r))&&(n+=".js");var l=i.resolve(t.location,n);return a(l,u)}},e.MemoizedLoader=function(e,t){var i=e.cache=e.cache||{};return o(t,i)};var l=function(e){var t=/^(.*)\.js$/.exec(e);return t&&(e=t[1]),e},o=function(e,i){return i=i||{},function(a,s){return u(i,a)||(i[a]=t.fcall(e,a,s)),i[a]}}}),bootstrap("require/browser",function(e){function t(e){return 200===e.status||0===e.status&&e.responseText}var i,a=e("require"),s=e("promise"),u=e("mini-url"),n="GET",r="application/javascript";a.getLocation=function(){if(!i){var e=document.querySelector("head > base");i=e?e.href:window.location,i=u.resolve(i,".")}return i},a.overlays=["window","browser","montage"],a.read=function(e){function i(){t(u)?l.resolve(u.responseText):a()}function a(){l.reject(Error("Can't XHR "+JSON.stringify(e)))}var u=new XMLHttpRequest,l=s.defer();try{u.open(n,e,!0),u.overrideMimeType&&u.overrideMimeType(r),u.onreadystatechange=function(){4===u.readyState&&i()},u.onload=u.load=i,u.onerror=u.error=a}catch(o){l.reject(o)}return u.send(),l.promise};var l=eval,o="__",c="_",m="(function ",d="(require, exports, module) {",p="//*/\n})\n//# sourceURL=";a.Compiler=function(e){return function(t){if(t.factory||void 0===t.text)return t;if(e.useScriptInjection)throw Error("Can't use eval.");var i=(t.require.config.name+o+t.id).replace(/[^\w\d]|^\d/g,c);try{t.factory=l(m+i+d+t.text+p+t.location)}catch(a){throw a.message=a.message+" in "+t.location,a}t.factory.displayName=i}},a.XhrLoader=function(e){return function(t,i){return e.read(t).then(function(e){i.type="javascript",i.text=e,i.location=t})}};var v={},h=function(e,t){return v[e]=v[e]||{},v[e][t]=v[e][t]||s.defer(),v[e][t]},g=function(e,t,i){i&&i.isPending()?i.then(function(){t.isPending()&&a.loadScript(e)}).done():t.isPending()&&a.loadScript(e)};montageDefine=function(e,t,i){h(e,t).resolve(i)},a.loadScript=function(e){var t=document.createElement("script");t.onload=function(){t.parentNode.removeChild(t)},t.onerror=function(){t.parentNode.removeChild(t)},t.src=e,t.defer=!0,document.getElementsByTagName("head")[0].appendChild(t)},a.ScriptLoader=function(e){var t=e.packageDescription.hash;return function(i,a){return s.fcall(function(){if(v[t]&&v[t][a.id])return v[t][a.id].promise;/\.js$/.test(i)?i=i.replace(/\.js$/,".load.js"):i+=".load.js";var s=h(t,a.id).promise;return g(i,s,e.preloaded),s}).then(function(e){delete v[t][a.id];for(var s in e)a[s]=e[s];a.location=i,a.directory=u.resolve(i,".")})}};var f=a.loadPackageDescription;a.loadPackageDescription=function(e,t){if(e.hash){var i=h(e.hash,"package.json").promise,a=u.resolve(e.location,"package.json.load.js");return g(a,i,t.preloaded),i.get("exports")}return f(e,t)},a.makeLoader=function(e){var t;return t=e.useScriptInjection?a.ScriptLoader:a.XhrLoader,a.MappingsLoader(e,a.LocationLoader(e,a.MemoizedLoader(e,t(e))))}}),function(e){if("function"==typeof bootstrap)bootstrap("promise",e);else if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=e}else Q=e()}(function(){"use strict";function e(e){return function(){return H.apply(e,arguments)}}function t(e){return e===Object(e)}function i(e){return"[object StopIteration]"===tt(e)||e instanceof B}function a(e,t){if(k&&t.stack&&"object"==typeof e&&null!==e&&e.stack&&-1===e.stack.indexOf(it)){for(var i=[],a=t;a;a=a.source)a.stack&&i.unshift(a.stack);i.unshift(e.stack);var u=i.join("\n"+it+"\n");e.stack=s(u)}}function s(e){for(var t=e.split("\n"),i=[],a=0;t.length>a;++a){var s=t[a];r(s)||u(s)||!s||i.push(s)}return i.join("\n")}function u(e){return-1!==e.indexOf("(module.js:")||-1!==e.indexOf("(node.js:")}function n(e){var t=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(t)return[t[1],Number(t[2])];var i=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(i)return[i[1],Number(i[2])];var a=/.*@(.+):(\d+)$/.exec(e);return a?[a[1],Number(a[2])]:void 0}function r(e){var t=n(e);if(!t)return!1;var i=t[0],a=t[1];return i===U&&a>=Q&&nt>=a}function l(){if(k)try{throw Error()}catch(e){var t=e.stack.split("\n"),i=t[0].indexOf("@")>0?t[1]:t[2],a=n(i);if(!a)return;return U=a[0],a[1]}}function o(e,t,i){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t+" is deprecated, use "+i+" instead.",Error("").stack),e.apply(e,arguments)}}function c(e){return f(e)?e:b(e)?E(e):N(e)}function m(){function e(e){t=e,u.source=e,Y(i,function(t,i){W(function(){e.promiseDispatch.apply(e,i)})},void 0),i=void 0,a=void 0}var t,i=[],a=[],s=$(m.prototype),u=$(v.prototype);if(u.promiseDispatch=function(e,s,u){var n=X(arguments);i?(i.push(n),"when"===s&&u[1]&&a.push(u[1])):W(function(){t.promiseDispatch.apply(t,n)})},u.valueOf=function(){if(i)return u;var e=g(t);return f(e)&&(t=e),e},u.inspect=function(){return t?t.inspect():{state:"pending"}},c.longStackSupport&&k)try{throw Error()}catch(n){u.stack=n.stack.substring(n.stack.indexOf("\n")+1)}return s.promise=u,s.resolve=function(i){t||e(c(i))},s.fulfill=function(i){t||e(N(i))},s.reject=function(i){t||e(D(i))},s.notify=function(e){t||Y(a,function(t,i){W(function(){i(e)})},void 0)},s}function d(e){if("function"!=typeof e)throw new TypeError("resolver must be a function.");var t=m();try{e(t.resolve,t.reject,t.notify)}catch(i){t.reject(i)}return t.promise}function p(e){return d(function(t,i){for(var a=0,s=e.length;s>a;a++)c(e[a]).then(t,i)})}function v(e,t,i){void 0===t&&(t=function(e){return D(Error("Promise does not support operation: "+e))}),void 0===i&&(i=function(){return{state:"unknown"}});var a=$(v.prototype);if(a.promiseDispatch=function(i,s,u){var n;try{n=e[s]?e[s].apply(a,u):t.call(a,s,u)}catch(r){n=D(r)}i&&i(n)},a.inspect=i,i){var s=i();"rejected"===s.state&&(a.exception=s.reason),a.valueOf=function(){var e=i();return"pending"===e.state||"rejected"===e.state?a:e.value}}return a}function h(e,t,i,a){return c(e).then(t,i,a)}function g(e){if(f(e)){var t=e.inspect();if("fulfilled"===t.state)return t.value}return e}function f(e){return t(e)&&"function"==typeof e.promiseDispatch&&"function"==typeof e.inspect}function b(e){return t(e)&&"function"==typeof e.then}function q(e){return f(e)&&"pending"===e.inspect().state}function _(e){return!f(e)||"fulfilled"===e.inspect().state}function y(e){return f(e)&&"rejected"===e.inspect().state}function S(){at.length=0,st.length=0,ut||(ut=!0)}function P(e,t){ut&&(st.push(e),t&&void 0!==t.stack?at.push(t.stack):at.push("(no stack) "+t))}function C(e){if(ut){var t=K(st,e);-1!==t&&(st.splice(t,1),at.splice(t,1))}}function D(e){var t=v({when:function(t){return t&&C(this),t?t(e):this}},function(){return this},function(){return{state:"rejected",reason:e}});return P(t,e),t}function N(e){return v({when:function(){return e},get:function(t){return e[t]},set:function(t,i){e[t]=i},"delete":function(t){delete e[t]},post:function(t,i){return null===t||void 0===t?e.apply(void 0,i):e[t].apply(e,i)},apply:function(t,i){return e.apply(t,i)},keys:function(){return et(e)}},void 0,function(){return{state:"fulfilled",value:e}})}function E(e){var t=m();return W(function(){try{e.then(t.resolve,t.reject,t.notify)}catch(i){t.reject(i)}}),t.promise}function M(e){return v({isDef:function(){}},function(t,i){return L(e,t,i)},function(){return c(e).inspect()})}function w(e,t,i){return c(e).spread(t,i)}function A(e){return function(){function t(e,t){var n;if("undefined"==typeof StopIteration){try{n=a[e](t)}catch(r){return D(r)}return n.done?n.value:h(n.value,s,u)}try{n=a[e](t)}catch(r){return i(r)?r.value:D(r)}return h(n,s,u)}var a=e.apply(this,arguments),s=t.bind(t,"next"),u=t.bind(t,"throw");return s()}}function x(e){c.done(c.async(e)())}function I(e){throw new B(e)}function T(e){return function(){return w([this,j(arguments)],function(t,i){return e.apply(t,i)})}}function L(e,t,i){return c(e).dispatch(t,i)}function j(e){return h(e,function(e){var t=0,i=m();return Y(e,function(a,s,u){var n;f(s)&&"fulfilled"===(n=s.inspect()).state?e[u]=n.value:(++t,h(s,function(a){e[u]=a,0===--t&&i.resolve(e)},i.reject,function(e){i.notify({index:u,value:e})}))},void 0),0===t&&i.resolve(e),i.promise})}function O(e){return h(e,function(e){return e=J(e,c),h(j(J(e,function(e){return h(e,G,G)})),function(){return e})})}function V(e){return c(e).allSettled()}function F(e,t){return c(e).then(void 0,void 0,t)}function R(e,t){return c(e).nodeify(t)}var k=!1;try{throw Error()}catch(z){k=!!z.stack}var U,B,Q=l(),G=function(){},W=function(){function e(){for(;t.next;){t=t.next;var i=t.task;t.task=void 0;var s=t.domain;s&&(t.domain=void 0,s.enter());try{i()}catch(n){if(u)throw s&&s.exit(),setTimeout(e,0),s&&s.enter(),n;setTimeout(function(){throw n},0)}s&&s.exit()}a=!1}var t={task:void 0,next:null},i=t,a=!1,s=void 0,u=!1;if(W=function(e){i=i.next={task:e,domain:u&&process.domain,next:null},a||(a=!0,s())},"undefined"!=typeof process&&process.nextTick)u=!0,s=function(){process.nextTick(e)};else if("function"==typeof setImmediate)s="undefined"!=typeof window?setImmediate.bind(window,e):function(){setImmediate(e)};else if("undefined"!=typeof MessageChannel){var n=new MessageChannel;n.port1.onmessage=function(){s=r,n.port1.onmessage=e,e()};var r=function(){n.port2.postMessage(0)};s=function(){setTimeout(e,0),r()}}else s=function(){setTimeout(e,0)};return W}(),H=Function.call,X=e(Array.prototype.slice),Y=e(Array.prototype.reduce||function(e,t){var i=0,a=this.length;if(1===arguments.length)for(;;){if(i in this){t=this[i++];break}if(++i>=a)throw new TypeError}for(;a>i;i++)i in this&&(t=e(t,this[i],i));return t}),K=e(Array.prototype.indexOf||function(e){for(var t=0;this.length>t;t++)if(this[t]===e)return t;return-1}),J=e(Array.prototype.map||function(e,t){var i=this,a=[];return Y(i,function(s,u,n){a.push(e.call(t,u,n,i))},void 0),a}),$=Object.create||function(e){function t(){}return t.prototype=e,new t},Z=e(Object.prototype.hasOwnProperty),et=Object.keys||function(e){var t=[];for(var i in e)Z(e,i)&&t.push(i);return t},tt=e(Object.prototype.toString);B="undefined"!=typeof ReturnValue?ReturnValue:function(e){this.value=e};var it="From previous event:";c.resolve=c,c.nextTick=W,c.longStackSupport=!1,c.defer=m,m.prototype.makeNodeResolver=function(){var e=this;return function(t,i){t?e.reject(t):arguments.length>2?e.resolve(X(arguments,1)):e.resolve(i)}},c.Promise=d,c.promise=d,d.race=p,d.all=j,d.reject=D,d.resolve=c,c.passByCopy=function(e){return e},v.prototype.passByCopy=function(){return this},c.join=function(e,t){return c(e).join(t)},v.prototype.join=function(e){return c([this,e]).spread(function(e,t){if(e===t)return e;throw Error("Can't join: not the same: "+e+" "+t)})},c.race=p,v.prototype.race=function(){return this.then(c.race)},c.makePromise=v,v.prototype.toString=function(){return"[object Promise]"},v.prototype.then=function(e,t,i){function s(t){try{return"function"==typeof e?e(t):t}catch(i){return D(i)}}function u(e){if("function"==typeof t){a(e,r);try{return t(e)}catch(i){return D(i)}}return D(e)}function n(e){return"function"==typeof i?i(e):e}var r=this,l=m(),o=!1;return W(function(){r.promiseDispatch(function(e){o||(o=!0,l.resolve(s(e)))},"when",[function(e){o||(o=!0,l.resolve(u(e)))}])}),r.promiseDispatch(void 0,"when",[void 0,function(e){var t,i=!1;try{t=n(e)}catch(a){if(i=!0,!c.onerror)throw a;c.onerror(a)}i||l.notify(t)}]),l.promise},c.when=h,v.prototype.thenResolve=function(e){return this.then(function(){return e})},c.thenResolve=function(e,t){return c(e).thenResolve(t)},v.prototype.thenReject=function(e){return this.then(function(){throw e})},c.thenReject=function(e,t){return c(e).thenReject(t)},c.nearer=g,c.isPromise=f,c.isPromiseAlike=b,c.isPending=q,v.prototype.isPending=function(){return"pending"===this.inspect().state},c.isFulfilled=_,v.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},c.isRejected=y,v.prototype.isRejected=function(){return"rejected"===this.inspect().state};var at=[],st=[],ut=!0;c.resetUnhandledRejections=S,c.getUnhandledReasons=function(){return at.slice()},c.stopUnhandledRejectionTracking=function(){S(),ut=!1},S(),c.reject=D,c.fulfill=N,c.master=M,c.spread=w,v.prototype.spread=function(e,t){return this.all().then(function(t){return e.apply(void 0,t)},t)},c.async=A,c.spawn=x,c["return"]=I,c.promised=T,c.dispatch=L,v.prototype.dispatch=function(e,t){var i=this,a=m();return W(function(){i.promiseDispatch(a.resolve,e,t)}),a.promise},c.get=function(e,t){return c(e).dispatch("get",[t])},v.prototype.get=function(e){return this.dispatch("get",[e])},c.set=function(e,t,i){return c(e).dispatch("set",[t,i])},v.prototype.set=function(e,t){return this.dispatch("set",[e,t])},c.del=c["delete"]=function(e,t){return c(e).dispatch("delete",[t])},v.prototype.del=v.prototype["delete"]=function(e){return this.dispatch("delete",[e])},c.mapply=c.post=function(e,t,i){return c(e).dispatch("post",[t,i])},v.prototype.mapply=v.prototype.post=function(e,t){return this.dispatch("post",[e,t])},c.send=c.mcall=c.invoke=function(e,t){return c(e).dispatch("post",[t,X(arguments,2)])},v.prototype.send=v.prototype.mcall=v.prototype.invoke=function(e){return this.dispatch("post",[e,X(arguments,1)])},c.fapply=function(e,t){return c(e).dispatch("apply",[void 0,t])},v.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])},c["try"]=c.fcall=function(e){return c(e).dispatch("apply",[void 0,X(arguments,1)])},v.prototype.fcall=function(){return this.dispatch("apply",[void 0,X(arguments)])},c.fbind=function(e){var t=c(e),i=X(arguments,1);return function(){return t.dispatch("apply",[this,i.concat(X(arguments))])}},v.prototype.fbind=function(){var e=this,t=X(arguments);return function(){return e.dispatch("apply",[this,t.concat(X(arguments))])}},c.keys=function(e){return c(e).dispatch("keys",[])},v.prototype.keys=function(){return this.dispatch("keys",[])},c.all=j,v.prototype.all=function(){return j(this)},c.allResolved=o(O,"allResolved","allSettled"),v.prototype.allResolved=function(){return O(this)},c.allSettled=V,v.prototype.allSettled=function(){return this.then(function(e){return j(J(e,function(e){function t(){return e.inspect()}return e=c(e),e.then(t,t)}))})},c.fail=c["catch"]=function(e,t){return c(e).then(void 0,t)},v.prototype.fail=v.prototype["catch"]=function(e){return this.then(void 0,e)},c.progress=F,v.prototype.progress=function(e){return this.then(void 0,void 0,e)},c.fin=c["finally"]=function(e,t){return c(e)["finally"](t)
},v.prototype.fin=v.prototype["finally"]=function(e){return e=c(e),this.then(function(t){return e.fcall().then(function(){return t})},function(t){return e.fcall().then(function(){throw t})})},c.done=function(e,t,i,a){return c(e).done(t,i,a)},v.prototype.done=function(e,t,i){var s=function(e){W(function(){if(a(e,u),!c.onerror)throw e;c.onerror(e)})},u=e||t||i?this.then(e,t,i):this;"object"==typeof process&&process&&process.domain&&(s=process.domain.bind(s)),u.then(void 0,s)},c.timeout=function(e,t,i){return c(e).timeout(t,i)},v.prototype.timeout=function(e,t){var i=m(),a=setTimeout(function(){i.reject(Error(t||"Timed out after "+e+" ms"))},e);return this.then(function(e){clearTimeout(a),i.resolve(e)},function(e){clearTimeout(a),i.reject(e)},i.notify),i.promise},c.delay=function(e,t){return void 0===t&&(t=e,e=void 0),c(e).delay(t)},v.prototype.delay=function(e){return this.then(function(t){var i=m();return setTimeout(function(){i.resolve(t)},e),i.promise})},c.nfapply=function(e,t){return c(e).nfapply(t)},v.prototype.nfapply=function(e){var t=m(),i=X(e);return i.push(t.makeNodeResolver()),this.fapply(i).fail(t.reject),t.promise},c.nfcall=function(e){var t=X(arguments,1);return c(e).nfapply(t)},v.prototype.nfcall=function(){var e=X(arguments),t=m();return e.push(t.makeNodeResolver()),this.fapply(e).fail(t.reject),t.promise},c.nfbind=c.denodeify=function(e){var t=X(arguments,1);return function(){var i=t.concat(X(arguments)),a=m();return i.push(a.makeNodeResolver()),c(e).fapply(i).fail(a.reject),a.promise}},v.prototype.nfbind=v.prototype.denodeify=function(){var e=X(arguments);return e.unshift(this),c.denodeify.apply(void 0,e)},c.nbind=function(e,t){var i=X(arguments,2);return function(){function a(){return e.apply(t,arguments)}var s=i.concat(X(arguments)),u=m();return s.push(u.makeNodeResolver()),c(a).fapply(s).fail(u.reject),u.promise}},v.prototype.nbind=function(){var e=X(arguments,0);return e.unshift(this),c.nbind.apply(void 0,e)},c.nmapply=c.npost=function(e,t,i){return c(e).npost(t,i)},v.prototype.nmapply=v.prototype.npost=function(e,t){var i=X(t||[]),a=m();return i.push(a.makeNodeResolver()),this.dispatch("post",[e,i]).fail(a.reject),a.promise},c.nsend=c.nmcall=c.ninvoke=function(e,t){var i=X(arguments,2),a=m();return i.push(a.makeNodeResolver()),c(e).dispatch("post",[t,i]).fail(a.reject),a.promise},v.prototype.nsend=v.prototype.nmcall=v.prototype.ninvoke=function(e){var t=X(arguments,1),i=m();return t.push(i.makeNodeResolver()),this.dispatch("post",[e,t]).fail(i.reject),i.promise},c.nodeify=R,v.prototype.nodeify=function(e){return e?(this.then(function(t){W(function(){e(null,t)})},function(t){W(function(){e(t)})}),void 0):this};var nt=l();return c}),montageDefine("47be41b","package.json",{exports:{name:"beachplanetblogpost",version:"0.1.0",dependencies:{matte:"~0.2.0",collections:"~1.2.2",q:"~1.0.0",digit:"~0.5.1","mjs-volume":"git://github.com/montagestudio/mjs-volume.git#beachplanet",montage:"~0.15.0"},bundle:["ui/main.reel"],hash:"47be41b",mappings:{matte:{name:"matte",hash:"03aabfe",location:"packages/matte@03aabfe/"},collections:{name:"collections",hash:"e3ee536",location:"packages/collections@e3ee536/"},q:{name:"q",hash:"d2f6328",location:"packages/q@d2f6328/"},digit:{name:"digit",hash:"88d5464",location:"packages/digit@88d5464/"},"mjs-volume":{name:"mjs-volume",hash:"3d2b056",location:"packages/mjs-volume@3d2b056/"},montage:{name:"montage",hash:"d41c331",location:"packages/montage@d41c331/"}},production:!0,useScriptInjection:!0}}),montageDefine("d41c331","package.json",{exports:{name:"montage",version:"0.15.2",description:"Build your next application with a browser based platform that really gets the web.",repository:{type:"git",url:"git+https://github.com/montagejs/montage.git"},main:"core/core",dependencies:{collections:"~1.2.2",frb:"~0.2.18",htmlparser2:"~3.0.5",mousse:"~0.3.0",mr:"~0.15.3",q:"1.0.0","q-io":"~1.11.0"},devDependencies:{jshint:"~2.4.4","montage-testing":"~0.4.2"},scripts:{test:"node test/node/node-spec.js",jsdoc:"node ../montagejs.org/build/jsdoc/jsdoc.js -out $PWD/builds/jsdoc/ montage@npm-link"},exclude:["test","tools"],gitHead:"122b96157f1d8f089a563139caa8e56e92fe880e",bugs:{url:"https://github.com/montagejs/montage/issues"},homepage:"https://github.com/montagejs/montage#readme",_id:"montage@0.15.2",_shasum:"8fb604713bba8ee211e152e9f7cbc85b0fc12775",_from:"montage@>=0.15.0 <0.16.0",_npmVersion:"2.13.1",_nodeVersion:"0.12.2",_npmUser:{name:"marchant",email:"benoit@montagestudio.com"},maintainers:[{name:"kriskowal",email:"kris.kowal@cixar.com"},{name:"francoisfrisch",email:"francoisfrisch@gmail.com"},{name:"montage-bot",email:"francoisfrisch@gmail.com"},{name:"marchant",email:"benoit@montagestudio.com"}],dist:{shasum:"8fb604713bba8ee211e152e9f7cbc85b0fc12775",tarball:"http://registry.npmjs.org/montage/-/montage-0.15.2.tgz"},directories:{},_resolved:"https://registry.npmjs.org/montage/-/montage-0.15.2.tgz",redirects:{montage:"core/core"},mappings:{mr:{name:"mr",hash:"3eaf1f5",location:"../mr@3eaf1f5/"},q:{name:"q",hash:"d2f6328",location:"../q@d2f6328/"},collections:{name:"collections",hash:"e3ee536",location:"../collections@e3ee536/"},frb:{name:"frb",hash:"cab98f5",location:"../frb@cab98f5/"},htmlparser2:{name:"htmlparser2",hash:"4038d19",location:"../htmlparser2@4038d19/"},mousse:{name:"mousse",hash:"4054049",location:"../mousse@4054049/"},"q-io":{name:"q-io",hash:"748f581",location:"../q-io@748f581/"}},hash:"d41c331",production:!0,useScriptInjection:!0}}),montageDefine("4054049","package.json",{exports:{name:"mousse",version:"0.3.1",description:"Deserialization of JavaScript objects",keywords:["deserialization","serialization"],author:{name:"António Afonso",email:"antonio.afonso@gmail.com",url:"http://github.com/aadsm/"},contributors:[{name:"António Afonso",email:"antonio.afonso@gmail.com",url:"http://github.com/aadsm/"}],bugs:{url:"http://github.com/montagejs/mousse/issues"},licenses:[{type:"BSD",url:"http://github.com/montagejs/mousse/raw/master/LICENSE.md"}],repository:{type:"git",url:"git+ssh://git@github.com/montagejs/mousse.git"},main:"mousse",dependencies:{q:"1.0.0",collections:"~1.2.1"},devDependencies:{"jasmine-node":"~1.9.1"},scripts:{test:"jasmine-node spec"},gitHead:"5d15aa142b073efd1429eccb2ffc7671031da9af",homepage:"https://github.com/montagejs/mousse",_id:"mousse@0.3.1",_shasum:"d07ab730589a0564ac2696b6c2f54b657818fbb4",_from:"mousse@>=0.3.0 <0.4.0",_npmVersion:"1.4.28",_npmUser:{name:"marchant",email:"benoit@montagestudio.com"},maintainers:[{name:"stuk",email:"stuart@stuartk.com"},{name:"aadsm",email:"antonio.afonso@gmail.com"},{name:"montage-bot",email:"francoisfrisch@gmail.com"},{name:"marchant",email:"benoit@montagestudio.com"}],dist:{shasum:"d07ab730589a0564ac2696b6c2f54b657818fbb4",tarball:"http://registry.npmjs.org/mousse/-/mousse-0.3.1.tgz"},directories:{},_resolved:"https://registry.npmjs.org/mousse/-/mousse-0.3.1.tgz",hash:"4054049",mappings:{q:{name:"q",hash:"d2f6328",location:"../q@d2f6328/"},collections:{name:"collections",hash:"e3ee536",location:"../collections@e3ee536/"}},production:!0,useScriptInjection:!0}}),montageDefine("e3ee536","package.json",{exports:{name:"collections",version:"1.2.4",description:"data structures with idiomatic JavaScript collection interfaces",homepage:"http://www.collectionsjs.com",author:{name:"Kris Kowal",email:"kris@cixar.com",url:"http://github.com/kriskowal"},keywords:["collections","data structures","observable","list","set","map","splay"],bugs:{url:"http://github.com/montagejs/collections/issues"},licenses:[{type:"MIT",url:"https://raw.github.com/montagejs/collections/master/LICENSE.md"}],repository:{type:"git",url:"git+ssh://git@github.com/montagejs/collections.git"},dependencies:{"weak-map":"~1.0.x"},devDependencies:{"jasmine-node":"~1.14.x",istanbul:"*",opener:"*"},scripts:{test:"jasmine-node spec",cover:"istanbul cover node_modules/jasmine-node/bin/jasmine-node spec && istanbul report html && opener coverage/index.html"},gitHead:"83daf11ace4df30c192632fbf8f14e1a897fc818",_id:"collections@1.2.4",_shasum:"3e2f1645ed43d7cf1fe248406001faab42e7e463",_from:"collections@>=1.2.2 <1.3.0",_npmVersion:"2.13.1",_nodeVersion:"0.12.2",_npmUser:{name:"marchant",email:"benoit@montagestudio.com"},maintainers:[{name:"kriskowal",email:"kris.kowal@cixar.com"},{name:"aadsm",email:"antonio.afonso@gmail.com"},{name:"francoisfrisch",email:"francoisfrisch@gmail.com"},{name:"marchant",email:"benoit@montagestudio.com"},{name:"stuk",email:"stuart@stuartk.com"}],dist:{shasum:"3e2f1645ed43d7cf1fe248406001faab42e7e463",tarball:"http://registry.npmjs.org/collections/-/collections-1.2.4.tgz"},directories:{},_resolved:"https://registry.npmjs.org/collections/-/collections-1.2.4.tgz",hash:"e3ee536",mappings:{"weak-map":{name:"weak-map",hash:"da18248",location:"../weak-map@da18248/"}},production:!0,useScriptInjection:!0}}),montageDefine("cab98f5","package.json",{exports:{name:"frb",version:"0.2.19",description:"Functional reactive bindings",keywords:["functional","reactive","bindings","observe","change"],author:{name:"Kris Kowal",email:"kris@cixar.com",url:"http://github.com/kriskowal/"},contributors:[{name:"Kris Kowal",email:"kris@cixar.com",url:"http://github.com/kriskowal/"}],bugs:{url:"http://github.com/kriskowal/frb/issues"},licenses:[{type:"MIT",url:"http://github.com/kriskowal/frb/raw/master/LICENSE.md"}],repository:{type:"git",url:"git+ssh://git@github.com/kriskowal/frb.git"},main:"bindings",dependencies:{collections:"^1.2.1"},devDependencies:{"jasmine-node":">=1.13.1 <1.14.0",pegjs:"git://github.com/dmajda/pegjs.git",memwatch:"*"},scripts:{test:"jasmine-node spec","build-parser":"pegjs --allowed-start-rules expression,sheet grammar.pegjs"},readmeFilename:"README.md",homepage:"https://github.com/kriskowal/frb",_id:"frb@0.2.19",_from:"frb@>=0.2.18 <0.3.0",hash:"cab98f5",mappings:{collections:{name:"collections",hash:"e3ee536",location:"../collections@e3ee536/"}},production:!0,useScriptInjection:!0}}),montageDefine("d2f6328","package.json",{exports:{name:"q",version:"1.0.1",description:"A library for promises (CommonJS/Promises/A,B,D)",homepage:"https://github.com/kriskowal/q",author:{name:"Kris Kowal",email:"kris@cixar.com",url:"https://github.com/kriskowal"},keywords:["q","promise","promises","promises-a","promises-aplus","deferred","future","async","flow control","fluent","browser","node"],contributors:[{name:"Kris Kowal",email:"kris@cixar.com",url:"https://github.com/kriskowal"},{name:"Irakli Gozalishvili",email:"rfobic@gmail.com",url:"http://jeditoolkit.com"},{name:"Domenic Denicola",email:"domenic@domenicdenicola.com",url:"http://domenicdenicola.com"}],bugs:{url:"http://github.com/kriskowal/q/issues"},license:{type:"MIT",url:"http://github.com/kriskowal/q/raw/master/LICENSE"},main:"q.js",repository:{type:"git",url:"git://github.com/kriskowal/q.git"},engines:{node:">=0.6.0",teleport:">=0.2.0"},dependencies:{},devDependencies:{jshint:"~2.1.9",cover:"*","jasmine-node":"1.11.0",opener:"*","promises-aplus-tests":"1.x",grunt:"~0.4.1","grunt-cli":"~0.1.9","grunt-contrib-uglify":"~0.2.2",matcha:"~0.2.0"},scripts:{test:"jasmine-node spec && promises-aplus-tests spec/aplus-adapter","test-browser":"opener spec/q-spec.html",benchmark:"matcha",lint:"jshint q.js",cover:"cover run node_modules/jasmine-node/bin/jasmine-node spec && cover report html && opener cover_html/index.html",minify:"grunt",prepublish:"grunt"},directories:{test:"./spec"},readmeFilename:"README.md",_id:"q@1.0.1",_shasum:"11872aeedee89268110b10a718448ffb10112a14",_from:"q@>=1.0.0 <1.1.0",_resolved:"https://registry.npmjs.org/q/-/q-1.0.1.tgz",hash:"d2f6328",mappings:{},production:!0,useScriptInjection:!0}}),montageDefine("da18248","package.json",{exports:{name:"weak-map",version:"1.0.5",description:"A WeakMap shim for Node.js and browsers",main:"weak-map.js",repository:{type:"git",url:"git://github.com/drses/weak-map.git"},keywords:["weakmap","weak-map","weak","map","collections","es6"],author:{name:"Mark Miller",email:"erights@gmail.com"},maintainer:"Kris Kowal <kris@cixar.com>",license:"Apache 2.0",bugs:{url:"https://github.com/drses/weak-map/issues"},files:["weak-map.js"],scripts:{test:"npm run test:native; npm run test:shim","test:phantom":"","test:shim":"node test/index.js","test:native":"node --harmony_collections test/index.js"},devDependencies:{jasminum:"^2.0.1"},homepage:"https://github.com/drses/weak-map",_id:"weak-map@1.0.5",dist:{shasum:"79691584d98607f5070bd3b70a40e6bb22e401eb",tarball:"http://registry.npmjs.org/weak-map/-/weak-map-1.0.5.tgz"},_from:"weak-map@>=1.0.0 <1.1.0",_npmVersion:"1.4.3",_npmUser:{name:"kriskowal",email:"kris.kowal@cixar.com"},maintainers:[{name:"kriskowal",email:"kris.kowal@cixar.com"}],directories:{},_shasum:"79691584d98607f5070bd3b70a40e6bb22e401eb",_resolved:"https://registry.npmjs.org/weak-map/-/weak-map-1.0.5.tgz",hash:"da18248",mappings:{},production:!0,useScriptInjection:!0}}),montageDefine("47be41b","02buoy.html",{text:'<!DOCTYPE html><html><head>\n    <meta charset=utf-8>\n    <title>MontageJS Application</title>\n\n    <script src=packages/montage@d41c331/montage.js async=""></script>\n    <script type=text/montage-serialization>{"owner":{"prototype":"montage/ui/loader.reel","properties":{"mainModule":"ui/buoy.reel","mainName":"Buoy"}}}</script>\n</head>\n<body>\n    <span class=loading></span>\n\n\n</body></html>'}),montageDefine("d41c331","core/core",{dependencies:["collections/shim","./shim/object","./shim/array","./shim/string","./extras/object","./extras/date","./extras/element","./extras/function","./extras/regexp","./extras/string","./deprecate","./uuid","collections/listen/property-changes","frb","collections/weak-map","collections/map","frb/parse","frb/evaluate","frb/assign","frb/bind","frb/compile-observer","frb/scope","frb/observers","./serialization/bindings","./promise"],factory:function(e,t){function i(e,t){var a=u+t+s;return e.hasOwnProperty(a)?e[a]:Object.defineProperty(e,a,{enumerable:!1,configurable:!1,writable:!0,value:Object.create(i(Object.getPrototypeOf(e),t))})[a]}e("collections/shim"),e("./shim/object"),e("./shim/array"),e("./shim/string"),e("./extras/object"),e("./extras/date"),e("./extras/element"),e("./extras/function"),e("./extras/regexp"),e("./extras/string");var a=e("./deprecate"),s="AttributeProperties",u="_",n="__proto__",r="value",l="enumerable",o="distinct",c="serializable",m=Array.prototype,d=Object.prototype,p=!0,v=t.Montage=function v(){};v.deprecate=a.deprecateMethod(v,a.deprecateMethod,"Montage.deprecate","deprecate module's deprecateMethod"),v.callDeprecatedFunction=a.deprecateMethod(v,a.callDeprecatedFunction,"Montage.callDeprecatedFunction","deprecate module's callDeprecatedFunction");var h={}.__proto__===Object.prototype,g={_montage_metadata:1,__state__:1},f=Object.getOwnPropertyNames(Function);if(Object.defineProperty(v,"specialize",{value:function(e,t){var i,s,u,n,r,l,o,c=this,m=void 0===this.specialize;if(e=e||Object.empty,t=t||Object.empty,i=e.constructor&&e.constructor.value?e.constructor.value:e.didCreate&&e.didCreate.value?v.deprecate(null,e.didCreate.value,"didCreate","constructor"):function(){return this.superForValue("constructor")()||this},h)i.__proto__=c;else{u=Object.getOwnPropertyNames(c);for(var l=0;u.length>l;l++)n=u[l],g.hasOwnProperty(n)||(r=Object.getOwnPropertyDescriptor(i,n),(!r||r.configurable)&&v.defineProperty(i,n,Object.getOwnPropertyDescriptor(c,n)));i.__constructorProto__=c,v.defineProperty(i,"isPrototypeOf",{value:function(e){for(;null!==e;){if(Object.getPrototypeOf(e)===this)return!0;e=Object.getPrototypeOf(e)}return!1},enumerable:!1})}if(s=Object.create(this.prototype),m){for(u=Object.getOwnPropertyNames(v),l=0;u.length>l;l++)n=u[l],r=Object.getOwnPropertyDescriptor(i,n),(!r||r.configurable)&&v.defineProperty(i,n,Object.getOwnPropertyDescriptor(v,n));for(u=Object.getOwnPropertyNames(v.prototype),l=0;u.length>l;l++)n=u[l],r=Object.getOwnPropertyDescriptor(i,n),(!r||r.configurable)&&v.defineProperty(s,n,Object.getOwnPropertyDescriptor(v.prototype,n))}if(v.defineProperties(s,e),p){o=function(e,t,i){function s(){return this===t&&a.deprecationWarning(v.getInfoForObject(t).objectName+"."+i+" should be moved to constructorProperties",null,3),e.apply(this,arguments)}return s.deprecatedFunction=e,s};for(n in e)f.has(n)?delete e[n]:(r=e[n],r.value&&"function"==typeof r.value&&!r.value.__isConstructor__?r.value=o(r.value,i,n):(r.get&&(r.get=o(r.get,i,n)),r.set&&(r.set=o(r.set,i,n))));v.defineProperties(i,e),v.defineProperty(i,"create",{value:function(){return new i},enumerable:!1})}return v.defineProperties(i,t),v.defineProperty(i,"__isConstructor__",{value:!0,enumerable:!1}),v.defineProperty(i,"_superCache",{value:{},enumerable:!1}),i.prototype=s,v.defineProperty(s,"constructor",{value:i,enumerable:!1}),i},writable:!0,configurable:!0,enumerable:!1}),!h){var b=Object.getPrototypeOf;Object.getPrototypeOf=function(e){return"function"==typeof e&&e.__constructorProto__?e.__constructorProto__:b.apply(Object,arguments)}}Object.defineProperty(v,"create",{configurable:!0,value:function(e,t){if(a.deprecationWarning("Montage.create()","Montage.specialize() or new Component()"),void 0!==e&&"object"!=typeof e&&"function"!=typeof e)throw new TypeError("Object prototype may only be an Object or null, not '"+e+"'");if(e=void 0===e?this:e,"function"==typeof e)return t?e.specialize(t):new e;var i=Object.create(e);return t&&v.defineProperties(i,t),i}});var q=[c];q.forEach(function(e){Object.defineProperty(Object.prototype,u+e+s,{enumerable:!1,configurable:!1,writable:!0,value:{}})}),Object.defineProperty(v,"defineProperty",{value:function(e,t,a){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError("Object must be an object, not '"+e+"'");var s=r in a;if(o in a&&!s)throw new TypeError("Cannot use distinct attribute on non-value property '"+t+"'");if(n in a)a.__proto__=s?"function"==typeof a.value?S:y:_;else{var p;p=s?"function"==typeof a.value?S:y:_;for(var v in p)v in a||(a[v]=p[v])}if(a.hasOwnProperty(l)||t.charAt(0)!==u||(a.enumerable=!1),a.hasOwnProperty(c)||(a.enumerable?a.get&&!a.set?a.serializable=!1:a.writable===!1&&(a.serializable=!1):a.serializable=!1),c in a&&(i(e,c)[t]=a.serializable),a.distinct!==!0||"object"!=typeof a.value){var h,g,f;if(e._superDependencies){if("function"==typeof a.value&&(h=e._superDependencies[t+".value"]))for(g=0,f=h.length;f>g;g++)delete h[g]._superCache[t+".value"];if("function"==typeof a.get&&(h=e._superDependencies[t+".get"]))for(g=0,f=h.length;f>g;g++)delete h[g]._superCache[t+".get"];if("function"==typeof a.set&&(h=e._superDependencies[t+".set"]))for(g=0,f=h.length;f>g;g++)delete h[g]._superCache[t+".set"]}return Object.defineProperty(e,t,a)}(function(e,t,i,a){var s=function(e,t,i){Object.defineProperty(e,t,{enumerable:!1,configurable:!0,writable:!0,value:i})};i.constructor===Object&&Object.getPrototypeOf(i)===d?0!==Object.keys(i).length?Object.defineProperty(a,e,{configurable:!0,get:function(){var e=this[t];if(!e){var a;e={};for(a in i)e[a]=i[a];this.hasOwnProperty(t)?this[t]=e:s(this,t,e)}return e},set:function(e){this.hasOwnProperty(t)?this[t]=e:s(this,t,e)}}):Object.defineProperty(a,e,{configurable:!0,get:function(){var e=this[t];return e||(e={},this.hasOwnProperty(t)?this[t]=e:s(this,t,e)),e},set:function(e){this.hasOwnProperty(t)?this[t]=e:s(this,t,e)}}):(i.__proto__||Object.getPrototypeOf(i))===m?0!==i.length?Object.defineProperty(a,e,{configurable:!0,get:function(){var e=this[t];if(!e){var a,u;for(e=[],a=0;void 0!==(u=i[a]);a++)e[a]=u;this.hasOwnProperty(t)?this[t]=e:s(this,t,e)}return e},set:function(e){this.hasOwnProperty(t)?this[t]=e:s(this,t,e)}}):Object.defineProperty(a,e,{configurable:!0,get:function(){var e=this[t];return e||(e=[],this.hasOwnProperty(t)?this[t]=e:s(this,t,e)),e},set:function(e){this.hasOwnProperty(t)?this[t]=e:s(this,t,e)}}):i.constructor.prototype===Object.getPrototypeOf(i)?Object.defineProperty(a,e,{configurable:!0,get:function(){var e=this[t];if(!e){var a;e=new i.constructor;for(a in i)e[a]=i[a];this.hasOwnProperty(t)?this[t]=e:s(this,t,e)}return e},set:function(e){this.hasOwnProperty(t)?this[t]=e:s(this,t,e)}}):Object.defineProperty(a,e,{configurable:!0,get:function(){var e=this[t];return e||(e=Object.create(i.__proto__||Object.getPrototypeOf(i)),this.hasOwnProperty(t)?this[t]=e:s(this,t,e)),e},set:function(e){this.hasOwnProperty(t)?this[t]=e:s(this,t,e)}})})(t,u+t,a.value,e)}}),Object.defineProperty(v,"defineProperties",{value:function(e,t){if("object"!=typeof t||null===t)throw new TypeError("Properties must be an object, not '"+t+"'");for(var i in t)"_bindingDescriptors"!==i&&this.defineProperty(e,i,t[i]);return e}});var _={enumerable:!0,configurable:!0,serializable:!0},y={writable:!0,enumerable:!0,configurable:!0,serializable:"reference"},S={writable:!0,enumerable:!1,configurable:!0,serializable:!1};v.defineProperty(v,"didCreate",{value:Function.noop});var P=function(e,t){var i,a,s,u,n,r,l,o,c;if(!t._superPropertyName||!t._superPropertyType)for(v.defineProperty(t,"_superPropertyType",{value:null}),v.defineProperty(t,"_superPropertyName",{value:null}),l=e;!o&&null!==l;){for(i=Object.getOwnPropertyNames(l),a=Object.getPrototypeOf(l),s=0,u=i.length,s;u>s;s++){if(n=i[s],c=Object.getOwnPropertyDescriptor(l,n),null!=(r=c.value)&&(r===t||r.deprecatedFunction===t)){t._superPropertyType="value",t._superPropertyName=n,o=!0;break}if(null!=(r=c.get)&&(r===t||r.deprecatedFunction===t)){t._superPropertyType="get",t._superPropertyName=n,o=!0;break}if(null!=(r=c.set)&&(r===t||r.deprecatedFunction===t)){t._superPropertyType="set",t._superPropertyName=n,o=!0;break}}l=a}return D(e,t._superPropertyType,t._superPropertyName,t)},C=function(){if("function"!=typeof C.caller)throw new TypeError("Can't get super without caller. Use this.superForValue(methodName) if using strict mode.");var e=P(this,C.caller);return"function"==typeof e?e.bind(this):Function.noop};v.defineProperty(v,"_superContext",{value:null});var D=function(e,t,i,a){var s,u,n,r,l,o=e,c=i+"."+t;if(e._superContext||(e._superContext={}),e._superContext[c])o=e._superContext[c];else for(o=e;null!==o&&(!o.hasOwnProperty(i)||(n=Object.getOwnPropertyDescriptor(o,i),"function"!=typeof n[t]));)o=Object.getPrototypeOf(o);if(r=o.constructor,r._superCache&&r._superCache[c])return l=function(e,t,i,a){return function(){t._superContext[e]=i;var s=a.apply(t,arguments);return delete t._superContext[e],s}}(c,e,r._superCache[c].owner,r._superCache[c].func);for(u=o;void 0===s&&(u=Object.getPrototypeOf(u));)if(u._superDependencies||v.defineProperty(u,"_superDependencies",{value:{}}),u._superDependencies[c]||(u._superDependencies[c]=[]),u._superDependencies[c].push(r),n=Object.getOwnPropertyDescriptor(u,i)){if("function"==typeof n[t]&&n[t]!==a){s=n[t];break}break}return"function"==typeof s?(l=function(e,t,i,a){return function(){t._superContext[e]=i;var s=a.apply(t,arguments);return delete t._superContext[e],s}}(c,e,u,s),r._superCache||v.defineProperty(r,"_superCache",{value:{}}),r._superCache[c]={func:s,owner:u},l):Function.noop},N=function(e){return D(this,"value",e,N.caller)},E=function(e){return D(this,"get",e,E.caller)},M=function(e){return D(this,"set",e,M.caller)};v.defineProperty(v,"super",{get:C,enumerable:!1}),v.defineProperty(v.prototype,"super",{get:C,enumerable:!1}),v.defineProperty(v,"superForValue",{value:N,enumerable:!1}),v.defineProperty(v.prototype,"superForValue",{value:N,enumerable:!1}),v.defineProperty(v,"superForGet",{value:E,enumerable:!1}),v.defineProperty(v.prototype,"superForGet",{value:E,enumerable:!1}),v.defineProperty(v,"superForSet",{value:M,enumerable:!1}),v.defineProperty(v.prototype,"superForSet",{value:M,enumerable:!1}),v.defineProperty(v,"getSerializablePropertyNames",{value:function(e){var t=[],i=e._serializableAttributeProperties;if(i)for(var a in i)i[a]&&t.push(a);return t}}),v.defineProperty(v,"getPropertyAttribute",{value:function(e,t,i){var a=u+i+s,n=e[a];return n?n[t]:void 0}}),v.defineProperty(v,"getPropertyAttributes",{value:function(e,t){var i={},a=u+t+s,n=e[a];if(n){for(var r in n)i[r]=n[r];return i}}});var w={isInstance:{value:!0}},A={objectName:{value:"Function"},isInstance:{value:!0}};v.defineProperty(v,"getInfoForObject",{value:function(e){var t,i;if(I.call(e,"_montage_metadata"))return e._montage_metadata;if(t=e._montage_metadata||e.constructor&&e.constructor._montage_metadata||null,i=e.constructor===Function?A:w,e===Object.prototype)return Object.create(t,i);try{return Object.defineProperty(e,"_montage_metadata",{enumerable:!1,writable:!0,value:Object.create(t,i)})._montage_metadata}catch(a){return e._montage_metadata=Object.create(t,i)}}});var x=e("./uuid");"undefined"!=typeof window&&(window.uuid=x.generate());var I=Object.prototype.hasOwnProperty,T=function(){var e=x.generate(),t=v.getInfoForObject(this);try{null!==t&&t.isInstance===!1?(this._uuid=e,Object.defineProperty(this,"uuid",{get:function(){return this.hasOwnProperty("uuid")?this._uuid:T.call(this)}})):(t.isInstance&&Object.defineProperty(this,"uuid",{configurable:!0,enumerable:!1,writable:!1,value:e}),!(this instanceof Element)&&t.isInstance&&r in(Object.getOwnPropertyDescriptor(this,"uuid")||{})&&n in this||(this._uuid=e))}catch(i){}return this._uuid=e,e},L=function L(){return I.call(this,"_uuid")?this._uuid:T.call(this)};Object.defineProperty(Object.prototype,"_uuid",{enumerable:!1,value:null,writable:!0}),Object.defineProperty(Object.prototype,"uuid",{configurable:!0,get:L,set:function(){}}),v.defineProperty(v,"identifier",{value:null,serializable:!0}),v.defineProperty(v.prototype,"identifier",{value:null,serializable:!0}),v.defineProperty(v.prototype,"equals",{value:function(e){return e?this===e||this.uuid===e.uuid:!1}}),v.defineProperty(v,"equals",{value:v.prototype.equals}),v.defineProperty(v.prototype,"callDelegateMethod",{value:function(e){var t,i,a=this.delegate;return"string"==typeof this.identifier&&(t=this.identifier+e.toCapitalized(),a&&"function"==typeof(i=a[t]))?(m.shift.call(arguments),i.apply(a,arguments)):a&&"function"==typeof(i=a[e])?(m.shift.call(arguments),i.apply(a,arguments)):void 0}});var j=e("collections/listen/property-changes");Object.addEach(v,j.prototype),Object.addEach(v.prototype,j.prototype);var O=t.Bindings=e("frb"),V={defineBinding:{value:function(e,t,i){return O.defineBinding(this,e,t,i)}},defineBindings:{value:function(e,t){return O.defineBindings(this,e,t)}},cancelBinding:{value:function(e){return O.cancelBinding(this,e)}},cancelBindings:{value:function(){return O.cancelBindings(this)}},getBinding:{value:function(e){return O.getBinding(this,e)}},getBindings:{value:function(){return O.getBindings(this)}}};v.defineProperties(v,V),v.defineProperties(v.prototype,V);var F=e("collections/weak-map"),R=e("collections/map"),k=e("frb/parse"),z=e("frb/evaluate"),U=e("frb/assign");e("frb/bind");var B=e("frb/compile-observer"),Q=e("frb/scope"),G=e("frb/observers"),W=G.autoCancelPrevious,H=new F,X={getPath:{value:function(e,t,i,a){return z(e,this,t||this,i,a)}},setPath:{value:function(e,t,i,a,s){return U(this,e,t,i||this,a,s)}},observePath:{value:function(e,t){var i=k(e),a=B(i);return a(W(t),new Q(this))}},addRangeAtPathChangeListener:{value:function(e,t,i,a,s,u){function n(e,a,s){if(t[i])t[i](e,a,s);else{if(!t.call)throw Error("Can't dispatch range change to "+t);t.call(null,e,a,s)}}i=i||"handleRangeChange";var r=[];return this.addPathChangeListener(e,function(e){return e&&e.toArray&&e.addRangeChangeListener?(n(e.toArray(),r.toArray(),0),r=e,e.addRangeChangeListener(n)):(e=[],n(e,r,0),r=e,void 0)},void 0,void 0,a,s,u)}},getPathChangeDescriptors:{value:function(){return H.has(this)||H.set(this,{}),H.get(this)}},getPathChangeDescriptor:{value:function(e,t,i){var a=v.getPathChangeDescriptors.call(this);return Object.owns(a,e)||(a[e]={willChangeListeners:new R,changeListeners:new R}),a=a[e],a=i?a.willChangeListeners:a.changeListeners,a.has(t)||a.set(t,{path:e,handler:t,beforeChange:i,cancel:Function.noop}),a.get(t)}},addPathChangeListener:{value:function(e,t,i,a,s,u,n){var r=this;t=t||Function.noop;var l=v.getPathChangeDescriptor.call(this,e,t,a);l.cancel();var o,c,m,d=k(e);if(t===Function.noop)m=function(t){if(c)throw Error("Path change handler needs a handler because it emits new values when the source changes: "+JSON.stringify(e));c=!0,o=t};else if(i)m=function(a){return t[i].call(t,a,e,r)};else if(t.handlePathChange)m=function(i){return t.handlePathChange.call(t,i,e,r)};else{if("function"!=typeof t)throw Error("Can't recognize handler type: "+t+". Must be function or delegate implementing handlePathChange.");m=function(i){return t.call(r,i,e,r)}}var p=B(d),h=new Q(this);h.beforeChange=a,h.parameters=s,h.document=u,h.components=n;var g=p(W(m),h);return l.cancel=g,c?o:g}},removePathChangeListener:{value:function(e,t,i){t=t||Function.noop;var a=v.getPathChangeDescriptors.call(this),s=i?"willChangeListeners":"changeListeners";if(!Object.owns(a,e))throw Error("Can't find "+s+" for "+JSON.stringify(e));var u=a[e],n=u[s];if(!n.has(t))throw Error("Can't find "+s+" for "+JSON.stringify(e));var r=n.get(t);r.cancel(),n["delete"](t),0===u.willChangeListeners.length&&0===u.changeListeners.length&&delete a[e];for(var l in a)return;H["delete"](this)}},addBeforePathChangeListener:{value:function(e,t,i,a,s,u){return v.addPathChangeListener.call(this,e,t,i,!0,a,s,u)}},removeBeforePathChangeListener:{value:function(e,t){return v.removePathChangeListener.call(this,e,t,!0)}}};v.defineProperties(v,X),v.defineProperties(v.prototype,X),e("./serialization/bindings"),t._blueprintModuleIdDescriptor={serializable:!1,enumerable:!1,get:function(){var e=v.getInfoForObject(this),t=e&&!e.isInstance?this:this.constructor;if(!Object.getOwnPropertyDescriptor(t,"_blueprintModuleId")||!t._blueprintModuleId){e=v.getInfoForObject(t);var i=e.moduleId,a=i.lastIndexOf("/"),s=i.lastIndexOf(".");a=-1===a?0:a+1,s=-1===s?i.length:s,s=a>s?i.length:s,v.defineProperty(t,"_blueprintModuleId",{enumerable:!1,value:i.slice(0,s)+".meta"})}return t._blueprintModuleId}},t._blueprintDescriptor={serializable:!1,enumerable:!1,get:function(){var i=v.getInfoForObject(this),a=i&&!i.isInstance?this:this.constructor;if(!Object.getOwnPropertyDescriptor(a,"_blueprint")||!a._blueprint){var s=a.blueprintModuleId;if(""===s)throw new TypeError("Blueprint moduleId undefined for the module '"+JSON.stringify(a)+"'");t._blueprintDescriptor.BlueprintModulePromise||(t._blueprintDescriptor.BlueprintModulePromise=e.async("core/meta/module-blueprint").get("ModuleBlueprint")),v.defineProperty(a,"_blueprint",{enumerable:!1,value:t._blueprintDescriptor.BlueprintModulePromise.then(function(e){var t=v.getInfoForObject(a);return e.getBlueprintWithModuleId(s,t.require).fail(function(t){if(-1!==t.message.indexOf("Can't XHR"))return e.createDefaultBlueprintForObject(a).then(function(e){return e});throw t})})})}return a._blueprint},set:function(t){var i,a=v.getInfoForObject(this),s=a&&!a.isInstance?this:this.constructor;if(null===t)i=null;else{if("function"==typeof t.then)throw new TypeError("Object blueprint should not be a promise");t.blueprintInstanceModule=s.blueprintModule,i=e("./promise").Promise.resolve(t)}v.defineProperty(s,"_blueprint",{enumerable:!1,value:i})}}}}),montageDefine("d41c331","core/event/event-manager",{dependencies:["../core","../uuid","./mutable-event","core/serialization/serializer/montage-serializer","core/serialization/deserializer/montage-deserializer"],factory:function(e,t){var i,a=e("../core").Montage,s=e("../uuid"),u=e("./mutable-event").MutableEvent,n=e("core/serialization/serializer/montage-serializer").MontageSerializer,r=e("core/serialization/deserializer/montage-deserializer").MontageDeserializer;if("undefined"!=typeof window){void 0===window.Touch&&"ontouchstart"in window&&(window.Touch=function(){},function(){var e;document.addEventListener("touchstart",e=function(t){window.Touch=t.touches[0].constructor,document.nativeRemoveEventListener?document.nativeRemoveEventListener("touchstart",e,!0):document.removeEventListener("touchstart",e,!0),i&&i.isStoringPointerEvents&&(i.isStoringPointerEvents=!1,i.isStoringPointerEvents=!0)
},!0)}());var l=a.specialize({constructor:{value:function(e){return this.data=Array(32),this.velocity={velocity:(new c).initWithIdentifier(e)},this}},data:{enumerable:!1,writable:!0,value:null},size:{enumerable:!1,writable:!0,value:0},pos:{enumerable:!1,writable:!0,value:0},velocity:{enumerable:!1,writable:!0,value:0}}),o=a.specialize({constructor:{value:function(e,t,i){return this.clientX=e,this.clientY=t,this.timeStamp=i,this}},clientX:{enumerable:!1,writable:!0,value:null},clientY:{enumerable:!1,writable:!0,value:0},timeStamp:{enumerable:!1,writable:!0,value:0}});a.specialize({memory:{value:{}},add:{value:function(e,t,i,a){var s;(s=this.memory[e])||(s=this.memory[e]=new l(e)),(data=s.data[s.pos])?(data.clientX=t,data.clientY=i,data.timeStamp=a):data=s.data[s.pos]=new o(t,i,a),s.size<s.data.length&&s.size++,s.pos=(s.pos+1)%s.data.length}},remove:{value:function(e){delete this.memory[e]}},clear:{value:function(e){this.memory[e]&&(this.memory[e].size=0,this.memory[e].velocity.velocity.clearCache())}},getMemory:{value:function(e){return this.memory[e]}},isStored:{value:function(e){return this.memory[e]&&this.memory[e].size>0}},pointerVelocity:{value:function(e){return this.memory[e]?this.memory[e].velocity:void 0}},storeEvent:{value:function(e){var t;switch(e.type){case"mousedown":i._isMouseDragging=!0;case"mousemove":i._isStoringMouseEventsWhileDraggingOnly?i._isMouseDragging&&(this.add("mouse",e.clientX,e.clientY,e.timeStamp),Object.defineProperty(e,"velocity",{get:function(){return i.pointerMotion("mouse").velocity},set:function(){}})):(this.add("mouse",e.clientX,e.clientY,e.timeStamp),Object.defineProperty(e,"velocity",{get:function(){return i.pointerMotion("mouse").velocity},set:function(){}}));break;case"mouseup":this.add("mouse",e.clientX,e.clientY,e.timeStamp),Object.defineProperty(e,"velocity",{get:function(){return i.pointerMotion("mouse").velocity},set:function(){}});break;case"touchstart":case"touchmove":for(t=0;e.touches.length>t;t++)this.add(e.touches[t].identifier,e.touches[t].clientX,e.touches[t].clientY,e.timeStamp);break;case"touchend":for(t=0;e.changedTouches.length>t;t++)this.add(e.changedTouches[t].identifier,e.changedTouches[t].clientX,e.changedTouches[t].clientY,e.timeStamp)}}},removeEvent:{value:function(e){var t;switch(e.type){case"mouseup":i._isMouseDragging=!1,i._isStoringMouseEventsWhileDraggingOnly&&this.clear("mouse");break;case"touchend":for(t=0;e.changedTouches.length>t;t++)this.remove(e.changedTouches[t].identifier)}}}});var c=a.specialize({_identifier:{enumerable:!1,writable:!0,value:null},initWithIdentifier:{value:function(e){return this._identifier=e,this}},clearCache:{value:function(){return this._data=this._x=this._y=this._speed=this._angle=null,this}},_data:{enumerable:!1,writable:!0,value:null},_x:{enumerable:!1,writable:!0,value:null},_y:{enumerable:!1,writable:!0,value:null},_speed:{enumerable:!1,writable:!0,value:null},_angle:{enumerable:!1,writable:!0,value:null},x:{get:function(){return null===this._x&&(null===this._data&&(this._data=i._getPointerVelocityData(this._identifier)),this._x=i._calculatePointerVelocity(this._data.time,this._data.x)),this._x},set:function(){}},y:{get:function(){return null===this._y&&(null===this._data&&(this._data=i._getPointerVelocityData(this._identifier)),this._y=i._calculatePointerVelocity(this._data.time,this._data.y)),this._y},set:function(){}},speed:{get:function(){return null===this._speed&&(this._speed=Math.sqrt(this.x*this.x+this.y*this.y)),this._speed},set:function(){}},angle:{get:function(){return null===this._angle&&(this._angle=Math.atan2(this.y,this.x)),this._angle},set:function(){}}}),m=function(){return this.listeners={},this};m._pool=[],m.checkoutRegistration=function(){return 0===this._pool.length?new this:this._pool.pop()},m.checkinRegistration=function(e){e.target=null,this._pool.push(e)},Object.defineProperties(m.prototype,{target:{enumerable:!1,writable:!0,value:null},listeners:{enumerable:!1,writable:!0,value:null}});var d=function(){return this};d._pool=[],d.checkoutRegistration=function(){return 0===this._pool.length?new this:this._pool.pop()},d.checkinRegistration=function(e){e.listener=null,this._pool.push(e)},Object.defineProperties(d.prototype,{initWithListener:{value:function(e,t,i){return this.listener=e,this.capture=t,this.bubble=i,this}},listener:{enumerable:!1,writable:!0,value:null},capture:{enumerable:!1,writable:!0,value:!0},bubble:{enumerable:!1,writable:!0,value:!1}}),n.defineSerializationUnit("listeners",function(e,t){var a,s,u,n=i,r=t.uuid,l=[];for(var o in n.registeredEventListeners)if(a=n.registeredEventListeners[o],s=a&&a[r])for(var c in s.listeners)u=s.listeners[c],l.push({type:o,listener:e.addObjectReference(u.listener),capture:u.capture});return l.length>0?l:void 0}),r.defineDeserializationUnit("listeners",function(e,t,i){for(var a,s=0;a=i[s];s++)t.addEventListener(a.type,a.listener,a.capture)});var p=Event.NONE,v=Event.CAPTURING_PHASE,h=Event.AT_TARGET,g=Event.BUBBLING_PHASE,f="function";t.EventManager=a.specialize({constructor:{value:function(){this.super(),this._trackingTouchList={touchesStart:Object.create(null),touchesEnd:Object.create(null)}}},eventDefinitions:{value:{abort:{bubbles:!1,cancelable:!1},beforeunload:{bubbles:!1},blur:{bubbles:!1,cancelable:!1},change:{bubbles:!0,cancelable:!1},click:{bubbles:!0,cancelable:!0},close:{bubbles:!1,cancelable:!1},compositionend:{bubbles:!0,cancelable:!1},compositionstart:{bubbles:!0,cancelable:!0},compositionupdate:{bubbles:!0,cancelable:!1},contextmenu:{bubbles:!0,cancelable:!0},copy:{bubbles:!0,cancelable:!0},cut:{bubbles:!0,cancelable:!0},dblclick:{bubbles:!0,cancelable:!1},DOMActivate:{bubbles:!0,cancelable:!0,deprecated:!0},DOMMouseScroll:{bubbles:!0},drag:{bubbles:!0,cancelable:!0},dragend:{bubbles:!0,cancelable:!1},dragenter:{bubbles:!0,cancelable:!0},dragleave:{bubbles:!0,cancelable:!1},dragover:{bubbles:!0,cancelable:!0},dragstart:{bubbles:!0,cancelable:!0},drop:{bubbles:!0,cancelable:!0},error:{bubbles:function(e){return!(XMLHttpRequest.prototype.isPrototypeOf(e)||e.tagName&&"VIDEO"===e.tagName.toUpperCase()||e.tagName&&"AUDIO"===e.tagName.toUpperCase())},cancelable:!1},focus:{bubbles:!1,cancelable:!1},focusin:{bubbles:!0,cancelable:!1},focusout:{bubbles:!0,cancelable:!1},input:{bubbles:!0,cancelable:!1},keydown:{bubbles:!0,cancelable:!1},keypress:{bubbles:!0,cancelable:!1},keyup:{bubbles:!0,cancelable:!1},load:{bubbles:!1,cancelable:!1},loadend:{bubbles:!1,cancelable:!1},loadstart:{bubbles:!1,cancelable:!1},message:{bubbles:!1,cancelable:!1},mousedown:{bubbles:!0,cancelable:!0},mouseenter:{bubbles:!1,cancelable:!1},mouseleave:{bubbles:!1,cancelable:!1},mousemove:{bubbles:!0,cancelable:!0},mouseout:{bubbles:!0,cancelable:!0},mouseover:{bubbles:!0,cancelable:!0},mouseup:{bubbles:!0,cancelable:!0},mousewheel:{bubbles:!0},orientationchange:{bubbles:!1},paste:{bubbles:!0,cancelable:!0},progress:{bubbles:!1,cancelable:!1},reset:{bubbles:!0,cancelable:!1},resize:{bubbles:!1,cancelable:!1},scroll:{bubbles:function(e){return!!e.defaultView},cancelable:!1},select:{bubbles:!0,cancelable:!1},submit:{bubbles:!0,cancelable:!0},touchcancel:{bubbles:!0,cancelable:!1},touchend:{bubbles:!0,cancelable:!0},touchmove:{bubbles:!0,cancelable:!0},touchstart:{bubbles:!0,cancelable:!0},unload:{bubbles:!1,cancelable:!1},wheel:{bubbles:!0,cancelable:!0},pointerdown:{bubbles:!0,cancelable:!0},pointerup:{bubbles:!0,cancelable:!0},pointerenter:{bubbles:!1,cancelable:!0},pointercancel:{bubbles:!0,cancelable:!0},pointerout:{bubbles:!0,cancelable:!0},pointerover:{bubbles:!0,cancelable:!0},pointerleave:{bubbles:!1,cancelable:!0},pointermove:{bubbles:!0,cancelable:!0},MSPointerDown:{bubbles:!0,cancelable:!0},MSPointerMove:{bubbles:!0,cancelable:!0},MSPointerUp:{bubbles:!0,cancelable:!0},MSPointerOver:{bubbles:!0,cancelable:!0},MSPointerOut:{bubbles:!0,cancelable:!0},MSPointerHover:{bubbles:!0,cancelable:!0}}},_DOMPasteboardElement:{value:null,enumerable:!1},_delegate:{value:null,enumerable:!1},delegate:{enumerable:!1,get:function(){return this._delegate},set:function(e){this._delegate=e}},_application:{value:null,enumerable:!1},application:{enumerable:!1,get:function(){return this._application},set:function(e){this._application=e}},_registeredWindows:{value:null,enumerable:!1},_windowsAwaitingFinalRegistration:{value:{},enumerable:!1},initWithWindow:{enumerable:!1,value:function(e){if(this._registeredWindows)throw"EventManager has already been initialized";return this.registerWindow(e),this}},registerWindow:{enumerable:!1,value:function(e){if(e.defaultEventManager&&e.defaultEventManager!==this)throw"EventManager cannot register a window already registered to another EventManager";if(this._registeredWindows&&this._registeredWindows.indexOf(e)>=0)throw"EventManager cannot register a window more than once";if(this._registeredWindows||(this._registeredWindows=[]),e.uuid&&0!==e.uuid.length||(e.uuid=s.generate()),this._windowsAwaitingFinalRegistration[e.uuid]!==e){if(e.Element.prototype.nativeAddEventListener=e.Element.prototype.addEventListener,Object.defineProperty(e,"nativeAddEventListener",{configurable:!0,value:e.addEventListener}),Object.getPrototypeOf(e.document).nativeAddEventListener=e.document.addEventListener,e.XMLHttpRequest.prototype.nativeAddEventListener=e.XMLHttpRequest.prototype.addEventListener,e.Worker&&(e.Worker.prototype.nativeAddEventListener=e.Worker.prototype.addEventListener),e.MediaController&&(e.MediaController.prototype.nativeAddEventListener=e.MediaController.prototype.addEventListener),e.Element.prototype.nativeRemoveEventListener=e.Element.prototype.removeEventListener,Object.defineProperty(e,"nativeRemoveEventListener",{configurable:!0,value:e.removeEventListener}),Object.getPrototypeOf(e.document).nativeRemoveEventListener=e.document.removeEventListener,e.XMLHttpRequest.prototype.nativeRemoveEventListener=e.XMLHttpRequest.prototype.removeEventListener,e.Worker&&(e.Worker.prototype.nativeRemoveEventListener=e.Worker.prototype.removeEventListener),e.MediaController&&(e.MediaController.prototype.nativeRemoveEventListener=e.MediaController.prototype.removeEventListener),Object.defineProperty(e,"addEventListener",{configurable:!0,value:e.XMLHttpRequest.prototype.addEventListener=e.Element.prototype.addEventListener=Object.getPrototypeOf(e.document).addEventListener=function(t,i,a){return e.defaultEventManager.registerEventListener(this,t,i,!!a)}}),e.Worker&&(e.Worker.prototype.addEventListener=e.addEventListener),e.MediaController&&(e.MediaController.prototype.addEventListener=e.addEventListener),Object.defineProperty(e,"removeEventListener",{configurable:!0,value:e.XMLHttpRequest.prototype.removeEventListener=e.Element.prototype.removeEventListener=Object.getPrototypeOf(e.document).removeEventListener=function(t,i,a){return e.defaultEventManager.unregisterEventListener(this,t,i,!!a)}}),e.Worker&&(e.Worker.prototype.removeEventListener=e.removeEventListener),e.MediaController&&(e.MediaController.prototype.removeEventListener=e.removeEventListener),e.HTMLDivElement.prototype.addEventListener!==e.Element.prototype.nativeAddEventListener&&e.HTMLElement&&"addEventListener"in e.HTMLElement.prototype){var u,n,r=Object.getOwnPropertyNames(e),l=0,o=r.length;for(l;o>l;l++)u=r[l],u.match(/^HTML\w*Element$/)&&"function"==typeof u&&(n=u.prototype,n.nativeAddEventListener=n.addEventListener,n.addEventListener=e.Element.prototype.addEventListener,n.nativeRemoveEventListener=n.removeEventListener,n.removeEventListener=e.Element.prototype.removeEventListener)}a.defineProperty(e.Element.prototype,"eventHandlerUUID",{value:void 0,enumerable:!1}),a.defineProperty(e.Element.prototype,"component",{get:function(){return i._elementEventHandlerByUUID[this.eventHandlerUUID]},enumerable:!1}),i=e.defaultEventManager=t.defaultEventManager=this,this._registeredWindows.push(e),this._windowsAwaitingFinalRegistration[e.uuid]=e,/loaded|complete|interactive/.test(e.document.readyState)?this._finalizeWindowRegistration(e):e.document.addEventListener("DOMContentLoaded",this,!0)}}},_finalizeWindowRegistration:{enumerable:!1,value:function(e){if(this._windowsAwaitingFinalRegistration[e.uuid]!==e)throw"EventManager wasn't expecting to register this window";delete this._windowsAwaitingFinalRegistration[e.uuid],this._listenToWindow(e)}},unregisterWindow:{enumerable:!1,value:function(e){if(0>this._registeredWindows.indexOf(e))throw"EventManager cannot unregister an unregistered window";if(this._registeredWindows=this._registeredWindows.filter(function(t){return e!==t}),delete e.defaultEventManager,e.Element.prototype.addEventListener=e.Element.prototype.nativeAddEventListener,Object.defineProperty(e,"addEventListener",{configurable:!0,value:e.nativeAddEventListener}),Object.getPrototypeOf(e.document).addEventListener=e.document.nativeAddEventListener,e.XMLHttpRequest.prototype.addEventListener=e.XMLHttpRequest.prototype.nativeAddEventListener,e.Worker&&(e.Worker.prototype.addEventListener=e.Worker.prototype.nativeAddEventListener),e.Element.prototype.removeEventListener=e.Element.prototype.nativeRemoveEventListener,Object.defineProperty(e,"removeEventListener",{configurable:!0,value:e.nativeRemoveEventListener}),Object.getPrototypeOf(e.document).removeEventListener=e.document.nativeRemoveEventListener,e.XMLHttpRequest.prototype.removeEventListener=e.XMLHttpRequest.prototype.nativeRemoveEventListener,e.Worker&&(e.Worker.prototype.removeEventListener=e.Worker.prototype.nativeRemoveEventListener),e.HTMLDivElement.prototype.nativeAddEventListener!==e.Element.prototype.addEventListener&&e.HTMLElement&&"addEventListener"in e.HTMLElement.prototype&&e.Components&&e.Components.interfaces){var t,i;for(t in Components.interfaces)t.match(/^nsIDOMHTML\w*Element$/)&&(t=t.replace(/^nsIDOM/,""),(t=window[t])&&(i=t.prototype,i.addEventListener=i.nativeAddEventListener,delete i.nativeAddEventListener,i.removeEventListener=i.nativeRemoveEventListener,delete i.nativeRemoveEventListener))}delete e.Element.prototype.nativeAddEventListener,delete e.nativeAddEventListener,delete Object.getPrototypeOf(e.document).nativeAddEventListener,delete e.XMLHttpRequest.prototype.nativeAddEventListener,e.Worker&&delete e.Worker.prototype.nativeAddEventListener,delete e.Element.prototype.nativeRemoveEventListener,delete e.nativeRemoveEventListener,delete Object.getPrototypeOf(e.document).nativeRemoveEventListener,delete e.XMLHttpRequest.prototype.nativeRemoveEventListener,e.Worker&&delete e.Worker.prototype.nativeRemoveEventListener,delete e.Element.prototype.eventHandlerUUID,delete e.Element.prototype.component,this._stopListeningToWindow(e)}},unregisterWindows:{enumerable:!1,value:function(){this._registeredWindows.forEach(this.unregisterWindow)}},registeredEventListeners:{enumerable:!1,value:{}},registeredEventListenersForEventType_:{value:function(e){var t,i,a,s,u=this.registeredEventListeners[e];if(!u)return null;s={};for(t in u){i=u[t].listeners;for(a in i)s[a]=i[a]}return s}},registeredEventListenersForEventType_onTarget_:{enumerable:!1,value:function(e,t,i){var a,s;return a=t===i?i.eventManager.registeredEventListeners[e]:this.registeredEventListeners[e],a&&t?(s=a[t.uuid],s?s.listeners:null):null}},registeredEventListenersOnTarget_:{value:function(e){var t,i,a=[];for(t in this.registeredEventListeners)i=this.registeredEventListeners[t],e.uuid in i&&a.push(i);return a}},registerEventListener:{enumerable:!1,value:function(e,t,i,a){var s,u,n,r=this.registeredEventListeners[t],l=!1,o=!1;if(void 0===e.uuid)throw Error("EventManager cannot observe a target without a uuid: "+(e.outerHTML||e));return r?((s=r[e.uuid])||((s=r[e.uuid]=m.checkoutRegistration()).target=e,l=!0),u=s.listeners[i.uuid],n=a?"capture":"bubble",u?(u[n]=!0,o=!0):(s.listeners[i.uuid]=d.checkoutRegistration().initWithListener(i,a,!a),o=!0)):(r=this.registeredEventListeners[t]={},(r[e.uuid]=m.checkoutRegistration()).target=e,r[e.uuid].listeners[i.uuid]=d.checkoutRegistration().initWithListener(i,a,!a),l=!0,o=!0),l&&"function"==typeof e.nativeAddEventListener&&this._observeTarget_forEventType_(e,t),o}},unregisterEventListener:{enumerable:!1,value:function(e,t,i,a){var s,u,n,r,l,o=this.registeredEventListeners[t];if(o&&(s=o[e.uuid])){if(u=s.listeners[i.uuid],!u){for(r in s.listeners)if(l=s.listeners[r].listener,l.originalListener&&l.originalListener.uuid===i.uuid){u=s.listeners[r],i=l;break}if(!u)return}n=a?"capture":"bubble",u[n]=!1,u.bubble||u.capture||(d.checkinRegistration(s.listeners[i.uuid]),delete s.listeners[i.uuid],0===Object.keys(s.listeners).length&&(delete o[e.uuid],m.checkinRegistration(s),0===Object.keys(o).length&&(delete this.registeredEventListeners[t],this._stopObservingTarget_forEventType_(e,t))))}}},actualDOMTargetForEventTypeOnTarget:{value:function(e,t){if(t.nativeAddEventListener){if(t.defaultView)return t;var i,a=this.eventDefinitions[e];return a?(i=typeof a.bubbles===f?a.bubbles(t):a.bubbles,i?t.screen?t.document:t.ownerDocument:t):t}return null}},_observedTarget_byEventType_:{value:{}},_observeTarget_forEventType_:{enumerable:!1,value:function(e,t){var i;!(i=this.actualDOMTargetForEventTypeOnTarget(t,e))||this._observedTarget_byEventType_[t]&&this._observedTarget_byEventType_[t][i.uuid]||(this._observedTarget_byEventType_[t]||(this._observedTarget_byEventType_[t]={}),this._observedTarget_byEventType_[t][i.uuid]=this,i.nativeAddEventListener(t,this,!0))}},_stopObservingTarget_forEventType_:{enumerable:!1,value:function(e,t){var i;i=this.actualDOMTargetForEventTypeOnTarget(t,e),i&&(delete this._observedTarget_byEventType_[t][i.uuid],i.nativeRemoveEventListener(t,this,!0))}},_activationHandler:{enumerable:!0,value:null},_listenToWindow:{enumerable:!1,value:function(e){if(!this._activationHandler){var t=this;this._activationHandler=function(e){var i;if(e.changedTouches){i=e.changedTouches.length;for(var a=0;i>a;a++)t._prepareComponentsForActivation(e.changedTouches[a].target)}else t._prepareComponentsForActivation(e.target)}}if(window.PointerEvent?(e.nativeAddEventListener("pointerdown",this._activationHandler,!0),e.nativeAddEventListener("pointerenter",this._activationHandler,!0)):window.MSPointerEvent&&window.navigator.msPointerEnabled?(e.nativeAddEventListener("MSPointerDown",this._activationHandler,!0),e.document.nativeAddEventListener("mouseenter",this._activationHandler,!0)):(e.nativeAddEventListener("touchstart",this._activationHandler,!0),e.nativeAddEventListener("mousedown",this._activationHandler,!0),e.document.nativeAddEventListener("mouseenter",this._activationHandler,!0)),e.nativeAddEventListener("focus",this._activationHandler,!0),this.application){var i,a=this.registeredEventListenersOnTarget_(this.application);for(i in a)this._observeTarget_forEventType_(e,i)}}},_stopListeningToWindow:{enumerable:!1,value:function(e){var t,i,a=this.registeredEventListenersOnTarget_(this.application),s=this.registeredEventListenersOnTarget_(e);for(t in a)this._stopObservingTarget_forEventType_(e,t);for(t in s)this._stopObservingTarget_forEventType_(e,t);(i=this._listeningWindowOnTouchCancel.indexOf(e))>-1&&this._listeningWindowOnTouchCancel.splice(i,1)}},reset:{enumerable:!1,value:function(){var e,t,i,a;for(e in this.registeredEventListeners){t=this.registeredEventListeners[e];for(i in t.targets)a=t.targets[i],this._stopObservingTarget_forEventType_(a.target,e)}this.registeredEventListeners={},this._claimedPointers={}}},unload:{enumerable:!1,value:function(){this._stopListening()}},methodNameForBubblePhaseOfEventType:{enumerable:!1,value:function(e,t){return function(i,a){var s;return a?(s=t[i]||(t[i]=Object.create(null)),s[a]||(s[a]="handle"+a.toCapitalized()+i.toCapitalized())):e[i]||(e[i]="handle"+i.toCapitalized())}}(Object.create(null),Object.create(null))},_methodNameForCapturePhaseByEventType_:{value:{}},methodNameForCapturePhaseOfEventType:{enumerable:!1,value:function(e,t){return function(i,a){var s;return a?(s=t[i]||(t[i]=Object.create(null)),s[a]||(s[a]="capture"+a.toCapitalized()+i.toCapitalized())):e[i]||(e[i]="capture"+i.toCapitalized())}}(Object.create(null),Object.create(null))},_claimedPointers:{enumerable:!1,distinct:!0,value:{}},componentClaimingPointer:{value:function(e){return this._claimedPointers[e]}},isPointerClaimedByComponent:{value:function(e,t){if(!t)throw"Must specify a valid component to see if it claims the specified pointer, '"+t+"' is not valid.";return this._claimedPointers[e]===t}},claimPointer:{value:function(e,t){if(!e&&0!==e)throw"Must specify a valid pointer to claim, '"+e+"' is not valid.";if(!t)throw"Must specify a valid component to claim a pointer, '"+t+"' is not valid.";var i=this._claimedPointers[e];return i===t?!0:i?i.surrenderPointer(e,t)?(this._claimedPointers[e]=t,!0):!1:(this._claimedPointers[e]=t,!0)}},forfeitPointer:{value:function(e,t){if(t!==this._claimedPointers[e])throw"Not allowed to forfeit pointer '"+e+"' claimed by another component";delete this._claimedPointers[e]}},forfeitAllPointers:{value:function(e){var t,i;for(t in this._claimedPointers)i=this._claimedPointers[t],e===i&&delete this._claimedPointers[t]}},_isStoringPointerEvents:{enumerable:!1,value:!1},isStoringPointerEvents:{enumerable:!0,get:function(){return this._isStoringPointerEvents},set:function(e){e===!0?this._isStoringPointerEvents||(this._isStoringPointerEvents=!0,window.PointerEvent||window.MSPointerEvent&&window.navigator.msPointerEnabled?Object.defineProperty(u.prototype,"velocity",{get:function(){return i.pointerMotion(this.pointerId).velocity}}):window.Touch&&Object.defineProperty(Touch.prototype,"velocity",{get:function(){return i.pointerMotion(this.identifier).velocity}})):(this._isStoringPointerEvents=!1,this._pointerStorage.memory={},this._isMouseDragging=!1)}},_isStoringMouseEventsWhileDraggingOnly:{enumerable:!1,value:!0},isStoringMouseEventsWhileDraggingOnly:{enumerable:!0,get:function(){return this._isStoringMouseEventsWhileDraggingOnly},set:function(e){this._isStoringMouseEventsWhileDraggingOnly=e===!0?!0:!1}},_isMouseDragging:{enumerable:!1,value:!1},_pointerStorage:{enumerable:!1,value:{memory:{},add:function(e,t){this.memory[e]||(this.memory[e]={data:Array(32),size:0,pos:0}),this.memory[e].data[this.memory[e].pos]=t,this.memory[e].size<this.memory[e].data.length&&this.memory[e].size++,this.memory[e].pos=(this.memory[e].pos+1)%this.memory[e].data.length},remove:function(e){delete this.memory[e]},clear:function(e){this.memory[e]&&(this.memory[e].size=0)},getMemory:function(e){return this.memory[e]},isStored:function(e){return this.memory[e]&&this.memory[e].size>0},storeEvent:function(e){var t=!!(window.PointerEvent||window.MSPointerEvent&&window.navigator.msPointerEnabled),a=e instanceof u?e._event:e;if(t&&("mouse"===e.pointerType||window.MSPointerEvent&&e.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_MOUSE)||!t&&a instanceof MouseEvent)switch(e.type){case"pointerdown":case"MSPointerDown":case"mousedown":i._isMouseDragging=!0;case"pointermove":case"MSPointerMove":case"mousemove":i._isStoringMouseEventsWhileDraggingOnly?i._isMouseDragging&&this._storeMouse(e):this._storeMouse(e);break;case"pointerup":case"MSPointerUp":case"mouseup":this._storeMouse(e)}else if(t&&("touch"===e.pointerType||window.MSPointerEvent&&e.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_TOUCH)||void 0!==window.TouchEvent&&!t&&a instanceof TouchEvent)switch(e.type){case"pointerdown":case"MSPointerDown":case"pointermove":case"MSPointerMove":case"pointerup":case"MSPointerUp":this._storeTouch(e.pointerId,e.clientX,e.clientY,e.timeStamp);break;case"touchstart":case"touchmove":this._storeTouches(e.touches,e.timeStamp);break;case"touchend":this._storeTouches(e.changedTouches,e.timeStamp)}},removeEvent:function(e){var t=!!(window.PointerEvent||window.MSPointerEvent&&window.navigator.msPointerEnabled),a=e instanceof u?e._event:e;if(t&&("mouse"===e.pointerType||window.MSPointerEvent&&e.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_MOUSE)||!t&&a instanceof MouseEvent)("mouseup"===e.type||"pointerup"===e.type||"MSPointerUp"===e.type)&&(i._isMouseDragging=!1,i._isStoringMouseEventsWhileDraggingOnly&&this.clear("mouse"));else if((t&&("touch"===e.pointerType||window.MSPointerEvent&&e.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_TOUCH)||void 0!==window.TouchEvent&&!t&&a instanceof TouchEvent)&&("touchend"===e.type||"pointerup"===e.type||"MSPointerUp"===e.type))if(e.changedTouches)for(var s=0;e.changedTouches.length>s;s++)this.remove(e.changedTouches[s].identifier);else this.remove(e.pointerId)},_storeMouse:function(e){this.add("mouse",{clientX:e.clientX,clientY:e.clientY,timeStamp:e.timeStamp}),Object.defineProperty(e,"velocity",{get:function(){return i.pointerMotion("mouse").velocity}})},_storeTouches:function(e,t){for(var i,a=0;e.length>a;a++)i=e[a],this._storeTouch(i.identifier,i.clientX,i.clientY,t)},_storeTouch:function(e,t,i,a){this.add(e,{clientX:t,clientY:i,timeStamp:a})}}},_getPointerVelocityData:{enumerable:!1,value:function(e){var t,a,s,u,n,r,l,o,c,m=0,d=!0,p={x:[],y:[],time:[]};for(t=i._pointerStorage.getMemory(e),a=t.data.length,s=t.data[(t.pos-1+a)%a],u=n=r=s.timeStamp,l=s.clientX,o=s.clientY;d&&n>u-350&&t.size>m;)s=t.data[(t.pos-m-1+a)%a],n=s.timeStamp,c=l*l+o*o,c>2&&50>=r-n?(p.x.push(s.clientX),p.y.push(s.clientY),p.time.push(n),r=n,l=s.clientX,o=s.clientY,m++):d=!1;return p}},_fitPointerCurve:{enumerable:!1,value:function(e,t){var i,a,s,u,n,r,l,o,c,m,d,p,v,h,g,f,b,q,_,y,S,P,C,D,N,E,M,w,A,x,I,T,L,j,O,V,F,R,k=1e-4,z=t.length;do{for(d=0,p=0,v=0,h=0,g=0,f=0,q=0,_=0,y=0,S=0,P=0,C=0,N=0,E=0,M=0,w=0,A=0,x=0,T=0,L=0,j=0,O=0,V=0,F=0,m=0;z>m;m++)n=t[m],r=n.t,o=r*r,c=o*r,l=n.v,b=k*(6*(o-r)-c+2),D=6*k*(c-2*o+r),I=6*k*(o-c),R=2*k*c,f+=b*b,C+=D*D,x+=I*I,F+=R*R,d+=l*b,q+=l*D,N+=l*I,T+=l*R,v-=b,y-=D,M-=I,j-=R,p-=b*r,_-=D*r,E-=I*r,L-=R*r,h-=b*o,S-=D*o,w-=I*o,O-=R*o,g-=b*c,P-=D*c,A-=I*c,V-=R*c;k*=2}while(0===f||0===C||0===x||0===F);for(r=k/f,d*=r,p*=3*r,v*=r,h*=3*r,g*=r,r=k/C,q*=r,_*=3*r,y*=r,S*=3*r,P*=r,r=k/x,N*=r,E*=3*r,M*=r,w*=3*r,A*=r,r=k/F,T*=r,L*=3*r,j*=r,O*=3*r,V*=r,f=e[0],C=e[1],x=e[2],F=e[3],i=3*(C-x)+F-f,a=f+x-2*C,s=C-f,u=f,m=0;20>m;m++)r=d+u*v+s*p+a*h+i*g,f+=r,u+=r,i-=r,a+=r,s-=r,r=q+u*y+s*_+a*S+i*P,C+=r,i+=3*r,a-=r+r,s+=r,r=N+u*M+s*E+a*w+i*A,x+=r,i-=3*r,a+=r,r=T+u*j+s*L+a*O+i*V,F+=r,i+=r;e[0]=f,e[1]=C,e[2]=x,e[3]=F}},_pointerBezierValue:{enumerable:!1,value:function(e,t){var i=1-e;return i*i*i*t[0]+3*i*i*e*t[1]+3*i*e*e*t[2]+e*e*e*t[3]}},_calculatePointerVelocity:{enumerable:!1,value:function(e,t){var i,a,s=e.length,u=e[0],n=e[0],r=0;for(a=1;s>a;a++)u>e[a]&&(u=e[a],r=a);if(i=n-u){if(s>5){var l,o,c,m=[];for(a=0;s>a;a++)m[a]={v:t[a],t:(e[a]-u)/i};return l=m[r].v,o=m[0].v,c=[l,(2*l+o)/3,(l+2*o)/3,o],this._fitPointerCurve(c,m),5e3*(this._pointerBezierValue(.8,c)-this._pointerBezierValue(.6,c))/i}return s>1?1e3*(t[0]-t[r])/i:0}return 0}},pointerMotion:{value:function(e){if(i._pointerStorage.isStored(e)){var t={};return Object.defineProperties(t,{_data:{enumerable:!1,writable:!0,value:null},_x:{enumerable:!1,writable:!0,value:null},_y:{enumerable:!1,writable:!0,value:null},_speed:{enumerable:!1,writable:!0,value:null},_angle:{enumerable:!1,writable:!0,value:null},x:{get:function(){return null===this._x&&(null===this._data&&(this._data=i._getPointerVelocityData(e)),this._x=i._calculatePointerVelocity(this._data.time,this._data.x)),this._x},set:function(){}},y:{get:function(){return null===this._y&&(null===this._data&&(this._data=i._getPointerVelocityData(e)),this._y=i._calculatePointerVelocity(this._data.time,this._data.y)),this._y},set:function(){}},speed:{get:function(){return null===this._speed&&(this._speed=Math.sqrt(this.x*this.x+this.y*this.y)),this._speed},set:function(){}},angle:{get:function(){return null===this._angle&&(this._angle=Math.atan2(this.y,this.x)),this._angle},set:function(){}}}),{velocity:t}}return void 0}},monitorDOMModificationInEventHandling:{value:!1},domModificationEventHandler:{value:a.specialize({handleEvent:{value:function(){throw"DOM Modified"}},captureDOMSubtreeModified:{value:function(){throw"DOMSubtreeModified"}},captureDOMAttrModified:{value:function(){throw"DOMAttrModified"}},captureDOMCharacterDataModified:{value:function(){throw"DOMCharacterDataModified"}}})},_touchNeedTracking:{value:["touchstart","touchend"]},_mouseEventTypeEmulatedList:{value:["mousedown","mouseup","click"]},_trackingTouchList:{value:null},_trackingTouchTimeoutIDs:{value:Object.create(null)},__isIOSPlatform:{value:null},_isIOSPlatform:{get:function(){return this.__isIOSPlatform=this.__isIOSPlatform||/iphone|ipod|ipad/gi.test(navigator.platform)}},_wouldTouchTriggerSimulatedEvent:{value:function(e){return this._touchNeedTracking.indexOf(e.type)>-1}},_couldEventBeSimulated:{value:function(e){return this._mouseEventTypeEmulatedList.indexOf(e.type)>-1}},_listeningWindowOnTouchCancel:{value:[]},_findWindowFromEvent:{value:function(e){var t,i=e.target;return i&&(t=i instanceof Window?i:i.defaultView instanceof Window?i.defaultView:i.ownerDocument&&i.ownerDocument.defaultView?i.ownerDocument.defaultView:null),t}},_isWindowListeningOnTouchCancel:{value:function(e){return this._registeredWindows.indexOf(e)>-1&&this._listeningWindowOnTouchCancel.indexOf(e)>-1}},_listenToTouchCancelIfNeeded:{value:function(e){var t=this._findWindowFromEvent(e);if(t&&!this._isWindowListeningOnTouchCancel(t)){var i=this;t.addEventListener("touchcancel",function(e){for(var t,a=e.changedTouches,s=i._trackingTouchList.touchesStart,u=0,n=a.length;n>u;u++)t=a[u].identifier,s[t]&&delete s[t]},!0),this._listeningWindowOnTouchCancel.push(t)}}},blocksEmulatedEvents:{value:!0},_shouldDispatchEvent:{value:function(e){if(!(!this.blocksEmulatedEvents||window.PointerEvent||window.MSPointerEvent&&window.navigator.msPointerEnabled)){if(this._isIOSPlatform)return!(0===e.timeStamp);if(this._wouldTouchTriggerSimulatedEvent(e)){var t=e.changedTouches;this._listenToTouchCancelIfNeeded(e);for(var i=0,a=t.length;a>i;i++)this._trackTouch(e,t[i].identifier)}else if(this._couldEventBeSimulated(e))return!this._isEmulatedEvent(e)}return!0}},_trackTouch:{value:function(e,t){var i=this._trackingTouchList,a=this._trackingTouchTimeoutIDs;if("touchstart"===e.type){var s=a[t];s&&(clearTimeout(s),delete a[t]),i.touchesStart[t]=e.target}else a[t]=setTimeout(function(){delete i.touchesEnd[t],delete a[t]},300),delete i.touchesStart[t],i.touchesEnd[t]=e.target}},_isEmulatedEvent:{value:function(e){var t,i=this._trackingTouchList.touchesStart,a=e.target,s=!1;for(t in i)if(s=i[t]===a)break;if(!s){i=this._trackingTouchList.touchesEnd;for(t in i)if(s=i[t]===a)break;if(s&&"click"===e.type){var u=this._trackingTouchTimeoutIDs,n=u[t];n&&(clearTimeout(n),delete i[t],delete u[t])}}return s}},handleEvent:{enumerable:!1,value:function(e){if(!this._shouldDispatchEvent(e))return void 0;this.monitorDOMModificationInEventHandling&&(document.body.addEventListener("DOMSubtreeModified",this.domModificationEventHandler,!0),document.body.addEventListener("DOMAttrModified",this.domModificationEventHandler,!0),document.body.addEventListener("DOMCharacterDataModified",this.domModificationEventHandler,!0));var t,i,a,s,n,r,l,o,c,m,d,b,q,_,y=e.type,S=e.bubbles;for("DOMContentLoaded"===y&&(t=e.target.defaultView,t&&this._windowsAwaitingFinalRegistration[t.uuid]&&(this._finalizeWindowRegistration(t),e.target.removeEventListener("DOMContentLoaded",this,!0))),_="boolean"!=typeof e.propagationStopped?u.fromEvent(e):e,c=Element.isElement(_.target)||_.target instanceof Document||_.target===window?this._eventPathForDomTarget(_.target):this._eventPathForTarget(_.target),b=_.target.identifier?this.methodNameForCapturePhaseOfEventType(y,_.target.identifier):null,q=_.target.identifier?this.methodNameForBubblePhaseOfEventType(y,_.target.identifier):null,m=this.methodNameForCapturePhaseOfEventType(y),d=this.methodNameForBubblePhaseOfEventType(y),this.delegate&&typeof this.delegate.willDistributeEvent===f&&this.delegate.willDistributeEvent(_),this._isStoringPointerEvents&&this._pointerStorage.storeEvent(_),_.eventPhase=v,i=c.length-1;!_.propagationStopped&&(a=c[i]);i--)if(_.currentTarget=a,s=this.registeredEventListenersForEventType_onTarget_(y,a))for(l=Object.keys(s),n=0;s&&!_.immediatePropagationStopped&&(r=s[l[n]]);n++)r.capture&&(o=r.listener,this._invokeTargetListenerForEvent(a,o,_,b,m));
if(!_.propagationStopped&&(_.eventPhase=h,_.currentTarget=a=_.target,s=this.registeredEventListenersForEventType_onTarget_(y,a)))for(l=Object.keys(s),n=0;s&&!_.immediatePropagationStopped&&(r=s[l[n]]);n++)o=r.listener,r.capture&&this._invokeTargetListenerForEvent(a,o,_,b,m),r.bubble&&this._invokeTargetListenerForEvent(a,o,_,q,d);for(_.eventPhase=g,i=0;S&&!_.propagationStopped&&(a=c[i]);i++)if(_.currentTarget=a,s=this.registeredEventListenersForEventType_onTarget_(y,a))for(l=Object.keys(s),n=0;s&&!_.immediatePropagationStopped&&(r=s[l[n]]);n++)r.bubble&&(o=r.listener,this._invokeTargetListenerForEvent(a,o,_,q,d));_.eventPhase=p,_.currentTarget=null,this._isStoringPointerEvents&&this._pointerStorage.removeEvent(e),this.monitorDOMModificationInEventHandling&&(document.body.removeEventListener("DOMSubtreeModified",this.domModificationEventHandler,!0),document.body.removeEventListener("DOMAttrModified",this.domModificationEventHandler,!0),document.body.removeEventListener("DOMCharacterDataModified",this.domModificationEventHandler,!0))}},_invokeTargetListenerForEvent:{value:function(e,t,i,a,s){var u;a&&typeof(u=t[a])===f||typeof(u=t[s])===f||typeof(u=t.handleEvent)===f?u.call(t,i):typeof t===f&&t.call(e,i)}},_prepareComponentsForActivation:{value:function(e){var t,i,a=e,s=a&&a.defaultView?a.defaultView:window,u=s.document?s.document:document,n=!1,r=null;do switch(a&&(i=this.eventHandlerForElement(a),i&&(n||(n=!0,r=this._findActiveTarget(i)),i.preparedForActivationEvents||i._prepareForActivationEvents())),t=a,a){case s:a=null;break;case u:a=s;break;case u.documentElement:a=u;break;default:a=a.parentNode}while(a&&t!==a);this.activeTarget=r}},_findActiveTarget:{value:function(e){for(var t=null,i={};!t&&e&&!(e.uuid in i);)i[e.uuid]=e,e.acceptsActiveTarget?t=e:e=e.nextTarget;return t}},_eventPathForTarget:{enumerable:!1,value:function(e){if(!e)return[];var t=e,i=this.application,a=[],s={};s[e.uuid]=e;do t.uuid in s||(a.push(t),s[t.uuid]=t),t=t.nextTarget,(!t||t.uuid in s)&&(t=i),t&&t.uuid in s&&(t=null);while(t);return a}},_eventPathForDomTarget:{enumerable:!1,value:function(e){if(!e)return[];var t,i=e,a=i&&i.defaultView?i.defaultView:window,s=a.document?a.document:document,u=this.application,n=[];do switch(i!==e&&n.push(i),t=i,i){case u:i=i.parentApplication,i&&(u=i);break;case a:i=u;break;case s:i=a;break;case s.documentElement:i=s;break;default:i=i.parentNode,i||(i=u)}while(i&&t!==i);return n}},_elementEventHandlerByUUID:{enumerable:!1,value:{}},registerEventHandlerForElement:{enumerable:!1,value:function(e,t){var i=this.eventHandlerForElement(t);i&&this.unregisterEventHandlerForElement(t),this._elementEventHandlerByUUID[t.eventHandlerUUID=e.uuid]=e}},unregisterEventHandlerForElement:{enumerable:!1,value:function(e){delete this._elementEventHandlerByUUID[e.eventHandlerUUID],delete e.eventHandlerUUID}},eventHandlerForElement:{enumerable:!1,value:function(e){return this._elementEventHandlerByUUID[e.eventHandlerUUID]}},_activeTarget:{value:null},activeTarget:{get:function(){return this._activeTarget||this.application},set:function(e){e||(e=this.application),e===this._activeTarget||this.activeTarget&&!this.activeTarget.surrendersActiveTarget(e)||(e.willBecomeActiveTarget(this.activeTarget),this._activeTarget=e,e.didBecomeActiveTarget())}}})}}}),montageDefine("d41c331","core/serialization/deserializer/montage-reviver",{dependencies:["../../core","mousse/deserialization/reviver","./properties-deserializer","./self-deserializer","./unit-deserializer","../../module-reference","../alias","../../promise"],factory:function(e,t){var i=e("../../core").Montage,a=e("mousse/deserialization/reviver").Reviver,s=e("./properties-deserializer").PropertiesDeserializer,u=e("./self-deserializer").SelfDeserializer,n=e("./unit-deserializer").UnitDeserializer,r=e("../../module-reference").ModuleReference,l=e("../alias").Alias,o=e("../../promise").Promise,c=i.specialize({_require:{value:null},_objectRequires:{value:null},init:{value:function(e,t){if("function"!=typeof e)throw Error("Function 'require' missing.");if("string"!=typeof e.location)throw Error("Function 'require' location is missing");if("object"!=typeof t&&void 0!==t)throw Error("Parameter 'objectRequires' should be an object.");return this._require=e,this._objectRequires=t,this}},getExports:{value:function(e,t){var i;for(t=e.resolve(t),i=e.getModuleDescriptor(t);void 0!==i.redirect;)i=e.getModuleDescriptor(i.redirect);return void 0!==i.mappingRedirect?this.getExports(i.mappingRequire,i.mappingRedirect):i.exports}},getModule:{value:function(e,t){var i,a,s=this._objectRequires;return i=s&&t in s?s[t]:this._require,a=this.getExports(i,e),a||(a=i.async(e)),a}}}),m=t.MontageReviver=i.specialize.call(a,{moduleLoader:{value:null},init:{value:function(e,t){return this.moduleLoader=(new c).init(e,t),this}},getTypeOf:{value:function(e){if(null!==e&&"object"==typeof e&&1===Object.keys(e).length){if("#"in e)return"Element";if("%"in e)return"Module"}return a.prototype.getTypeOf.call(this,e)}},_checkLabel:{value:function(e,t){return t&&":"!==e[0]?Error('Aliases can only be defined in template properties (start with a colon (:)), "'+e+'".'):t||":"!==e[0]?void 0:Error('Only aliases are allowed as template properties (start with a colon (:), "'+e+'".')}},reviveRootObject:{value:function(e,t,i){var s,u="alias"in e;return s=this._checkLabel(i,u),s?o.reject(s):a.prototype.reviveRootObject.apply(this,arguments)}},reviveElement:{value:function(e,t,i){var a=e["#"],s=t.getElementById(a);return s?(i&&t.setObjectLabel(s,i),s):o.reject(Error("Element with id '"+a+"' was not found."))}},reviveModule:{value:function(e,t){var i=e["%"],a=t.getRequire();i=a.resolve(i);var s=a.getModuleDescriptor(i);return(new r).initWithIdAndRequire(s.id,s.require)}},reviveCustomObject:{value:function(e,t,i){return"alias"in e?this.reviveAlias(e,t,i):this.reviveMontageObject(e,t,i)}},reviveMontageObject:{value:function(e,t,i){var a,s,u,n=this,r=e.prototype||e.object;return r&&(s=m.parseObjectLocationId(r),a=this.moduleLoader.getModule(s.moduleId,i),u=s.objectName),o.isPromise(a)?a.then(function(a){return n.instantiateMontageObject(e,a,u,t,i)},function(t){throw t.stack&&console.error(t.stack),Error('Error deserializing "'+i+'" when loading module "'+s.moduleId+"' from '"+e.prototype+"'")}):this.instantiateMontageObject(e,a,u,t,i)}},instantiateMontageObject:{value:function(e,t,i,a,s){var u,n,r=this;return u=this.getMontageObject(e,t,i,a,s),a.setObjectLabel(u,s),u.isDeserializing=!0,n=this.reviveObjectLiteral(e,a),o.isPromise(n)?n.then(function(e){return r.deserializeMontageObject(e,u,a,s)}):this.deserializeMontageObject(n,u,a,s)}},deserializeMontageObject:{value:function(e,t,i,a){var s;return"function"==typeof t.deserializeSelf?this.deserializeCustomMontageObject(t,e,i,a):(i.setUnitsToDeserialize(t,e,m._unitNames),s=this.deserializeMontageObjectProperties(t,e.properties,i),o.isPromise(s)?s.then(function(){return t}):t)}},deserializeMontageObjectProperties:{value:function(e,t,i){var a;if("function"==typeof e.deserializeProperties){var u=(new s).initWithReviverAndObjects(this,i);a=e.deserializeProperties(u)}else for(var n in t)e[n]=t[n];return a}},deserializeCustomMontageObject:{value:function(e,t,i,a){var s,n=(new u).initWithObjectAndObjectDescriptorAndContextAndUnitNames(e,t,i,m._unitNames);return s=e.deserializeSelf(n),o.isPromise(s)?s.then(function(e){return i.setObjectLabel(e,a),e}):void 0!==s?(i.setObjectLabel(s,a),s):e}},getMontageObject:{value:function(e,t,i,a,s){var u;if(a.hasUserObject(s))return a.getUserObject(s);if("prototype"in e){if(!(i in t))throw Error('Error deserializing "'+s+'": object named "'+i+'"'+' was not found in "'+e.prototype+'".'+" Available objects are: "+Object.keys(t)+".");return u=Object.create(t[i].prototype),u.isDeserializing=!0,"function"==typeof u.didCreate?u.didCreate():"function"==typeof u.constructor&&u.constructor(),u}if("object"in e){if(!(i in t))throw Error('Error deserializing "'+s+'": object named "'+u+"' was not found given '"+e.object+"'");return t[i]}throw Error("Error deserializing "+JSON.stringify(e)+', might need "prototype" or "object" on label '+JSON.stringify(s))}},reviveAlias:{value:function(e,t,i){var a=new l;return a.value=e.alias,t.setObjectLabel(a,i),a}},didReviveObjects:{value:function(e,t){var i,a=this;return i=this._deserializeUnits(t),o.isPromise(i)?i.then(function(){a._invokeDeserializedFromSerialization(e,t)}):(this._invokeDeserializedFromSerialization(e,t),void 0)}},_invokeDeserializedFromSerialization:{value:function(e,t){var i;for(var a in e)i=e[a],null!=i&&delete i.isDeserializing,t.hasUserObject(a)||i&&"function"==typeof i.deserializedFromSerialization&&i.deserializedFromSerialization(a)}},_deserializeUnits:{value:function(e){var t,i,a=e.getUnitsToDeserialize(),s=m._unitRevivers;try{for(var u,r=0;u=a[r];r++){t=u.unitNames;for(var l,c=0;l=t[c];c++)l in u.objectDesc&&(i=(new n).initWithContext(e),s[l](i,u.object,u.objectDesc[l]))}}catch(d){return o.reject(d)}}}},{_unitRevivers:{value:Object.create(null)},_unitNames:{value:[]},_findObjectNameRegExp:{value:/([^\/]+?)(\.reel)?$/},_toCamelCaseRegExp:{value:/(?:^|-)([^-])/g},_replaceToCamelCase:{value:function(e,t){return t.toUpperCase()}},_locationDescCache:{value:Object.create(null)},parseObjectLocationId:{value:function(e){var t,i,a,s,u=this._locationDescCache;return e in u?t=u[e]:(i=e.indexOf("["),i>0?(a=e.substr(0,i),s=e.slice(i+1,-1)):(a=e,this._findObjectNameRegExp.test(e),s=RegExp.$1.replace(this._toCamelCaseRegExp,this._replaceToCamelCase)),t={moduleId:a,objectName:s},u[e]=t),t}},defineUnitReviver:{value:function(e,t){this._unitRevivers[e]=t,this._unitNames.push(e)}},getTypeOf:{value:function(e){return this.prototype.getTypeOf.call(this,e)}}});void 0!==t&&(t.MontageReviver=m)}}),montageDefine("d41c331","core/logger",{dependencies:["./core"],factory:function(e,t){function i(e){var t=function(e){return this._color=e,this};for(var i in m)t[i]=function(t){return function(){return e.color(m[t])}}(i);e.color=t}var a,s,u,n,r,l,o,c=e("./core").Montage;s=t.loggers={},n=function(){var e,t=n.caller.caller;return e=t.name,""===e&&(e="anonymous"),e},r=function(e){if(e.getHours){var t=e.getHours(),i=e.getMinutes(),a=e.getSeconds();return(1===t.length?"0"+t:t)+":"+(1===i.length?"0"+i:i)+":"+(1===a.length?"0"+a:a)+"."+e.getMilliseconds()}},u=function(){console.log(arguments)},a=t.Logger=c.specialize({constructor:{value:function a(){this.super(),i(this)}},init:{value:function(e,t,i){if(this.name=e,this._onStateChange=t,this._storeState=!i,this._storeState&&o){var a=o.getItem("_montage_logger_"+e);a&&(this.isDebug="true"===a)}return t&&this._onStateChange("true"===a),this.isError=!0,this}},name:{value:null},buffer:{value:[],distinct:!0},buffered:{value:!1},flush:{value:function(){var e,t,i=this.buffer;for(t=0;e=i[t];t++)this._formattedLog(e);this.buffer.length=0}},isDebug:{get:function(){return this.debug!==Function.noop},set:function(e){this.debug=e?this._consoleLogMontage:Function.noop}},isError:{get:function(){return this.error!==Function.noop},set:function(e){this.error=e?this._consoleLogMontage:Function.noop}},_consoleLogMontage:{value:function(){var e=arguments[0],t=e._montage_metadata;new Date,t?(Array.prototype.shift.call(arguments),Array.prototype.unshift.call(arguments,t.objectName+"."+n(e)+"()"),this.buffered?this.buffer.push(arguments):this._formattedLog(arguments)):this.buffered?this.buffer.push(arguments):this._formattedLog(arguments)}},_formattedLog:{value:function(e){var t=e[0];v.isDebug&&"string"==typeof t&&Array.prototype.splice.call(e,0,1,"%c"+t,this._logCss),console.log.apply(console,e)}},__logCss:{value:null},_logCss:{get:function(){return null===this.__logCss&&(this.__logCss="",this.__logCss+=this._color?"color:"+this._color+";":"color:black;"),this.__logCss}},debug:{value:Function.noop},error:{value:Function.noop},toTimeString:{value:r},_storeState:{value:null},_onStateChange:{value:null}});var m={base03:"#002b36",base02:"#073642",base01:"#586e75",base00:"#657b83",base0:"#839496",base1:"#93a1a1",base2:"#eee8d5",base3:"#fdf6e3",yellow:"#b58900",orange:"#cb4b16",red:"#dc322f",magenta:"#d33682",violet:"#6c71c4",blue:"#268bd2",cyan:"#2aa198",green:"#859900"};t.logger=function(e,t,i){var u;return null==(u=s[e])&&(u=(new a).init(e,t,i),c.defineProperty(s,e,{value:u})),u},l=c.specialize({constructor:{value:function l(){this.super()}},init:{value:function(){return document.nativeAddEventListener?(document.nativeAddEventListener("keyup",this,!1),document.nativeAddEventListener("keydown",this,!1)):(document.addEventListener("keyup",this,!1),document.addEventListener("keydown",this,!1)),this}},inspectorElement:{value:null},m_dontRemove:{value:null},titleHeader:{value:null},shown:{value:!1},isCtrl:{value:!1},isAlt:{value:!1},keyup:{value:function(e){17==e.which&&(this.isCtrl=!1),18==e.which&&(this.isAlt=!1)}},keydown:{value:function(e){return 17==e.which&&(this.isCtrl=!0),18==e.which&&(this.isAlt=!0),76==e.which&&this.isCtrl===!0&&this.isAlt===!0?(this.shown?this.hideInspector():this.showInspector(),!1):void 0}},change:{value:function(e){var t=e.target.checked,i=e.target.value,a=s[i];a.isDebug=t,a._onStateChange&&a._onStateChange(t),a._storeState&&o&&o.setItem("_montage_logger_"+i,t)}},mouseup:{value:function(){this.hideInspector()}},showInspector:{value:function(){if(!this.inspectorElement){var e,t,i,a,u,n,r,l,c,m,d,p=0;for(this.m_dontRemove=document.getElementsByTagName("body")[0],this.inspectorElement=document.createElement("div"),this.inspectorElement.id="_montage_logger_inspector",t=document.createElement("div"),this.inspectorElement.appendChild(t),a=document.createElement("div"),t.appendChild(a),i=document.createElement("h1"),i.className="_montage_logger_inspector-title",i.textContent="Logger Inspector",this.titleHeader=i,a.appendChild(i),c=Object.keys(s),p=0;e=s[c[p]];p++)u=document.createElement("label"),n=document.createElement("input"),d=document.createElement("span"),u.className="_montage_logger_inspector-content",d.textContent=e.name,u.appendChild(n),u.appendChild(d),n.value=e.name,n.type="checkbox",n.checked=!!e.isDebug,l="_montage_logger_"+e.name,e._storeState&&o&&(r=o.getItem(l),null==r&&o.setItem(l,e.isDebug)),a.appendChild(u);m=document.createElement("style");var v="#_montage_logger_inspector {";v+="    border: 1px solid rgba(15,15,15,0.4);",v+="    position: fixed;",v+="    right: 25px;",v+="    top: 25px;",v+="    -webkit-border-radius: 5px;",v+="    color: #dddddd;",v+='    font: 10px "Lucida Grande","Lucida Sans", sans;',v+="    background:-webkit-gradient(linear, left top, left bottom, from(rgba(15,15,15,0.75)), to(rgba(15,15,15,0.95)) );",v+="    -webkit-box-shadow: 0 0 15px rgba(0,0,0,.3);",v+="    width: 250px;",v+="}",v+="#_montage_logger_inspector div {",v+="    -webkit-border-radius: 5px;",v+="    background: -webkit-gradient(radial, 100 -60, 0, 125 -50, 125, from(rgba(255,255,255,0.00)), to(rgba(0,0,0,.2)), color-stop(1, rgba(0,0,0,.2)));",v+="}",v+="#_montage_logger_inspector div div {",v+="    background: -webkit-gradient(linear, left top, left bottom, from(rgba(255,255,255,0.2)), to(rgba(0,0,0,.1)), color-stop(0.33, rgba(255,255,255,.01)), color-stop(0.33, rgba(50,50,50,1)) );",v+="    padding: 7px 10px;",v+="    -webkit-border-radius: 3px;",v+="    overflow-x: hidden;",v+="}",v+="._montage_logger_inspector-title {",v+="    color: rgba(255,255,255,0.9);",v+="    font-size: 13px;",v+="    margin: 0 0 11px 0;",v+="    padding: 0 0 0 5px;",v+="}",v+="._montage_logger_inspector-content {",v+="    padding: 0 0 0 20px;",v+="    margin: 0;",v+="    display: block;",v+="}",m.textContent=v,document.head.appendChild(m)}this.shown=!0,this.m_dontRemove.appendChild(this.inspectorElement),this.titleHeader.nativeAddEventListener("mouseup",this,!1),this.inspectorElement.nativeAddEventListener("change",this,!1)}},hideInspector:{value:function(){document.getElementById("_montage_logger_inspector")&&(this.shown=!1,this.m_dontRemove.removeChild(this.inspectorElement),this.titleHeader.nativeRemoveEventListener("mouseup",this,!1),this.inspectorElement.nativeRemoveEventListener("change",this,!1))}},handleEvent:{enumerable:!1,value:function(e){this[e.type]&&this[e.type](e)}}});var d=function(){(new l).init()};if("undefined"!=typeof window){try{o=window.localStorage}catch(p){console.log("Error accessing localStorage",p)}window.loggers=s,o&&d()}var v=t.logger("colors")}}),montageDefine("d41c331","core/serialization/deserializer/properties-deserializer",{dependencies:["../../core"],factory:function(e,t){var i=e("../../core").Montage,a=i.specialize({_object:{value:null},_objectDescriptor:{value:null},_context:{value:null},initWithObjectAndObjectDescriptorAndContext:{value:function(e,t,i){return this._object=e,this._objectDescriptor=t,this._context=i,this}},get:{value:function(e){return this._objectDescriptor.properties?this._objectDescriptor.properties[e]:void 0}},deserializeProperties:{value:function(e){var t,a=this._object,s=this._objectDescriptor.properties;if(s){e||(e=i.getSerializablePropertyNames(a));for(var u=0,n=e.length;n>u;u++)t=e[u],a[t]=s[t]}}},getObjectByLabel:{value:function(e){this._context.getObject(e)}}});t.PropertiesDeserializer=a}}),montageDefine("d41c331","core/serialization/deserializer/self-deserializer",{dependencies:["../../core"],factory:function(e,t){var i=e("../../core").Montage,a=i.specialize({_object:{value:null},_objectDescriptor:{value:null},_context:{value:null},_unitNames:{value:null},_objectUnitNames:{value:null},create:{value:function(){return new this}},initWithObjectAndObjectDescriptorAndContextAndUnitNames:{value:function(e,t,i,a){return this._object=e,this._objectDescriptor=t,this._context=i,this._unitNames=a,this}},getProperty:{value:function(e){return this._objectDescriptor.properties?this._objectDescriptor.properties[e]:void 0}},getType:{value:function(){return"prototype"in this._objectDescriptor?"prototype":"object"in this._objectDescriptor?"object":void 0}},getTypeValue:{value:function(){return this._objectDescriptor.prototype||this._objectDescriptor.object}},getObjectByLabel:{value:function(e){this._context.getObject(e)}},deserializeProperties:{value:function(e){var t,a=this._object,s=this._objectDescriptor.properties;if(s){e||(e=i.getSerializablePropertyNames(a));for(var u=0,n=e.length;n>u;u++)t=e[u],a[t]=s[t]}}},deserializeUnit:{value:function(e){var t=this._objectUnitNames;t?-1===t.indexOf(e)&&t.push(e):(t=this._objectUnitNames=[e],this._context.setUnitsToDeserialize(this._object,this._objectDescriptor,t))}},deserializeUnits:{value:function(){var e=this._objectUnitNames;if(e)for(var t,i=0;t=e[i];i++)-1===e.indexOf(t)&&e.push(t);else e=this._objectUnitNames=this._unitNames,this._context.setUnitsToDeserialize(this._object,this._objectDescriptor,e)}}});t.SelfDeserializer=a}}),montageDefine("d41c331","core/serialization/deserializer/unit-deserializer",{dependencies:["../../core"],factory:function(e,t){var i=e("../../core").Montage,a=i.specialize({_context:{value:null},create:{value:function(){return new this}},initWithContext:{value:function(e){return this._context=e,this}},_templatePropertyRegExp:{value:/^([^:]+)(:.*)$/},isValidTemplatePropertyReference:{value:function(e){var t=this._templatePropertyRegExp.exec(e);if(t){var i=t[1];return this._context.hasObject(i)?!0:!1}return!1}},getObjectByLabel:{value:function(e){if(this._context.hasObject(e))return this._context.getObject(e);if(this.isValidTemplatePropertyReference(e))return null;throw Error("Object with label '"+e+"' was not found.")}}});t.UnitDeserializer=a}}),montageDefine("d41c331","core/module-reference",{dependencies:["./core"],factory:function(e,t){var i=e("./core").Montage;t.ModuleReference=i.specialize({constructor:{value:function(){return this.super()}},initWithIdAndRequire:{value:function(e,t){if(!e||!t)throw Error("Module ID and require required");return this.id=e,this.require=t,this}},id:{value:null},require:{value:null},_exports:{value:null},exports:{get:function(){return this._exports?this._exports:this._exports=this.require.async(this.id)}},resolve:{value:function(e){return e.identify(this.id,this.require)}},isModuleReference:{writable:!1,configurable:!1,value:!0}})}}),montageDefine("d41c331","core/serialization/alias",{dependencies:["../core"],factory:function(e,t){var i=e("../core").Montage;t.Alias=i.specialize({_value:{value:null},_aliasRegExp:{value:/@([_a-zA-Z$][0-9_a-zA-Z$]*):([_a-zA-Z$][0-9_a-zA-Z$]*)$/},value:{get:function(){return this._value},set:function(e){var t=this._aliasRegExp.exec(e);if(!t)throw Error("Invalid alias syntax: "+e);this._value=e,this._componentLabel=t[1],this._propertyName=t[2]}},_componentLabel:{value:null},componentLabel:{get:function(){return this._componentLabel}},_propertyName:{value:null},propertyName:{get:function(){return this._propertyName}},init:{value:function(e){return this.value=e,this}}})}}),montageDefine("d41c331","core/shim/object",{dependencies:[],factory:function(){Object.create||(Object._creator=function e(){this.__proto__=e.prototype},Object.create=function(e){return this._creator.prototype=e||Object.prototype,new this._creator},Object.getPrototypeOf=function(e){return e.__proto__}),Object.isSealed||Object.defineProperty(Object,"isSealed",{value:function(){return!1},writable:!0,configurable:!0}),Object.seal||Object.defineProperty(Object,"seal",{value:function(e){return e},writable:!0,configurable:!0})}}),montageDefine("d41c331","core/shim/array",{dependencies:[],factory:function(){Array.isArray||Object.defineProperty(Array,"isArray",{value:function(e){return"[object Array]"===Object.prototype.toString.call(e)},writable:!0,configurable:!0})}}),montageDefine("d41c331","core/shim/string",{dependencies:[],factory:function(){String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(e){return this.length>=e.length&&this.slice(0,e.length)===e},writable:!0,configurable:!0}),String.prototype.endsWith||Object.defineProperty(String.prototype,"endsWith",{value:function(e){return this.length>=e.length&&this.slice(this.length-e.length,this.length)===e},writable:!0,configurable:!0})}}),montageDefine("d41c331","core/extras/object",{dependencies:["frb"],factory:function(e){Object.defineProperty(Object,"getPropertyDescriptor",{value:function(e,t){var i,a=e;do i=Object.getOwnPropertyDescriptor(a,t);while(!i&&(a=a.__proto__||Object.getPrototypeOf(a)));return i},writable:!0,configurable:!0}),Object.defineProperty(Object,"getPrototypeAndDescriptorDefiningProperty",{value:function(e,t){var i,a=e;if(t){do i=Object.getOwnPropertyDescriptor(a,t);while(!i&&(a=a.__proto__||Object.getPrototypeOf(a)));return{prototype:a,propertyDescriptor:i}}},writable:!0,configurable:!0}),Object.defineProperty(Object.prototype,"clear",{value:function(){for(var e=Object.keys(this),t=e.length;t;)t--,delete this[e[t]];return this},writable:!0,configurable:!0}),Object.defineProperty(Object,"defineBinding",{value:function(t,i,a){var s=Error.stackTraceLimit;Error.stackTraceLimit=2,console.warn("Object.defineBinding deprecated.  See the comment below this warning for migration instructions.",Error("deprecated").stack),Error.stackTraceLimit=s;var u=e("frb");a.source=a.boundObject,a.oneway?a["<-"]=a.boundObjectPropertyPath:a["<->"]=a.boundObjectPropertyPath,a.boundValueMutator&&(a.convert=a.boundValueMutator),u.defineBinding(t,i,a)}}),Object.defineProperty(Object,"deleteBinding",{value:function(t,i){var a=e("frb");a.cancelBinding(t,i)}})}}),montageDefine("d41c331","core/extras/date",{dependencies:[],factory:function(){Object.defineProperty(Date.prototype,"clone",{value:function(){return new Date(this)},writable:!0,configurable:!0})}}),montageDefine("d41c331","core/extras/element",{dependencies:[],factory:function(){"undefined"==typeof Element||Element.isElement||Object.defineProperty(Element,"isElement",{value:function(e){return!(!e||1!==e.nodeType)},writable:!0,configurable:!0})}}),montageDefine("d41c331","core/extras/function",{dependencies:["./object"],factory:function(e){e("./object"),Object.defineProperty(Function,"identity",{value:function(e){return e},writable:!0,configurable:!0}),Object.defineProperty(Function,"noop",{value:function(){},writable:!0,configurable:!0}),Object.defineProperty(Function,"by",{value:function(e,t){t=t||Object.compare,e=e||Function.identity;var i=function(i,a){return t(e(i),e(a))};return i.compare=t,i.by=e,i},writable:!0,configurable:!0})}}),montageDefine("d41c331","core/extras/regexp",{dependencies:[],factory:function(){if(!RegExp.isRegExp){var e=Object.prototype.toString;Object.defineProperty(RegExp,"isRegExp",{value:function(t){return"[object RegExp]"===e.call(t)},writable:!0,configurable:!0})}}}),montageDefine("d41c331","core/extras/string",{dependencies:[],factory:function(){Object.defineProperty(String.prototype,"equals",{value:function(e){return this.valueOf()===Object.getValueOf(e)},writable:!0,configurable:!0}),Object.defineProperty(String.prototype,"contains",{value:function(e){return-1!==this.indexOf(e)},writable:!0,configurable:!0}),Object.defineProperty(String.prototype,"toCapitalized",{value:function(){return this.charAt(0).toUpperCase()+this.slice(1)},writable:!0,configurable:!0})}}),montageDefine("d41c331","core/deprecate",{dependencies:[],factory:function(e,t){var i=t.deprecationWarning=function i(e,t,i){if(i=i===!0?2:i){var a=Error.stackTraceLimit;Error.stackTraceLimit=i}if("undefined"!=typeof console&&"function"==typeof console.warn){var s=i?Error("").stack:"";t?console.warn(e+" is deprecated, use "+t+" instead.",s):console.warn(e,s)}i&&(Error.stackTraceLimit=a)};t.deprecateMethod=function(e,t,a,s){var u=function(){return i(a,s,3),t.apply(e?e:this,arguments)};return u.deprecatedFunction=t,u},t.callDeprecatedFunction=function(e,t,i,a){var s,u,n=Error.stackTraceLimit;return Error.stackTraceLimit=2,"undefined"!=typeof console&&"function"==typeof console.warn&&(s=Montage.getInfoForObject(e).objectName,a?console.warn(i+" is deprecated, use "+a+" instead.",s):console.warn(i,s)),Error.stackTraceLimit=n,u=ARRAY_PROTOTYPE.slice.call(arguments,4),t.apply(e?e:this,u)}}}),montageDefine("d41c331","core/uuid",{dependencies:[],factory:function(e,t){function i(){var e,t=a,i=s;return i[0]=t[15&(e=4294967296*Math.random())],i[1]=t[15&(e>>>=4)],i[2]=t[15&(e>>>=4)],i[3]=t[15&(e>>>=4)],i[4]=t[15&(e>>>=4)],i[5]=t[15&(e>>>=4)],i[6]=t[15&(e>>>=4)],i[7]=t[15&(e>>>=4)],i[9]=t[15&(e=4294967296*Math.random())],i[10]=t[15&(e>>>=4)],i[11]=t[15&(e>>>=4)],i[12]=t[15&(e>>>=4)],i[15]=t[15&(e>>>=4)],i[16]=t[15&(e>>>=4)],i[17]=t[15&(e>>>=4)],i[19]=t[8|3&(e=4294967296*Math.random())],i[20]=t[15&(e>>>=4)],i[21]=t[15&(e>>>=4)],i[22]=t[15&(e>>>=4)],i[24]=t[15&(e>>>=4)],i[25]=t[15&(e>>>=4)],i[26]=t[15&(e>>>=4)],i[27]=t[15&(e>>>=4)],i[28]=t[15&(e=4294967296*Math.random())],i[29]=t[15&(e>>>=4)],i[30]=t[15&(e>>>=4)],i[31]=t[15&(e>>>=4)],i[32]=t[15&(e>>>=4)],i[33]=t[15&(e>>>=4)],i[34]=t[15&(e>>>=4)],i[35]=t[15&(e>>>=4)],i.join("")}var a="0123456789ABCDEF".split(""),s="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".split("");t.Uuid=Object.create(Object.prototype,{generate:{enumerable:!1,value:i}}),t.generate=i}}),montageDefine("d41c331","core/serialization/bindings",{dependencies:["frb","frb/stringify","frb/expand","frb/scope","core/serialization/serializer/montage-serializer","core/serialization/deserializer/montage-deserializer"],factory:function(e){var t=e("frb"),i=e("frb/stringify"),a=e("frb/expand"),s=e("frb/scope"),u=e("core/serialization/serializer/montage-serializer").MontageSerializer,n=e("core/serialization/deserializer/montage-deserializer").MontageDeserializer;u.defineSerializationUnit("bindings",function(e,u){var n,r=t.getBindings(u),l={};for(var o in r){var c=r[o],m={};if(!("serializable"in c)||c.serializable){var d=c.sourcePath,p=c.sourceSyntax;if(c.source!==u){var v=e.getObjectLabel(c.source),h=new s({type:"component",label:v});h.components=e,p=a(p,h)}var h=new s;h.components=e,d=i(p,h),c.twoWay?m["<->"]=d:m["<-"]=d,c.converter?m.converter=c.converter:(m.convert=c.convert,m.revert=c.revert),c.trace&&(m.trace=!0),l[o]=m,n=!0}}return n?l:void 0}),n.defineDeserializationUnit("bindings",function(e,i,a){for(var s in a){var u=a[s];if("object"!=typeof u)throw Error("Binding descriptor must be an object, not "+typeof u);"boundObject"in u?(u.source=e.getObjectByLabel(u.boundObject),u.oneway?u["<-"]=u.boundPropertyPath:u["<->"]=u.boundPropertyPath,delete u.boundObject,delete u.boundObjectPropertyPath,delete u.oneway):u["<<->"]&&(console.warn("WARNING: <<-> in bindings is deprectated, use <-> only, please update now."),u["<->"]=u["<<->"],delete u["<<->"])}t.defineBindings(i,a,{components:e})})}}),montageDefine("d41c331","core/event/mutable-event",{dependencies:["../core"],factory:function(e,t){var i=e("../core").Montage;if("undefined"!=typeof window){var a={},s=function(e,t){var a="_"+t;i.defineProperty(e,a,{value:void 0}),i.defineProperty(e,t,{get:function(e,t){return function(){return this.hasOwnProperty(t)?this[t]:this._event?this._event[e]:void 0}}(t,a),set:function(e){return function(t){this[e]=t}}(a)})};t.MutableEvent=i.specialize({_initPrototypeWithEvent:{value:function(e){var t;for(t in e)this[t]||s(this,t);return s(this,"replayed"),this}},_initWithEvent:{value:function(e){return this._event=e,this}},preventDefault:{value:function(){this._event.preventDefault()}},getPreventDefault:{value:function(){return this._event.getPreventDefault?this._event.getPreventDefault():this._event.defaultPrevented}},stopImmediatePropagation:{value:function(){this._event.stopImmediatePropagation(),this.propagationStopped=!0,this.immediatePropagationStopped=!0}},propagationStopped:{value:!1},immediatePropagationStopped:{value:!1},mutable:{value:!0},target:{value:null},stopPropagation:{value:function(){this._event.stopPropagation(),this.propagationStopped=!0}},stop:{value:function(){this.preventDefault(),this.stopPropagation()}}},{fromEvent:{value:function(e){var i,s=e.type,u=a[s];return u||(u=function(){},u.prototype=(new t.MutableEvent)._initPrototypeWithEvent(e),a[s]=u),i=new u,i._initWithEvent(e),i}},fromType:{value:function(e,t,i,a){var s=document.createEvent("CustomEvent");return s.initCustomEvent(e,t,i,a),this.fromEvent(s)}}})}}}),montageDefine("d41c331","core/serialization/serializer/montage-serializer",{dependencies:["../../core","mousse/serialization/malker","mousse/serialization/serializer","./montage-builder","./montage-labeler","./montage-visitor","../../logger"],factory:function(e,t){var i=e("../../core").Montage,a=e("mousse/serialization/malker").Malker,s=e("mousse/serialization/serializer").Serializer,u=e("./montage-builder").MontageBuilder,n=e("./montage-labeler").MontageLabeler,r=e("./montage-visitor").MontageVisitor;e("../../logger").logger("montage-serializer");var l=i.specialize.call(s,{_require:{value:null},_visitor:{value:null},_findObjectNameRegExp:{value:/([^\/]+?)(\.reel)?$/},_toCamelCaseRegExp:{value:/(?:^|-)([^-])/g},_replaceToCamelCase:{value:function(e,t){return t.toUpperCase()}},constructor:{value:function l(){}},initWithRequire:{value:function(e){return this._require=e,this._builder=new u,this._labeler=new n,this._visitor=(new r).initWithBuilderAndLabelerAndRequireAndUnits(this._builder,this._labeler,this._require,this.constructor._units),this._malker=new a(this._visitor),this}},getExternalObjects:{value:function(){return this._visitor.getExternalObjects()}},getExternalElements:{value:function(){return this._visitor.getExternalElements()}}},{_units:{value:Object.create(null)},defineSerializationUnit:{value:function(e,t){this._units[e]=t}},getDefaultObjectNameForModuleId:{value:function(e){return this._findObjectNameRegExp.test(e),RegExp.$1.replace(this._toCamelCaseRegExp,this._replaceToCamelCase)}}});t.MontageSerializer=l,t.serialize=function(e,t){return(new l).initWithRequire(t).serializeObject(e)}}}),montageDefine("d41c331","core/serialization/deserializer/montage-deserializer",{dependencies:["../../core","mousse/deserialization/deserializer","./montage-interpreter","./montage-reviver","../../promise","../../jshint","../../logger"],factory:function(e,t){var i=e("../../core").Montage,a=e("mousse/deserialization/deserializer").Deserializer,s=e("./montage-interpreter").MontageInterpreter,u=e("./montage-reviver").MontageReviver,n=e("../../promise").Promise,r=e("../../jshint").JSHINT;
e("../../logger").logger("montage-deserializer");var l=i.specialize.call(a,{_interpreter:{value:null},_serializationString:{value:null},_serialization:{value:null},init:{value:function(e,t,i){if(!this.isSerializationStringValid(e))throw Error(this._formatSerializationSyntaxError(e));return a.call(this,e),this._serialization=null,this._interpreter=(new s).init(t,i),this}},serialization:{get:function(){var e=this._serialization;return e||(e=JSON.parse(this._serializationString),this._serialization=e),e}},deserialize:{value:function(e,t){var i;try{i=JSON.parse(this._serializationString)}catch(a){return n.reject(a)}return this._interpreter.instantiate(i,e,t)}},preloadModules:{value:function(){var e=JSON.parse(this._serializationString);return this._interpreter.preloadModules(e)}},getExternalObjectLabels:{value:function(){var e=this.serialization,t=[];for(var i in e)0===Object.keys(e[i]).length&&t.push(i);return t}},isSerializationStringValid:{value:function(e){try{return JSON.parse(e),!0}catch(t){return!1}}},_formatSerializationSyntaxError:{value:function(e){var t,i,a,s,u,n="   ",l=this._origin;if(r(e))t="Syntax error in the serialization but not able to find it!\n"+e;else{i=r.errors[0],a=e.split("\n"),s=(n+a.length).length,u=i.line-1;for(var o=0,c=a.length;c>o;o++)a[o]=Array(s-(o+1+"").length+1).join(o===u?">":" ")+(o+1)+" "+a[o];t="Syntax error at line "+i.line+(l?" from "+l:"")+":\n"+i.evidence+"\n"+i.reason+"\n"+a.join("\n")}return t}}},{defineDeserializationUnit:{value:function(e,t){u.defineUnitReviver(e,t)}}});t.MontageDeserializer=l,t.deserialize=function(e,t){return(new l).init(e,t).deserializeObject()}}}),montageDefine("d41c331","core/serialization/serializer/montage-builder",{dependencies:["../../core","mousse/serialization/builder","./montage-ast"],factory:function(e,t){var i=e("../../core").Montage,a=e("mousse/serialization/builder").Builder,s=e("./montage-ast"),u=i.specialize.call(a,{constructor:{value:function u(){a.call(this)}},createElementReference:{value:function(e){return(new s.ElementReference).initWithRootAndId(this._root,e)}},createModuleReference:{value:function(e){return(new s.ModuleReference).initWithRootAndModuleId(this._root,e)}}});t.MontageBuilder=u}}),montageDefine("d41c331","core/serialization/serializer/montage-labeler",{dependencies:["../../core","mousse/serialization/labeler"],factory:function(e,t){var i=e("../../core").Montage,a=e("mousse/serialization/labeler").Labeler;t.MontageLabeler=i.specialize.call(a,{_labelRegexp:{value:/^[a-zA-Z_$][0-9a-zA-Z_$]*$/},constructor:{value:function(){a.call(this)}},getTemplatePropertyLabel:{value:function(e){var t=this.superForValue("getObjectLabel")(e);if(":"!==t[0])throw Error("Template property's labels need to start with a colon (:), (\""+t+'").');return t}},getObjectLabel:{value:function(e){var t=this.super(e);if(":"===t[0])throw Error('Labels starting with colon (:) can only be used for template properties, ("'+t+'").');return t}},getObjectName:{value:function(e){var t,s=e.identifier;return s&&this._labelRegexp.test(s)?t=e.identifier:"getInfoForObject"in e||"getInfoForObject"in e.constructor?(t=i.getInfoForObject(e).objectName,t=t.toLowerCase()):t=a.prototype.getObjectName.call(this,e),t}}})}}),montageDefine("d41c331","core/serialization/serializer/montage-visitor",{dependencies:["../../core","./montage-serializer","./properties-serializer","./self-serializer","./unit-serializer","../alias","mousse/serialization/visitor"],factory:function(e,t){var i=e("../../core").Montage,a=e("./montage-serializer"),s=e("./properties-serializer").PropertiesSerializer,u=e("./self-serializer").SelfSerializer,n=e("./unit-serializer").UnitSerializer,r=e("../alias").Alias,l=e("mousse/serialization/visitor").Visitor,o=i.specialize.call(l,{_MONTAGE_ID_ATTRIBUTE:{value:"data-montage-id"},_require:{value:null},_units:{value:null},_elements:{value:null},constructor:{value:function o(){}},initWithBuilderAndLabelerAndRequireAndUnits:{value:function(e,t,i,a){return l.call(this,e,t),this._require=i,this._units=a,this._elements=[],this}},getTypeOf:{value:function(e){return e.isModuleReference?"Module":e instanceof r?"Alias":"getInfoForObject"in e||"getInfoForObject"in e.constructor?"MontageObject":e.thisIsAReferenceCreatedByMontageSerializer?"MontageReference":"undefined"!=typeof Element&&Element.isElement(e)?"Element":void 0}},visitMontageReference:{value:function(e,t,i){this.builder.top.setProperty(i,t.reference)}},visitElement:{value:function(e,t,i){var a,s;if(s=t.getAttribute(this._MONTAGE_ID_ATTRIBUTE),!s)throw Error("Not possible to serialize a DOM element with no "+this._MONTAGE_ID_ATTRIBUTE+" assigned: "+t.outerHTML);a=this.builder.createElementReference(s),this.storeValue(a,t,i),this._elements.push(t)}},visitModule:{value:function(e,t,i){var a,s;try{s=t.resolve(this._require)}catch(u){throw Error("Not possible to serialize module reference "+t.id+" from package "+t.require.location+" inside package "+this._require.location)}a=this.builder.createModuleReference(s),this.storeValue(a,t,i)}},visitAlias:{value:function(e,t){var i=this.labeler.getTemplatePropertyLabel(t),a=this.builder.createCustomObject();a.setProperty("alias",t.value),this.builder.top.setProperty(i,a)}},visitMontageObject:{value:function(e,t,i){this.isObjectSerialized(t)?this.serializeReferenceToMontageObject(e,t,i):this.handleMontageObject(e,t,i)}},handleMontageObject:{value:function(e,t,i){var a,s=this.builder.createCustomObject();this.setObjectSerialization(t,s),a=this.serializeMontageObject(e,t,s),a?this.serializeSubstituteObject(e,t,i,s,a):(s.setLabel(this.labeler.getObjectLabel(t)),this.builder.top.setProperty(i,s))}},serializeReferenceToMontageObject:{value:function(e,t,i){var a=this.labeler.getObjectLabel(t),s=this.builder.createObjectReference(a);this.builder.top.setProperty(i,s)}},serializeSubstituteObject:{value:function(e,t,i,a,s){var u,n,r,l;u=this.labeler.getObjectLabel(t),this.labeler.isUserDefinedLabel(u)?(n=this.labeler.getObjectLabel(s),this.labeler.setObjectLabel(s,u),this.builder.relabelReferences(n,u),l=this.getObjectSerialization(s),l&&(l.setLabel(u),this.labeler.isUserDefinedLabel(n)&&this.builder.createObjectReference(u).setLabel(n)),e.visit(s,i)):(e.visit(s,i),r=this.labeler.getObjectLabel(s),this.labeler.setObjectLabel(t,r),this.builder.relabelReferences(u,r))}},serializeMontageObject:{value:function(e,t,i){var a,s,n=this.builder.createObjectLiteral();return this.setObjectType(t,i),i.setProperty("properties",n),this.builder.push(i),"function"==typeof t.serializeSelf?(a=(new u).initWithMalkerAndVisitorAndObject(e,this,t,i),s=t.serializeSelf(a)):(this.setObjectProperties(e,t),this.setObjectCustomUnits(e,t)),this.builder.pop(),0===n.getPropertyNames().length&&i.clearProperty("properties"),s}},setObjectType:{value:function(e,t){var a=i.getInfoForObject(e).isInstance,s=this.getObjectLocationId(e),u=this.builder.createString(s);a?t.setProperty("prototype",u):t.setProperty("object",u)}},getObjectModuleId:{value:function(e){var t=i.getInfoForObject(e);return this._require.identify(t.moduleId,t.require)}},getObjectLocationId:{value:function(e){var t,s=this.getObjectModuleId(e),u=i.getInfoForObject(e),n=u.objectName;return t=a.MontageSerializer.getDefaultObjectNameForModuleId(s),t===n?s:s+"["+n+"]"}},setObjectProperties:{value:function(e,t){var i,a;a=this.builder.top.getProperty("properties"),this.builder.push(a),"function"==typeof t.serializeProperties?(i=(new s).initWithMalkerAndVisitorAndObject(e,this,t),t.serializeProperties(i)):this.setSerializableObjectProperties(e,t),this.builder.pop()}},setSerializableObjectProperties:{value:function(e,t){for(var a,s,u=i.getSerializablePropertyNames(t),n=u.length,r=0;n>r;r++)s=u[r],a=i.getPropertyAttribute(t,s,"serializable"),this.setProperty(e,s,t[s],a)}},hackIsReferenceAllowedForValue:{value:function(e){return"object"==typeof e&&null!=e&&!("undefined"!=typeof Element&&Element.isElement(e))}},setProperty:{value:function(e,t,i,a){var s;if("reference"===a&&this.hackIsReferenceAllowedForValue(i)){s=this.labeler.getObjectLabel(i);var u=this.builder.createObjectReference(s);this.builder.top.setProperty(t,u)}else e.visit(i,t)}},setObjectCustomUnits:{value:function(e,t){for(var i in this._units)this.setObjectCustomUnit(e,t,i)}},setObjectCustomUnit:{value:function(e,t,i){var a,s,u=this._units[i];u&&(s=(new n).initWithMalkerAndVisitorAndObject(e,this,t),a=u(s,t),null!=a&&e.visit(a,i))}},getExternalObjects:{value:function(){for(var e,t={},i=this.builder.getExternalReferences(),a=0;e=i[a];a++)t[e]=this.labeler.getObjectByLabel(e);return t}},getExternalElements:{value:function(){return this._elements}}});t.MontageVisitor=o}}),montageDefine("d41c331","core/serialization/deserializer/montage-interpreter",{dependencies:["../../core","mousse/deserialization/context","./montage-reviver","../../promise"],factory:function(e,t){var i=e("../../core").Montage,a=e("mousse/deserialization/context").Context,s=e("./montage-reviver").MontageReviver,u=e("../../promise").Promise,n=i.specialize({_require:{value:null},_reviver:{value:null},init:{value:function(e,t){if("function"!=typeof e)throw Error("Function 'require' missing.");return this._reviver=(new s).init(e,t),this._require=e,this}},instantiate:{value:function(e,t,i){var a;return a=(new r).init(e,this._reviver,t,i,this._require),a.getObjects()}},preloadModules:{value:function(e){var t,i,a,n,r=this._reviver,l=r.moduleLoader,o=[];for(var c in e)t=e[c],i=t.prototype||t.object,i&&(a=s.parseObjectLocationId(i),n=l.getModule(a.moduleId,c),u.isPromise(n)&&o.push(n));return o.length>0?u.all(o):void 0}}}),r=i.specialize.call(a,{_ELEMENT_ID_ATTRIBUTE:{value:"data-montage-id"},_unitsToDeserialize:{value:null},_element:{value:null},_require:{value:null},constructor:{value:function(){this._unitsToDeserialize=[]}},init:{value:function(e,t,i,s,u){return a.call(this,e,t,i),this._element=s,this._require=u,this}},hasObject:{value:function(e){return e in this._serialization}},getRequire:{value:function(){return this._require}},getElement:{value:function(){return this._element}},getElementById:{value:function(e){var t="*["+this._ELEMENT_ID_ATTRIBUTE+'="'+e+'"]';return this._element.querySelector(t)}},setUnitsToDeserialize:{value:function(e,t,i){this._unitsToDeserialize.push({object:e,objectDesc:t,unitNames:i})}},getUnitsToDeserialize:{value:function(){return this._unitsToDeserialize}}});t.MontageInterpreter=n,t.MontageContext=r}}),montageDefine("d41c331","core/jshint",{dependencies:[],factory:function(e,t){var i=function(e){var t,i=function(){return t||(t=e(i)),t.apply(this,arguments)};return i}(function(e){"use strict";function t(){}function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function a(e,t){var a;for(a in t)i(t,a)&&(e[a]=t[a])}function s(){dt.couch&&a(pt,Et),dt.rhino&&a(pt,Ot),dt.prototypejs&&a(pt,jt),dt.node&&a(pt,Lt),dt.devel&&a(pt,Mt),dt.dojo&&a(pt,wt),dt.browser&&a(pt,Nt),dt.jquery&&a(pt,It),dt.mootools&&a(pt,Tt),dt.wsh&&a(pt,Rt),dt.globalstrict&&dt.strict!==!1&&(dt.strict=!0)}function u(e,t,i){var a=Math.floor(100*(t/nt.length));throw{name:"JSHintError",line:t,character:i,message:e+" ("+a+"% scanned)."}}function n(t,i,a,s,n,r){var l,o,c;return i=i||ct,"(end)"===i.id&&(i=yt),o=i.line||0,l=i.from||0,c={id:"(error)",raw:t,evidence:nt[o-1]||"",line:o,character:l,a:a,b:s,c:n,d:r},c.reason=t.supplant(c),e.errors.push(c),dt.passfail&&u("Stopping. ",o,l),Pt+=1,Pt>=dt.maxerr&&u("Too many errors.",o,l),c}function r(e,t,i,a,s,u,r){return n(e,{line:t,from:i},a,s,u,r)}function l(e,t,i,a,s,r){var l=n(e,t,i,a,s,r);u("Stopping, unable to continue.",l.line,l.character)}function o(e,t,i,a,s,u,n){return l(e,{line:t,from:i},a,s,u,n)}function c(e,t){"hasOwnProperty"===e&&n("'hasOwnProperty' is a really bad name."),i(Z,e)&&!Z["(global)"]&&(Z[e]===!0?dt.latedef&&n("'{a}' was used before it was defined.",ct,e):dt.shadow||n("'{a}' is already defined.",ct,e)),Z[e]=t,Z["(global)"]?(tt[e]=Z,i(it,e)&&(dt.latedef&&n("'{a}' was used before it was defined.",ct,e),delete it[e])):gt[e]=Z}function m(){var e,t,i,a,u,n=ct.value;switch(n){case"*/":l("Unbegun comment.");break;case"/*members":case"/*member":n="/*members",ot||(ot={}),t=ot;break;case"/*jshint":case"/*jslint":t=dt,i=Dt;break;case"/*global":t=pt;break;default:l("What?")}a=Xt.token();e:for(;;){for(;;){if("special"===a.type&&"*/"===a.value)break e;if("(endline)"!==a.id&&","!==a.id)break;a=Xt.token()}"(string)"!==a.type&&"(identifier)"!==a.type&&"/*members"!==n&&l("Bad option.",a),u=Xt.token(),":"===u.id?(u=Xt.token(),t===ot&&l("Expected '{a}' and instead saw '{b}'.",a,"*/",":"),"indent"!==a.value||"/*jshint"!==n&&"/*jslint"!==n?"maxerr"!==a.value||"/*jshint"!==n&&"/*jslint"!==n?"maxlen"!==a.value||"/*jshint"!==n&&"/*jslint"!==n?"true"===u.value?t[a.value]=!0:"false"===u.value?t[a.value]=!1:l("Bad option value.",u):(e=+u.value,("number"!=typeof e||!isFinite(e)||0>=e||Math.floor(e)!==e)&&l("Expected a small integer and instead saw '{a}'.",u,u.value),t.maxlen=e):(e=+u.value,("number"!=typeof e||!isFinite(e)||0>=e||Math.floor(e)!==e)&&l("Expected a small integer and instead saw '{a}'.",u,u.value),t.maxerr=e):(e=+u.value,("number"!=typeof e||!isFinite(e)||0>=e||Math.floor(e)!==e)&&l("Expected a small integer and instead saw '{a}'.",u,u.value),t.white=!0,t.indent=e),a=Xt.token()):(("/*jshint"===n||"/*jslint"===n)&&l("Missing option value.",a),t[a.value]=!1,a=u)}i&&s()}function d(e){for(var t,i=e||0,a=0;i>=a;)t=rt[a],t||(t=rt[a]=Xt.token()),a+=1;return t}function p(e,t){switch(yt.id){case"(number)":"."===ct.id&&n("A dot following a number can be confused with a decimal point.",yt);break;case"-":("-"===ct.id||"--"===ct.id)&&n("Confusing minusses.");break;case"+":("+"===ct.id||"++"===ct.id)&&n("Confusing plusses.")}for(("(string)"===yt.type||yt.identifier)&&($=yt.value),e&&ct.id!==e&&(t?"(end)"===ct.id?n("Unmatched '{a}'.",t,t.id):n("Expected '{a}' to match '{b}' from line {c} and instead saw '{d}'.",ct,e,t.id,t.line,ct.value):("(identifier)"!==ct.type||ct.value!==e)&&n("Expected '{a}' and instead saw '{b}'.",ct,e,ct.value)),ht=yt,yt=ct;;){if(ct=rt.shift()||Xt.token(),"(end)"===ct.id||"(error)"===ct.id)return;if("special"===ct.type)m();else if("(endline)"!==ct.id)break}}function v(e,t){var i,a=!1;if("(end)"===ct.id&&l("Unexpected early end of program.",yt),p(),t&&($="anonymous",Z["(verb)"]=yt.value),t===!0&&yt.fud)i=yt.fud();else{if(yt.nud)i=yt.nud();else{if("(number)"===ct.type&&"."===yt.id)return n("A leading decimal point can be confused with a dot: '.{a}'.",yt,ct.value),p(),yt;l("Expected an identifier and instead saw '{a}'.",yt,yt.id)}for(;ct.lbp>e;)a="Array"==yt.value,p(),a&&"("==yt.id&&")"==ct.id&&n("Use the array literal notation [].",yt),yt.led?i=yt.led(i):l("Expected an operator and instead saw '{a}'.",yt,yt.id)}return i}function h(e,t){e=e||yt,t=t||ct,dt.white&&e.character!==t.from&&e.line===t.line&&n("Unexpected space after '{a}'.",t,e.value)}function g(e,t){e=e||yt,t=t||ct,!dt.white||e.character===t.from&&e.line===t.line||n("Unexpected space before '{a}'.",t,t.value)}function f(e,t){e=e||yt,t=t||ct,dt.white&&!e.comment&&e.line===t.line&&h(e,t)}function b(e,t){dt.white&&(e=e||yt,t=t||ct,e.line===t.line&&e.character===t.from&&n("Missing space after '{a}'.",ct,e.value))}function q(e,t){e=e||yt,t=t||ct,dt.laxbreak||e.line===t.line?dt.white&&(e=e||yt,t=t||ct,e.character===t.from&&n("Missing space after '{a}'.",ct,e.value)):n("Bad line breaking before '{a}'.",t,t.id)}function _(e){var t;dt.white&&"(end)"!==ct.id&&(t=st+(e||0),ct.from!==t&&n("Expected '{a}' to have an indentation at {b} instead at {c}.",ct,ct.value,t,ct.from))}function y(e){e=e||yt,e.line!==ct.line&&n("Line breaking error '{a}'.",e,e.value)}function S(){yt.line!==ct.line?dt.laxbreak||n("Bad line breaking before '{a}'.",yt,ct.id):yt.character!==ct.from&&dt.white&&n("Unexpected space after '{a}'.",ct,yt.value),p(","),b(yt,ct)}function P(e,t){var i=Ft[e];return i&&"object"==typeof i||(Ft[e]=i={id:e,lbp:t,value:e}),i}function C(e){return P(e,0)}function D(e,t){var i=C(e);return i.identifier=i.reserved=!0,i.fud=t,i}function N(e,t){var i=D(e,t);return i.block=!0,i}function E(e){var t=e.id.charAt(0);return(t>="a"&&"z">=t||t>="A"&&"Z">=t)&&(e.identifier=e.reserved=!0),e}function M(e,t){var i=P(e,150);return E(i),i.nud="function"==typeof t?t:function(){return this.right=v(150),this.arity="unary",("++"===this.id||"--"===this.id)&&(dt.plusplus?n("Unexpected use of '{a}'.",this,this.id):this.right.identifier&&!this.right.reserved||"."===this.right.id||"["===this.right.id||n("Bad operand.",this)),this},i}function w(e,t){var i=C(e);return i.type=e,i.nud=t,i}function A(e,t){var i=w(e,t);return i.identifier=i.reserved=!0,i}function x(e,t){return A(e,function(){return"function"==typeof t&&t(this),this})}function I(e,t,i,a){var s=P(e,i);return E(s),s.led=function(e){return a||(q(ht,yt),b(yt,ct)),"function"==typeof t?t(e,this):(this.left=e,this.right=v(i),this)},s}function T(e,t){var i=P(e,100);return i.led=function(e){q(ht,yt),b(yt,ct);var i=v(100);return e&&"NaN"===e.id||i&&"NaN"===i.id?n("Use the isNaN function to compare with NaN.",this):t&&t.apply(this,[e,i]),"!"===e.id&&n("Confusing use of '{a}'.",e,"!"),"!"===i.id&&n("Confusing use of '{a}'.",e,"!"),this.left=e,this.right=i,this},i}function L(e){return e&&("(number)"===e.type&&0===+e.value||"(string)"===e.type&&""===e.value||"null"===e.type&&!dt.eqnull||"true"===e.type||"false"===e.type||"undefined"===e.type)}function j(e){return P(e,20).exps=!0,I(e,function(e,t){if(t.left=e,pt[e.value]===!1&&gt[e.value]["(global)"]===!0?n("Read only.",e):e["function"]&&n("'{a}' is a function.",e,e.value),e){if("."===e.id||"["===e.id)return e.left&&"arguments"!==e.left.value||n("Bad assignment.",t),t.right=v(19),t;if(e.identifier&&!e.reserved)return"exception"===Z[e.value]&&n("Do not assign to the exception parameter.",e),t.right=v(19),t;e===Ft["function"]&&n("Expected an identifier in an assignment and instead saw a function invocation.",yt)}l("Bad assignment.",t)},20)}function O(e,t,i){var a=P(e,i);return E(a),a.led="function"==typeof t?t:function(e){return dt.bitwise&&n("Unexpected use of '{a}'.",this,this.id),this.left=e,this.right=v(i),this},a}function V(e){return P(e,20).exps=!0,I(e,function(e,t){return dt.bitwise&&n("Unexpected use of '{a}'.",t,t.id),b(ht,yt),b(yt,ct),e?"."===e.id||"["===e.id||e.identifier&&!e.reserved?(v(19),t):(e===Ft["function"]&&n("Expected an identifier in an assignment, and instead saw a function invocation.",yt),t):(l("Bad assignment.",t),void 0)},20)}function F(e){var t=P(e,150);return t.led=function(e){return dt.plusplus?n("Unexpected use of '{a}'.",this,this.id):e.identifier&&!e.reserved||"."===e.id||"["===e.id||n("Bad operand.",this),this.left=e,this},t}function R(e){return ct.identifier?(p(),yt.reserved&&!dt.es5&&(e&&"undefined"==yt.value||n("Expected an identifier and instead saw '{a}' (a reserved word).",yt,yt.id)),yt.value):void 0}function k(e){var t=R(e);return t?t:("function"===yt.id&&"("===ct.id?n("Missing name in function declaration."):l("Expected an identifier and instead saw '{a}'.",ct,ct.value),void 0)}function z(e){var t,i=0;if(";"===ct.id&&!mt)for(;;){if(t=d(i),t.reach)return;if("(endline)"!==t.id){if("function"===t.id){n("Inner functions should be listed at the top of the outer function.",t);break}n("Unreachable '{a}' after '{b}'.",t,t.value,e);break}i+=1}}function U(e){var t,i=st,a=gt,s=ct;return";"===s.id?(n("Unnecessary semicolon.",s),p(";"),void 0):(s.identifier&&!s.reserved&&":"===d().id&&(p(),p(":"),gt=Object.create(a),c(s.value,"label"),ct.labelled||n("Label '{a}' on {b} statement.",ct,s.value,ct.value),Wt.test(s.value+":")&&n("Label '{a}' looks like a javascript url.",s,s.value),ct.label=s.value,s=ct),e||_(),t=v(0,!0),s.block||(dt.expr||t&&t.exps?dt.nonew&&"("===t.id&&"new"===t.left.id&&n("Do not use 'new' for side effects."):n("Expected an assignment or function call and instead saw an expression.",yt),";"!==ct.id?dt.asi||dt.lastsemic&&"}"==ct.id&&ct.line==yt.line||r("Missing semicolon.",yt.line,yt.from+yt.value.length):(h(yt,ct),p(";"),b(yt,ct))),st=i,gt=a,t)}function B(){return"use strict"===ct.value?(qt&&n('Unnecessary "use strict".'),p(),p(";"),qt=!0,dt.newcap=!0,dt.undef=!0,!0):!1}function Q(){for(var e=[];!ct.reach&&"(end)"!==ct.id;)";"===ct.id?(n("Unnecessary semicolon."),p(";")):e.push(U());return e}function G(e,t){var i,a,s=at,u=st,r=qt,o=gt;if(at=e,gt=Object.create(gt),b(yt,ct),a=ct,"{"===ct.id){if(p("{"),"}"!==ct.id||yt.line!==ct.line){for(st+=dt.indent;!e&&ct.from>st;)st+=dt.indent;e||B()||r||!dt.strict||!Z["(context)"]["(global)"]||n('Missing "use strict" statement.'),i=Q(),qt=r,st-=dt.indent,_()}p("}",a),st=u}else e?((!t||dt.curly)&&n("Expected '{a}' and instead saw '{b}'.",ct,"{",ct.value),mt=!0,i=[U()],mt=!1):l("Expected '{a}' and instead saw '{b}'.",ct,"{",ct.value);return Z["(verb)"]=null,gt=o,at=s,!e||!dt.noempty||i&&0!==i.length||n("Empty block."),i}function W(e){ot&&"boolean"!=typeof ot[e]&&n("Unexpected /*member '{a}'.",yt,e),"number"==typeof lt[e]?lt[e]+=1:lt[e]=1}function H(e){var t=e.value,i=e.line,a=it[t];"function"==typeof a&&(a=!1),a?a[a.length-1]!==i&&a.push(i):(a=[i],it[t]=a)}function X(){var e=R(!0);return e||("(string)"===ct.id?(e=ct.value,p()):"(number)"===ct.id&&(e=""+ct.value,p())),e}function Y(){var e,t=ct,i=[];if(p("("),f(),")"===ct.id)return p(")"),f(ht,yt),void 0;for(;;){if(e=k(!0),i.push(e),c(e,"parameter"),","!==ct.id)return p(")",t),f(ht,yt),i;S()}}function K(e,t){var i,a=dt,s=gt;return dt=Object.create(dt),gt=Object.create(gt),Z={"(name)":e||'"'+$+'"',"(line)":ct.line,"(context)":Z,"(breakage)":0,"(loopage)":0,"(scope)":gt,"(statement)":t},i=Z,yt.funct=Z,et.push(Z),e&&c(e,"function"),Z["(params)"]=Y(),G(!1),gt=s,dt=a,Z["(last)"]=yt.line,Z=Z["(context)"],i}function J(){function e(){var e={},t=ct;if(p("{"),"}"!==ct.id)for(;;){if("(end)"===ct.id)l("Missing '}' to match '{' from line {a}.",ct,t.line);else{if("}"===ct.id){n("Unexpected comma.",yt);break}","===ct.id?l("Unexpected comma.",ct):"(string)"!==ct.id&&n("Expected a string and instead saw {a}.",ct,ct.value)}if(e[ct.value]===!0?n("Duplicate key '{a}'.",ct,ct.value):"__proto__"===ct.value?n("Stupid key '{a}'.",ct,ct.value):e[ct.value]=!0,p(),p(":"),J(),","!==ct.id)break;p(",")}p("}")}function t(){var e=ct;if(p("["),"]"!==ct.id)for(;;){if("(end)"===ct.id)l("Missing ']' to match '[' from line {a}.",ct,e.line);else{if("]"===ct.id){n("Unexpected comma.",yt);break}","===ct.id&&l("Unexpected comma.",ct)}if(J(),","!==ct.id)break;p(",")}p("]")}switch(ct.id){case"{":e();break;case"[":t();break;case"true":case"false":case"null":case"(number)":case"(string)":p();break;case"-":p("-"),yt.character!==ct.from&&n("Unexpected space after '-'.",yt),h(yt,ct),p("(number)");break;default:l("Expected a JSON value.",ct)}}var $,Z,et,tt,it,at,st,ut,nt,rt,lt,ot,ct,mt,dt,pt,vt,ht,gt,ft,bt,qt,_t,yt,St,Pt,Ct={"<":!0,"<=":!0,"==":!0,"===":!0,"!==":!0,"!=":!0,">":!0,">=":!0,"+":!0,"-":!0,"*":!0,"/":!0,"%":!0},Dt={asi:!0,bitwise:!0,boss:!0,browser:!0,couch:!0,curly:!0,debug:!0,devel:!0,dojo:!0,eqeqeq:!0,eqnull:!0,es5:!0,evil:!0,expr:!0,forin:!0,globalstrict:!0,immed:!0,jquery:!0,latedef:!0,laxbreak:!0,loopfunc:!0,mootools:!0,newcap:!0,noarg:!0,node:!0,noempty:!0,nonew:!0,nomen:!0,onevar:!0,passfail:!0,plusplus:!0,prototypejs:!0,regexdash:!0,regexp:!0,rhino:!0,undef:!0,scripturl:!0,shadow:!0,strict:!0,sub:!0,supernew:!0,trailing:!0,white:!0,wsh:!0},Nt={ArrayBuffer:!1,ArrayBufferView:!1,addEventListener:!1,applicationCache:!1,blur:!1,clearInterval:!1,clearTimeout:!1,close:!1,closed:!1,DataView:!1,defaultStatus:!1,document:!1,event:!1,FileReader:!1,Float32Array:!1,Float64Array:!1,focus:!1,frames:!1,getComputedStyle:!1,HTMLElement:!1,history:!1,Int16Array:!1,Int32Array:!1,Int8Array:!1,Image:!1,length:!1,localStorage:!1,location:!1,moveBy:!1,moveTo:!1,name:!1,navigator:!1,onbeforeunload:!0,onblur:!0,onerror:!0,onfocus:!0,onload:!0,onresize:!0,onunload:!0,open:!1,openDatabase:!1,opener:!1,Option:!1,parent:!1,print:!1,removeEventListener:!1,resizeBy:!1,resizeTo:!1,screen:!1,scroll:!1,scrollBy:!1,scrollTo:!1,setInterval:!1,setTimeout:!1,status:!1,top:!1,Uint16Array:!1,Uint32Array:!1,Uint8Array:!1,WebSocket:!1,window:!1,Worker:!1,XMLHttpRequest:!1,XPathEvaluator:!1,XPathException:!1,XPathExpression:!1,XPathNamespace:!1,XPathNSResolver:!1,XPathResult:!1},Et={require:!1,respond:!1,getRow:!1,emit:!1,send:!1,start:!1,sum:!1,log:!1,exports:!1,module:!1},Mt={alert:!1,confirm:!1,console:!1,Debug:!1,opera:!1,prompt:!1},wt={dojo:!1,dijit:!1,dojox:!1,define:!1,require:!1},At={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"/":"\\/","\\":"\\\\"},xt=["closure","exception","global","label","outer","unused","var"],It={$:!1,jQuery:!1},Tt={$:!1,$$:!1,Assets:!1,Browser:!1,Chain:!1,Class:!1,Color:!1,Cookie:!1,Core:!1,Document:!1,DomReady:!1,DOMReady:!1,Drag:!1,Element:!1,Elements:!1,Event:!1,Events:!1,Fx:!1,Group:!1,Hash:!1,HtmlTable:!1,Iframe:!1,IframeShim:!1,InputValidator:!1,instanceOf:!1,Keyboard:!1,Locale:!1,Mask:!1,MooTools:!1,Native:!1,Options:!1,OverText:!1,Request:!1,Scroller:!1,Slick:!1,Slider:!1,Sortables:!1,Spinner:!1,Swiff:!1,Tips:!1,Type:!1,typeOf:!1,URI:!1,Window:!1},Lt={__filename:!1,__dirname:!1,exports:!1,Buffer:!1,GLOBAL:!1,global:!1,module:!1,process:!1,require:!1},jt={$:!1,$$:!1,$A:!1,$F:!1,$H:!1,$R:!1,$break:!1,$continue:!1,$w:!1,Abstract:!1,Ajax:!1,Class:!1,Enumerable:!1,Element:!1,Event:!1,Field:!1,Form:!1,Hash:!1,Insertion:!1,ObjectRange:!1,PeriodicalExecuter:!1,Position:!1,Prototype:!1,Selector:!1,Template:!1,Toggle:!1,Try:!1,Autocompleter:!1,Builder:!1,Control:!1,Draggable:!1,Draggables:!1,Droppables:!1,Effect:!1,Sortable:!1,SortableObserver:!1,Sound:!1,Scriptaculous:!1},Ot={defineClass:!1,deserialize:!1,gc:!1,help:!1,load:!1,loadClass:!1,print:!1,quit:!1,readFile:!1,readUrl:!1,runCommand:!1,seal:!1,serialize:!1,spawn:!1,sync:!1,toint32:!1,version:!1},Vt={Array:!1,Boolean:!1,Date:!1,decodeURI:!1,decodeURIComponent:!1,encodeURI:!1,encodeURIComponent:!1,Error:!1,eval:!1,EvalError:!1,Function:!1,hasOwnProperty:!1,isFinite:!1,isNaN:!1,JSON:!1,Math:!1,Number:!1,Object:!1,parseInt:!1,parseFloat:!1,RangeError:!1,ReferenceError:!1,RegExp:!1,String:!1,SyntaxError:!1,TypeError:!1,URIError:!1},Ft={},Rt={ActiveXObject:!0,Enumerator:!0,GetObject:!0,ScriptEngine:!0,ScriptEngineBuildVersion:!0,ScriptEngineMajorVersion:!0,ScriptEngineMinorVersion:!0,VBArray:!0,WSH:!0,WScript:!0},kt=/[\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/,zt=/^\s*([(){}\[.,:;'"~\?\]#@]|==?=?|\/(\*(jshint|jslint|members?|global)?|=|\/)?|\*[\/=]?|\+(?:=|\++)?|-(?:=|-+)?|%=?|&[&=]?|\|[|=]?|>>?>?=?|<([\/=!]|\!(\[|--)?|<=?)?|\^=?|\!=?=?|[a-zA-Z_$][a-zA-Z0-9_$]*|[0-9]+([xX][0-9a-fA-F]+|\.[0-9]*)?([eE][+\-]?[0-9]+)?)/,Ut=/[\u0000-\u001f&<"\/\\\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/,Bt=/[\u0000-\u001f&<"\/\\\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,Qt=/\*\/|\/\*/,Gt=/^([a-zA-Z_$][a-zA-Z0-9_$]*)$/,Wt=/^(?:javascript|jscript|ecmascript|vbscript|mocha|livescript)\s*:/i,Ht=/^\s*\/\*\s*falls\sthrough\s*\*\/\s*$/;"function"!=typeof Array.isArray&&(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.apply(e)}),"function"!=typeof Object.create&&(Object.create=function(e){return t.prototype=e,new t}),"function"!=typeof Object.keys&&(Object.keys=function(e){var t,a=[];for(t in e)i(e,t)&&a.push(t);return a}),"function"!=typeof String.prototype.entityify&&(String.prototype.entityify=function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}),"function"!=typeof String.prototype.isAlpha&&(String.prototype.isAlpha=function(){return this>="a"&&"z￿">=this||this>="A"&&"Z￿">=this}),"function"!=typeof String.prototype.isDigit&&(String.prototype.isDigit=function(){return this>="0"&&"9">=this}),"function"!=typeof String.prototype.supplant&&(String.prototype.supplant=function(e){return this.replace(/\{([^{}]*)\}/g,function(t,i){var a=e[i];return"string"==typeof a||"number"==typeof a?a:t})}),"function"!=typeof String.prototype.name&&(String.prototype.name=function(){return Gt.test(this)?this:Ut.test(this)?'"'+this.replace(Bt,function(e){var t=At[e];return t?t:"\\u"+("0000"+e.charCodeAt().toString(16)).slice(-4)})+'"':'"'+this+'"'});var Xt=function Xt(){function e(){var e,t;return u>=nt.length?!1:(a=1,n=nt[u],u+=1,e=n.search(/ \t/),e>=0&&r("Mixed spaces and tabs.",u,e+1),n=n.replace(/\t/g,_t),e=n.search(kt),e>=0&&r("Unsafe character.",u,e),dt.maxlen&&dt.maxlen<n.length&&r("Line too long.",u,n.length),t=n.search(/\s+$/),dt.trailing&&~t&&!~n.search(/^\s+$/)&&r("Trailing whitespace.",u,t),!0)}function t(e,t){var n,l;return l="(color)"===e||"(range)"===e?{type:e}:"(punctuator)"===e||"(identifier)"===e&&i(Ft,t)?Ft[t]||Ft["(error)"]:Ft[e],l=Object.create(l),("(string)"===e||"(range)"===e)&&!dt.scripturl&&Wt.test(t)&&r("Script URL.",u,s),"(identifier)"===e&&(l.identifier=!0,"__iterator__"===t||"__proto__"===t?o("Reserved name '{a}'.",u,s,t):!dt.nomen||"_"!==t.charAt(0)&&"_"!==t.charAt(t.length-1)||r("Unexpected {a} in '{b}'.",u,s,"dangling '_'",t)),l.value=t,l.line=u,l.character=a,l.from=s,n=l.id,"(endline)"!==n&&(vt=n&&("(,=:[!&|?{};".indexOf(n.charAt(n.length-1))>=0||"return"===n)),l}var a,s,u,n;return{init:function(t){nt="string"==typeof t?t.replace(/\r\n/g,"\n").replace(/\r/g,"\n").split("\n"):t,nt[0]&&"#!"==nt[0].substr(0,2)&&(nt[0]=""),u=0,e(),s=1},range:function(e,i){var l,c="";for(s=a,n.charAt(0)!==e&&o("Expected '{a}' and instead saw '{b}'.",u,a,e,n.charAt(0));;){switch(n=n.slice(1),a+=1,l=n.charAt(0)){case"":o("Missing '{a}'.",u,a,l);break;case i:return n=n.slice(1),a+=1,t("(range)",c);case"\\":r("Unexpected '{a}'.",u,a,l)}c+=l}},token:function(){function i(e){var t,i=e.exec(n);return i?(f=i[0].length,t=i[1],m=t.charAt(0),n=n.substr(f),s=a+f-t.length,a+=f,t):void 0}function l(i){function l(e){var t=parseInt(n.substr(m+1,e),16);m+=e,t>=32&&126>=t&&34!==t&&92!==t&&39!==t&&r("Unnecessary escapement.",u,a),a+=e,c=String.fromCharCode(t)}var c,m,d="";for(ut&&'"'!==i&&r("Strings must use doublequote.",u,a),m=0;;){for(;m>=n.length;)m=0,e()||o("Unclosed string.",u,s);if(c=n.charAt(m),c===i)return a+=1,n=n.substr(m+1),t("(string)",d,i);if(" ">c){if("\n"===c||"\r"===c)break;r("Control character in string: {a}.",u,a+m,n.slice(0,m))}else if("\\"===c)switch(m+=1,a+=1,c=n.charAt(m)){case"\\":case'"':case"/":break;case"'":ut&&r("Avoid \\'.",u,a);break;case"b":c="\b";break;case"f":c="\f";break;case"n":c="\n";break;case"r":c="\r";break;case"t":c="	";break;case"u":l(4);break;case"v":ut&&r("Avoid \\v.",u,a),c="";break;case"x":ut&&r("Avoid \\x-.",u,a),l(2);break;default:r("Bad escapement.",u,a)}d+=c,a+=1,m+=1}}for(var c,m,d,p,v,h,g,f,b,q,_;;){if(!n)return t(e()?"(endline)":"(end)","");if(_=i(zt)){if(m.isAlpha()||"_"===m||"$"===m)return t("(identifier)",_);if(m.isDigit())return isFinite(Number(_))||r("Bad number '{a}'.",u,a,_),n.substr(0,1).isAlpha()&&r("Missing space after '{a}'.",u,a,_),"0"===m&&(p=_.substr(1,1),p.isDigit()?"."!==yt.id&&r("Don't use extra leading zeros '{a}'.",u,a,_):!ut||"x"!==p&&"X"!==p||r("Avoid 0x-. '{a}'.",u,a,_)),"."===_.substr(_.length-1)&&r("A trailing decimal point can be confused with a dot '{a}'.",u,a,_),t("(number)",_);switch(_){case'"':case"'":return l(_);case"//":ft&&r("Unexpected comment.",u,a),n="",yt.comment=!0;break;case"/*":for(ft&&r("Unexpected comment.",u,a);g=n.search(Qt),!(g>=0);)e()||o("Unclosed comment.",u,a);a+=g+2,"/"===n.substr(g,1)&&o("Nested comment.",u,a),n=n.substr(g+2),yt.comment=!0;break;case"/*members":case"/*member":case"/*jshint":case"/*jslint":case"/*global":case"*/":return{value:_,type:"special",line:u,character:a,from:s};case"":break;case"/":if("/="===yt.id&&o("A regular expression literal can be confused with '/='.",u,s),vt){for(v=0,d=0,f=0;;){switch(c=!0,m=n.charAt(f),f+=1,m){case"":return o("Unclosed regular expression.",u,s),void 0;case"/":for(v>0&&r("Unescaped '{a}'.",u,s+f,"/"),m=n.substr(0,f-1),q={g:!0,i:!0,m:!0};q[n.charAt(f)]===!0;)q[n.charAt(f)]=!1,f+=1;
return a+=f,n=n.substr(f),q=n.charAt(0),("/"===q||"*"===q)&&o("Confusing regular expression.",u,s),t("(regexp)",m);case"\\":m=n.charAt(f)," ">m?r("Unexpected control character in regular expression.",u,s+f):"<"===m&&r("Unexpected escaped character '{a}' in regular expression.",u,s+f,m),f+=1;break;case"(":if(v+=1,c=!1,"?"===n.charAt(f))switch(f+=1,n.charAt(f)){case":":case"=":case"!":f+=1;break;default:r("Expected '{a}' and instead saw '{b}'.",u,s+f,":",n.charAt(f))}else d+=1;break;case"|":c=!1;break;case")":0===v?r("Unescaped '{a}'.",u,s+f,")"):v-=1;break;case" ":for(q=1;" "===n.charAt(f);)f+=1,q+=1;q>1&&r("Spaces are hard to count. Use {{a}}.",u,s+f,q);break;case"[":m=n.charAt(f),"^"===m&&(f+=1,dt.regexp?r("Insecure '{a}'.",u,s+f,m):"]"===n.charAt(f)&&o("Unescaped '{a}'.",u,s+f,"^")),q=!1,"]"===m&&(r("Empty class.",u,s+f-1),q=!0);e:do switch(m=n.charAt(f),f+=1,m){case"[":case"^":r("Unescaped '{a}'.",u,s+f,m),q=!0;break;case"-":q?q=!1:(r("Unescaped '{a}'.",u,s+f,"-"),q=!0);break;case"]":q||dt.regexdash||r("Unescaped '{a}'.",u,s+f-1,"-");break e;case"\\":m=n.charAt(f)," ">m?r("Unexpected control character in regular expression.",u,s+f):"<"===m&&r("Unexpected escaped character '{a}' in regular expression.",u,s+f,m),f+=1,q=!0;break;case"/":r("Unescaped '{a}'.",u,s+f-1,"/"),q=!0;break;case"<":q=!0;break;default:q=!0}while(m);break;case".":dt.regexp&&r("Insecure '{a}'.",u,s+f,m);break;case"]":case"?":case"{":case"}":case"+":case"*":r("Unescaped '{a}'.",u,s+f,m)}if(c)switch(n.charAt(f)){case"?":case"+":case"*":f+=1,"?"===n.charAt(f)&&(f+=1);break;case"{":for(f+=1,m=n.charAt(f),("0">m||m>"9")&&r("Expected a number and instead saw '{a}'.",u,s+f,m),f+=1,b=+m;m=n.charAt(f),!("0">m||m>"9");)f+=1,b=+m+10*b;if(h=b,","===m&&(f+=1,h=1/0,m=n.charAt(f),m>="0"&&"9">=m))for(f+=1,h=+m;m=n.charAt(f),!("0">m||m>"9");)f+=1,h=+m+10*h;"}"!==n.charAt(f)?r("Expected '{a}' and instead saw '{b}'.",u,s+f,"}",m):f+=1,"?"===n.charAt(f)&&(f+=1),b>h&&r("'{a}' should not be greater than '{b}'.",u,s+f,b,h)}}return m=n.substr(0,f-1),a+=f,n=n.substr(f),t("(regexp)",m)}return t("(punctuator)",_);case"#":return t("(punctuator)",_);default:return t("(punctuator)",_)}}else{for(_="",m="";n&&"!">n;)n=n.substr(1);n&&o("Unexpected '{a}'.",u,a,n.substr(0,1))}}}}}();w("(number)",function(){return this}),w("(string)",function(){return this}),Ft["(identifier)"]={type:"(identifier)",lbp:0,identifier:!0,nud:function(){var e,t=this.value,i=gt[t];if("function"==typeof i?i=void 0:"boolean"==typeof i&&(e=Z,Z=et[0],c(t,"var"),i=Z,Z=e),Z===i)switch(Z[t]){case"unused":Z[t]="var";break;case"unction":Z[t]="function",this["function"]=!0;break;case"function":this["function"]=!0;break;case"label":n("'{a}' is a statement label.",yt,t)}else if(Z["(global)"])"typeof"!=$&&"delete"!=$&&dt.undef&&"boolean"!=typeof pt[t]&&n("'{a}' is not defined.",yt,t),H(yt);else switch(Z[t]){case"closure":case"function":case"var":case"unused":n("'{a}' used out of scope.",yt,t);break;case"label":n("'{a}' is a statement label.",yt,t);break;case"outer":case"global":break;default:if(i===!0)Z[t]=!0;else if(null===i)n("'{a}' is not allowed.",yt,t),H(yt);else if("object"!=typeof i)"typeof"!=$&&"delete"!=$&&dt.undef?n("'{a}' is not defined.",yt,t):Z[t]=!0,H(yt);else switch(i[t]){case"function":case"unction":this["function"]=!0,i[t]="closure",Z[t]=i["(global)"]?"global":"outer";break;case"var":case"unused":i[t]="closure",Z[t]=i["(global)"]?"global":"outer";break;case"closure":case"parameter":Z[t]=i["(global)"]?"global":"outer";break;case"label":n("'{a}' is a statement label.",yt,t)}}return this},led:function(){l("Expected an operator and instead saw '{a}'.",ct,ct.value)}},w("(regexp)",function(){return this}),C("(endline)"),C("(begin)"),C("(end)").reach=!0,C("</").reach=!0,C("<!"),C("<!--"),C("-->"),C("(error)").reach=!0,C("}").reach=!0,C(")"),C("]"),C('"').reach=!0,C("'").reach=!0,C(";"),C(":").reach=!0,C(","),C("#"),C("@"),A("else"),A("case").reach=!0,A("catch"),A("default").reach=!0,A("finally"),x("arguments",function(e){qt&&Z["(global)"]&&n("Strict violation.",e)}),x("eval"),x("false"),x("Infinity"),x("NaN"),x("null"),x("this",function(e){qt&&(Z["(statement)"]&&Z["(name)"].charAt(0)>"Z"||Z["(global)"])&&n("Strict violation.",e)}),x("true"),x("undefined"),j("=","assign",20),j("+=","assignadd",20),j("-=","assignsub",20),j("*=","assignmult",20),j("/=","assigndiv",20).nud=function(){l("A regular expression literal can be confused with '/='.")},j("%=","assignmod",20),V("&=","assignbitand",20),V("|=","assignbitor",20),V("^=","assignbitxor",20),V("<<=","assignshiftleft",20),V(">>=","assignshiftright",20),V(">>>=","assignshiftrightunsigned",20),I("?",function(e,t){return t.left=e,t.right=v(10),p(":"),t["else"]=v(10),t},30),I("||","or",40),I("&&","and",50),O("|","bitor",70),O("^","bitxor",80),O("&","bitand",90),T("==",function(e,t){var i=dt.eqnull&&("null"==e.value||"null"==t.value);return!i&&dt.eqeqeq?n("Expected '{a}' and instead saw '{b}'.",this,"===","=="):L(e)?n("Use '{a}' to compare with '{b}'.",this,"===",e.value):L(t)&&n("Use '{a}' to compare with '{b}'.",this,"===",t.value),this}),T("==="),T("!=",function(e,t){return dt.eqeqeq?n("Expected '{a}' and instead saw '{b}'.",this,"!==","!="):L(e)?n("Use '{a}' to compare with '{b}'.",this,"!==",e.value):L(t)&&n("Use '{a}' to compare with '{b}'.",this,"!==",t.value),this}),T("!=="),T("<"),T(">"),T("<="),T(">="),O("<<","shiftleft",120),O(">>","shiftright",120),O(">>>","shiftrightunsigned",120),I("in","in",120),I("instanceof","instanceof",120),I("+",function(e,t){var i=v(130);return e&&i&&"(string)"===e.id&&"(string)"===i.id?(e.value+=i.value,e.character=i.character,!dt.scripturl&&Wt.test(e.value)&&n("JavaScript URL.",e),e):(t.left=e,t.right=i,t)},130),M("+","num"),M("+++",function(){return n("Confusing pluses."),this.right=v(150),this.arity="unary",this}),I("+++",function(e){return n("Confusing pluses."),this.left=e,this.right=v(130),this},130),I("-","sub",130),M("-","neg"),M("---",function(){return n("Confusing minuses."),this.right=v(150),this.arity="unary",this}),I("---",function(e){return n("Confusing minuses."),this.left=e,this.right=v(130),this},130),I("*","mult",140),I("/","div",140),I("%","mod",140),F("++","postinc"),M("++","preinc"),Ft["++"].exps=!0,F("--","postdec"),M("--","predec"),Ft["--"].exps=!0,M("delete",function(){var e=v(0);return(!e||"."!==e.id&&"["!==e.id)&&n("Variables should not be deleted."),this.first=e,this}).exps=!0,M("~",function(){return dt.bitwise&&n("Unexpected '{a}'.",this,"~"),v(150),this}),M("!",function(){return this.right=v(150),this.arity="unary",Ct[this.right.id]===!0&&n("Confusing use of '{a}'.",this,"!"),this}),M("typeof","typeof"),M("new",function(){var e,t=v(155);if(t&&"function"!==t.id)if(t.identifier)switch(t["new"]=!0,t.value){case"Object":n("Use the object literal notation {}.",yt);break;case"Number":case"String":case"Boolean":case"Math":case"JSON":n("Do not use {a} as a constructor.",yt,t.value);break;case"Function":dt.evil||n("The Function constructor is eval.");break;case"Date":case"RegExp":break;default:"function"!==t.id&&(e=t.value.substr(0,1),dt.newcap&&("A">e||e>"Z")&&n("A constructor name should start with an uppercase letter.",yt))}else"."!==t.id&&"["!==t.id&&"("!==t.id&&n("Bad constructor.",yt);else dt.supernew||n("Weird construction. Delete 'new'.",this);return h(yt,ct),"("===ct.id||dt.supernew||n("Missing '()' invoking a constructor."),this.first=t,this}),Ft["new"].exps=!0,M("void").exps=!0,I(".",function(e,t){h(ht,yt),g();var i=k();return"string"==typeof i&&W(i),t.left=e,t.right=i,dt.noarg&&e&&"arguments"===e.value&&("callee"===i||"caller"===i)?n("Avoid arguments.{a}.",e,i):dt.evil||!e||"document"!==e.value||"write"!==i&&"writeln"!==i||n("document.write can be a form of eval.",e),dt.evil||"eval"!==i&&"execScript"!==i||n("eval is evil."),t},160,!0),I("(",function(e,t){"}"!==ht.id&&")"!==ht.id&&g(ht,yt),f(),dt.immed&&!e.immed&&"function"===e.id&&n("Wrap an immediate function invocation in parentheses to assist the reader in understanding that the expression is the result of a function, and not the function itself.");var i=0,a=[];if(e&&"(identifier)"===e.type&&e.value.match(/^[A-Z]([A-Z0-9_$]*[a-z][A-Za-z0-9_$]*)?$/)&&"Number"!==e.value&&"String"!==e.value&&"Boolean"!==e.value&&"Date"!==e.value&&("Math"===e.value?n("Math is not a function.",e):dt.newcap&&n("Missing 'new' prefix when invoking a constructor.",e)),")"!==ct.id)for(;a[a.length]=v(10),i+=1,","===ct.id;)S();return p(")"),f(ht,yt),"object"==typeof e&&("parseInt"===e.value&&1===i&&n("Missing radix parameter.",e),dt.evil||("eval"===e.value||"Function"===e.value||"execScript"===e.value?n("eval is evil.",e):!a[0]||"(string)"!==a[0].id||"setTimeout"!==e.value&&"setInterval"!==e.value||n("Implied eval is evil. Pass a function instead of a string.",e)),e.identifier||"."===e.id||"["===e.id||"("===e.id||"&&"===e.id||"||"===e.id||"?"===e.id||n("Bad invocation.",e)),t.left=e,t},155,!0).exps=!0,M("(",function(){f(),"function"===ct.id&&(ct.immed=!0);var e=v(0);return p(")",this),f(ht,yt),dt.immed&&"function"===e.id&&("("===ct.id?n("Move the invocation into the parens that contain the function.",ct):n("Do not wrap function literals in parens unless they are to be immediately invoked.",this)),e}),I("[",function(e,t){g(ht,yt),f();var i,a=v(0);return a&&"(string)"===a.type&&(dt.evil||"eval"!==a.value&&"execScript"!==a.value||n("eval is evil.",t),W(a.value),!dt.sub&&Gt.test(a.value)&&(i=Ft[a.value],i&&i.reserved||n("['{a}'] is better written in dot notation.",a,a.value))),p("]",t),f(ht,yt),t.left=e,t.right=a,t},160,!0),M("[",function(){var e=yt.line!==ct.line;for(this.first=[],e&&(st+=dt.indent,ct.from===st+dt.indent&&(st+=dt.indent));"(end)"!==ct.id;){for(;","===ct.id;)n("Extra comma."),p(",");if("]"===ct.id)break;if(e&&yt.line!==ct.line&&_(),this.first.push(v(10)),","!==ct.id)break;if(S(),"]"===ct.id&&!dt.es5){n("Extra comma.",yt);break}}return e&&(st-=dt.indent,_()),p("]",this),this},160),function(e){e.nud=function(){var e,t,i,a,s,u,r={};for(e=yt.line!==ct.line,e&&(st+=dt.indent,ct.from===st+dt.indent&&(st+=dt.indent));"}"!==ct.id;){if(e&&_(),"get"===ct.value&&":"!==d().id)p("get"),dt.es5||l("get/set are ES5 features."),i=X(),i||l("Missing property name."),u=ct,h(yt,ct),t=K(),!dt.loopfunc&&Z["(loopage)"]&&n("Don't make functions within a loop.",u),s=t["(params)"],s&&n("Unexpected parameter '{a}' in get {b} function.",u,s[0],i),h(yt,ct),p(","),_(),p("set"),a=X(),i!==a&&l("Expected {a} and instead saw {b}.",yt,i,a),u=ct,h(yt,ct),t=K(),s=t["(params)"],s&&1===s.length&&"value"===s[0]||n("Expected (value) in set {a} function.",u,i);else{if(i=X(),"string"!=typeof i)break;p(":"),b(yt,ct),v(10)}if(r[i]===!0&&n("Duplicate member '{a}'.",ct,i),r[i]=!0,W(i),","!==ct.id)break;S(),","===ct.id?n("Extra comma.",yt):"}"!==ct.id||dt.es5||n("Extra comma.",yt)}return e&&(st-=dt.indent,_()),p("}",this),this},e.fud=function(){l("Expected to see a statement and instead saw a block.",yt)}}(C("{"));var Yt=D("var",function(e){var t,i,a;for(Z["(onevar)"]&&dt.onevar?n("Too many var statements."):Z["(global)"]||(Z["(onevar)"]=!0),this.first=[];b(yt,ct),t=k(),Z["(global)"]&&pt[t]===!1&&n("Redefinition of '{a}'.",yt,t),c(t,"unused"),!e&&(i=yt,this.first.push(yt),"="===ct.id&&(b(yt,ct),p("="),b(yt,ct),"undefined"===ct.id&&n("It is not necessary to initialize '{a}' to 'undefined'.",yt,t),"="===d(0).id&&ct.identifier&&l("Variable {a} was not declared correctly.",ct,ct.value),a=v(0),i.first=a),","===ct.id);)S();return this});Yt.exps=!0,N("function",function(){at&&n("Function declarations should not be placed in blocks. Use a function expression or move the statement to the top of the outer function.",yt);var e=k();return h(yt,ct),c(e,"unction"),K(e,!0),"("===ct.id&&ct.line===yt.line&&l("Function declarations are not invocable. Wrap the whole function invocation in parens."),this}),M("function",function(){var e=R();return e?h(yt,ct):b(yt,ct),K(e),!dt.loopfunc&&Z["(loopage)"]&&n("Don't make functions within a loop."),this}),N("if",function(){var e=ct;return p("("),b(this,e),f(),v(20),"="===ct.id&&(dt.boss||n("Expected a conditional expression and instead saw an assignment."),p("="),v(20)),p(")",e),f(ht,yt),G(!0,!0),"else"===ct.id&&(b(yt,ct),p("else"),"if"===ct.id||"switch"===ct.id?U(!0):G(!0,!0)),this}),N("try",function(){var e,t,i;return G(!1),"catch"===ct.id&&(p("catch"),b(yt,ct),p("("),i=gt,gt=Object.create(i),t=ct.value,"(identifier)"!==ct.type?n("Expected an identifier and instead saw '{a}'.",ct,t):c(t,"exception"),p(),p(")"),G(!1),e=!0,gt=i),"finally"===ct.id?(p("finally"),G(!1),void 0):(e||l("Expected '{a}' and instead saw '{b}'.",ct,"catch",ct.value),this)}),N("while",function(){var e=ct;return Z["(breakage)"]+=1,Z["(loopage)"]+=1,p("("),b(this,e),f(),v(20),"="===ct.id&&(dt.boss||n("Expected a conditional expression and instead saw an assignment."),p("="),v(20)),p(")",e),f(ht,yt),G(!0,!0),Z["(breakage)"]-=1,Z["(loopage)"]-=1,this}).labelled=!0,A("with"),N("switch",function(){var e=ct,t=!1;for(Z["(breakage)"]+=1,p("("),b(this,e),f(),this.condition=v(20),p(")",e),f(ht,yt),b(yt,ct),e=ct,p("{"),b(yt,ct),st+=dt.indent,this.cases=[];;)switch(ct.id){case"case":switch(Z["(verb)"]){case"break":case"case":case"continue":case"return":case"switch":case"throw":break;default:Ht.test(nt[ct.line-2])||n("Expected a 'break' statement before 'case'.",yt)}_(-dt.indent),p("case"),this.cases.push(v(20)),t=!0,p(":"),Z["(verb)"]="case";break;case"default":switch(Z["(verb)"]){case"break":case"continue":case"return":case"throw":break;default:Ht.test(nt[ct.line-2])||n("Expected a 'break' statement before 'default'.",yt)}_(-dt.indent),p("default"),t=!0,p(":");break;case"}":return st-=dt.indent,_(),p("}",e),(1===this.cases.length||"true"===this.condition.id||"false"===this.condition.id)&&n("This 'switch' should be an 'if'.",this),Z["(breakage)"]-=1,Z["(verb)"]=void 0,void 0;case"(end)":return l("Missing '{a}'.",ct,"}"),void 0;default:if(t)switch(yt.id){case",":return l("Each value should have its own case label."),void 0;case":":Q();break;default:l("Missing ':' on a case clause.",yt)}else l("Expected '{a}' and instead saw '{b}'.",ct,"case",ct.value)}}).labelled=!0,D("debugger",function(){return dt.debug||n("All 'debugger' statements should be removed."),this}).exps=!0,function(){var e=D("do",function(){Z["(breakage)"]+=1,Z["(loopage)"]+=1,this.first=G(!0),p("while");var e=ct;return b(yt,e),p("("),f(),v(20),"="===ct.id&&(dt.boss||n("Expected a conditional expression and instead saw an assignment."),p("="),v(20)),p(")",e),f(ht,yt),Z["(breakage)"]-=1,Z["(loopage)"]-=1,this});e.labelled=!0,e.exps=!0}(),N("for",function(){var e,t=ct;if(Z["(breakage)"]+=1,Z["(loopage)"]+=1,p("("),b(this,t),f(),"in"===d("var"===ct.id?1:0).id){if("var"===ct.id)p("var"),Yt.fud.call(Yt,!0);else{switch(Z[ct.value]){case"unused":Z[ct.value]="var";break;case"var":break;default:n("Bad for in variable '{a}'.",ct,ct.value)}p()}return p("in"),v(20),p(")",t),e=G(!0,!0),dt.forin&&(e.length>1||"object"!=typeof e[0]||"if"!==e[0].value)&&n("The body of a for in should be wrapped in an if statement to filter unwanted properties from the prototype.",this),Z["(breakage)"]-=1,Z["(loopage)"]-=1,this}if(";"!==ct.id)if("var"===ct.id)p("var"),Yt.fud.call(Yt);else for(;v(0,"for"),","===ct.id;)S();if(y(yt),p(";"),";"!==ct.id&&(v(20),"="===ct.id&&(dt.boss||n("Expected a conditional expression and instead saw an assignment."),p("="),v(20))),y(yt),p(";"),";"===ct.id&&l("Expected '{a}' and instead saw '{b}'.",ct,")",";"),")"!==ct.id)for(;v(0,"for"),","===ct.id;)S();return p(")",t),f(ht,yt),G(!0,!0),Z["(breakage)"]-=1,Z["(loopage)"]-=1,this}).labelled=!0,D("break",function(){var e=ct.value;return 0===Z["(breakage)"]&&n("Unexpected '{a}'.",ct,this.value),y(this),";"!==ct.id&&yt.line===ct.line&&("label"!==Z[e]?n("'{a}' is not a statement label.",ct,e):gt[e]!==Z&&n("'{a}' is out of scope.",ct,e),this.first=ct,p()),z("break"),this}).exps=!0,D("continue",function(){var e=ct.value;return 0===Z["(breakage)"]&&n("Unexpected '{a}'.",ct,this.value),y(this),";"!==ct.id?yt.line===ct.line&&("label"!==Z[e]?n("'{a}' is not a statement label.",ct,e):gt[e]!==Z&&n("'{a}' is out of scope.",ct,e),this.first=ct,p()):Z["(loopage)"]||n("Unexpected '{a}'.",ct,this.value),z("continue"),this}).exps=!0,D("return",function(){return y(this),"(regexp)"===ct.id&&n("Wrap the /regexp/ literal in parens to disambiguate the slash operator."),";"===ct.id||ct.reach||(b(yt,ct),this.first=v(20)),z("return"),this}).exps=!0,D("throw",function(){return y(this),b(yt,ct),this.first=v(20),z("throw"),this}).exps=!0,A("class"),A("const"),A("enum"),A("export"),A("extends"),A("import"),A("super"),A("let"),A("yield"),A("implements"),A("interface"),A("package"),A("private"),A("protected"),A("public"),A("static");var Kt=function(t,i,u){var r,l,o;if(e.errors=[],pt=Object.create(Vt),a(pt,u||{}),i){if(r=i.predef)if(Array.isArray(r))for(l=0;r.length>l;l+=1)pt[r[l]]=!0;else if("object"==typeof r)for(o=Object.keys(r),l=0;o.length>l;l+=1)pt[o[l]]=!!r[o];dt=i}else dt={};for(dt.indent=dt.indent||4,dt.maxerr=dt.maxerr||50,_t="",l=0;dt.indent>l;l+=1)_t+=" ";st=1,tt=Object.create(pt),gt=tt,Z={"(global)":!0,"(name)":"(global)","(scope)":gt,"(breakage)":0,"(loopage)":0},et=[Z],St=[],ft=!1,bt=null,lt={},ot=null,it={},at=!1,rt=[],ut=!1,Pt=0,Xt.init(t),vt=!0,qt=!1,ht=yt=ct=Ft["(begin)"],s();try{switch(p(),ct.id){case"{":case"[":dt.laxbreak=!0,ut=!0,J();break;default:"use strict"===ct.value&&(dt.globalstrict||n('Use the function form of "use strict".'),B()),Q("lib")}p("(end)")}catch(c){c&&e.errors.push({reason:c.message,line:c.line||ct.line,character:c.character||ct.from},null)}return 0===e.errors.length};return e.data=function(){var t,a,s,u,n,r,l,o={functions:[]},c=[],m=[],d=[];e.errors.length&&(o.errors=e.errors),ut&&(o.json=!0);for(r in it)i(it,r)&&c.push({name:r,line:it[r]});for(c.length>0&&(o.implieds=c),St.length>0&&(o.urls=St),a=Object.keys(gt),a.length>0&&(o.globals=a),u=1;et.length>u;u+=1){for(s=et[u],t={},n=0;xt.length>n;n+=1)t[xt[n]]=[];for(r in s)i(s,r)&&"("!==r.charAt(0)&&(l=s[r],"unction"===l&&(l="unused"),Array.isArray(t[l])&&(t[l].push(r),"unused"===l&&d.push({name:r,line:s["(line)"],"function":s["(name)"]})));for(n=0;xt.length>n;n+=1)0===t[xt[n]].length&&delete t[xt[n]];t.name=s["(name)"],t.param=s["(params)"],t.line=s["(line)"],t.last=s["(last)"],o.functions.push(t)}d.length>0&&(o.unused=d),m=[];for(r in lt)if("number"==typeof lt[r]){o.member=lt;break}return o},e.report=function(t){function i(e,t){var i,a,s;if(t){for(h.push("<div><i>"+e+"</i> "),t=t.sort(),a=0;t.length>a;a+=1)t[a]!==s&&(s=t[a],h.push((i?", ":"")+s),i=!0);h.push("</div>")}}var a,s,u,n,r,l,o,c,m,d=e.data(),p=[],v="",h=[];if(d.errors||d.implieds||d.unused){if(u=!0,h.push("<div id=errors><i>Error:</i>"),d.errors)for(r=0;d.errors.length>r;r+=1)a=d.errors[r],a&&(s=a.evidence||"",h.push("<p>Problem"+(isFinite(a.line)?" at line "+a.line+" character "+a.character:"")+": "+a.reason.entityify()+"</p><p class=evidence>"+(s&&(s.length>80?s.slice(0,77)+"...":s).entityify())+"</p>"));if(d.implieds){for(m=[],r=0;d.implieds.length>r;r+=1)m[r]="<code>"+d.implieds[r].name+"</code>&nbsp;<i>"+d.implieds[r].line+"</i>";h.push("<p><i>Implied global:</i> "+m.join(", ")+"</p>")}if(d.unused){for(m=[],r=0;d.unused.length>r;r+=1)m[r]="<code><u>"+d.unused[r].name+"</u></code>&nbsp;<i>"+d.unused[r].line+"</i> <code>"+d.unused[r]["function"]+"</code>";h.push("<p><i>Unused variable:</i> "+m.join(", ")+"</p>")}d.json&&h.push("<p>JSON: bad.</p>"),h.push("</div>")}if(!t){for(h.push("<br><div id=functions>"),d.urls&&i("URLs<br>",d.urls,"<br>"),d.json&&!u?h.push("<p>JSON: good.</p>"):d.globals?h.push("<div><i>Global</i> "+d.globals.sort().join(", ")+"</div>"):h.push("<div><i>No new global variables introduced.</i></div>"),r=0;d.functions.length>r;r+=1)n=d.functions[r],h.push("<br><div class=function><i>"+n.line+"-"+n.last+"</i> "+(n.name||"")+"("+(n.param?n.param.join(", "):"")+")</div>"),i("<big><b>Unused</b></big>",n.unused),i("Closure",n.closure),i("Variable",n["var"]),i("Exception",n.exception),i("Outer",n.outer),i("Global",n.global),i("Label",n.label);if(d.member){if(p=Object.keys(d.member),p.length){for(p=p.sort(),v="<br><pre id=members>/*members ",o=10,r=0;p.length>r;r+=1)l=p[r],c=l.name(),o+c.length>72&&(h.push(v+"<br>"),v="    ",o=1),o+=c.length+2,1===d.member[l]&&(c="<i>"+c+"</i>"),p.length-1>r&&(c+=", "),v+=c;h.push(v+"<br>*/</pre>")}h.push("</div>")}}return h.join("")},e.jshint=Kt,e.edition="2011-04-16",Kt});"object"==typeof t&&(t.JSHINT=i),"undefined"!=typeof bootstrap&&bootstrap("core/jshint",function(e,t){"use strict";t.JSHINT=i})}}),montageDefine("d41c331","core/serialization/serializer/montage-ast",{dependencies:["../../core","mousse/serialization/ast"],factory:function(e,t){var i=e("../../core").Montage,a=e("mousse/serialization/ast").Value,s=i.specialize.call(a,{constructor:{value:function s(){}},initWithRootAndId:{value:function(e,t){return a.call(this,e,t),this}},_getSerializationValue:{value:function(){return{"#":this.value}}}}),u=i.specialize.call(a,{constructor:{value:function u(){}},initWithRootAndModuleId:{value:function(e,t){return a.call(this,e,t),this}},_getSerializationValue:{value:function(){return{"%":this.value}}}});t.ElementReference=s,t.ModuleReference=u}}),montageDefine("d41c331","core/serialization/serializer/properties-serializer",{dependencies:["../../core"],factory:function(e,t){var i=e("../../core").Montage,a=i.specialize.call(Object,{_malker:{value:null},_visitor:{value:null},_object:{value:null},constructor:{value:function a(){}},initWithMalkerAndVisitorAndObject:{value:function(e,t,i){return this._malker=e,this._visitor=t,this._object=i,this}},addObject:{value:function(e){return"object"==typeof e?(this._malker.visit(e),e):void 0}},addObjectReference:{value:function(e){var t=this._visitor.builder,i=this._visitor.labeler,a=i.getObjectLabel(e),u=Object.create(s);return u.reference=t.createReference(a),u}},set:{value:function(e,t,i){this._visitor.setProperty(this._malker,e,t,i)}},setAll:{value:function(){this._visitor.setSerializableObjectProperties(this._malker,this._object)}}}),s={thisIsAReferenceCreatedByMontageSerializer:!0,reference:null};t.PropertiesSerializer=a}}),montageDefine("d41c331","core/serialization/serializer/self-serializer",{dependencies:["../../core"],factory:function(e,t){var i=e("../../core").Montage,a=i.specialize.call(Object,{_malker:{value:null},_visitor:{value:null},_object:{value:null},constructor:{value:function a(){}},initWithMalkerAndVisitorAndObject:{value:function(e,t,i){return this._malker=e,this._visitor=t,this._object=i,this}},getObjectLabel:{value:function(e){return this._visitor.labeler.getObjectLabel(e)}},addObject:{value:function(e){return"object"==typeof e?(this._malker.visit(e),e):void 0}},addObjectReference:{value:function(e){var t=this._visitor.builder,i=this._visitor.labeler,a=i.getObjectLabel(e);return{thisIsAReferenceCreatedByMontageSerializer:!0,reference:t.createObjectReference(a)}}},setProperty:{value:function(e,t,i){var a,s=this._visitor.builder;a=s.top.getProperty("properties"),s.push(a),this._visitor.setProperty(this._malker,e,t,i),s.pop()}},setAllProperties:{value:function(){var e,t=this._visitor.builder;e=t.top.getProperty("properties"),t.push(e),this._visitor.setSerializableObjectProperties(this._malker,this._object),t.pop()}},setUnit:{value:function(e){this._visitor.setObjectCustomUnit(this._malker,this._object,e)}},setAllUnits:{value:function(){this._visitor.setObjectCustomUnits(this._malker,this._object)}}});t.SelfSerializer=a}}),montageDefine("d41c331","core/serialization/serializer/unit-serializer",{dependencies:["../../core"],factory:function(e,t){function i(e,t,i){this._visitor=e,this._malker=t,this._object=i}var a=e("../../core").Montage,i=a.specialize.call(Object,{_malker:{value:null},_visitor:{value:null},_object:{value:null},constructor:{value:function i(){}},initWithMalkerAndVisitorAndObject:{value:function(e,t,i){return this._malker=e,this._visitor=t,this._object=i,this}},getObjectLabel:{value:function(e){return this.addObjectReference(e),this._visitor.labeler.getObjectLabel(e)}},addObject:{value:function(e){return"object"==typeof e?(this._malker.visit(e),e):void 0}},addObjectReference:{value:function(e){var t=this._visitor.builder,i=this._visitor.labeler,a=i.getObjectLabel(e);return{thisIsAReferenceCreatedByMontageSerializer:!0,reference:t.createObjectReference(a)}}}});t.UnitSerializer=i}}),montageDefine("d41c331","ui/loader.reel/loader",{dependencies:["../component","../../core/logger","../../core/event/event-manager"],factory:function(e,t){var i=e("../component").Component,a=e("../../core/logger").logger("loader"),s=e("../../core/event/event-manager").defaultEventManager,u="_montageStartBootstrappingTimeout",n="montage-app-loader",r="montage-app-bootstrapping",l="montage-app-loading",o="montage-app-loaded",c=0,m=1,d=2,p=3;t.Loader=i.specialize({constructor:{value:function(){this.super()}},mainModule:{value:"ui/main.reel"},mainName:{value:"Main"},includeFrameworkModules:{value:!1},minimumBootstrappingDuration:{value:1500},minimumLoadingDuration:{value:2e3},_initializedModules:{value:null},initializedModules:{dependencies:["includeFrameworkModules"],enumerable:!1,get:function(){return!this._initializedModules||this.includeFrameworkModules?this._initializedModules:this._initializedModules.slice(this._frameworkModuleCount-1)},set:function(e){this._initializedModules=e}},_requiredModules:{value:null},requiredModules:{dependencies:["includeFrameworkModules"],enumerable:!1,get:function(){return!this._requiredModules||this.includeFrameworkModules?this._requiredModules:this._requiredModules.slice(this._frameworkModuleCount-1)},set:function(e){this._requiredModules=e}},_currentStage:{value:c},currentStage:{get:function(){return this._currentStage},set:function(e){e!==this._currentStage&&(a.isDebug&&a.debug(this,"CURRENT STAGE: "+e),this._currentStage=e,this.needsDraw=!0)}},_readyToShowLoader:{value:!1},isLoadingMainComponent:{value:null},readyToShowLoader:{get:function(){return this._readyToShowLoader},set:function(e){e===this._readyToShowLoader&&(this._readyToShowLoader=e,this.needsDraw=!0)}},readyToShowMainComponent:{get:function(){return!!this._mainComponent}},_frameworkModuleCount:{enumerable:!1,value:null},hasTemplate:{enumerable:!1,value:!1},_mainComponent:{value:null},_mainComponentEnterDocument:{value:null},_showLoadingTimeout:{enumerable:!1,value:null},_showMainComponentTimeout:{enumerable:!1,value:null},templateDidLoad:{value:function(){a.isDebug&&a.debug(this,"templateDidLoad"),this.element||(this.element=document.documentElement,this.attachToParentComponent()),this.readyToShowLoader=!0;var e,t=document._montageTiming,i=this;t.bootstrappingStartTime?(a.isDebug&&a.debug(this,"had already started bootstrapping"),this.currentStage=m,t.bootstrappingEndTime=Date.now(),e=this.minimumBootstrappingDuration-(t.bootstrappingEndTime-t.bootstrappingStartTime),e>0?(a.isDebug&&a.debug(this,"still need to show bootstrapper for another "+e+"ms"),this._showLoadingTimeout=setTimeout(function(){i._revealLoader()},e)):this._revealLoader()):(a.isDebug&&a.debug(this,"bootstrapping has not started yet…"),this._loadMainComponent())}},_revealLoader:{value:function(){a.isDebug&&a.debug(this,"_revealLoader"),this.currentStage=d,document._montageTiming.loadingStartTime=Date.now();var e,t,i,s,u=document.getElementById(n);if(u)for(t=u.children,e=0;i=t[e];e++)(s=i.component)&&(s.attachToParentComponent(),s.needsDraw=!0)}},_revealMainComponent:{value:function(){a.isDebug&&a.debug(this,"_revealMainComponent"),this.currentStage=p}},_loadMainComponent:{value:function(){a.isDebug&&a.debug(this,"_loadMainComponent"),this.isLoadingMainComponent=!0;var e=this;mr.async(this.mainModule).then(function(t){if(!(e.mainName in t))throw Error(e.mainName+" was not found in "+e.mainModule);return e._mainLoadedCallback(t)}).done()}},_mainLoadedCallback:{value:function(e){a.isDebug&&a.debug(this,"_mainLoadedCallback"),this._mainComponent=e[this.mainName].create(),this._mainComponentEnterDocument=this._mainComponent.enterDocument,this._mainComponent.enterDocument=this.mainComponentEnterDocument.bind(this),this._mainComponent.setElementWithParentComponent(document.createElement("div"),this),this._mainComponent.attachToParentComponent(),this._mainComponent._canDrawOutsideDocument=!0,this._mainComponent.needsDraw=!0}},mainComponentEnterDocument:{value:function(){var e,t=this;a.isDebug&&a.debug(this,"main preparing to draw"),this.isLoadingMainComponent=!1,this._contentToRemove=document.createRange(),e=this.element===document.documentElement?document.body:this.element,this._contentToRemove.selectNodeContents(e),this.childComponents=[this._mainComponent],e.appendChild(this._mainComponent.element);var i,n,r=document[u],l=document._montageTiming;l.bootstrappingStartTime?l.bootstrappingStartTime&&!l.loadingStartTime?(clearTimeout(this._showLoadingTimeout),this._showLoadingTimeout=null,l.bootstrappingEndTime=Date.now(),(i=this.minimumBootstrappingDuration-(l.bootstrappingEndTime-l.bootstrappingStartTime))>0?(a.isDebug&&a.debug(this,"show bootstrapper for another "+i+"ms"),this._showMainComponentTimeout=setTimeout(function(){a.isDebug&&a.debug(this,"ok, shown bootstrapper long enough"),t._revealMainComponent()},i)):setTimeout(function(){a.isDebug&&a.debug(this,"ok, showing bootstrapper now"),t._revealMainComponent()},0)):l.loadingStartTime&&(l.loadingEndTime=Date.now(),(n=this.minimumLoadingDuration-(l.loadingEndTime-l.loadingStartTime))>0?(a.isDebug&&a.debug(this,"show loader for another "+n+"ms"),this._showMainComponentTimeout=setTimeout(function(){a.isDebug&&a.debug(this,"ok, shown loader long enough"),t._revealMainComponent()},n)):this._revealMainComponent()):(a.isDebug&&a.debug(this,"bootstrapper never shown"),clearTimeout(r),r=null,this._revealMainComponent());var o=this._mainComponent;return s.unregisterEventHandlerForElement(this.element),o.attachToParentComponent(),p>this.currentStage&&(this.currentStage=p),o.enterDocument=this._mainComponentEnterDocument,o.enterDocument?o.enterDocument.apply(o,arguments):void 0}},removeContentOnLoad:{value:!0},_forceContentRemoval:{enumerable:!1,value:!1},_contentToRemove:{enumerable:!1,value:null},removeContent:{value:function(){this._forceContentRemoval=!0,this.needsDraw=!0}},draw:{value:function(){if(this.readyToShowMainComponent||this.isLoadingMainComponent||(a.isDebug&&a.debug(this,"draw; start loading main component"),this._loadMainComponent()),d===this.currentStage)this.element.classList.remove(r),this.element.classList.add(l);else if(p===this.currentStage&&this._contentToRemove){this.element.classList.remove(r),this.element.classList.remove(l),(this.removeContentOnLoad||this._forceContentRemoval)&&(this._contentToRemove.extractContents(),this._contentToRemove=null),this.element.classList.add(o);var e=document.createEvent("CustomEvent");e.initCustomEvent("componentLoaded",!0,!0,this._mainComponent),this.dispatchEvent(e,!0,!0),this.detachFromParentComponent()}}}})}}),montageDefine("d41c331","ui/component",{dependencies:["../core/core","../core/target","../core/template","../core/document-resources","../core/gate","../core/promise","../core/event/event-manager","../core/serialization/alias","../core/logger","collections/set","../core/application"],factory:function(e,t){function i(e){return e?e._montage_metadata.objectName+":"+Object.hash(e)+" id: "+e.identifier:"NIL"}var a=e("../core/core").Montage,s=e("../core/target").Target,u=e("../core/template").Template,n=e("../core/document-resources").DocumentResources,r=e("../core/gate").Gate,l=e("../core/promise").Promise,o=e("../core/event/event-manager").defaultEventManager,c=e("../core/serialization/alias").Alias,m=e("../core/logger").logger("component"),d=e("../core/logger").logger("Drawing performance").color.green(),p=e("../core/logger").logger("drawing list").color.blue(),v=e("../core/logger").logger("drawing needsDraw").color.violet(),h=e("../core/logger").logger("drawing").color.blue(),g=e("collections/set"),f="data-montage-le-component",b="data-montage-le-arg",q="data-montage-le-arg-begin",_="data-montage-le-arg-end",y=t.Component=s.specialize({DOM_ARG_ATTRIBUTE:{value:"data-arg"},constructor:{value:function y(){this.super()
}},delegate:{value:null},_templateObjects:{serializable:!1,value:null},templateObjects:{serializable:!1,get:function(){return this._templateObjects||(this._templateObjects=Object.create(null)),!this._setupTemplateObjectsCompleted&&this._templateDocumentPart&&this._setupTemplateObjects(this._templateDocumentPart.objects),this._templateObjects},set:function(e){this._templateObjects=e}},_nextTarget:{value:null},nextTarget:{get:function(){return this._nextTarget||this.parentComponent},set:function(e){this._nextTarget=e}},_ownerDocumentPart:{value:null},_templateDocumentPart:{value:null},_domArguments:{value:null},_domArgumentNames:{value:null},_dispatchActionEvent:{value:function(){this.dispatchEvent(this.createActionEvent())},enumerable:!1},createActionEvent:{value:function(){var e=document.createEvent("CustomEvent");return e.initCustomEvent("action",!0,!0,null),e}},canDrawGate:{get:function(){return this._canDrawGate||(this._canDrawGate=(new r).initWithDelegate(this),this._canDrawGate.setField("componentTreeLoaded",!1)),this._canDrawGate},enumerable:!1},_blockDrawGate:{value:null},blockDrawGate:{enumerable:!1,get:function(){return this._blockDrawGate||(this._blockDrawGate=(new r).initWithDelegate(this),this._blockDrawGate.setField("element",!1),this._blockDrawGate.setField("drawRequested",!1)),this._blockDrawGate}},_firstDraw:{enumerable:!1,value:!0},_completedFirstDraw:{enumerable:!1,value:!1},originalElement:{value:null},_element:{enumerable:!1,value:null},element:{get:function(){return this._element},set:function(e){if(null==e)return console.warn("Tried to set element of ",this," to ",e),void 0;if(e.component&&e.component!==this)throw Error("Element "+e+" is already assigned to another component: "+e.component);if(window._montage_le_flag&&e.setAttribute(f,a.getInfoForObject(this).moduleId),this.isDeserializing)this.eventManager.registerEventHandlerForElement(this,e),this._isTemplateInstantiated?this._templateElement||(this._templateElement=e):(this._element=e,!this.blockDrawGate.value&&this._element&&this.blockDrawGate.setField("element",!0));else{if(!this._firstDraw)return console.error("Cannot change element of ",this," after it has been set"),void 0;this.eventManager.registerEventHandlerForElement(this,e),this._element=e,!this.blockDrawGate.value&&this._element&&this.blockDrawGate.setField("element",!0)}this._initializeClassListFromElement(e)}},getElementId:{value:function(){var e=this._element;return e?e.getAttribute("data-montage-id"):void 0}},_initDomArguments:{value:function(){var e,t,i,a={},s=this.element;e=s.querySelectorAll("*["+this.DOM_ARG_ATTRIBUTE+"]");e:for(var u,n=0;u=e[n];n++){for(i=u;(i=i.parentNode)!==s;)if(i.component)continue e;this._findAndDetachComponents(u),u.parentNode.removeChild(u),t=u.getAttribute(this.DOM_ARG_ATTRIBUTE),u.removeAttribute(this.DOM_ARG_ATTRIBUTE),a[t]=u}this._domArguments=a}},getDomArgumentNames:{value:function(){return this._domArgumentNames||(this._domArgumentNames=Object.keys(this._domArguments)),this._domArgumentNames}},extractDomArgument:{value:function(e){var t;return t=this._domArguments[e],this._domArguments[e]=null,t}},_getTemplateDomArgument:{value:function(e){var t,i,a,s,u,n,r=this._ownerDocumentPart.template;a=r.getElementById(this.getElementId()),t=a.querySelectorAll("*["+this.DOM_ARG_ATTRIBUTE+"='"+e+"']");e:for(var l,o=0;l=t[o];o++){for(i=l;(i=i.parentNode)!==a;)if(s=r.getElementId(i),s&&(u=r.getSerialization(),n=u.getSerializationLabelsWithElements(s),n.length>0))continue e;return l}}},getTemplateArgumentElement:{value:function(e){var t,i,a,s=this._ownerDocumentPart.template;if(window._montage_le_flag)var u=this.ownerComponent._montage_metadata.moduleId,n=this._montage_metadata.label;return"*"===e?(t=s.getElementById(this.getElementId()),i=s.document.createRange(),i.selectNodeContents(t),a=i.cloneContents(),window._montage_le_flag&&t.children.length>0&&this._leTagStarArgument(u,n,a)):(a=this._getTemplateDomArgument(e).cloneNode(!0),a.removeAttribute(this.DOM_ARG_ATTRIBUTE),window._montage_le_flag&&this._leTagNamedArgument(u,n,a,e)),a}},getTemplateArgumentSerialization:{value:function(e){var t=this._ownerDocumentPart.template;return t._createSerializationWithElementIds(e)}},resolveTemplateArgumentTemplateProperty:{value:function(e){var t,i,s,u,n=e.indexOf(":"),r=e.slice(0,n),l=e.slice(n),o=this._templateDocumentPart;return a.getInfoForObject(this).label===r?(o&&(s=o.objects[l]),s instanceof c&&(i=o.objects[s.componentLabel],t=s.value.slice(1),u=i.resolveTemplateArgumentTemplateProperty(t),u||(u=t)),u):void 0}},setElementWithParentComponent:{value:function(e,t){this._alternateParentComponent=t,this.element!==e&&(this.element=e)}},application:{enumerable:!1,get:function(){return e("../core/application").application}},eventManager:{enumerable:!1,get:function(){return o}},rootComponent:{enumerable:!1,get:function(){return P}},elementControllerFromEvent:{enumerable:!1,value:function(e,t){return t}},_alternateParentComponent:{value:null},__parentComponent:{value:null},_parentComponent:{set:function(e){this.__parentComponent=e,this.dispatchOwnPropertyChange("parentComponent",e)},get:function(){return this.__parentComponent}},parentComponent:{enumerable:!1,get:function(){return this._parentComponent}},findParentComponent:{value:function(){var e,t=this.element,i=this.eventManager;if(t){for(;null!=(e=t.parentNode)&&null==i.eventHandlerForElement(e);)t=e;return e?i.eventHandlerForElement(e):this._alternateParentComponent}}},querySelectorComponent:{value:function(e){if("string"!=typeof e)throw"querySelectorComponent: Selector needs to be a string.";var t=e.match(/^\s*(?:@([^>\s]+))?(?:\s*(>)?\s*@([^>\s]+)(.*))?$/);if(!t)throw'querySelectorComponent: Syntax error "'+e+'"';var i,s,u,n=this.childComponents,r=t[1],l=(t[2]||" ",t[3]),o=t[4];if(r)for(o=l?"@"+l+o:"",s=0,u;u=n[s];s++){if(r===a.getInfoForObject(u).label)return o?u.querySelectorComponent(o):u;if(i=u.querySelectorComponent(e))return i}else for(s=0,u;u=n[s];s++)if(l===a.getInfoForObject(u).label)return o?u.querySelectorComponent(o):u;return null}},querySelectorAllComponent:{value:function(e,t){if("string"!=typeof e)throw"querySelectorComponent: Selector needs to be a string.";var i=e.match(/^\s*(?:@([^>\s]+))?(?:\s*(>)?\s*@([^>\s]+)(.*))?$/);if(!i)throw'querySelectorComponent: Syntax error "'+e+'"';var s,u,n=this.childComponents,r=i[1],l=(i[2]||" ",i[3]),o=i[4],c=[];if(r)for(o=l?"@"+l+o:"",s=0,u;u=n[s];s++)r!==a.getInfoForObject(u).label||t&&t!==u.ownerComponent?c=c.concat(u.querySelectorAllComponent(e,t)):o?c=c.concat(u.querySelectorAllComponent(o)):c.push(u);else for(s=0,u;u=n[s];s++)l!==a.getInfoForObject(u).label||t&&t!==u.ownerComponent||(o?c=c.concat(u.querySelectorAllComponent(o,t)):c.push(u));return c}},template:{enumerable:!1,value:null},hasTemplate:{enumerable:!1,value:!0},_templateModuleId:{serializable:!1,value:null},_template:{value:null},_treeLevel:{value:0},_addChildComponent:{value:function(e){return this.addChildComponent(e)}},addChildComponent:{value:function(e){-1===this.childComponents.indexOf(e)&&(this.childComponents.push(e),e._prepareForEnterDocument(),e._parentComponent=this,e.needsDraw&&!this.rootComponent.isComponentWaitingNeedsDraw(e)&&e._addToParentsDrawList())}},attachToParentComponent:{value:function(){this.detachFromParentComponent(),this._parentComponent=null;var e,t,i=this.findParentComponent();if(i){e=i.childComponents;for(var a=0;t=e[a];a++){var s=t.findParentComponent();s===this&&(i.removeChildComponent(t),s.addChildComponent(t))}i.addChildComponent(this)}}},detachFromParentComponent:{value:function(){var e=this.parentComponent;e&&e.removeChildComponent(this)}},removeChildComponent:{value:function(e){var t=this.childComponents,i=t.indexOf(e);i>-1&&(e._exitDocument(),t.splice(i,1),e._parentComponent=null,e._alternateParentComponent=null,e._addedToDrawList&&(e._addedToDrawList=!1,i=this._drawList.indexOf(e),this._drawList.splice(i,1)),this.rootComponent.removeFromCannotDrawList(e))}},childComponents:{enumerable:!1,distinct:!0,value:[]},_needsEnterDocument:{value:!1},_inDocument:{value:!1},__exitDocument:{value:function(){this._inDocument&&"function"==typeof this.exitDocument&&(this.exitDocument(),this._inDocument=!1)}},_exitDocument:{value:function(){var e;this._needsEnterDocument?this._needsEnterDocument=!1:(e=function(t){for(var i,a=t.childComponents,s=0;i=a[s];s++)i._isComponentExpanded&&e(i);t._inDocument&&t.__exitDocument()},e(this))}},exitDocument:{value:function(){this.isActiveTarget&&(o.activeTarget=this.nextTarget)}},_prepareForEnterDocument:{value:function(){this._firstDraw?this._needsEnterDocument=!0:(this.needsDraw=!0,this.traverseComponentTree(function(e){return e._needsEnterDocument?!1:(e._needsEnterDocument=!0,e.needsDraw=!0,void 0)}))}},ownerComponent:{enumerable:!1,value:null},components:{enumerable:!1,value:{}},_isComponentExpanded:{enumerable:!1,value:!1},_isTemplateLoaded:{enumerable:!1,value:!1},_isTemplateInstantiated:{enumerable:!1,value:!1},cleanupDeletedComponentTree:{value:function(e){e&&this.cancelBindings(),this.needsDraw=!1,this.traverseComponentTree(function(t){e&&t.cancelBindings(),t.needsDraw=!1})}},_newDomContent:{enumerable:!1,value:null},domContent:{serializable:!1,get:function(){return this._element?Array.prototype.slice.call(this._element.childNodes,0):null},set:function(e){var t,i,a,s=[];for(this._newDomContent=e,this.needsDraw=!0,null===this._newDomContent&&(this._shouldClearDomContentOnNextDraw=!0),"function"==typeof this.contentWillChange&&this.contentWillChange(e),t=this.childComponents,i=0,a;a=t[i];i++)a.detachFromParentComponent();if(e instanceof Element)this._findAndDetachComponents(e,s);else if(e&&e[0])for(i=0;e.length>i;i++)this._findAndDetachComponents(e[i],s);for(i=0,a;a=s[i];i++)this.addChildComponent(a)}},_shouldClearDomContentOnNextDraw:{value:!1},_findAndDetachComponents:{value:function(e,t){var i,a=e.component;if(t||(t=[]),a)a.detachFromParentComponent(),t.push(a);else{i=e.children||e.childNodes;for(var s,u=0;s=i[u];u++)this._findAndDetachComponents(s,t)}return t}},clonesChildComponents:{writable:!1,value:!1},_innerTemplate:{value:null},innerTemplate:{serializable:!1,get:function(){var e,t,i,a,s,u,n,r=this._innerTemplate;if(!r&&(e=this._ownerDocumentPart)){t=e.template,i=this.getElementId(),r=t.createTemplateFromElementContents(i),a=r.getSerialization(),s=a.getExternalObjectLabels(),u=e.objects,n=Object.create(null);for(var l,o=0;l=s[o];o++)n[l]=u[l];r.setInstances(n),this._innerTemplate=r}return r},set:function(e){this._innerTemplate=e}},canDraw:{value:function(){return this._canDraw}},_canDraw:{get:function(){return!this._canDrawGate||this._canDrawGate.value},set:function(e){P.componentCanDraw(this,e)},enumerable:!1},_prepareCanDraw:{enumerable:!1,value:function(){this._isComponentTreeLoaded||this.loadComponentTree().done()}},_blocksOwnerComponentDraw:{value:!1},_updateOwnerCanDrawGate:{value:function(){this._blocksOwnerComponentDraw&&this.ownerComponent&&this.ownerComponent.canDrawGate.setField(this.uuid,this.canDrawGate.value)}},_isComponentTreeLoaded:{value:!1},shouldLoadComponentTree:{value:!0},_loadComponentTreeDeferred:{value:null},loadComponentTree:{value:function(){var e=this,t=this.canDrawGate,i=this._loadComponentTreeDeferred;return i||(i=l.defer(),this._loadComponentTreeDeferred=i,t.setField("componentTreeLoaded",!1),(this.needsDraw||this.hasTemplate)&&(this._canDraw=!1),this.expandComponent().then(function(){if(e.hasTemplate||e.shouldLoadComponentTree){for(var t,i=[],a=e.childComponents,s=0;t=a[s];s++)i.push(t.loadComponentTree());return l.all(i)}}).then(function(){e._isComponentTreeLoaded=!0,e._needsEnterDocument&&(e.needsDraw=!0),t.setField("componentTreeLoaded",!0),i.resolve()},i.reject).done()),i.promise}},traverseComponentTree:{value:function(e,t){function i(){var i,s,u=a.childComponents;if(e&&e(a)===!1)return t&&t(),void 0;if(0===(s=u.length))return t&&t(),void 0;for(var n=function(){0===--s&&t&&t()},r=0;i=u[r];r++)i.traverseComponentTree(e,n)}var a=this;this._isComponentExpanded?i():t&&t()}},_expandComponentDeferred:{value:null},expandComponent:{value:function(){var e=this,t=this._expandComponentDeferred;return t||(t=l.defer(),this._expandComponentDeferred=t,this.hasTemplate?this._instantiateTemplate().then(function(){e._isComponentExpanded=!0,e._addTemplateStyles(),e.needsDraw=!0,t.resolve()},t.reject):(this._isComponentExpanded=!0,t.resolve())),t.promise}},_templateObjectDescriptor:{value:{enumerable:!0,configurable:!0}},_setupTemplateObjects:{value:function(e){return this._templateObjects=this._templateObjects||Object.create(null),this._addTemplateObjects(e),this._setupTemplateObjectsCompleted=!0,this._templateObjects}},_setupTemplateObjectsCompleted:{value:!1},_addTemplateObjects:{value:function(e){var t=this._templateObjectDescriptor,i=this._templateObjects;for(var a in e){var s=e[a];"object"==typeof s&&null!=s&&(y.prototype.isPrototypeOf(s)&&s!==this&&s.parentComponent!==this?(t.get=this._makeTemplateObjectGetter(this,a,s),Object.defineProperty(i,a,t)):i[a]=s)}}},_makeTemplateObjectGetter:{value:function(e,t,i){var a,s,u,n="@"+t;return function(){if(a)return e.querySelectorAllComponent(n,e);if(s=e.querySelectorAllComponent(n,e),1===s.length)for(u=s[0];u=u.parentComponent;){if(u===e)return Object.defineProperty(this,t,{value:s[0]}),s[0];if(u.clonesChildComponents)break}else if(0===s.length)return i;return a=!0,s}}},_instantiateTemplate:{value:function(){var e=this;return this._loadTemplate().then(function(t){if(!e._element)return console.error("Cannot instantiate template without an element.",e),l.reject(Error("Cannot instantiate template without an element.",e));var i=null,a=e._element.ownerDocument;return i||(i=Object.create(null)),i.owner=e,e._isTemplateInstantiated=!0,t.instantiateWithInstances(i,a).then(function(t){t.parentDocumentPart=e._ownerDocumentPart,e._templateDocumentPart=t,t.fragment=null,i=null}).fail(function(e){var i=e.stack||e;throw console.error("Error in",t.getBaseUrl()+":",i),e})})}},_templateDidLoad:{value:function(e){this._templateDocumentPart=e,this._templateObjects&&this._setupTemplateObjects(e.objects)}},_loadTemplatePromise:{value:null},_loadTemplate:{value:function(){var e,t=this,i=this._loadTemplatePromise;return i||(e=a.getInfoForObject(this),i=this._loadTemplatePromise=u.getTemplateWithModuleId(this.templateModuleId,e.require).then(function(e){return t._template=e,t._isTemplateLoaded=!0,e})),i}},templateModuleId:{get:function(){return this._templateModuleId||this._getDefaultTemplateModuleId()}},_getDefaultTemplateModuleId:{value:function(){var e,t,i,s;return s=a.getInfoForObject(this),i=s.moduleId,t=i.lastIndexOf("/"),e=i+"/"+i.slice(-1===t?0:t+1,-5)+".html"}},deserializedFromSerialization:{value:function(){this.attachToParentComponent()}},_deserializedFromTemplate:{value:function(e,t,i){a.getInfoForObject(this).label=t,this._ownerDocumentPart=i,this.hasOwnProperty("identifier")||(this.identifier=t),this.ownerComponent||(this.ownerComponent=y.prototype.isPrototypeOf(e)?e:this.rootComponent,this._updateOwnerCanDrawGate()),this._needsDrawInDeserialization&&(this.needsDraw=!0)}},blueprintModuleId:{serializable:!1,enumerable:!1,get:function(){var e=a.getInfoForObject(this),t=e&&!e.isInstance?this:Object.getPrototypeOf(this);if(!Object.getOwnPropertyDescriptor(t,"_blueprintModuleId")||!t._blueprintModuleId){e=a.getInfoForObject(t);var i=e.moduleId,s=i.lastIndexOf("/"),u=i.lastIndexOf(".");s=-1===s?0:s+1,u=-1===u?i.length:u,u=s>u?i.length:u;var n;n=i.length>u&&".reel"===i.slice(u,i.length)?i+"/"+i.slice(s,u)+".meta":i.slice(0,u)+".meta",a.defineProperty(t,"_blueprintModuleId",{value:n})}return t._blueprintModuleId}},blueprint:e("../core/core")._blueprintDescriptor,gateDidBecomeTrue:{value:function(e){e===this._canDrawGate?(this._canDraw=!0,this._updateOwnerCanDrawGate()):e===this._blockDrawGate&&(P.componentBlockDraw(this),this._prepareCanDraw())},enumerable:!1},gateDidBecomeFalse:{value:function(e){e===this._canDrawGate&&this._updateOwnerCanDrawGate()},enumerable:!1},_canDrawGate:{enumerable:!1,value:null},preparedForActivationEvents:{enumerable:!1,value:!1},_arrayObjectPool:{value:{pool:null,size:200,ix:0}},_getArray:{value:function(){if(null==this._arrayObjectPool.pool){this._arrayObjectPool.pool=[];for(var e=0;this._arrayObjectPool.size>e;e++)this._arrayObjectPool.pool[e]=[]}return this._arrayObjectPool.ix<this._arrayObjectPool.size?this._arrayObjectPool.pool[this._arrayObjectPool.ix++]:[]}},_disposeArray:{value:function(e){this._arrayObjectPool.ix>0&&(e.length=0,this._arrayObjectPool.pool[--this._arrayObjectPool.ix]=e)}},_drawIfNeeded:{enumerable:!1,value:function(e){var t,s,u,n,r=this._firstDraw;if(this._treeLevel=e,r&&(this.originalElement=this.element),this.needsDraw&&P.addToDrawCycle(this),r&&this.prepareForDraw&&a.callDeprecatedFunction(this,this.prepareForDraw,"prepareForDraw","enterDocument(firstTime)"),this._needsEnterDocument&&(this._needsEnterDocument=!1,this._inDocument=!0,"function"==typeof this.enterDocument&&this.enterDocument(r),this._enterDocument(r)),r&&(this.originalElement=null),null!==this._drawList&&this._drawList.length>0){for(s=this._drawList,this._drawList=this._getArray(),n=s.length,u=0;n>u;u++)t=s[u],t._addedToDrawList=!1,t.canDraw()?t._drawIfNeeded(e+1):h.isDebug&&h.debug(i(t)+" can't draw.");this._disposeArray(s)}}},_updateComponentDom:{value:function(){if(this._firstDraw){if(this._prepareForDraw(),this._composerList)for(var e,t=0,i=this._composerList.length;i>t;t++)e=this._composerList[t],e.lazyLoad||this.loadComposer(e);this._firstDraw=!1}(null!==this._newDomContent||this._shouldClearDomContentOnNextDraw)&&(h.isDebug&&m.debug("Component content changed: component ",this._montage_metadata.objectName,this.identifier," newDomContent",this._newDomContent),this._performDomContentChanges())}},_replaceElementWithTemplate:{enumerable:!1,value:function(){var e,t,i,a,s,u=this.element,n=this._templateElement,r=this.element.attributes;for(i=0;a=r[i];i++)e=a.nodeName,window._montage_le_flag&&e===f?t=a.nodeValue:"id"===e||"data-montage-id"===e?t=a.nodeValue:(s=n.getAttribute(e)||"",t=s?s+("style"===e?"; ":" ")+a.nodeValue:a.nodeValue),n.setAttribute(e,t);this._initializeClassListFromElement(n),u.parentNode?u.parentNode.replaceChild(n,u):this._canDrawOutsideDocument||console.warn("Warning: Trying to replace element ",u," which has no parentNode"),this.eventManager.unregisterEventHandlerForElement(u),this.eventManager.registerEventHandlerForElement(this,n),this._element=n,this._templateElement=null,this._newDomContent&&(this._newDomContent=null,this._shouldClearDomContentOnNextDraw=!1)}},_addTemplateStyles:{value:function(){var e,t,i,a=this._templateDocumentPart;if(a){e=a.template.getResources(),i=this.element.ownerDocument,t=e.createStylesForDocument(i);for(var s,u=0;s=t[u];u++)this.rootComponent.addStylesheet(s)}}},_prepareForDraw:{value:function(){m.isDebug&&m.debug(this,"_templateElement: "+this._templateElement);var e;window._montage_le_flag&&(e=this.element.children.length>0),this._initDomArguments(),e&&this._leTagArguments(),this._templateElement&&(this._bindTemplateParametersToArguments(),this._replaceElementWithTemplate())},enumerable:!1},_leTagArguments:{value:function(){var e=this.ownerComponent._montage_metadata.moduleId,t=this._montage_metadata.label,i=this.getDomArgumentNames();if(0===i.length)this._leTagStarArgument(e,t,this.element);else for(var a,s=0;a=i[s];s++)this._leTagNamedArgument(e,t,this._domArguments[a],a)}},_getNodeFirstElement:{value:function(e){var t=e.firstElementChild;if(!t){t=e.firstChild;do if(t.nodeType===Node.ELEMENT_NODE)break;while(t=t.nextSibling)}return t}},_getNodeLastElement:{value:function(e){var t=e.lastElementChild;if(!t){t=e.lastChild;do if(t.nodeType===Node.ELEMENT_NODE)break;while(t=t.previousSibling)}return t}},_leTagStarArgument:{value:function(e,t,i){var a=this._getNodeFirstElement(i),s=this._getNodeLastElement(i);a.setAttribute(q,(a.getAttribute(q)||"")+" "+e+","+t),s.setAttribute(_,(s.getAttribute(_)||"")+" "+e+","+t)}},_leTagNamedArgument:{value:function(e,t,i,a){i.setAttribute(b,e+","+t+","+a)}},_bindTemplateParametersToArguments:{value:function(){var e,t,i,a,s,u,n,r,l=this._templateDocumentPart.parameters;if(t=this._domArguments,this._template.hasParameters()||1!==t.length){if(a=this._validateTemplateArguments(t,l))throw a;for(var o in l){e=l[o],i=t[o],"*"===o?(n=this._element.ownerDocument.createRange(),n.selectNodeContents(this._element),s=n.extractContents()):s=i,u=this._findAndDetachComponents(s),e.parentNode.replaceChild(s,e);for(var c=0;r=u[c];c++)r.attachToParentComponent()}}}},_validateTemplateArguments:{value:function(e,t){var i,a,s=Object.keys(t);if(0!==s.length)if(null==e){if(s.length>0)return Error("No arguments provided for "+this.templateModuleId+". Arguments needed: "+s+".")}else if("*"in t){if(i=Object.keys(e),i.length>0)return Error('Arguments "'+i+'" were given to component but no named parameters '+"are defined in "+this.templateModuleId)}else{for(a in t)if(!(a in e))return Error('"'+a+'" argument not '+"given in "+this.templateModuleId);for(a in e)if("*"!==a&&!(a in t))return Error('"'+a+'" parameter does '+"not exist in "+this.templateModuleId)}}},prepareForActivationEvents:{enumerable:!1,value:null},_prepareForActivationEvents:{value:function(){if("function"==typeof this.prepareForActivationEvents&&this.prepareForActivationEvents(),this._composerList)for(var e,t=0,i=this._composerList.length;i>t;t++)e=this._composerList[t],e.lazyLoad&&this.loadComposer(e);this.preparedForActivationEvents=!0}},_performDomContentChanges:{value:function(){var e,t,i=this._newDomContent,a=this._element.childNodes[0];if(i||this._shouldClearDomContentOnNextDraw){t=this._element,e=this._element.childNodes.length;for(var s=0;e>s;s++)t.removeChild(t.firstChild);if(Element.isElement(i))t.appendChild(i);else if(null!=i)for(var u,s=0;u=i[s];s++)t.appendChild(u);this._newDomContent=null,"function"==typeof this.contentDidChange&&this.contentDidChange(this._element.childNodes[0],a),this._shouldClearDomContentOnNextDraw=!1}}},prepareForDraw:{enumerable:!1,value:null},draw:{enumerable:!1,value:function(){}},willDraw:{enumerable:!1,value:null},didDraw:{enumerable:!1,value:function(){}},_addedToDrawList:{value:!1},_addToParentsDrawList:{enumerable:!1,value:function(){if(!this._addedToDrawList){var e=this.parentComponent;e?(e._addToDrawList(this),p.isDebug&&p.debug(i(this)+" added to "+i(e)+"'s drawList")):p.isDebug&&p.debug(this,"parentComponent is null")}}},_needsDraw:{value:!1},_needsDrawInDeserialization:{value:!1},needsDraw:{enumerable:!1,get:function(){return!!this._needsDraw},set:function(e){return this.isDeserializing?(this._needsDrawInDeserialization=!0,void 0):(this._needsDraw!==e&&(v.isDebug&&v.debug("needsDraw toggled "+e+" for "+this._montage_metadata.objectName),this._needsDraw=!!e,e&&(this.canDrawGate.value?this._addToParentsDrawList():this.blockDrawGate.setField("drawRequested",!0))),void 0)}},_drawList:{value:null},__addToDrawList:{enumerable:!1,value:function(e){null===this._drawList?(this._drawList=[e],e._addedToDrawList=!0):-1===this._drawList.indexOf(e)&&(this._drawList.push(e),e._addedToDrawList=!0)}},_addToDrawList:{enumerable:!1,value:function(e){this.__addToDrawList(e),this._addToParentsDrawList()}},_templateElement:{enumerable:!1,value:null},surrenderPointer:{value:function(){return!0}},_composerList:{value:null,serializable:!1},composerList:{get:function(){return this._composerList||(this._composerList=[]),this._composerList},serializable:!1},addComposer:{value:function(e){this.addComposerForElement(e,e.element)}},addComposerForElement:{value:function(e,t){e.component=this,e.element=t,this.composerList.push(e),this._firstDraw||(e.lazyLoad?this.preparedForActivationEvents&&this.loadComposer(e):this.loadComposer(e))}},loadComposer:{value:function(e){this._composerList&&this._composerList.indexOf(e)>-1&&s.prototype.loadComposer.call(this,e)}},unloadComposer:{value:function(e){this._composerList&&this._composerList.indexOf(e)>-1&&s.prototype.unloadComposer.call(this,e)}},scheduleComposer:{value:function(e){this.rootComponent.addToComposerList(e)}},removeComposer:{value:function(e){if(this._composerList)for(var t=0,i=this._composerList.length;i>t;t++)if(this._composerList[t].uuid===e.uuid){this.unloadComposer(this._composerList[t]),this._composerList.splice(t,1);break}}},clearAllComposers:{value:function(){if(this._composerList){for(var e=this._composerList,t=0,i=e.length;i>t;t++)this.unloadComposer(e[t]);e.length=0}}},localizer:{value:null},_waitForLocalizerMessages:{value:!1},waitForLocalizerMessages:{enumerable:!1,get:function(){return this._waitForLocalizerMessages},set:function(e){if(this._waitForLocalizerMessages!==e)if(e!==!0||this.localizer.messages)this._waitForLocalizerMessages=!1,this.canDrawGate.setField("messages",!0);else{if(!this.localizer)throw"Cannot wait for messages on localizer if it is not set";this._waitForLocalizerMessages=!0;var t=this;m.debug(this,"waiting for messages from localizer"),this.canDrawGate.setField("messages",!1),this.localizer.messagesPromise.then(function(){m.isDebug&&m.debug(t,"got messages from localizer"),t.canDrawGate.setField("messages",!0)})}}},_elementAttributeValues:{value:null},_elementAttributeDescriptors:{value:null},_getElementAttributeDescriptor:{value:function(e){for(var t,i=this;i&&i._elementAttributeDescriptors&&!(t=i._elementAttributeDescriptors[e]);)i=Object.getPrototypeOf(i);return t}},_enterDocument:{value:function(e){var t;if(e){t=this.originalElement;var i,a,s,u,n,r,l;if(i=t.attributes)for(s=i.length,a=0;s>a;a++)u=i[a].name,n=i[a].value,l=this._getElementAttributeDescriptor(u,this),(l||void 0!==this[u])&&(null===this._elementAttributeValues&&(this._elementAttributeValues={}),void 0===this._elementAttributeValues[u]&&(this._elementAttributeValues[u]=n,(void 0===this[u]||null==this[u])&&(this[u]=n)));if(l=this._getElementAttributeDescriptor("textContent",this)){var o=t.textContent;null===this._elementAttributeValues&&(this._elementAttributeValues={}),void 0===this._elementAttributeValues.textContent&&(this._elementAttributeValues.textContent=o,null==this.textContent&&(this.textContent=o))}if(this._elementAttributeDescriptors)for(r in this._elementAttributeDescriptors){l=this._elementAttributeDescriptors[r];var c="_"+r;null===this[c]&&null!==l&&"value"in l&&(this[c]=this._elementAttributeDescriptors[r].value)}}}},_draw:{value:function(){var e,t=this.element;for(var i in this._elementAttributeValues)if(this._elementAttributeValues.hasOwnProperty(i)){var a=this[i];e=this._getElementAttributeDescriptor(i,this),e&&("boolean"===e.dataType?a===!0?(t[i]=!0,t.setAttribute(i,i.toLowerCase())):(t[i]=!1,t.removeAttribute(i)):void 0!==a&&("textContent"===i?t.textContent=a:t.setAttribute(i,a))),delete this._elementAttributeValues[i]}this._drawClassListIntoComponent()}},_classList:{value:null},_classListDirty:{value:!1},classList:{get:function(){return null===this._classList&&(this._classList=new g,this._subscribeToToClassListChanges(),this._initializeClassListFromElement(this.element)),this._classList}},_initializeClassListFromElement:{value:function(e){if(e&&e.classList&&e.classList.length>0){var t=this.classList;this._unsubscribeToClassListChanges&&this._unsubscribeToClassListChanges(),t.addEach(e.classList),this._subscribeToToClassListChanges()}}},_unsubscribeToClassListChanges:{value:null},_subscribeToToClassListChanges:{value:function(){this._unsubscribeToClassListChanges=this._classList.addRangeChangeListener(this,"classList")}},handleClassListRangeChange:{value:function(){this._classListDirty=!0,this.needsDraw=!0}},_drawClassListIntoComponent:{value:function(){if(this._classListDirty){for(var e,t=this.element.classList,i=this._classList,a=0,s=t.length;s>a;a++)e=t.item(a),i.has(e)||(t.remove(e),a--,s--);this._classList.forEach(function(e){t.add(e)}),this._classListDirty=!1}}},dispose:{value:function(){this.cancelBindings(),this.detachFromParentComponent(),this._element&&(o.unregisterEventHandlerForElement(this._element),this._element=null),this.childComponents.forEach(function(e){e.dispose()})}}},{addAttributes:{value:function(e){var t,i,a;this.prototype._elementAttributeDescriptors=e;for(i in e)e.hasOwnProperty(i)&&(a=e[i],null===a||"string"==typeof a?(t={value:a,dataType:"string"},e[i]=t):t=a,void 0===this[i]&&this.defineAttribute(i,t))}},defineAttribute:{value:function(e,t){t=t||{};var i="_"+e,s={configurable:void 0===t.configurable?!0:t.configurable,enumerable:void 0===t.enumerable?!0:t.enumerable,set:function(e,t){return function(i){var a=this._getElementAttributeDescriptor(e,this);a&&"boolean"===a.dataType&&(i=i||""===i?!0:!1),void 0!==i&&this[t]!==i&&(this[t]=i,null===this._elementAttributeValues&&(this._elementAttributeValues={}),this._elementAttributeValues[e]=i,this.needsDraw=!0)}}(e,i),get:function(e,t){return function(){return this[t]}}(e,i)};a.defineProperty(this.prototype,i,{value:null}),a.defineProperty(this.prototype,e,s)}}}),S=y.specialize({constructor:{value:function S(){this.super(),this._drawTree=this._drawTree.bind(this),this._readyToDrawListIndex={}}},init:{value:function(){return this}},needsDraw:{enumerable:!0,get:function(){return!1},set:function(e){if(this._needsDraw!==e&&(this._needsDraw=!!e,e))for(var t,i=this.childComponents,a=0;t=i[a];a++)v.isDebug&&v.debug(this,"needsDraw = true for: "+t._montage_metadata.exportedSymbol),t.needsDraw=!0}},canDrawGate:{get:function(){return this._canDrawGate||(this._canDrawGate=(new r).initWithDelegate(this))}},_clearNeedsDrawTimeOut:{value:null},_needsDrawList:{value:[]},_cannotDrawList:{value:null},componentBlockDraw:{value:function(e){this._cannotDrawList=this._cannotDrawList?this._cannotDrawList:{},this._cannotDrawList[e.uuid]=e,this._clearNeedsDrawTimeOut&&(window.clearTimeout(this._clearNeedsDrawTimeOut),this._clearNeedsDrawTimeOut=null)}},isComponentWaitingNeedsDraw:{value:function(e){return e.uuid in this._cannotDrawList||this._needsDrawList.indexOf(e)>=0}},componentCanDraw:{value:function(e,t){if(t){if(!this._cannotDrawList)return;if(delete this._cannotDrawList[e.uuid],this._needsDrawList.push(e),0===Object.keys(this._cannotDrawList).length&&this._needsDrawList.length>0&&!this._clearNeedsDrawTimeOut){var i=this;this._clearNeedsDrawTimeOut=window.setTimeout(function(){i._clearNeedsDrawList()},0)}}else this._clearNeedsDrawTimeOut&&(window.clearTimeout(this._clearNeedsDrawTimeOut),this._clearNeedsDrawTimeOut=null)}},_clearNeedsDrawList:{value:function(){var e,t,i,a=this._needsDrawList;for(i=a.length,t=0;i>t;t++)e=a[t],(e.needsDraw||e._drawList&&e._drawList.length>0)&&e._addToParentsDrawList();this._clearNeedsDrawTimeOut=null,a.length=0}},removeFromCannotDrawList:{value:function(e){if(this._cannotDrawList&&(delete this._cannotDrawList[e.uuid],0===Object.keys(this._cannotDrawList).length&&this._needsDrawList.length>0&&!this._clearNeedsDrawTimeOut)){var t=this;this._clearNeedsDrawTimeOut=window.setTimeout(function(){t._clearNeedsDrawList()},0)}}},_cancelDrawIfScheduled:{value:function(){var e=this.requestedAnimationFrame,t=this.cancelAnimationFrame;null!==e&&(this._frameTime||(m.isDebug&&m.debug(this,"clearing draw"),t?t.call(window,e):window.clearTimeout(e),this.requestedAnimationFrame=null))}},_addToDrawList:{value:function(e){this.__addToDrawList(e),p.isDebug&&p.debug(this,this.canDrawGate.value,this.requestedAnimationFrame),this.drawTree()},enumerable:!1},addToComposerList:{value:function(e){this.composerList.push(e),h.isDebug&&h.debug(this,e,"Added to composer list"),this._scheduleComposerRequest=!0,this.drawTree()}},composerListSwap:{get:function(){return this._composerListSwap||(this._composerListSwap=[]),this._composerListSwap}},_composerListSwap:{value:null},_scheduleComposerRequest:{value:!1},requestedAnimationFrame:{value:null,enumerable:!1},requestAnimationFrame:{value:window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame,enumerable:!1},cancelAnimationFrame:{value:window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame,enumerable:!1},_frameTime:{value:null},_oldSource:{value:null},_diff:{value:function(e,t){for(var i={},a={},s=0;t.length>s;s++)null==i[t[s]]&&(i[t[s]]={rows:[],o:null}),i[t[s]].rows.push(s);
for(s=0;e.length>s;s++)null==a[e[s]]&&(a[e[s]]={rows:[],n:null}),a[e[s]].rows.push(s);for(s in i)1===i[s].rows.length&&void 0!==a[s]&&1===a[s].rows.length&&(t[i[s].rows[0]]={text:t[i[s].rows[0]],row:a[s].rows[0]},e[a[s].rows[0]]={text:e[a[s].rows[0]],row:i[s].rows[0]});for(s=0;t.length-1>s;s++)null!=t[s].text&&null==t[s+1].text&&t[s].row+1<e.length&&null==e[t[s].row+1].text&&t[s+1]==e[t[s].row+1]&&(t[s+1]={text:t[s+1],row:t[s].row+1},e[t[s].row+1]={text:e[t[s].row+1],row:s+1});for(s=t.length-1;s>0;s--)null!=t[s].text&&null==t[s-1].text&&t[s].row>0&&null==e[t[s].row-1].text&&t[s-1]==e[t[s].row-1]&&(t[s-1]={text:t[s-1],row:t[s].row-1},e[t[s].row-1]={text:e[t[s].row-1],row:s-1});return{o:e,n:t}}},_previousDrawDate:{enumerable:!1,value:0},_documentResources:{value:null},_needsStylesheetsDraw:{value:!1},_stylesheets:{value:[]},addStylesheet:{value:function(e){this._stylesheets.push(e),this._needsStylesheetsDraw=!0}},drawStylesheets:{value:function(){for(var e,t=this._documentResources,i=this._stylesheets;e=i.shift();)t.addStyle(e);this._needsStylesheetsDraw=!1}},drawTree:{value:function(){if(null===this.requestedAnimationFrame){var e=this.requestAnimationFrame;if(e)this.requestedAnimationFrame=e.call(window,this._drawTree);else{var t=Date.now(),i=17-t+this._previousDrawDate;0>i&&(i=0),this.requestedAnimationFrame=setTimeout(this._drawTree,i),this._previousDrawDate=t+i}this._scheduleComposerRequest=!1}},enumerable:!1},_drawTree:{value:function(e){var t;if(this._needsStylesheetsDraw&&this.drawStylesheets(),!this._documentResources.areStylesLoaded)return d.isDebug&&console.log("Draw Cycle Waiting Stylesheets: ",this._documentResources._expectedStyles.length),this.requestedAnimationFrame=null,this.drawTree(),void 0;if(d.isDebug&&(t=window.performance?window.performance.now():Date.now()),this._frameTime=e?e:Date.now(),this._clearNeedsDrawTimeOut&&this._clearNeedsDrawList(),h.isDebug){var i=document.body.innerHTML;if(this._oldSource&&i!==this._oldSource){for(var a=["DOM modified outside of the draw loop"],s=this._diff(this._oldSource.split("\n"),i.split("\n")),u=0;s.n.length>u;u++)if(null==s.n[u].text)a.push("+ "+s.n[u]);else for(var n=s.n[u].row+1;s.o.length>n&&null==s.o[n].text;n++)a.push("- "+s.o[n]);console.warn(a.join("\n"))}console.group((e?h.toTimeString(new Date(e))+" ":"")+"Draw Fired")}if(this.drawIfNeeded(),d.isDebug){var r;r=window.performance?window.performance.now():Date.now(),console.log("Draw Cycle Time: ",r-t,", Components: ",this._lastDrawComponentsCount)}h.isDebug&&(console.groupEnd(),this._oldSource=document.body.innerHTML),this._frameTime=null,this._scheduleComposerRequest&&this.drawTree()}},_readyToDrawList:{enumerable:!1,value:[]},_readyToDrawListIndex:{enumerable:!1,value:null},addToDrawCycle:{value:function(e){var t=this._readyToDrawListIndex;return t.hasOwnProperty(e.uuid)?(h.isDebug&&this!==P&&h.debug(i(this)+" added to the draw cycle twice, this should not happen."),void 0):(this._readyToDrawList.push(e),this._readyToDrawListIndex[e.uuid]=!0,e._updateComponentDom(),void 0)}},_lastDrawComponentsCount:{value:null},_sortByLevel:{value:function(e,t){return e._treeLevel-t._treeLevel}},drawIfNeeded:{value:function(){var e,t,a,s,u,n,r=this._readyToDrawList,l=0,o=this._composerList;if(r.length=0,this._readyToDrawListIndex.clear(),o&&(n=o.length)>0){for(this._composerList=this.composerListSwap,t=0;n>t;t++)u=o[t],u.needsFrame=!1,u.frame(this._frameTime);o.length=0,this._composerListSwap=o}for(this._drawIfNeeded(0),a=r.length,h.isDebug&&console.groupCollapsed("willDraw - "+r.length+(r.length>1?" components.":" component."));a>l;){for(t=l;a>t;t++)e=r[t],"function"==typeof e.willDraw&&e.willDraw(this._frameTime),h.isDebug&&h.debug("Level "+e._treeLevel+" "+i(e));this._drawIfNeeded(0),l=a,a=r.length}for(h.isDebug&&(console.groupEnd(),console.group("draw - "+r.length+(r.length>1?" components.":" component."))),r.sort(this._sortByLevel),t=0;a>t;t++)e=r[t],e.needsDraw=!1;for(this.requestedAnimationFrame=null,t=a-1;t>=0;t--)e=r[t],e._draw(this._frameTime),e.draw(this._frameTime),h.isDebug&&h.debug("Level "+e._treeLevel+" "+i(e));for(h.isDebug&&(console.groupEnd(),console.groupCollapsed("didDraw - "+r.length+(r.length>1?" components.":" component."))),t=0;a>t;t++)e=r[t],e.didDraw(this._frameTime),e._completedFirstDraw||(s=document.createEvent("CustomEvent"),s.initCustomEvent("firstDraw",!0,!1,null),e.dispatchEvent(s),e._completedFirstDraw=!0),h.isDebug&&h.debug("Level "+e._treeLevel+" "+i(e));return h.isDebug&&console.groupEnd(),d.isDebug&&(this._lastDrawComponentsCount=r.length),!!r.length}},element:{get:function(){return this._element},set:function(e){o.registerEventHandlerForElement(this,e),this._element=e,this._documentResources=n.getInstanceForDocument(e)}}}),P=(new S).init();t.__root__=P,y.addAttributes({accesskey:null,contenteditable:null,contextmenu:null,dir:null,draggable:null,dropzone:null,hidden:{dataType:"boolean"},lang:null,spellcheck:null,tabindex:null,title:null})}}),montageDefine("d41c331","core/target",{dependencies:["./core","./event/event-manager","./event/mutable-event"],factory:function(e,t){var i=e("./core").Montage,a=e("./event/event-manager").defaultEventManager,s=e("./event/mutable-event").MutableEvent;t.Target=i.specialize({constructor:{value:function(){this.super()}},acceptsActiveTarget:{serializable:!1,value:!1},isActiveTarget:{get:function(){return this===a.activeTarget}},willBecomeActiveTarget:{value:Function.noop},didBecomeActiveTarget:{value:Function.noop},surrendersActiveTarget:{value:function(){return!0}},nextTarget:{serializable:!1,value:null},dispatchEvent:{value:function(e){var t=e;return e instanceof s||(t=s.fromEvent(t)),t.target=this,a.handleEvent(t),!e.defaultPrevented}},dispatchEventNamed:{value:function(e,t,i,u){var n=s.fromType(e,t,i,u);return n.target=this,a.handleEvent(n),!n.defaultPrevented}},addEventListener:{value:function(e,t,i){t&&a.registerEventListener(this,e,t,i)}},removeEventListener:{value:function(e,t,i){t&&a.unregisterEventListener(this,e,t,i)}},loadComposer:{value:function(e){e&&!e._isLoaded&&(e._resolveDefaults(),e.load(),e._isLoaded=!0)}},unloadComposer:{value:function(e){e&&e._isLoaded&&(e.unload(),e._isLoaded=!1)}}})}}),montageDefine("d41c331","core/template",{dependencies:["./core","core/serialization/deserializer/montage-deserializer","./document-part","./document-resources","./serialization/serialization","./serialization/serializer/montage-labeler","./promise","./mini-url","./logger","./event/event-manager","./application"],factory:function(e,t){function i(e,t,i){var a,s,u=new d,r=e.documentElement.outerHTML,l=new n,o=e.documentElement;return a=u.createHtmlDocumentWithHtml(r,e.location.href),u.initWithDocument(a,t).then(function(){return u.setBaseUrl(e.location.href),s=u._createTemplateObjects(i),l.initWithTemplateAndFragment(u),u._instantiateObjects(s,o).then(function(e){return l.objects=e,u._invokeDelegates(l),l})})}var a,s=e("./core").Montage,u=e("core/serialization/deserializer/montage-deserializer").MontageDeserializer,n=e("./document-part").DocumentPart,r=e("./document-resources").DocumentResources,l=e("./serialization/serialization").Serialization,o=e("./serialization/serializer/montage-labeler").MontageLabeler,c=e("./promise").Promise,m=e("./mini-url");e("./logger").logger("template"),e("./event/event-manager").defaultEventManager;var d=s.specialize({_SERIALIZATON_SCRIPT_TYPE:{value:"text/montage-serialization"},_ELEMENT_ID_ATTRIBUTE:{value:"data-montage-id"},PARAM_ATTRIBUTE:{value:"data-param"},_require:{value:null},_resources:{value:null},_baseUrl:{value:null},_instances:{value:null},_metadata:{value:null},_objectsString:{value:null},objectsString:{get:function(){return this._objectsString},set:function(e){this._objectsString=e,this._serialization&&this._serialization.initWithString(e),this.__deserializer=null}},__deserializer:{value:null},_deserializer:{get:function(){var e,t,i=this.__deserializer;if(!i){if(e=this._metadata){t=Object.create(null);for(var a in e)t[a]=e[a].require}i=(new u).init(this.objectsString,this._require,t),this.__deserializer=i}return i}},getDeserializer:{value:function(){return this._deserializer}},_serialization:{value:null},getSerialization:{value:function(){var e=this._serialization;return e||(e=this._serialization=new l,e.initWithString(this.objectsString)),e}},_isDirty:{value:!1},isDirty:{get:function(){return this._isDirty},set:function(e){this._isDirty!==e&&(this._isDirty=e,this.clearTemplateFromElementContentsCache())}},refresher:{value:null},_document:{value:null},document:{get:function(){return this._isDirty&&this.refresh(),this._document},set:function(e){this._document=e}},constructor:{value:function d(){this.super()}},initWithRequire:{value:function(e){return this._require=e,this.document=this.createHtmlDocumentWithHtml(""),this.objectsString="",this}},initWithDocument:{value:function(e,t){var i=this;return this._require=t,this.setDocument(e),this.getObjectsString(e).then(function(e){return i.objectsString=e,i})}},initWithHtml:{value:function(e,t){var i=this;return this._require=t,this.document=this.createHtmlDocumentWithHtml(e),this.getObjectsString(this.document).then(function(e){return i.objectsString=e,i})}},initWithObjectsAndDocumentFragment:{value:function(e,t,i){return this._require=i,this.document=this.createHtmlDocumentWithHtml(""),this.document.body.appendChild(this.document.importNode(t,!0)),this.setObjects(e),this}},initWithModuleId:{value:function(e,t){var i=this;return this._require=t,this.createHtmlDocumentWithModuleId(e,t).then(function(a){var s=t(e).directory;return i.document=a,i.setBaseUrl(s),i.getObjectsString(a).then(function(e){return i.objectsString=e,i})})}},clone:{value:function(){var e=new d;return e._require=this._require,e._baseUrl=this._baseUrl,e.setDocument(this.document),e.objectsString=this.objectsString,e._instances=Object.clone(this._instances,1),e}},instantiate:{value:function(e){return this.instantiateWithInstances(null,e)}},instantiateWithInstances:{value:function(e,t){var i,a,s,u=this,r=new n;return e=e||this._instances,i=this._createMarkupDocumentFragment(t),s=this._getParameters(i),r.initWithTemplateAndFragment(this,i),r.startActingAsTopComponent(),r.parameters=s,a=this._createTemplateObjects(e),this._instantiateObjects(a,i).then(function(i){var a;return r.objects=i,u._invokeDelegates(r,e),r.stopActingAsTopComponent(),a=u.getResources(),!a.resourcesLoaded()&&a.hasResources()&&a.loadResources(t).done(),r})}},_objectsInstantiationOptimized:{value:!1},_optimizeObjectsInstantiationPromise:{value:null},_optimizeObjectsInstantiation:{value:function(){var e,t=this;return this._objectsInstantiationOptimized?void 0:(this._optimizeObjectsInstantiationPromise||(e=this._deserializer.preloadModules(),e?this._optimizeObjectsInstantiationPromise=e.then(function(){t._objectsInstantiationOptimized=!0}):this._objectsInstantiationOptimized=!0),this._optimizeObjectsInstantiationPromise)}},setBaseUrl:{value:function(e){this._baseUrl=e}},getBaseUrl:{value:function(){return this._baseUrl}},getResources:{value:function(){var e=this._resources;return e||(e=this._resources=new p,e.initWithTemplate(this)),e}},_createTemplateObjects:{value:function(t){var i=Object.create(t||null);return void 0===a&&(a=e("./application").application),i.application=a,i.template=this,i}},_instantiateObjects:{value:function(e,t){var i,a=this._deserializer;return i=this._optimizeObjectsInstantiation(),i?i.then(function(){return a.deserialize(e,t)}):a.deserialize(e,t)}},_createMarkupDocumentFragment:{value:function(e){for(var t=e.createDocumentFragment(),i=this.document.body.childNodes,a=0,s=i.length;s>a;a++)t.appendChild(e.importNode(i[a],!0));return t}},getParameterName:{value:function(e){return e.getAttribute(this.PARAM_ATTRIBUTE)}},getParameters:{value:function(){return this._getParameters(this.document.body)}},_getParameters:{value:function(e){for(var t,i=e.querySelectorAll("*["+this.PARAM_ATTRIBUTE+"]"),a=i.length,s={},u=0;a>u;u++){t=i[u];var n=this.getParameterName(t);if(n in s)throw Error('The parameter "'+n+'" is'+" declared more than once in "+this.getBaseUrl()+".");s[n]=t}if("*"in s&&a>1)throw Error('The star "*" template parameter was declared when other parameters were also present in '+this.getBaseUrl()+": "+Object.keys(s)+".");return s}},hasParameters:{value:function(){return!!this.document.querySelector("*["+this.PARAM_ATTRIBUTE+"]")}},_invokeDelegates:{value:function(e,t){var i,a,s,u=e.objects,n=u.owner||t&&t.owner;for(var r in u)t&&r in t||(i=u[r],a=this._getObjectOwner(r,n),s=this._getObjectLabel(r),i&&("function"==typeof i._deserializedFromTemplate&&i._deserializedFromTemplate(a,s,e),"function"==typeof i.deserializedFromTemplate&&i.deserializedFromTemplate(a,s,e)));if(n){var l=this.getSerialization();l.isExternalObject("owner")||("function"==typeof n._templateDidLoad&&n._templateDidLoad(e),"function"==typeof n.templateDidLoad&&n.templateDidLoad(e))}}},setInstances:{value:function(e){this._instances=e}},getInstances:{value:function(){return this._instances}},setObjects:{value:function(e){this.objectsString=JSON.stringify(e,null,4)}},setObjectMetadata:{value:function(e,t,i,a){var s=this._metadata;s||(this._metadata=s=Object.create(null)),s[e]={require:t,label:i,owner:a},this.__deserializer=null}},getObjectMetadata:{value:function(e){var t=this._metadata;return t&&e in t?t[e]:{require:this._require,label:e}}},_getObjectOwner:{value:function(e,t){var i,a=this._metadata;return i=a&&e in a?a[e].owner:t}},_getObjectLabel:{value:function(e){var t,i=this._metadata;return t=i&&e in i?i[e].label:e}},setDocument:{value:function(e){this.document=this.cloneHtmlDocument(e),this.clearTemplateFromElementContentsCache()}},getObjectsString:{value:function(e){var t;return t=this.getInlineObjectsString(e),null===t?this.getExternalObjectsString(e):c.resolve(t)}},getInlineObjectsString:{value:function(e){var t="script[type='"+this._SERIALIZATON_SCRIPT_TYPE+"']",i=e.querySelector(t);return i?i.textContent:null}},getExternalObjectsString:{value:function(e){var t,i,a,s=e.querySelector('link[rel="serialization"]');return s?(t=new XMLHttpRequest,i=s.getAttribute("href"),a=c.defer(),t.open("GET",i),t.addEventListener("load",function(){200==t.status?a.resolve(t.responseText):a.reject(Error("Unable to retrive '"+i+"', code status: "+t.status))},!1),t.addEventListener("error",function(e){a.reject(Error("Unable to retrive '"+i+"' with error: "+e.error+"."))},!1),t.send(),a.promise):c.resolve(null)}},createHtmlDocumentWithHtml:{value:function(e,t){var i=document.implementation.createHTMLDocument("");return i.documentElement.innerHTML=e,this.normalizeRelativeUrls(i,t),i}},cloneHtmlDocument:{value:function(e){var t=document.implementation.createHTMLDocument(""),i=e.baseURI||e.URL;return t.replaceChild(t.importNode(e.documentElement,!0),t.documentElement),this.normalizeRelativeUrls(t,i),t}},createHtmlDocumentWithModuleId:{value:function(e,t){var i=this;return"function"!=typeof t?c.reject(Error("Missing 'require' function to load module '"+e+"'.")):t.async(e).then(function(e){return i.createHtmlDocumentWithHtml(e.content,e.directory)})}},_removeObjects:{value:function(e){var t="script[type='"+this._SERIALIZATON_SCRIPT_TYPE+"'], link[rel='serialization']";Array.prototype.forEach.call(e.querySelectorAll(t),function(e){e.parentNode.removeChild(e)})}},_addObjects:{value:function(e,t){if(t){var i=e.createElement("script");i.setAttribute("type",this._SERIALIZATON_SCRIPT_TYPE),i.textContent=JSON.stringify(JSON.parse(t),null,4),e.head.appendChild(i)}}},_templateFromElementContentsCache:{value:null},clearTemplateFromElementContentsCache:{value:function(){this._templateFromElementContentsCache=null}},createTemplateFromElementContents:{value:function(e){var t,i,a,s=this._templateFromElementContentsCache;return s||(s=Object.create(null),this._templateFromElementContentsCache=s),e in s?Object.create(s[e]):(t=this.getElementById(e),a=this.document.createRange(),a.selectNodeContents(t),i=this.createTemplateFromRange(a),s[e]=i,Object.create(i))}},createTemplateFromElement:{value:function(e){var t,i;return t=this.getElementById(e),i=this.document.createRange(),i.selectNode(t),this.createTemplateFromRange(i)}},createTemplateFromRange:{value:function(e){var t,i,a,s,u,n=new l;return t=e.cloneContents(),i=this._getChildrenElementIds(t),n.initWithString(this.objectsString),a=n.getSerializationLabelsWithElements(i),u=n.extractSerialization(a,["owner"]),s=new d,s.initWithObjectsAndDocumentFragment(null,t,this._require),s.objectsString=u.getSerializationString(),s._resources=this.getResources(),s}},_createSerializationWithElementIds:{value:function(e){var t,i,a=new l;return a.initWithString(this.objectsString),t=a.getSerializationLabelsWithElements(e),i=a.extractSerialization(t,["owner"])}},expandParameters:{value:function(e){var t,i,a,s,u,n,r,l=[],o={},c=this.getSerialization(),m={};t=this.getParameters();for(var d in t)if(s=t[d],u=e.getTemplateArgumentElement(d),l.push.apply(l,this._getElementIds(u)),i=this.replaceNode(u,s))for(var p in i)o[p]=i[p];return m.elementIds=l,m.elementIdsCollisions=o,n=e.getTemplateArgumentSerialization(l),n.renameElementReferences(o),r=function(t){return t.indexOf(":")>0?e.resolveTemplateArgumentTemplateProperty(t):void 0},a=c.mergeSerialization(n,{willMergeObjectWithLabel:r}),this.objectsString=c.getSerializationString(),m.labels=n.getSerializationLabels(),m.labelsCollisions=a,m}},_resolveElementIdCollisions:{value:function(e,t){var i,a,s,u,n;t=t||new o,s=this.getElementIds();for(var r,l=0;r=s[l];l++)t.addLabel(r);a=this._getElements(e);for(var r in a)this.getElementById(r)&&(u=a[r],n=t.generateLabel(t.getLabelBaseName(r)),this.setElementId(u,n),i||(i=Object.create(null)),i[r]=n);return i}},replaceNode:{value:function(e,t,i){var a;return a=this._resolveElementIdCollisions(e,i),this.normalizeRelativeUrls(e,this.getBaseUrl()),t.parentNode.replaceChild(e,t),a}},insertNodeBefore:{value:function(e,t,i){var a;return a=this._resolveElementIdCollisions(e,i),this.normalizeRelativeUrls(e,this.getBaseUrl()),t.parentNode.insertBefore(e,t),a}},appendNode:{value:function(e,t,i){var a;return a=this._resolveElementIdCollisions(e,i),this.normalizeRelativeUrls(e,this.getBaseUrl()),t.appendChild(e),a}},getElementId:{value:function(e){return e.getAttribute?e.getAttribute(this._ELEMENT_ID_ATTRIBUTE):void 0}},setElementId:{value:function(e,t){e.setAttribute(this._ELEMENT_ID_ATTRIBUTE,t)}},getElementIds:{value:function(){return this._getElementIds(this.document.body)}},_getElements:{value:function(e){var t,i,a="*["+this._ELEMENT_ID_ATTRIBUTE+"]",s={};t=e.querySelectorAll(a);for(var u,n=0;u=t[n];n++)i=this.getElementId(u),s[i]=u;return i=this.getElementId(e),i&&(s[i]=e),s}},_getChildrenElementIds:{value:function(e){var t,i="*["+this._ELEMENT_ID_ATTRIBUTE+"]",a=[];t=e.querySelectorAll(i);for(var s,u=0;s=t[u];u++)a.push(this.getElementId(s));return a}},_getElementIds:{value:function(e){var t,i=this._getChildrenElementIds(e);return t=this.getElementId(e),t&&i.push(t),i}},getElementById:{value:function(e){var t="*["+this._ELEMENT_ID_ATTRIBUTE+"='"+e+"']";return this.document.querySelector(t)}},html:{get:function(){var e=this.document;return this._removeObjects(e),this._addObjects(e,this.objectsString),this._getDoctypeString(e.doctype)+"\n"+e.documentElement.outerHTML}},_getDoctypeString:{value:function(e){return"<!DOCTYPE "+e.name+(e.publicId?' PUBLIC "'+e.publicId+'"':"")+(!e.publicId&&e.systemId?" SYSTEM":"")+(e.systemId?' "'+e.systemId+'"':"")+">"}},normalizeRelativeUrls:{value:function(e,t){if("string"==typeof t&&""!==t&&"about:blank"!==t)for(var i="http://www.w3.org/1999/xlink",a=/^[\w\-]+:|^\//,s=-1!==d._NORMALIZED_TAG_NAMES.indexOf(e.tagName)?[e]:e.querySelectorAll(d._NORMALIZED_TAG_NAMES_SELECTOR),u=0,n=s.length;n>u;u++){var r,l=s[u];"image"===l.tagName?(r=l.getAttributeNS(i,"href"),a.test(r)||l.setAttributeNS(i,"href",m.resolve(t,r))):l.hasAttribute("src")?(r=l.getAttribute("src"),""===r||a.test(r)||l.setAttribute("src",m.resolve(t,r))):l.hasAttribute("href")&&(r=l.getAttribute("href"),""===r||a.test(r)||l.setAttribute("href",m.resolve(t,r)))}}},replaceContentsWithTemplate:{value:function(e){this._require=e._require,this._baseUrl=e._baseUrl,this._document=e._document,this.objectsString=e.objectsString,this._instances=e._instances,this._templateFromElementContentsCache=e._templateFromElementContentsCache,this._metadata=e._metadata}},refresh:{value:function(){this.isDirty&&(this.refresher&&"function"==typeof this.refresher.refreshTemplate?(this.refresher.refreshTemplate(this),this.isDirty=!1):console.warn("Not able to refresh without a refresher.refreshTemplate."))}}},{_templateCache:{value:{moduleId:Object.create(null)}},_getTemplateCacheKey:{value:function(e,t){return e=t.resolve(e),t.location+"#"+e}},getTemplateWithModuleId:{value:function(e,t){var i,a;return i=this._getTemplateCacheKey(e,t),a=this._templateCache.moduleId[i],a||(a=(new d).initWithModuleId(e,t),this._templateCache.moduleId[i]=a),a}},_NORMALIZED_TAG_NAMES:{value:["IMG","image","IFRAME","link","script"]},__NORMALIZED_TAG_NAMES_SELECTOR:{value:null},_NORMALIZED_TAG_NAMES_SELECTOR:{get:function(){return this.__NORMALIZED_TAG_NAMES_SELECTOR||(this.__NORMALIZED_TAG_NAMES_SELECTOR=this._NORMALIZED_TAG_NAMES.join(",")),this.__NORMALIZED_TAG_NAMES_SELECTOR}}}),p=s.specialize({_resources:{value:null},_resourcesLoaded:{value:!1},template:{value:null},rootUrl:{value:""},constructor:{value:function p(){this._resources=Object.create(null)}},initWithTemplate:{value:function(e){this.template=e}},hasResources:{value:function(){return this.getStyles().length>0||this.getScripts().length>0}},resourcesLoaded:{value:function(){return this._resourcesLoaded}},loadResources:{value:function(e){return this._resourcesLoaded=!0,c.all([this.loadScripts(e),this.loadStyles(e)])}},getScripts:{value:function(){var e,t,i,a=this._resources.scripts;if(!a){t=this.template,a=this._resources.scripts=[],i=t.document.querySelectorAll("script");for(var s=0,u=i.length;u>s;s++)e=i[s],e.type!==this.template._SERIALIZATON_SCRIPT_TYPE&&a.push(e)}return a}},loadScripts:{value:function(e){var t,i=[];t=this.getScripts();for(var a=0,s=t.length;s>a;a++)i.push(this.loadScript(t[a],e));return c.all(i)}},loadScript:{value:function(e,t){var i,a;return i=r.getInstanceForDocument(t),a=this._cloneScriptElement(e,t),i.addScript(a)}},_cloneScriptElement:{value:function(e,t){for(var i,a=t.createElement("script"),s=e.attributes,u=0,n=s.length;n>u;u++)i=s[u],a.setAttribute(i.name,i.value);return a.textContent=e.textContent,a}},getStyles:{value:function(){var e,t,i,a=this._resources.styles;return a||(i='link[rel="stylesheet"], style',e=this.template,t=e.document.querySelectorAll(i),a=Array.prototype.slice.call(t,0),this._resources.styles=a),a}},loadStyles:{value:function(e){var t,i=[];t=this.getStyles();for(var a=0,s=t.length;s>a;a++)i.push(this.loadStyle(t[a],e));return c.all(i)}},loadStyle:{value:function(e,t){var i,a;return i=e.getAttribute("href"),i?(a=r.getInstanceForDocument(t),a.preloadResource(i)):c.resolve()}},createStylesForDocument:{value:function(e){for(var t,i,a=this.getStyles(),s=[],u=0;i=a[u];u++)t=e.importNode(i,!0),s.push(t);return s}}}),v=s.specialize({getTemplateArgumentElement:{value:Function.noop},getTemplateArgumentSerialization:{value:Function.noop},resolveTemplateArgumentTemplateProperty:{value:Function.noop}});t.Template=d,t.TemplateArgumentProvider=v,t.TemplateResources=p,t.instantiateDocument=i}}),montageDefine("d41c331","core/document-resources",{dependencies:["./core","./promise","./mini-url"],factory:function(e,t){var i=e("./core").Montage,a=e("./promise").Promise,s=e("./mini-url"),u=i.specialize({_SCRIPT_TIMEOUT:{value:5e3},_document:{value:null},_resources:{value:null},_preloaded:{value:null},_expectedStyles:{value:null},constructor:{value:function u(){this.super(),this._expectedStyles=[],this._isPollingDocumentStyleSheets=!this._isLinkLoadEventAvailable()}},_webkitVersion:{value:function(){var e=/AppleWebKit\/([\d.]+)/.exec(navigator.userAgent);return e?parseInt(e[1]):null}},_isLinkLoadEventAvailable:{value:function(){var e=document.createElement("link"),t=this._webkitVersion();return"onload"in e?null!==t&&535>t?!1:!0:!1}},initWithDocument:{value:function(e){return this.clear(),this._document=e,this._populateWithDocument(e),this}},_populateWithDocument:{value:function(e){var t=e.querySelectorAll("script"),i=Array.prototype.forEach;i.call(t,function(e){e.src&&this._addResource(this.normalizeUrl(e.src))},this);var a=e.querySelectorAll("link");i.call(a,function(e){"stylesheet"===e.rel&&this._addResource(this.normalizeUrl(e.href))},this)}},clear:{value:function(){this._resources=Object.create(null),this._preloaded=Object.create(null)}},_addResource:{value:function(e){this._resources[e]=!0}},hasResource:{value:function(e){return e in this._resources}},isResourcePreloaded:{value:function(e){return this._preloaded[e]===!0}},isResourcePreloading:{value:function(e){return a.isPromise(this._preloaded[e])}},setResourcePreloadedPromise:{value:function(e,t){this._preloaded[e]=t}},setResourcePreloaded:{value:function(e){this._preloaded[e]=!0}},getResourcePreloadedPromise:{value:function(e){return this._preloaded[e]}},addScript:{value:function(e){var t=this.normalizeUrl(e.src);return t?this.isResourcePreloaded(t)?a.resolve():this.isResourcePreloading(t)?this.getResourcePreloadedPromise(t):this._importScript(e):this._importScript(e)}},_importScript:{value:function(e){var t,i,s=this,u=this._document,n=u.head,r=a.defer(),l=e.src;return l?(s._addResource(l),t=function(){s.setResourcePreloaded(l),e.removeEventListener("load",t,!1),e.removeEventListener("error",t,!1),clearTimeout(i),r.resolve()},e.addEventListener("load",t,!1),e.addEventListener("error",t,!1),i=setTimeout(function(){s.setResourcePreloaded(l),r.resolve()},this._SCRIPT_TIMEOUT),this.setResourcePreloadedPromise(l,r.promise)):r.resolve(),n.appendChild(u.createComment("Inserted from FIXME")),n.appendChild(e),r.promise}},handleEvent:{value:function(e){var t,i=e.target;"LINK"===i.tagName&&(t=this._expectedStyles.indexOf(i.href),t>=0&&this._expectedStyles.splice(t,1),i.removeEventListener("load",this,!1),i.removeEventListener("error",this,!1))}},addStyle:{value:function(e){var t,i=e.getAttribute("href");if(i){if(i=this.normalizeUrl(i),this.hasResource(i))return;this._addResource(i),this._expectedStyles.push(i),this._isPollingDocumentStyleSheets||(e.setAttribute("href",i),e.addEventListener("load",this,!1),e.addEventListener("error",this,!1))}t=this._document.head,t.insertBefore(e,t.firstChild)}},normalizeUrl:{value:function(e,t){return t||(t=this._document.location.href),s.resolve(t,e)}},domain:{value:window.location.protocol+"//"+window.location.host},isCrossDomain:{value:function(e){return 0!==e.indexOf(this.domain+"/")||0===e.indexOf("file://")}},preloadResource:{value:function(e,t){var i;return e=this.normalizeUrl(e),!t&&this.isCrossDomain(e)&&(i=!0),i||this.isResourcePreloaded(e)?a.resolve():this.isResourcePreloading(e)?this.getResourcePreloadedPromise(e):this._preloadResource(e)}},_preloadResource:{value:function(e){var t,i,s=this,u=new XMLHttpRequest,n=a.defer();return u.open("GET",e),t=function(){s.setResourcePreloaded(e),u.removeEventListener("load",t),u.removeEventListener("error",t),clearTimeout(i),n.resolve()},u.addEventListener("load",t,!1),u.addEventListener("error",t,!1),u.send(),i=setTimeout(function(){s.setResourcePreloaded(e),n.resolve()},this._SCRIPT_TIMEOUT),this.setResourcePreloadedPromise(e,n.promise),n.promise}},areStylesLoaded:{get:function(){var e,t;if(this._isPollingDocumentStyleSheets&&this._expectedStyles.length>0){e=this._document.styleSheets;for(var i,a=0;i=e[a];a++)t=this._expectedStyles.indexOf(i.href),t>=0&&this._expectedStyles.splice(t,1)}return 0===this._expectedStyles.length}}},{getInstanceForDocument:{value:function(e){var t=e.__montage_resources__;return t||(t=e.__montage_resources__=(new u).initWithDocument(e)),t}}});t.DocumentResources=u}}),montageDefine("d41c331","core/gate",{dependencies:["./core","./logger"],factory:function(e,t){var i=e("./core").Montage,a=e("./logger").logger("gate");t.Gate=i.specialize({constructor:{value:function(){this.super()}},init:{enumerable:!1,value:function(){return this.reset(),this}},initWithDelegate:{enumerable:!1,value:function(e){return this.reset(),this.delegate=e,this}},initWithDescriptor:{enumerable:!1,value:function(e){var t;this.reset();for(t in e)this.setField(t,e[t].value);return this}},count:{value:0},table:{value:null},getField:{enumerable:!1,value:function(e){var t=this.table;return!t||t[e]}},setField:{enumerable:!1,value:function(e,t){var i,s=this.table,u=this.count;s=s?s:this.table={},i=s[e],void 0!==i||t?void 0!==i&&i!==t?t?this.count--:this.count++:t&&a.isDebug&&a.debug(this,e+" was not set before."):this.count++,s[e]=!!t,0===this.count&&u>0?this.callDelegateMethod(!0):0===u&&this.count>0&&this.callDelegateMethod(!1)}},removeField:{enumerable:!1,value:function(e){var t=this.table,i=t[e];void 0===i||i||this.count--,delete t[e]}},delegate:{enumerable:!1,value:null},callDelegateMethod:{value:function(e){var t;this.delegate&&"function"==typeof(t=this.delegate["gateDidBecome"+(e?"True":"False")])&&t.call(this.delegate,this)},enumerable:!1},value:{enumerable:!1,get:function(){return 0===this.count}},reset:{enumerable:!1,value:function(){this.table={},this.count=0}},toString:{value:function(){var e,t,i=this._fields,a="";for(e=0;t=i[e];e++)a+=t+"["+(this._value&i[t])+"], ";return a}}})}}),montageDefine("d41c331","core/application",{dependencies:["./core","./target","../window-loader/montage-window","./dom","./template"],factory:function(e,t){var i,a=(e("./core").Montage,e("./target").Target),s=e("../window-loader/montage-window").MontageWindow;e("./dom"),t.Application=a.specialize({eventManager:{value:null},parentApplication:{value:null},mainApplication:{get:function(){for(var e=this;e.parentApplication;)e=e.parentApplication;return e}},_windowsSortOrder:{value:"reverse-z-order"},windowsSortOrder:{get:function(){return null==this.parentApplication?this._windowsSortOrder:this.mainApplication.windowsSortOrder},set:function(e){null==this.parentApplication?-1!==["z-order","reverse-z-order","z-order","reverse-open-order"].indexOf(e)&&(this._windowsSortOrder=e):this.mainApplication.windowsSortOrder=e}},windows:{get:function(){if(null==this.parentApplication){if(!this._windows){var e=new s;e.application=this,e.window=window,this.window=e,this._windows=[this.window],this._multipleWindow=!0}return this._windows}return this.mainApplication.windows}},_window:{value:null},window:{get:function(){if(!this._window&&this==this.mainApplication){var e=new s;e.application=this,e.window=window,this._window=e}return this._window},set:function(e){this._window||(this._window=e)}},attachedWindows:{value:[]},eventManagerForWindow:{value:function(e){return e.defaultEventMananger}},focusWindow:{get:function(){var e=this.windows,t=this.windowsSortOrder;if("z-order"==t)return e[0];if("reverse-z-order"==t)return e[e.length-1];for(var i in e)if(e[i].focused)return e[i]}},delegate:{value:null},nextTarget:{get:function(){return this.delegate}},openWindow:{value:function(e,t,i){var a,u,n=this,r=new s,l={location:!1,menubar:!1,resizable:!0,scrollbars:!0,status:!1,titlebar:!0,toolbar:!1},o={module:e,name:t,parent:window,callback:function(e,t){var i;a=e.document.application,r.window=e,r.application=a,r.component=t,a.window=r,n.attachedWindows.push(r),i=n.mainApplication.windowsSortOrder,"z-order"==i||"reverse-open-order"==i?n.windows.unshift(r):n.windows.push(r),u=document.createEvent("CustomEvent"),u.initCustomEvent("load",!0,!0,null),r.dispatchEvent(u)}};if(this!==this.mainApplication||this._multipleWindow||this.window,"object"==typeof i){var c,m,d="",p="";for(c in i)i.hasOwnProperty(c)&&(l[c]=i[c])}var v=["name"];for(c in l)-1==v.indexOf(c)&&(m=l[c],"boolean"==typeof m?m=m?"yes":"no":(m+="",m.match(/[ ,"]/)&&(m='"'+m.replace(/"/g,'\\"')+'"')),p+=d+c+"="+m,d=",");return self.mr.loadPackage({name:"montage"}).then(function(e){var t=window.open(e.location+"window-loader/index.html","_blank",p);
t.loadInfo=o}).done(),r}},attachWindow:{value:function(e){var t,i=e.application.parentApplication;return i!==this&&(i&&i.detachWindow(e),e.parentApplication=this,this.attachedWindows.push(e),t=this.mainApplication.windowsSortOrder,"z-order"==t||"reverse-open-order"==t?this.windows.unshift(e):this.windows.push(e),e.focus()),e}},detachWindow:{value:function(e){var t,i,a=this.windows;return void 0===e&&(e=this.window),i=e.application.parentApplication,i==this?(t=this.attachedWindows.indexOf(e),-1!==t&&this.attachedWindows.splice(t,1),t=a.indexOf(e),-1!==t&&a.splice(t,1),e.application.parentApplication=null):i&&i.detachWindow(e),e}},constructor:{value:function(){window.loadInfo&&!this.parentApplication&&(this.parentApplication=window.loadInfo.parent.document.application)}},_load:{value:function(i,a){var s,u=this;t.application=u,e.async("ui/component").then(function(t){return s=t.__root__,s.element=document,e("./template").instantiateDocument(window.document,i).then(function(){u.callDelegateMethod("willFinishLoading",u),s.needsDraw=!0,a&&a(u)})}).done()}},_alertPopup:{value:null,enumerable:!1},_confirmPopup:{value:null,enumerable:!1},_notifyPopup:{value:null,enumerable:!1},_zIndex:{value:null},_isSystemPopup:{value:function(e){return"alert"===e||"confirm"===e||"notify"===e}},_createPopupSlot:{value:function(e){var t=document.createElement("div");document.body.appendChild(t),t.style.zIndex=e,t.style.position="absolute";var a=new i;return a.element=t,a.attachToParentComponent(),a}},getPopupSlot:{value:function(t,a,s){var u=this;e.async("ui/slot.reel/slot").then(function(e){i=i||e.Slot,t=t||"custom";var n,r,l=u._isSystemPopup(t);if(u.popupSlots=u.popupSlots||{},l)switch(t){case"alert":n=9004;break;case"confirm":n=9003;break;case"notify":n=9002}else u._zIndex=u._zIndex?u._zIndex+1:7e3,n=u._zIndex;r=u.popupSlots[t],r||(r=u.popupSlots[t]=u._createPopupSlot(n)),l||(r.element.style.zIndex=n),r.content=a,s.call(this,r)}).done()}},returnPopupSlot:{value:function(e){var t=this;if(t.popupSlots&&t.popupSlots[e]){var i=t.popupSlots[e];i.content=null}}},_getActivePopupSlots:{value:function(){var e=[];if(this.popupSlots){var t=Object.keys(this.popupSlots);if(t&&t.length>0){var i,a,s=t.length;for(i=0;s>i;i++)a=this.popupSlots[t[i]],a&&null!==a.content&&e.push(a)}}return e}}})}}),montageDefine("d41c331","core/document-part",{dependencies:["./core","./logger","./promise","./event/event-manager"],factory:function(e,t){var i=e("./core").Montage,a=(e("./logger").logger("document-part"),e("./promise").Promise),s=e("./event/event-manager").defaultEventManager,u=i.specialize({parentDocumentPart:{value:null},template:{value:null},fragment:{value:null},objects:{value:null},childComponents:{value:null},parameters:{value:null},constructor:{value:function u(){this.super()}},initWithTemplateAndFragment:{value:function(e,t){this.template=e,this.fragment=t,this.objects=null,this.childComponents=[],this.parameters=null}},startActingAsTopComponent:{value:function(){this.fragment&&s.registerEventHandlerForElement(this,this.fragment)}},stopActingAsTopComponent:{value:function(){this.fragment&&s.unregisterEventHandlerForElement(this.fragment)}},addChildComponent:{value:function(e){-1==this.childComponents.indexOf(e)&&this.childComponents.push(e)}},removeChildComponent:{value:function(e){var t=this.childComponents,i=t.indexOf(e);i>-1&&(t.splice(i,1),e._parentComponent=null,e._alternateParentComponent=null)}},_addToDrawList:{value:Function.noop},_componentTreeLoadedDeferred:{value:null},loadComponentTree:{value:function(){var e,t=this._componentTreeLoadedDeferred;return t||(t=a.defer(),this._componentTreeLoadedDeferred=t,e=[],this.childComponents.forEach(function(t){e.push(t.loadComponentTree())}),a.all(e).then(function(){t.resolve()},t.reject).done()),t.promise}}});t.DocumentPart=u}}),montageDefine("d41c331","core/serialization/serialization",{dependencies:["../core","./serializer/montage-labeler","./deserializer/montage-reviver","frb/parse","frb/stringify"],factory:function(e,t){var i=e("../core").Montage,a=e("./serializer/montage-labeler").MontageLabeler,s=e("./deserializer/montage-reviver").MontageReviver,u=e("frb/parse"),n=e("frb/stringify"),r=i.specialize({_serializationString:{value:null},_serializationObject:{value:null},_serializationLabels:{value:null},initWithString:{value:function(e){return this._serializationString=e,this._serializationObject=null,this._serializationLabels=null,this}},initWithObject:{value:function(e){return this._serializationString=null,this._serializationObject=e,this._serializationLabels=null,this}},clone:{value:function(){var e=new r;return e.initWithString(this.getSerializationString()),e}},getSerializationObject:{value:function(){return this._serializationObject||(this._serializationObject=JSON.parse(this._serializationString)),this._serializationObject}},getSerializationString:{value:function(){return this._serializationString||(this._serializationString=JSON.stringify(this._serializationObject)),this._serializationString}},getSerializationLabels:{value:function(){var e;return this._serializationLabels||(e=this.getSerializationObject())&&(this._serializationLabels=Object.keys(e)),this._serializationLabels}},getExternalObjectLabels:{value:function(){var e=this.getSerializationObject(),t=[];for(var i in e)0===Object.keys(e[i]).length&&t.push(i);return t}},hasSerializationLabel:{value:function(e){return e in this.getSerializationObject()}},isExternalObject:{value:function(e){var t=this.getSerializationObject();return t&&e in t?0===Object.keys(t[e]).length:!1}},isAlias:{value:function(e){var t=this.getSerializationObject();return t&&e in t?"alias"in t[e]:!1}},getElementId:{value:function(e){var t=this.getSerializationObject(),a=i.getPath.call(t,e+".properties.element");return a?a["#"]:void 0}},getSerializationLabelsWithElements:{value:function(e){var t=new o,i=[];return t.initWithSerialization(this),t.visitSerialization(function(t){"Element"===t.type&&e.indexOf(t.data)>=0&&(t=t.parent,t&&"properties"===t.name&&(t=t.parent,t&&"montageObject"===t.type&&i.push(t.label)))}),i}},renameElementReferences:{value:function(e){var t=new o;t.initWithSerialization(this),t.visitSerialization(function(t){"Element"===t.type&&t.data in e&&(t.data=e[t.data])})}},renameSerializationLabels:{value:function(e){var t=new o;t.initWithSerialization(this),t.visitSerialization(function(t){if(t.label){var i=t.label;i in e&&(t.label=e[i])}if("reference"===t.type){var a=t.data;a in e&&(t.data=e[a])}})}},mergeSerialization:{value:function(e,t){return l.mergeSerializations(this,e,t)}},extractSerialization:{value:function(e,t){var i=new c;return i.initWithSerialization(this),i.extractSerialization(e,t)}}}),l=i.specialize(null,{mergeSerializations:{value:function(e,t,i){var a,s,u,n,r,l,o={};u=e.getSerializationLabels(),n=t.getSerializationLabels(),r=this._createCollisionTable(u,n,o,i&&i.labeler),i&&i.willMergeObjectWithLabel&&(l=this._willMergeObjectWithLabel(i,e,t,o),r=r||l),r&&(t=t.clone(),t.renameSerializationLabels(o),n=t.getSerializationLabels()),a=e.getSerializationObject(),s=t.getSerializationObject();for(var c,m=0;c=n[m];m++)-1===u.indexOf(c)&&(a[c]=s[c]);return e.initWithObject(a),o}},_willMergeObjectWithLabel:{value:function(e,t,i,a){var s,u,n,r,l,o=!1,c=i.getSerializationLabels();a&&(n=[],Object.keys(a).forEach(function(e){n.push(a[e])}));for(var m,d=0;m=c[d];d++)if(u=a&&a[m],s=e.willMergeObjectWithLabel(m,u),"string"==typeof s){if(r=this._isLabelValidInSerialization(s,t),r||(l=!this._isLabelValidInSerialization(s,i)&&-1===n.indexOf(s)),!r&&!l)throw Error("willMergeObjectWithLabel either needs to return a label that exists in the destination serialization to indicate it's the same object or return a completely new label to rename the object being merged. \""+s+'"  destination: '+t.getSerializationString()+"\n source: "+i.getSerializationString()+"\n collision table: "+JSON.stringify(a,null,4));o=!0,a[m]=s}return o}},_isLabelValidInSerialization:{value:function(e,t){var i,a;return t.hasSerializationLabel(e)?!0:(a=e.indexOf(":"),a>0&&(i=e.slice(0,a),t.hasSerializationLabel(i))?!0:!1)}},_createCollisionTable:{value:function(e,t,i,s){for(var u,n,r,l,s=s||new a,o=!1,c=Object.create(null),m=0;e.length>m;m++)r=e[m],l=r.indexOf(":"),l>0&&(u=r.slice(0,l),s.addLabel(u),c[u]=1),s.addLabel(r),c[r]=1;for(var m=0;r=t[m];m++)l=r.indexOf(":"),l>0?(u=r.slice(0,l),n=i[u],n?(i[r]=n+":"+r.slice(l+1),o=!0):u in c?(n=s.generateLabel(s.getLabelBaseName(u)),t.indexOf(u)>=0&&(i[u]=n),i[r]=n+r.slice(l),o=!0):s.addLabel(u)):r in c&&!(r in i)?(i[r]=s.generateLabel(s.getLabelBaseName(r)),o=!0):s.addLabel(r);return o}}}),o=i.specialize({initWithSerialization:{value:function(e){this._serialization=e}},visitSerialization:{value:function(e){var t=this._serialization.getSerializationObject();this._walkRootObjects(e,t),this._serialization.initWithObject(t)}},visitSerializationObject:{value:function(e,t){var i=this._serialization.getSerializationObject();if(!(e in i))throw Error('Object "'+e+'" does not exist in '+this._serialization.getSerializationString());this._walkRootObject(t,i,e),this._serialization.initWithObject(i)}},changeLabel:{value:function(e,t){var i,a=this._serialization.getSerializationObject();i=a[e],delete a[e],a[t]=i}},_walkRootObjects:{value:function(e,t){for(var i in t)this._walkRootObject(e,t,i)}},_walkRootObject:{value:function(e,t,i){var a=t[i];"value"in a?this._walkObject(e,a,"value",i):this._walkCustomObject(e,t,i)}},_walkObject:{value:function(e,t,i,a,u){var n,r=t[i],l=s.getTypeOf(r);if(n={type:l},a?n.label=a:n.name=i,u&&(n.parent=u),"number"===l||"string"===l||"null"===l)n.data=r,e(n),t[i]=n.data;else if("regexp"===l)n.data=r["/"],e(n),r["/"]=n.data;else if("reference"===l)n.data=r["@"],e(n),r["@"]=n.data;else if("Element"===l)n.data=r["#"],e(n),r["#"]=n.data;else if("array"===l){n.data=r,e(n),t[i]=r=n.data;for(var o=0,c=r.length;c>o;o++)this._walkObject(e,r,""+o,null,n)}else if("object"===l){n.data=r,e(n),t[i]=r=n.data;for(var i in r)this._walkObject(e,r,i,null,n)}n.label!=a&&this.changeLabel(a,n.label)}},_walkCustomObject:{value:function(e,t,i){var a,s=t[i];a={type:"montageObject",label:i,data:s},e(a),t[i]=s=a.data,a.label!=i&&this.changeLabel(i,a.label),s.properties&&this._walkObject(e,s,"properties",null,a),s.listeners&&this._walkObject(e,s,"listeners",null,a),s.bindings&&this._walkBindings(e,s,null,a),s.localizations&&this._walkLocalizations(e,s,null,a)}},_walkBindings:{value:function(e,t,i){var a,s=t.bindings;a={type:"bindings",data:s,parent:i},e(a),t.bindings=s=a.data;for(var u in s)this._walkBinding(e,s,u,a)}},_walkBinding:{value:function(e,t,i,a){var s,u=t[i];s={type:"binding",name:i,data:u,parent:a},e(s),t[i]=u=s.data,this._walkBindingData(e,u,s)}},_walkBindingData:{value:function(e,t,i){var a,s,r=!1;a=t["<-"]||t["<->"],s=Object.clone(u(a)),this._walksBindingReferences(s,function(t){var i={type:"reference",data:t.label};e(i),t.label!==i.data&&(t.label=i.data,r=!0)}),r&&("<-"in t?t["<-"]=n(s):t["<->"]=n(s)),t.converter&&this._walkObject(e,t,"converter",null,i)}},_walkLocalizations:{value:function(e,t,i){var a,s=t.localizations;a={type:"localizations",data:s,parent:i},e(a),t.localizations=s=a.data;for(var u in s)this._walkLocalization(e,s,u,a)}},_walkLocalization:{value:function(e,t,i,a){var s,u,n=t[i];if(s={type:"localization",name:i,data:n,parent:a},e(s),t[i]=n=s.data,"object"==typeof n.key&&this._walkBindingData(e,n.key,s),"object"==typeof n.default&&this._walkBindingData(e,n.default,s),"object"==typeof n.data){u=n.data;for(var i in u)this._walkBindingData(e,u[i],s)}}},_walksBindingReferences:{value:function(e,t){var i=e.args;if("component"===e.type&&t(e),i)for(var a=0,s=i.length;s>a;a++)this._walksBindingReferences(i[a],t)}}}),c=i.specialize({_serialization:{value:null},initWithSerialization:{value:function(e){this._serialization=e}},extractSerialization:{value:function(e,t){var i,a=new o,s={},u=[];i=this._serialization.getSerializationObject(),a.initWithSerialization(this._serialization);for(var n,l=0;n=e[l];l++)s[n]=i[n],a.visitSerializationObject(n,function(t){var i;"reference"===t.type&&(i=t.data,-1===u.indexOf(i)&&-1===e.indexOf(i)&&u.push(i))});if(t)for(var n,l=0;n=t[l];l++)n in i&&!(n in s)&&(s[n]={});for(var n,l=0;n=u[l];l++)s[n]={};return(new r).initWithObject(s)}}});t.Serialization=r,t.SerializationMerger=l,t.SerializationInspector=o,t.SerializationExtractor=c}}),montageDefine("d41c331","window-loader/montage-window",{dependencies:["../core/core"],factory:function(e,t){var i=e("../core/core").Montage;t.MontageWindow=i.specialize({_application:{value:null},application:{get:function(){return this._application},set:function(e){null===this._application&&(this._application=e,this.focused&&this._setFocusedWindow(this))}},_window:{value:null},window:{get:function(){return this._window},set:function(e){if(null===this._window){var t=e.document.body;this._window=e,e.addEventListener("beforeunload",this,!0),e.addEventListener("focus",this,!0),e.addEventListener("mousedown",this,!0),null===t.getAttribute("tabIndex")&&(t.setAttribute("tabIndex",-1),t.focus())}}},document:{get:function(){return this._window.document}},_component:{value:null},component:{get:function(){return this._component},set:function(e){null===this._component&&(this._component=e)}},title:{get:function(){return this.document.title},set:function(e){this.document.title=e}},focused:{value:!1},focus:{value:function(){this._window&&this._window.focus()}},_setFocusedWindow:{value:function(e){var t,i,a,s=this.application;if(s._multipleWindow){t=s.windows;for(a in t)i=t[a],i.window===e?i.focused!==!0&&(i.focused=!0,"z-order"==s.windowsSortOrder?(t.splice(a,1),t.unshift(i)):"reverse-z-order"==s.windowsSortOrder&&(t.splice(a,1),t.push(i))):i.focused=!1}else this.focused=!0}},closed:{get:function(){return this._window?this._window.closed:!1}},close:{value:function(){this._window&&this._window.close()}},resizeTo:{value:function(e,t){this._window&&this._window.resizeTo(e,t)}},moveTo:{value:function(e,t){this._window&&this._window.moveTo(e,t)}},captureFocus:{value:function(e){var t=this.application;if(!this.application)return this.focused=!0,void 0;if(t.parentApplication)t.mainApplication.window.captureFocus(e);else{var i=(e.target.ownerDocument?e.target.ownerDocument.defaultView:null)||e.target.defaultView||e.target;this._setFocusedWindow(i)}}},captureMousedown:{value:function(e){this.captureFocus(e)}},captureBeforeunload:{value:function(){var e,t=this.application,i=t.windows,a=t.attachedWindows;t.attachedWindows=[];for(var e in a)a[e].close();t.parentApplication&&(a=t.parentApplication.attachedWindows,e=a.indexOf(this),-1!==e&&a.splice(e,1),e=i.indexOf(this),-1!==e&&i.splice(e,1),this.window.removeEventListener("beforeunload",this,!0),this.close())}}})}}),montageDefine("d41c331","core/dom",{dependencies:["./geometry/point"],factory:function(e,t){var i=e("./geometry/point").Point,a=Node.prototype,s=Element.prototype;Object.defineProperty(s,"set",{value:function(e,t,i){var a,s,u,n,r,l=e.indexOf(".",i);i=i||0,s=e.substring(i,-1===l?e.length:l),-1===l?this.setAttribute(s,t):(u=e.lastIndexOf("."),"style"===s?(n=e.substring(l+1,e.length),this.style[n]=t):"classList"===s?(r=e.substring(l+1,e.length),t?this.classList.add(r):this.classList.remove(r)):(a=this.get(e.substring(0,u)))&&(a[e.substring(u+1,e.length)]=t))},enumerable:!1}),a.get=function(e){return this.getAttribute(e)||this[e]},Object.getPrototypeOf(document).addRule=function(e,t){var i,a;if(null==(i=document.styleSheets[0])){var s=document.createElement("style");s.type="text/css",document.head.appendChild(s),i=document.styleSheets[0]}else a=document.getRule(e,i);a||i.insertRule(e+" "+t,i.cssRules.length)},Object.getPrototypeOf(document).getRule=function(e,t){var i;if(t.cssRules)for(var a=0;i=t.cssRules[a];a++){if(i.name&&i.name===e)return i;if(i.selectorText===e)return i}},"undefined"!=typeof Element&&function(){var e="classList";if(!Element.prototype.hasOwnProperty(e)){var t=/^\s+|\s+$/g,i=function(e,t){e.setAttribute("class",t.join(" "))},a=function(e,t){if(""===t)throw"SYNTAX_ERR";if(/\s/.test(t))throw"INVALID_CHARACTER_ERR";return e.indexOf(t)},s=function(){var e=this,s=e.getAttribute("class")||"";return s=s.replace(t,"").split(/\s+/),{length:s.length,item:function(e){return s[e]||null},contains:function(e){return-1!==a(s,e)},add:function(t){-1===a(s,t)&&(s.push(t),this.length=s.length,i(e,s))},remove:function(t){var u=a(s,t);-1!==u&&(s.splice(u,1),this.length=s.length,i(e,s))},toggle:function(e){-1===a(s,e)?this.add(e):this.remove(e)},toString:function(){return e.getAttribute("class")||""}}};Object.defineProperty?Object.defineProperty(Element.prototype,e,{get:s,enumerable:!0}):Object.prototype.__defineGetter__&&Element.prototype.__defineGetter__(e,s)}}(),a.parentOf=function(e){for(;(e=e.parentNode)&&e!==this;);return e?!0:!1};var u=function(e){var t,i,a,s,u=e.ownerDocument;if(e&&u){if(i=u.documentElement,a=u.body,s=u.defaultView,e!==a){if(t=e.getBoundingClientRect(),i.parentOf(e)){var n=i.clientTop||a.clientTop||0,r=i.clientLeft||a.clientLeft||0,l=s.pageYOffset||i.scrollTop||a.scrollTop,o=s.pageXOffset||i.scrollLeft||a.scrollLeft,c=t.top+l-n,m=t.left+o-r;return{top:c,left:m}}return{top:t.top,left:t.left}}return{top:a.offsetTop,left:a.offsetLeft}}return null},n=null,r=function(){t.convertPointFromNodeToPage=function(e,t){return t?(n.x=t.x,n.y=t.y):(n.x=0,n.y=0),t=webkitConvertPointFromNodeToPage(e,n),t?(new i).init(t.x,t.y):null},t.convertPointFromPageToNode=function(e,t){return t?(n.x=t.x,n.y=t.y):(n.x=0,n.y=0),t=webkitConvertPointFromPageToNode(e,n),t?(new i).init(t.x,t.y):null}},l=function(){t.convertPointFromNodeToPage=function(e,t){if(!e||void 0!==e.x)return null;var a;return(a=u(e))?(new i).init((t?t.x:0)+a.left,(t?t.y:0)+a.top):(new i).init(t?t.x:0,t?t.y:0)},t.convertPointFromPageToNode=function(e,t){if(!e||void 0!==e.x)return null;var a;return(a=u(e))?(new i).init((t?t.x:0)-a.left,(t?t.y:0)-a.top):(new i).init(t?t.x:0,t?t.y:0)}};"undefined"!=typeof WebKitPoint?(n=new WebKitPoint(0,0),r()):l()}}),montageDefine("d41c331","core/geometry/point",{dependencies:["../core"],factory:function(e,t){var i=e("../core").Montage;t.Point=i.specialize({init:{enumerable:!1,value:function(e,t){return this.x=null===e?0:e,this.y=null===t?0:t,this}},x:{enumerable:!0,value:0},y:{enumerable:!0,value:0}},{interpolate:{enumerable:!1,value:function(e,i,a,s){var u,n;return u=i.x+(a.x-i.x)*e,n=i.y+(a.y-i.y)*e,s>0&&(u=Math.round(u*s)/s,n=Math.round(n*s)/s),(new t.Point).init(u,n)}}})}}),montageDefine("4054049","deserialization/reviver",{dependencies:["q"],factory:function(e,t){(function(t){function i(){}function a(e){var t=i.prototype.getCustomObjectTypeOf;return function(i){return e(i)||t(i)}}var s=function(){return this}(),u=e("q");Object.defineProperties(i.prototype,{_createAssignValueFunction:{value:function(e,t){return function(i){e[t]=i}}},getTypeOf:{value:function(e){var t=typeof e;return null===e?"null":Array.isArray(e)?"array":"object"===t&&1===Object.keys(e).length?"@"in e?"reference":"/"in e?"regexp":"object":t}},getCustomObjectTypeOf:{writable:!0,value:function(){}},reviveRootObject:{value:function(e,t,i){var a;return e.debugger,"value"in e?t.hasUserObject(i)?(a=t.getUserObject(i),t.setObjectLabel(a,i),a):this.reviveValue(e.value,t,i):0===Object.keys(e).length?t.hasUserObject(i)?(a=t.getUserObject(i),t.setObjectLabel(a,i),a):this.reviveExternalObject(e,t,i):this.reviveCustomObject(e,t,i)}},reviveValue:{value:function(e,t,i){var a=this.getTypeOf(e);return"string"===a||"number"===a||"boolean"===a||"null"===a||"undefined"===a?this.reviveNativeValue(e,t,i):"regexp"===a?this.reviveRegExp(e,t,i):"reference"===a?this.reviveObjectReference(e,t,i):"array"===a?this.reviveArray(e,t,i):"object"===a?this.reviveObjectLiteral(e,t,i):this._callReviveMethod("revive"+a,e,t,i)}},reviveNativeValue:{value:function(e,t,i){return i&&t.setObjectLabel(e,i),e}},reviveObjectLiteral:{value:function(e,t,i){var a,s=[];i&&t.setObjectLabel(e,i);for(var n in e)a=this.reviveValue(e[n],t),u.isPromise(a)?s.push(a.then(this._createAssignValueFunction(e,n))):e[n]=a;return 0===s.length?e:u.all(s).then(function(){return e})}},reviveRegExp:{value:function(e,t,i){var e=e["/"],a=RegExp(e.source,e.flags);return i&&t.setObjectLabel(a,i),a}},reviveObjectReference:{value:function(e,t){var e=e["@"],i=t.getObject(e);return i}},reviveArray:{value:function(e,t,i){var a,s=[];i&&t.setObjectLabel(e,i);for(var n=0,r=e.length;r>n;n++)a=this.reviveValue(e[n],t),u.isPromise(a)?s.push(a.then(this._createAssignValueFunction(e,n))):e[n]=a;return 0===s.length?e:u.all(s).then(function(){return e})}},reviveCustomObject:{value:function(e,t,i){var a=this.getCustomObjectTypeOf(e),r=n["revive"+a];return a?r.call(s,e,t,i):u.reject(Error("Object's type is unknown: "+JSON.stringify(e)))}},reviveExternalObject:{value:function(e,t,i){return u.reject(Error("External object '"+i+"' not found in user objects."))}},_callReviveMethod:{value:function(e,t,i,a){return this[e](t,i,a)}}});var n=Object.create(null);i.addCustomObjectReviver=function(e){for(var t in e)if("getTypeOf"!==t&&"function"==typeof e[t]&&/^revive/.test(t)){if(void 0!==n[t])return Error("Reviver '"+t+"' is already registered.");n[t]=e[t].bind(e)}this.prototype.getCustomObjectTypeOf=a(e.getTypeOf)},i.resetCustomObjectRevivers=function(){n=Object.create(null),this.prototype.getCustomObjectTypeOf=function(){}},t.Reviver=i})(t),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)})}}),montageDefine("4054049","serialization/malker",{dependencies:[],factory:function(e,t){(function(e){function t(e){this._visitHandler=e,this._enteredObjects={}}Object.defineProperties(t.prototype,{_visitHandler:{value:null,writable:!0},_enteredObjects:{value:null,writable:!0},_isObjectEntered:{value:function(e){return Object.hash(e)in this._enteredObjects}},_markObjectAsEntered:{value:function(e){this._enteredObjects[Object.hash(e)]=!0}},visit:{value:function(e,t){this._visitValue(e,t)},enumerable:!0},_getTypeOf:{value:function(e){return Array.isArray(e)?"array":RegExp.isRegExp(e)?"regexp":null===e?"null":"object"==typeof e||"function"==typeof e?this._getObjectType(e):typeof e}},_getObjectType:{value:function(e){var t,i=this._visitHandler;return"function"==typeof i.getTypeOf&&(t=i.getTypeOf(e)),void 0===t?typeof e:t}},_visitValue:{value:function(e,t){var i=this._getTypeOf(e);"object"===i?this._visitObject(e,t):"array"===i?this._visitArray(e,t):"regexp"===i?this._visitRegExp(e,t):"number"===i?this._visitNumber(e,t):"string"===i?this._visitString(e,t):"boolean"===i?this._visitBoolean(e,t):"null"===i?this._visitNull(t):"undefined"===i?this._visitUndefined(t):this._visitCustomType(i,e,t)}},_visitCustomType:{value:function(e,t,i){this._callVisitorMethod("visit"+e,t,i)}},_enterCustomObject:{value:function(e,t,i){this._callVisitorMethod("enter"+e,t,i),this._callVisitorMethod("exit"+e,t,i)}},_visitObject:{value:function(e,t){var i;this._isObjectEntered(e)?this._callVisitorMethod("visitObject",e,t):(i=this._callVisitorMethod("willEnterObject",e,t),i!==!1&&(this._markObjectAsEntered(e),this._enterObject(e,t)))}},_enterObject:{value:function(e,t){var i,a=Object.keys(e);this._callVisitorMethod("enterObject",e,t);for(var s=0,u=a.length;u>s;s++)i=a[s],this._visitValue(e[i],i);this._callVisitorMethod("exitObject",e,t)}},_visitArray:{value:function(e,t){var i;this._isObjectEntered(e)?this._callVisitorMethod("visitArray",e,t):(i=this._callVisitorMethod("willEnterArray",e,t),i!==!1&&(this._markObjectAsEntered(e),this._enterArray(e,t)))}},_enterArray:{value:function(e,t){this._callVisitorMethod("enterArray",e,t);for(var i=0,a=e.length;a>i;i++)this._visitValue(e[i],""+i);this._callVisitorMethod("exitArray",e,t)}},_visitRegExp:{value:function(e,t){this._callVisitorMethod("visitRegExp",e,t)}},_visitString:{value:function(e,t){this._callVisitorMethod("visitString",e,t)}},_visitNumber:{value:function(e,t){this._callVisitorMethod("visitNumber",e,t)}},_visitBoolean:{value:function(e,t){this._callVisitorMethod("visitBoolean",e,t)}},_visitNull:{value:function(e){this._callVisitorMethod("visitNull",e)}},_visitUndefined:{value:function(e){this._callVisitorMethod("visitUndefined",e)}},_callVisitorMethod:{value:function(e){var t,i=this._visitHandler;return"function"==typeof i[e]?(t=Array.prototype.slice.call(arguments,1),t.unshift(this),i[e].apply(i,t)):void 0}}}),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),RegExp.isRegExp||(RegExp.isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)}),e.Malker=t,e.visit=function(e,i){var a=new t(i);a.visit(e)}})(t)}}),montageDefine("4054049","serialization/serializer",{dependencies:["./malker","./builder","./labeler","./visitor"],factory:function(e,t){(function(t){function i(){var e;this._builder=new s,this._labeler=new u,e=new n(this._builder,this._labeler),this._malker=new a(e)}var a=e("./malker").Malker,s=e("./builder").Builder,u=e("./labeler").Labeler,n=e("./visitor").Visitor;Object.defineProperties(i.prototype,{_labeler:{value:null,writable:!0},_builder:{value:null,writable:!0},_serializationIndentation:{value:2,writable:!0},_malker:{value:null,writable:!0},setSerializationIndentation:{value:function(e){this._serializationIndentation=e}},serialize:{value:function(e){var t;this._labeler.initWithObjects(e);for(var i in e)this._malker.visit(e[i]);return t=this._formatSerialization(this._builder.getSerialization(this._serializationIndentation))}},serializeObject:{value:function(e){return this.serialize({root:e})}},_formatSerializationBindingsRegExp:{value:/\{\s*("(?:<->?)")\s*:\s*("[^"]+"\s*(?:,\s*"converter"\s*:\s*\{\s*"@"\s*:\s*"[^"]+"\s*\}\s*|,\s*"deferred"\s*:\s*(true|false)\s*)*)\}/gi},_formatSerializationBindingsReplacer:{value:function(e,t,i){return"{"+t+": "+i.replace(/\n\s*/g,"").replace(/,\s*/g,", ")+"}"}},_formatSerializationBindings:{value:function(e){return e.replace(this._formatSerializationBindingsRegExp,this._formatSerializationBindingsReplacer)}},_formatSerializationReferencesRegExp:{value:/\{\s*("[#@]")\s*:\s*("[^"]+")\s*\}/gi},_formatSerializationReferences:{value:function(e){return e.replace(this._formatSerializationReferencesRegExp,"{$1: $2}")}},_formatSerialization:{value:function(e){return this._formatSerializationBindings(this._formatSerializationReferences(e))}}}),t.Serializer=i,t.serialize=function(e){return(new i).serializeObject(e)}})(t)}}),montageDefine("4054049","deserialization/deserializer",{dependencies:["q","./interpreter"],factory:function(e,t){(function(t){function i(e){this._serializationString=e}function a(e){return new i(e).deserializeObject()}var s=e("q"),u=e("./interpreter").Interpreter;Object.defineProperties(i.prototype,{_interpreter:{value:new u},_serializationString:{value:null,writable:!0},deserialize:{value:function(e){var t;try{t=JSON.parse(this._serializationString)}catch(i){return s.reject(i)}return this._interpreter.instantiate(t,e)}},deserializeObject:{value:function(e){return this.deserialize(e).then(function(e){return e.root})}}}),t.Deserializer=i,t.deserialize=a})(t)}}),montageDefine("4054049","serialization/builder",{dependencies:["./ast"],factory:function(e,t){(function(t){function i(){this.init()}var a=e("./ast");Object.defineProperties(i.prototype,{_root:{value:null,writable:!0},_stack:{value:null,writable:!0},_references:{value:null,writable:!0},_placeholderProperty:{value:Object.create(null)},init:{value:function(){return this._references=Object.create(null),this._root=new a.Root,this._stack=[this._root],this}},cleanup:{value:function(){this._references=null,this._root=null,this._stack=null}},getExternalReferences:{value:function(){var e=this._references,t=this._root,i=[];for(var a in e)t.hasProperty(a)&&t.getProperty(a)!==this._placeholderProperty||i.push(a);return i}},relabelReferences:{value:function(e,t){var i=this._references[e];if(i){i=i.slice(0);for(var a=0,s=i.length;s>a;a++)i[a].value=t}}},_registerReference:{value:function(e){var t=this._references,i=e.value;t[i]?t[i].push(e):t[i]=[e]}},_unregisterReference:{value:function(e){var t,i=e.label,a=this._references[i];1===a.length?delete this._references[i]:(t=a.indexOf(e),-1===t?console.log("BUG: reference '"+i+"' not found in registry."):a.splice(t,1))}},_createPlaceholdersForReferences:{value:function(){var e=this._references,t=this._root;for(var i in e)t.hasProperty(i)||t.setProperty(i,this._placeholderProperty)}},getSerialization:{value:function(e){return this._createPlaceholdersForReferences(),this._root.serialize(e)}},root:{get:function(){return this._root}},top:{get:function(){return this._stack[0]}},push:{value:function(e){return this._stack.unshift(e)}},pop:{value:function(){return this._stack.shift()}},createObjectLiteral:{value:function(){return new a.ObjectLiteral(this._root,Object.create(null))}},createArray:{value:function(){return new a.ObjectLiteral(this._root,[])}},createObjectReference:{value:function(e){var t=new a.ObjectReference(this._root,e);return this._registerReference(t),t}},createRegExp:{value:function(e){return new a.RegExpObject(this._root,e)}},createString:{value:function(e){return new a.Value(this._root,e)}},createNumber:{value:function(e){return new a.Value(this._root,e)}},createBoolean:{value:function(e){return new a.Value(this._root,e)}},createNull:{value:function(){return new a.Value(this._root,null)}},createCustomObject:{value:function(){return new a.CustomObject(this._root)}}}),t.Builder=i})(t)}}),montageDefine("4054049","serialization/visitor",{dependencies:["collections/shim-object"],factory:function(e,t){(function(t){function i(e,t){this.builder=e,this.labeler=t,this._objectsSerialization=Object.create(null)}function a(e){var t=i.prototype.getCustomObjectTypeOf;return function(i){return e(i)||t(i)}}e("collections/shim-object"),Object.defineProperties(i.prototype,{builder:{value:null,writable:!0},labeler:{value:null,writable:!0},getTypeOf:{value:function(e){return this.isCustomObject(e)?"CustomObject":void 0}},getCustomObjectTypeOf:{value:function(){},writable:!0},isCustomObject:{value:function(e){var t=this.getCustomObjectTypeOf(e);return"string"==typeof t}},_objectsSerialization:{value:null,writable:!0},setObjectSerialization:{value:function(e,t){this._objectsSerialization[Object.hash(e)]=t}},getObjectSerialization:{value:function(e){return this._objectsSerialization[Object.hash(e)]}},isObjectSerialized:{value:function(e){return Object.hash(e)in this._objectsSerialization}},enterObject:{value:function(e,t){var i=this.builder.createObjectLiteral();this.setObjectSerialization(t,i),this.builder.push(i)}},exitObject:{value:function(e,t,i){this.storeValue(this.builder.pop(),t,i)}},visitObject:{value:function(e,t,i){var a=this.labeler.getObjectLabel(t),s=this.builder.createObjectReference(a);this.getObjectSerialization(t).setLabel(a),this.builder.top.setProperty(i,s)}},enterArray:{value:function(e,t){var i=this.builder.createArray();this.setObjectSerialization(t,i),this.builder.push(i)}},exitArray:{value:function(e,t,i){this.storeValue(this.builder.pop(),t,i)}},visitArray:{value:function(e,t,i){var a=this.labeler.getObjectLabel(t),s=this.builder.createObjectReference(a);this.getObjectSerialization(t).setLabel(a),this.builder.top.setProperty(i,s)}},visitRegExp:{value:function(e,t,i){this.storeValue(this.builder.createRegExp(t),t,i)}},visitString:{value:function(e,t,i){this.storeValue(this.builder.createString(t),t,i)}},visitNumber:{value:function(e,t,i){this.storeValue(this.builder.createNumber(t),t,i)}},visitBoolean:{value:function(e,t,i){this.storeValue(this.builder.createBoolean(t),t,i)}},visitNull:{value:function(e,t){this.storeValue(this.builder.createNull(),null,t)}},visitCustomObject:{value:function(e,t,i){var a=this.getCustomObjectTypeOf(t),u=s["visit"+a];if(a)return u.call(global,e,this,t,i);throw Error("Object's type is unknown: "+t)}},storeValue:{value:function(e,t,i){void 0===i?e.setLabel(this.labeler.getObjectLabel(t)):this.builder.top.setProperty(i,e)
}}});var s=Object.create(null);i.addCustomObjectVisitor=function(e){for(var t in e)if("getTypeOf"!==t&&"function"==typeof e[t]&&/^visit/.test(t)){if(void 0!==s[t])return Error("Visitor '"+t+"' is already registered.");s[t]=e[t].bind(e)}this.prototype.getCustomObjectTypeOf=a(e.getTypeOf)},i.resetCustomObjectVisitors=function(){s=Object.create(null),this.prototype.getCustomObjectTypeOf=function(){}},t.Visitor=i})(t)}}),montageDefine("4054049","serialization/labeler",{dependencies:[],factory:function(e,t){(function(e){function t(){this._labels=Object.create(null),this._objectsLabels=Object.create(null),this._objects=Object.create(null),this._baseNamesIndex=Object.create(null),this._userDefinedLabels=Object.create(null)}Object.defineProperties(t.prototype,{_labels:{value:null,writable:!0},_objectsLabels:{value:null,writable:!0},_objects:{value:null,writable:!0},_INITIAL_LABEL_NUMBER:{value:2},_baseNamesIndex:{value:null,writable:!0},_userDefinedLabels:{value:null,writable:!0},initWithObjects:{value:function(e){for(var t in e)this.setObjectLabel(e[t],t),this._userDefinedLabels[t]=!0}},cleanup:{value:function(){this._labels=null,this._objectsLabels=null,this._objects=null,this._baseNamesIndex=null,this._userDefinedLabels=null}},generateLabel:{value:function(e){var t,i=this._baseNamesIndex[e];do i?(t=e+i,this._baseNamesIndex[e]=i+=1):(t=e,this._baseNamesIndex[e]=i=this._INITIAL_LABEL_NUMBER);while(t in this._labels);return t}},getLabelBaseName:{value:function(e){return e.replace(/\d*$/,"")}},addLabel:{value:function(e){this._labels[e]=!0}},addLabels:{value:function(e){for(var t=0,i=e.length;i>t;t++)this.addLabel(e[t])}},isLabelDefined:{value:function(e){return e in this._labels}},isUserDefinedLabel:{value:function(e){return e in this._userDefinedLabels}},getObjectName:{value:function(e){return Array.isArray(e)?"array":RegExp.isRegExp(e)?"regexp":typeof e}},generateObjectLabel:{value:function(e){var t=this.getObjectName(e);return this.generateLabel(t)}},getObjectLabel:{value:function(e){var t,i=Object.hash(e);return i in this._objectsLabels?t=this._objectsLabels[i]:(t=this.generateObjectLabel(e),this.setObjectLabel(e,t)),t}},setObjectLabel:{value:function(e,t){if(void 0!==e){var i=Object.hash(e);this.addLabel(t),this._objectsLabels[i]=t,this._objects[t]=e}}},getObjectByLabel:{value:function(e){return this._objects[e]}}}),e.Labeler=t})(t)}}),montageDefine("4054049","deserialization/context",{dependencies:["q"],factory:function(e,t){var i=e("q");(function(e){function t(e,t,i){if(this._reviver=t,this._serialization=e,this._objects=Object.create(null),i){this._userObjects=Object.create(null);for(var a in i)this._userObjects[a]=i[a]}}Object.defineProperties(t.prototype,{_objects:{value:null,writable:!0},_userObjects:{value:null,writable:!0},_serialization:{value:null,writable:!0},_reviver:{value:null,writable:!0},setObjectLabel:{value:function(e,t){this._objects[t]=e}},getObject:{value:function(e){var t,a=this._serialization,s=this._reviver,u=this._objects;return e in u?u[e]:e in a?(t=s.reviveRootObject(a[e],this,e),e in u||(u[e]=t),t):i.reject(Error("Object with label '"+e+"' was not found."))}},getObjects:{value:function(){var e,t=this,a=(this._reviver,this._serialization),s=[];for(var u in a)e=this.getObject(u),i.isPromise(e)&&s.push(e);return 0===s.length?i.resolve(this._invokeDidReviveObjects()):i.all(s).then(function(){return t._invokeDidReviveObjects()})}},hasUserObject:{value:function(e){var t=this._userObjects;return t?e in t:!1}},getUserObject:{value:function(e){var t=this._userObjects;return t?t[e]:void 0}},_invokeDidReviveObjects:{value:function(){var e,t=this,a=this._reviver;return"function"==typeof a.didReviveObjects&&(e=a.didReviveObjects(this._objects,this),i.isPromise(e))?e.then(function(){return t._objects}):this._objects}}}),e.Context=t})(t)}}),montageDefine("4054049","deserialization/interpreter",{dependencies:["./reviver","./context"],factory:function(e,t){(function(t){function i(){}var a=e("./reviver").Reviver,s=e("./context").Context;Object.defineProperties(i.prototype,{instantiate:{value:function(e,t){var i=new a,u=new s(e,i,t);return u.getObjects()}}}),t.Interpreter=i})(t)}}),montageDefine("4054049","serialization/ast",{dependencies:[],factory:function(e,t){(function(e){function t(){this.object=Object.create(null)}function i(e,t){this.root=e,this.value=t}function a(e,t){i.call(this,e,t)}function s(e,t){i.call(this,e,t)}function u(e,t){i.call(this,e,t)}function n(e){i.call(this,e,Object.create(null))}function r(e,t){i.call(this,e,t)}Object.defineProperties(t.prototype,{object:{value:null,writable:!0},setProperty:{value:function(e,t){null!=e&&(this.object[e]=t)}},getProperty:{value:function(e){return this.object[e]}},clearProperty:{value:function(e){delete this.object[e]}},hasProperty:{value:function(e){return e in this.object}},serialize:{value:function(e){return JSON.stringify(this,null,e)}},toJSON:{value:function(){var e,t=Object.create(null);for(var i in this.object)e=this.object[i],t[i]=e.toJSON?e.toJSON(i,1):e;return t}}}),Object.defineProperties(i.prototype,{root:{value:null,writable:!0},label:{value:null,writable:!0},value:{value:null,writable:!0},setLabel:{value:function(e){this.label&&this.root.clearProperty(this.label),this.label=e,this.root.setProperty(e,this)}},getLabel:{value:function(){return this.label}},clearLabel:{value:function(){this.root.clearProperty(this.label),this.label=null}},_getSerializationValue:{value:function(){return this.value}},toJSON:{value:function(e,t){var i=this._getSerializationValue();return 1===t?{value:i}:i}}}),a.prototype=Object.create(i.prototype,{constructor:{value:a},toJSON:{value:function(e,t){var i,a=this._getSerializationValue();return 1===t?{value:a}:this.label?(i=new r(this.root,this.label),i.toJSON()):a}}}),s.prototype=Object.create(a.prototype,{constructor:{value:s},setProperty:{value:function(e,t){null!=e&&(this.value[e]=t)}},getProperty:{value:function(e){return this.value[e]}},clearProperty:{value:function(e){delete this.value[e]}},getPropertyNames:{value:function(){return Object.keys(this.value)}}}),u.prototype=Object.create(a.prototype,{constructor:{value:u},_getSerializationValue:{value:function(){var e=this.value;return{"/":{source:e.source,flags:(e.global?"g":"")+(e.ignoreCase?"i":"")+(e.multiline?"m":"")}}}}}),n.prototype=Object.create(i.prototype,{constructor:{value:n},setProperty:{value:function(e,t){null!=e&&(this.value[e]=t)}},getProperty:{value:function(e){return this.value[e]}},clearProperty:{value:function(e){delete this.value[e]}},toJSON:{value:function(e,t){var i,a=this._getSerializationValue();return 1===t?a:(i=new r(this.root,this.label),i.toJSON())}}}),r.prototype=Object.create(i.prototype,{constructor:{value:r},_getSerializationValue:{value:function(){return{"@":this.value}}}}),e.Root=t,e.Value=i,e.ReferenceableValue=a,e.ObjectLiteral=s,e.RegExpObject=u,e.CustomObject=n,e.ObjectReference=r})(t)}}),montageDefine("e3ee536","shim",{dependencies:["./shim-array","./shim-object","./shim-function","./shim-regexp"],factory:function(e){e("./shim-array"),e("./shim-object"),e("./shim-function"),e("./shim-regexp")}}),montageDefine("e3ee536","listen/property-changes",{dependencies:["../shim"],factory:function(e,t,i){function a(){throw Error("This is an abstract interface. Mix it. Don't construct it")}function s(e,t,i,a){var s,u,n,r=e.active,l=e.current,o=l.length,c=o;for(r.length>o&&(r.length=o);o--;)r[o]=l[o];for(u=0;c>u;u++)if(n=r[u],!u||l.indexOf(n)>=0){if(s=n[e.specificHandlerMethodName]||n[e.genericHandlerMethodName]||n,!s.call)throw Error("No event listener for "+e.specificHandlerName+" or "+e.genericHandlerName+" or call on "+s);s.call(n,i,t,a)}}e("../shim");var u=Object.prototype.hasOwnProperty;i.exports=a,a.debug=!0,a.prototype.getOwnPropertyChangeDescriptor=function(e){this.__propertyChangeListeners__||Object.defineProperty(this,"__propertyChangeListeners__",{value:{},enumerable:!1,configurable:!0,writable:!0});var t=this.__propertyChangeListeners__;if(!u.call(t,e)){var i=e+"";i=i&&i[0].toUpperCase()+i.slice(1),t[e]={willChangeListeners:{current:[],active:[],specificHandlerMethodName:"handle"+i+"WillChange",genericHandlerMethodName:"handlePropertyWillChange"},changeListeners:{current:[],active:[],specificHandlerMethodName:"handle"+i+"Change",genericHandlerMethodName:"handlePropertyChange"}}}return t[e]},a.prototype.hasOwnPropertyChangeDescriptor=function(e){if(!this.__propertyChangeListeners__)return!1;if(!e)return!0;var t=this.__propertyChangeListeners__;return u.call(t,e)?!0:!1},a.prototype.addOwnPropertyChangeListener=function(e,t,i){this.makeObservable&&!this.isObservable&&this.makeObservable();var s,u=a.getOwnPropertyChangeDescriptor(this,e);s=i?u.willChangeListeners:u.changeListeners,a.makePropertyObservable(this,e),s.current.push(t);var n=this;return function(){a.removeOwnPropertyChangeListener(n,e,t,i),n=null}},a.prototype.addBeforeOwnPropertyChangeListener=function(e,t){return a.addOwnPropertyChangeListener(this,e,t,!0)},a.prototype.removeOwnPropertyChangeListener=function(e,t,i){var s,u=a.getOwnPropertyChangeDescriptor(this,e);s=i?u.willChangeListeners:u.changeListeners;var n=s.current.lastIndexOf(t);if(-1===n)throw Error("Can't remove property change listener: does not exist: property name"+JSON.stringify(e));s.current.splice(n,1)},a.prototype.removeBeforeOwnPropertyChangeListener=function(e,t){return a.removeOwnPropertyChangeListener(this,e,t,!0)},a.prototype.dispatchOwnPropertyChange=function(e,t,i){var u,n=a.getOwnPropertyChangeDescriptor(this,e);if(!n.isActive){n.isActive=!0,u=i?n.willChangeListeners:n.changeListeners;try{s(u,e,t,this)}finally{n.isActive=!1}}},a.prototype.dispatchBeforeOwnPropertyChange=function(e,t){return a.dispatchOwnPropertyChange(this,e,t,!0)},a.prototype.makePropertyObservable=function(e){var t=this.__overriddenPropertyDescriptors__;if(t){if(u.call(t,e))return}else{if(Array.isArray(this))return;if(!Object.isExtensible(this))throw Error("Can't make property "+JSON.stringify(e)+" observable on "+this+" because object is not extensible");t={},Object.defineProperty(this,"__overriddenPropertyDescriptors__",{value:t,enumerable:!1,writable:!0,configurable:!0})}var i;"object"==typeof this.__state__?i=this.__state__:(i={},Object.defineProperty(this,"__state__",{value:i,writable:!0,enumerable:!1})),i[e]=this[e];var a,n=this;do{if(a=Object.getOwnPropertyDescriptor(n,e))break;n=Object.getPrototypeOf(n)}while(n);if(a){if(!a.configurable)return;if(!a.writable&&!a.set)return}else a={value:void 0,enumerable:!0,writable:!0,configurable:!0};t[e]=a;var r;r="value"in a?{get:function(){return a.value},set:function(t){var u,n;if(t!==a.value){if(u=this.__propertyChangeListeners__[e],n=u.isActive,!n){u.isActive=!0;try{s(u.willChangeListeners,e,a.value,this)}finally{}}if(a.value=t,i[e]=t,!n)try{s(u.changeListeners,e,t,this)}finally{u.isActive=!1}}},enumerable:a.enumerable,configurable:!0}:{get:a.get,set:function(t){var u,n,r=this[e];if(a.set.call(this,t),t=this[e],t!==r){if(u=this.__propertyChangeListeners__[e],n=u.isActive,!n){u.isActive=!0;try{s(u.willChangeListeners,e,r,this)}finally{}}if(i[e]=t,!n)try{s(u.changeListeners,e,t,this)}finally{u.isActive=!1}}},enumerable:a.enumerable,configurable:!0},Object.defineProperty(this,e,r)},a.getOwnPropertyChangeDescriptor=function(e,t){return e.getOwnPropertyChangeDescriptor?e.getOwnPropertyChangeDescriptor(t):a.prototype.getOwnPropertyChangeDescriptor.call(e,t)},a.hasOwnPropertyChangeDescriptor=function(e,t){return e.hasOwnPropertyChangeDescriptor?e.hasOwnPropertyChangeDescriptor(t):a.prototype.hasOwnPropertyChangeDescriptor.call(e,t)},a.addOwnPropertyChangeListener=function(e,t,i,s){return Object.isObject(e)?e.addOwnPropertyChangeListener?e.addOwnPropertyChangeListener(t,i,s):a.prototype.addOwnPropertyChangeListener.call(e,t,i,s):void 0},a.removeOwnPropertyChangeListener=function(e,t,i,s){return Object.isObject(e)?e.removeOwnPropertyChangeListener?e.removeOwnPropertyChangeListener(t,i,s):a.prototype.removeOwnPropertyChangeListener.call(e,t,i,s):void 0},a.dispatchOwnPropertyChange=function(e,t,i,s){return Object.isObject(e)?e.dispatchOwnPropertyChange?e.dispatchOwnPropertyChange(t,i,s):a.prototype.dispatchOwnPropertyChange.call(e,t,i,s):void 0},a.addBeforeOwnPropertyChangeListener=function(e,t,i){return a.addOwnPropertyChangeListener(e,t,i,!0)},a.removeBeforeOwnPropertyChangeListener=function(e,t,i){return a.removeOwnPropertyChangeListener(e,t,i,!0)},a.dispatchBeforeOwnPropertyChange=function(e,t,i){return a.dispatchOwnPropertyChange(e,t,i,!0)},a.makePropertyObservable=function(e,t){return e.makePropertyObservable?e.makePropertyObservable(t):a.prototype.makePropertyObservable.call(e,t)}}}),montageDefine("e3ee536","map",{dependencies:["./shim","./set","./generic-collection","./generic-map","./listen/property-changes","map"],factory:function(e,t,i){"use strict";function a(e,t,i,u){return this instanceof a?(t=t||Object.equals,i=i||Object.hash,u=u||Function.noop,this.contentEquals=t,this.contentHash=i,this.getDefault=u,this.store=new s(void 0,function(e,i){return t(e.key,i.key)},function(e){return i(e.key)}),this.length=0,this.addEach(e),void 0):new a(e,t,i,u)}e("./shim");var s=e("./set"),u=e("./generic-collection"),n=e("./generic-map"),r=e("./listen/property-changes");i.exports=a,a.Map=a,Object.addEach(a.prototype,u.prototype),Object.addEach(a.prototype,n.prototype),Object.addEach(a.prototype,r.prototype),a.prototype.constructClone=function(e){return new this.constructor(e,this.contentEquals,this.contentHash,this.getDefault)},a.prototype.log=function(e,t,i,a){t=t||this.logNode,this.store.log(e,function(e,i,a){t(e.value.value,i,a)},i,a)},a.prototype.logNode=function(e,t){t(" key: "+e.key),t(" value: "+e.value)}}}),montageDefine("e3ee536","shim-array",{dependencies:["./shim-function","./generic-collection","./generic-order","weak-map"],factory:function(e,t,i){"use strict";function a(e,t){Object.defineProperty(Array.prototype,e,{value:t,writable:!0,configurable:!0,enumerable:!1})}function s(e,t,i){this.array=e,this.start=null==t?0:t,this.end=i}e("./shim-function");var u=e("./generic-collection"),n=e("./generic-order"),r=e("weak-map");i.exports=Array;var l=Array.prototype.splice,o=Array.prototype.slice;Array.empty=[],Object.freeze&&Object.freeze(Array.empty),Array.from=function(e){var t=[];return t.addEach(e),t},Array.unzip=function(e){for(var t=[],i=1/0,a=0;e.length>a;a++){var s=e[a];e[a]=s.toArray(),i>s.length&&(i=s.length)}for(var a=0;e.length>a;a++)for(var s=e[a],u=0;s.length>u;u++)i>u&&u in s&&(t[u]=t[u]||[],t[u][a]=s[u]);return t},a("addEach",u.prototype.addEach),a("deleteEach",u.prototype.deleteEach),a("toArray",u.prototype.toArray),a("toObject",u.prototype.toObject),a("all",u.prototype.all),a("any",u.prototype.any),a("min",u.prototype.min),a("max",u.prototype.max),a("sum",u.prototype.sum),a("average",u.prototype.average),a("only",u.prototype.only),a("flatten",u.prototype.flatten),a("zip",u.prototype.zip),a("enumerate",u.prototype.enumerate),a("group",u.prototype.group),a("sorted",u.prototype.sorted),a("reversed",u.prototype.reversed),a("constructClone",function(e){var t=new this.constructor;return t.addEach(e),t}),a("has",function(e,t){return-1!==this.find(e,t)}),a("get",function(e,t){if(+e!==e)throw Error("Indicies must be numbers");return!e in this?t:this[e]}),a("set",function(e,t){return this[e]=t,!0}),a("add",function(e){return this.push(e),!0}),a("delete",function(e,t){var i=this.find(e,t);return-1!==i?(this.splice(i,1),!0):!1}),a("deleteAll",function(e,t){t=t||this.contentEquals||Object.equals;for(var i=0,a=0;this.length>a;)t(e,this[a])?(this.swap(a,1),i++):a++;return i}),a("find",function(e,t){t=t||this.contentEquals||Object.equals;for(var i=0;this.length>i;i++)if(i in this&&t(e,this[i]))return i;return-1}),a("findLast",function(e,t){t=t||this.contentEquals||Object.equals;var i=this.length;do if(i--,i in this&&t(this[i],e))return i;while(i>0);return-1}),a("swap",function(e,t,i){var a,s,u,n,r;if(e>this.length&&(this.length=e),void 0!==i){if(a=[e,t],Array.isArray(i)||(i=o.call(i)),u=0,s=i.length,1e3>s){for(u;s>u;u++)a[u+2]=i[u];return l.apply(this,a)}for(r=l.apply(this,a),u;s>u;){for(a=[e+u,0],n=2;1002>n&&s>u;n++,u++)a[n]=i[u];l.apply(this,a)}return r}return void 0!==t?l.call(this,e,t):void 0!==e?l.call(this,e):[]}),a("peek",function(){return this[0]}),a("poke",function(e){this.length>0&&(this[0]=e)}),a("peekBack",function(){return this.length>0?this[this.length-1]:void 0}),a("pokeBack",function(e){this.length>0&&(this[this.length-1]=e)}),a("one",function(){for(var e in this)if(Object.owns(this,e))return this[e]}),Array.prototype.clear||a("clear",function(){return this.length=0,this}),a("compare",function(e,t){t=t||Object.compare;var i,a,s,u,r;if(this===e)return 0;if(!e||!Array.isArray(e))return n.prototype.compare.call(this,e,t);for(a=Math.min(this.length,e.length),i=0;a>i;i++)if(i in this){if(!(i in e))return-1;if(s=this[i],u=e[i],r=t(s,u))return r}else if(i in e)return 1;return this.length-e.length}),a("equals",function(e,t){t=t||Object.equals;var i,a,s=0,u=this.length;if(this===e)return!0;if(!e||!Array.isArray(e))return n.prototype.equals.call(this,e);if(u!==e.length)return!1;for(;u>s;++s)if(s in this){if(!(s in e))return!1;if(i=this[s],a=e[s],!t(i,a))return!1}else if(s in e)return!1;return!0}),a("clone",function(e,t){if(null==e)e=1/0;else if(0===e)return this;if(t=t||new r,t.has(this))return t.get(this);var i=Array(this.length);t.set(this,i);for(var a in this)i[a]=Object.clone(this[a],e-1,t);return i}),a("iterate",function(e,t){return new s(this,e,t)}),a("Iterator",s),s.prototype.next=function(){if(this.start===(null==this.end?this.array.length:this.end))throw StopIteration;return this.array[this.start++]}}}),montageDefine("e3ee536","shim-object",{dependencies:["weak-map"],factory:function(e,t,i){"use strict";var a=e("weak-map");i.exports=Object,Object.empty=Object.freeze(Object.create(null)),Object.isObject=function(e){return Object(e)===e},Object.getValueOf=function(e){return e&&"function"==typeof e.valueOf&&(e=e.valueOf()),e};var s=new a;Object.hash=function(e){return e&&"function"==typeof e.hash?""+e.hash():Object(e)===e?(s.has(e)||s.set(e,Math.random().toString(36).slice(2)),s.get(e)):""+e};var u=Object.prototype.hasOwnProperty;Object.owns=function(e,t){return u.call(e,t)},Object.has=function(e,t){if("object"!=typeof e)throw Error("Object.has can't accept non-object: "+typeof e);if(e&&"function"==typeof e.has)return e.has(t);if("string"==typeof t)return t in e&&e[t]!==Object.prototype[t];throw Error("Key must be a string for Object.has on plain objects")},Object.get=function(e,t,i){if("object"!=typeof e)throw Error("Object.get can't accept non-object: "+typeof e);return e&&"function"==typeof e.get?e.get(t,i):Object.has(e,t)?e[t]:i},Object.set=function(e,t,i){e&&"function"==typeof e.set?e.set(t,i):e[t]=i},Object.addEach=function(e,t){if(t)if("function"!=typeof t.forEach||t.hasOwnProperty("forEach"))if("number"==typeof t.length)for(var i=0;t.length>i;i++)e[i]=t[i];else Object.keys(t).forEach(function(i){e[i]=t[i]});else t.isMap===!0?t.forEach(function(t,i){e[i]=t}):t.forEach(function(t){e[t[0]]=t[1]});return e},Object.forEach=function(e,t,i){Object.keys(e).forEach(function(a){t.call(i,e[a],a,e)})},Object.map=function(e,t,i){return Object.keys(e).map(function(a){return t.call(i,e[a],a,e)})},Object.values=function(e){return Object.map(e,Function.identity)},Object.concat=function(){for(var e={},t=0;arguments.length>t;t++)Object.addEach(e,arguments[t]);return e},Object.from=Object.concat,Object.is=function(e,t){return e===t?0!==e||1/e===1/t:e!==e&&t!==t},Object.equals=function(e,t,i,s){if(i=i||Object.equals,e=Object.getValueOf(e),t=Object.getValueOf(t),e===t)return!0;if(Object.isObject(e)){if(s=s||new a,s.has(e))return!0;s.set(e,!0)}if(Object.isObject(e)&&"function"==typeof e.equals)return e.equals(t,i,s);if(Object.isObject(t)&&"function"==typeof t.equals)return t.equals(e,i,s);if(Object.isObject(e)&&Object.isObject(t)&&Object.getPrototypeOf(e)===Object.prototype&&Object.getPrototypeOf(t)===Object.prototype){for(var u in e)if(!i(e[u],t[u],i,s))return!1;for(var u in t)if(!(u in e&&i(t[u],e[u],i,s)))return!1;return!0}return e!==e&&t!==t?!0:e&&t?!1:e===t},Object.compare=function(e,t){if(e=Object.getValueOf(e),t=Object.getValueOf(t),e===t)return 0;var i=typeof e,a=typeof t;return"number"===i&&"number"===a?e-t:"string"===i&&"string"===a?t>e?-1/0:1/0:e&&"function"==typeof e.compare?e.compare(t):t&&"function"==typeof t.compare?-t.compare(e):0},Object.clone=function(e,t,i){if(e=Object.getValueOf(e),i=i||new a,void 0===t)t=1/0;else if(0===t)return e;if(Object.isObject(e)){if(!i.has(e))if(e&&"function"==typeof e.clone)i.set(e,e.clone(t,i));else{var s=Object.getPrototypeOf(e);if(null!==s&&s!==Object.prototype)throw Error("Can't clone "+e);var u=Object.create(s);i.set(e,u);for(var n in e)u[n]=Object.clone(e[n],t-1,i)}return i.get(e)}return e},Object.clear=function(e){if(e&&"function"==typeof e.clear)e.clear();else for(var t=Object.keys(e),i=t.length;i;)i--,delete e[t[i]];return e}}}),montageDefine("e3ee536","shim-function",{dependencies:[],factory:function(e,t,i){i.exports=Function,Function.noop=function(){},Function.identity=function(e){return e},Function.by=function(e,t){t=t||Object.compare,e=e||Function.identity;var i=function(i,a){return t(e(i),e(a))};return i.compare=t,i.by=e,i},Function.get=function(e){return function(t){return Object.get(t,e)}}}}),montageDefine("e3ee536","shim-regexp",{dependencies:[],factory:function(){if(!RegExp.escape){var e=/[-[\]{}()*+?.\\^$|,#\s]/g;RegExp.escape=function(t){return t.replace(e,"\\$&")}}}}),montageDefine("e3ee536","set",{dependencies:["./shim","./list","./fast-set","./generic-collection","./generic-set","./listen/property-changes","./listen/range-changes","set"],factory:function(e,t,i){"use strict";function a(e,t,i,s){return this instanceof a?(t=t||Object.equals,i=i||Object.hash,s=s||Function.noop,this.contentEquals=t,this.contentHash=i,this.getDefault=s,this.order=new this.Order(void 0,t),this.store=new this.Store(void 0,function(e,i){return t(e.value,i.value)},function(e){return i(e.value)}),this.length=0,this.addEach(e),void 0):new a(e,t,i,s)}e("./shim");var s=e("./list"),u=e("./fast-set"),n=e("./generic-collection"),r=e("./generic-set"),l=e("./listen/property-changes"),o=e("./listen/range-changes");i.exports=a,a.Set=a,Object.addEach(a.prototype,n.prototype),Object.addEach(a.prototype,r.prototype),Object.addEach(a.prototype,l.prototype),Object.addEach(a.prototype,o.prototype),a.prototype.Order=s,a.prototype.Store=u,a.prototype.constructClone=function(e){return new this.constructor(e,this.contentEquals,this.contentHash,this.getDefault)},a.prototype.has=function(e){var t=new this.order.Node(e);return this.store.has(t)},a.prototype.get=function(e,t){if(t)throw Error("Set#get does not support second argument: equals");var i=new this.order.Node(e);return i=this.store.get(i),i?i.value:this.getDefault(e)},a.prototype.add=function(e){var t=new this.order.Node(e);if(!this.store.has(t)){var i=this.length;return this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([e],[],i),this.order.add(e),t=this.order.head.prev,this.store.add(t),this.length++,this.dispatchesRangeChanges&&this.dispatchRangeChange([e],[],i),!0}return!1},a.prototype["delete"]=function(e,t){if(t)throw Error("Set#delete does not support second argument: equals");var i=new this.order.Node(e);return this.store.has(i)?(i=this.store.get(i),this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([],[e],i.index),this.store["delete"](i),this.order.splice(i,1),this.length--,this.dispatchesRangeChanges&&this.dispatchRangeChange([],[e],i.index),!0):!1},a.prototype.pop=function(){if(this.length){var e=this.order.head.prev.value;return this["delete"](e),e}},a.prototype.shift=function(){if(this.length){var e=this.order.head.next.value;return this["delete"](e),e}},a.prototype.one=function(){return this.length>0?this.store.one().value:void 0},a.prototype.clear=function(){var e;this.dispatchesRangeChanges&&(e=this.toArray(),this.dispatchBeforeRangeChange([],e,0)),this.store.clear(),this.order.clear(),this.length=0,this.dispatchesRangeChanges&&this.dispatchRangeChange([],e,0)},a.prototype.reduce=function(e,t){var i=arguments[2],a=this.order,s=0;return a.reduce(function(t,a){return e.call(i,t,a,s++,this)},t,this)},a.prototype.reduceRight=function(e,t){var i=arguments[2],a=this.order,s=this.length-1;return a.reduceRight(function(t,a){return e.call(i,t,a,s--,this)},t,this)},a.prototype.iterate=function(){return this.order.iterate()},a.prototype.log=function(){var e=this.store;return e.log.apply(e,arguments)},a.prototype.makeObservable=function(){this.order.makeObservable()}}}),montageDefine("e3ee536","generic-collection",{dependencies:["./shim-array"],factory:function(e,t,i){"use strict";function a(){throw Error("Can't construct. GenericCollection is a mixin.")}i.exports=a,a.EmptyArray=Object.freeze([]),a.prototype.addEach=function(e){if(e&&Object(e)===e)if("function"==typeof e.forEach)e.forEach(this.add,this);else if("number"==typeof e.length)for(var t=0;e.length>t;t++)this.add(e[t],t);else Object.keys(e).forEach(function(t){this.add(e[t],t)},this);else if(e&&"number"==typeof e.length)for(var t=0;e.length>t;t++)this.add(e[t],t);return this},a.prototype.deleteEach=function(e,t){return e.forEach(function(e){this["delete"](e,t)},this),this},a.prototype.forEach=function(e){var t=arguments[1];return this.reduce(function(i,a,s,u,n){e.call(t,a,s,u,n)},void 0)},a.prototype.map=function(e){var t=arguments[1],i=[];return this.reduce(function(a,s,u,n,r){i.push(e.call(t,s,u,n,r))},void 0),i},a.prototype.enumerate=function(e){null==e&&(e=0);var t=[];return this.reduce(function(i,a){t.push([e++,a])},void 0),t},a.prototype.group=function(e,t,i){i=i||Object.equals;var a=[],s=[];return this.forEach(function(u,n,r){var l,n=e.call(t,u,n,r),o=s.indexOf(n,i);-1===o?(l=[],a.push([n,l]),s.push(n)):l=a[o][1],l.push(u)}),a},a.prototype.toArray=function(){return this.map(Function.identity)},a.prototype.toObject=function(){var e={};return this.reduce(function(t,i,a){e[a]=i},void 0),e},a.prototype.filter=function(e){var t=arguments[1],i=this.constructClone();return this.reduce(function(a,s,u,n,r){e.call(t,s,u,n,r)&&i.add(s,u)},void 0),i},a.prototype.every=function(e){var t=arguments[1];return this.reduce(function(i,a,s,u,n){return i&&e.call(t,a,s,u,n)},!0)},a.prototype.some=function(e){var t=arguments[1];return this.reduce(function(i,a,s,u,n){return i||e.call(t,a,s,u,n)},!1)},a.prototype.all=function(){return this.every(Boolean)},a.prototype.any=function(){return this.some(Boolean)},a.prototype.min=function(e){e=e||this.contentCompare||Object.compare;var t=!0;return this.reduce(function(i,a){return t?(t=!1,a):0>e(a,i)?a:i},void 0)},a.prototype.max=function(e){e=e||this.contentCompare||Object.compare;var t=!0;return this.reduce(function(i,a){return t?(t=!1,a):e(a,i)>0?a:i},void 0)},a.prototype.sum=function(e){return e=void 0===e?0:e,this.reduce(function(e,t){return e+t},e)},a.prototype.average=function(e){var t=void 0===e?0:e,i=void 0===e?0:e;return this.reduce(function(e,a){t+=a,i+=1},void 0),t/i},a.prototype.concat=function(){for(var e=this.constructClone(this),t=0;arguments.length>t;t++)e.addEach(arguments[t]);return e},a.prototype.flatten=function(){var e=this;return this.reduce(function(t,i){return i.forEach(function(e){this.push(e)},t,e),t},[])},a.prototype.zip=function(){var e=Array.prototype.slice.call(arguments);return e.unshift(this),Array.unzip(e)},a.prototype.join=function(e){return this.reduce(function(t,i){return void 0===t?i:t+e+i},void 0)},a.prototype.sorted=function(e,t,i){return e=e||this.contentCompare||Object.compare,e.by?(t=e.by,e=e.compare||this.contentCompare||Object.compare):t=t||Function.identity,void 0===i&&(i=1),this.map(function(e){return{by:t(e),value:e}}).sort(function(t,a){return e(t.by,a.by)*i}).map(function(e){return e.value})},a.prototype.reversed=function(){return this.constructClone(this).reverse()},a.prototype.clone=function(e,t){if(void 0===e)e=1/0;else if(0===e)return this;var i=this.constructClone();return this.forEach(function(a,s){i.add(Object.clone(a,e-1,t),s)},this),i},a.prototype.only=function(){return 1===this.length?this.one():void 0},a.prototype.iterator=function(){return this.iterate.apply(this,arguments)},e("./shim-array")}}),montageDefine("e3ee536","generic-map",{dependencies:["./shim-object","./listen/map-changes","./listen/property-changes"],factory:function(e,t,i){"use strict";function a(){throw Error("Can't construct. GenericMap is a mixin.")}function s(e,t){this.key=e,this.value=t}var u=e("./shim-object"),n=e("./listen/map-changes"),r=e("./listen/property-changes");i.exports=a,u.addEach(a.prototype,n.prototype),u.addEach(a.prototype,r.prototype),a.prototype.isMap=!0,a.prototype.addEach=function(e){if(e&&u(e)===e)if("function"==typeof e.forEach)e.isMap===!0?e.forEach(function(e,t){this.set(t,e)},this):e.forEach(function(e){this.set(e[0],e[1])},this);else if("number"==typeof e.length)for(var t=0;e.length>t;t++)this.add(e[t],t);else u.keys(e).forEach(function(t){this.set(t,e[t])},this);else if(e&&"number"==typeof e.length)for(var t=0;e.length>t;t++)this.add(e[t],t);return this},a.prototype.get=function(e,t){var i=this.store.get(new this.Item(e));return i?i.value:arguments.length>1?t:this.getDefault(e)},a.prototype.set=function(e,t){var i=new this.Item(e,t),a=this.store.get(i),s=!1;return a?(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(e,a.value),a.value=t,this.dispatchesMapChanges&&this.dispatchMapChange(e,t)):(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(e,void 0),this.store.add(i)&&(this.length++,s=!0),this.dispatchesMapChanges&&this.dispatchMapChange(e,t)),s},a.prototype.add=function(e,t){return this.set(t,e)},a.prototype.has=function(e){return this.store.has(new this.Item(e))},a.prototype["delete"]=function(e){var t=new this.Item(e);if(this.store.has(t)){var i=this.store.get(t).value;return this.dispatchesMapChanges&&this.dispatchBeforeMapChange(e,i),this.store["delete"](t),this.length--,this.dispatchesMapChanges&&this.dispatchMapChange(e,void 0),!0}return!1},a.prototype.clear=function(){var e;this.dispatchesMapChanges&&(this.forEach(function(e,t){this.dispatchBeforeMapChange(t,e)},this),e=this.keys()),this.store.clear(),this.length=0,this.dispatchesMapChanges&&e.forEach(function(e){this.dispatchMapChange(e)},this)},a.prototype.reduce=function(e,t,i){return this.store.reduce(function(t,a){return e.call(i,t,a.value,a.key,this)},t,this)},a.prototype.reduceRight=function(e,t,i){return this.store.reduceRight(function(t,a){return e.call(i,t,a.value,a.key,this)},t,this)},a.prototype.keys=function(){return this.map(function(e,t){return t})},a.prototype.values=function(){return this.map(Function.identity)},a.prototype.entries=function(){return this.map(function(e,t){return[t,e]})},a.prototype.items=function(){return this.entries()},a.prototype.equals=function(e,t){if(t=t||u.equals,this===e)return!0;if(e&&"function"==typeof e.every)return e.length===this.length&&e.every(function(e,i){return t(this.get(i),e)},this);var i=u.keys(e);return i.length===this.length&&u.keys(e).every(function(i){return t(this.get(i),e[i])},this)},a.prototype.toJSON=function(){return this.entries()},a.prototype.Item=s,s.prototype.equals=function(e){return u.equals(this.key,e.key)&&u.equals(this.value,e.value)},s.prototype.compare=function(e){return u.compare(this.key,e.key)}}}),montageDefine("e3ee536","listen/array-changes",{dependencies:["../shim","../list","./property-changes","./range-changes","./map-changes"],factory:function(e,t){function i(e){for(var t in e)Object.defineProperty(Array.prototype,t,{value:e[t],writable:!0,configurable:!0,enumerable:!1})}e("../shim"),e("../list");var a=e("./property-changes"),s=e("./range-changes"),u=e("./map-changes");Array.prototype.splice;var n=Array.prototype.slice;Array.prototype.reverse;var r,l=Array.prototype.sort,o=Array.prototype.swap,c=Array.prototype.push,m={}.__proto__===Object.prototype;
r=m?function(){this.__proto__=p}:function(){Object.defineProperties(this,d)},Object.defineProperty(Array.prototype,"makeObservable",{value:r,writable:!0,configurable:!0,enumerable:!1}),i(a.prototype),Object.defineProperty(Array.prototype,"makePropertyObservable",{value:function(){},writable:!0,configurable:!0,enumerable:!1}),i(s.prototype),i(u.prototype);var d={isObservable:{value:!0,writable:!0,configurable:!0},makeObservable:{value:Function.noop,writable:!0,configurable:!0},reverse:{value:function(){var e=this.constructClone(this);return e.reverse(),this.swap(0,this.length,e),this},writable:!0,configurable:!0},sort:{value:function(){var e,t;for(this.dispatchBeforeRangeChange(this,this,0),e=0,t=this.length;t>e;e++)a.dispatchBeforeOwnPropertyChange(this,e,this[e]),this.dispatchBeforeMapChange(e,this[e]);for(l.apply(this,arguments),e=0,t=this.length;t>e;e++)a.dispatchOwnPropertyChange(this,e,this[e]),this.dispatchMapChange(e,this[e]);return this.dispatchRangeChange(this,this,0),this},writable:!0,configurable:!0},_dispatchBeforeOwnPropertyChange:{value:function(e,t){for(var i=e,s=e+t;s>i;i++)a.dispatchBeforeOwnPropertyChange(this,i,this[i]),this.dispatchBeforeMapChange(i,this[i])}},_dispatchOwnPropertyChange:{value:function(e,t){for(var i=e,a=e+t;a>i;i++)this.dispatchOwnPropertyChange(i,this[i]),this.dispatchMapChange(i,this[i])}},swap:{value:function(e,t,i){var s,u,r;if(i?Array.isArray(i)||(i=n.call(i)):i=Array.empty,0>e)e=this.length+e;else if(e>this.length){var l=e-this.length,c=Array(l+i.length);for(u=0,r=l;i.length>u;u++,r++)u in i&&(c[r]=i[u]);i=c,e=this.length}var m;if(0===t){if(0===i.length)return[];m=Array.empty}else m=n.call(this,e,e+t);var d=i.length-m.length,p=this.length,v=Math.max(this.length+d,e+i.length),h=Math.max(p,v);d&&a.dispatchBeforeOwnPropertyChange(this,"length",this.length),this.dispatchBeforeRangeChange(i,m,e),0===d?this._dispatchBeforeOwnPropertyChange(e,i.length):(s=a.hasOwnPropertyChangeDescriptor(this))&&this._dispatchBeforeOwnPropertyChange(e,h-e),e>p&&(this.length=e);var g=o.call(this,e,t,i);return 0===d?this._dispatchOwnPropertyChange(e,i.length):s&&this._dispatchOwnPropertyChange(e,h-e),this.dispatchRangeChange(i,m,e),d&&this.dispatchOwnPropertyChange("length",this.length),g},writable:!0,configurable:!0},splice:{value:function(e,t){return e>this.length&&(e=this.length),this.swap.call(this,e,t,n.call(arguments,2))},writable:!0,configurable:!0},set:{value:function(e,t){return this.swap(e,e>=this.length?0:1,[t]),!0},writable:!0,configurable:!0},shift:{value:function(){return this.splice(0,1)[0]},writable:!0,configurable:!0},pop:{value:function(){return this.length?this.splice(this.length-1,1)[0]:void 0},writable:!0,configurable:!0},push:{value:function(){var e,t,i=this.length,s=arguments.length;e=1===s?[arguments[0]]:Array.apply(null,arguments),s>0&&(a.dispatchBeforeOwnPropertyChange(this,"length",i),this.dispatchBeforeRangeChange(e,Array.empty,i),(t=a.hasOwnPropertyChangeDescriptor(this))&&this._dispatchBeforeOwnPropertyChange(i,s)),c.apply(this,arguments),s>0&&(t&&this._dispatchOwnPropertyChange(i,s),this.dispatchRangeChange(e,Array.empty,i),this.dispatchOwnPropertyChange("length",this.length))},writable:!0,configurable:!0},unshift:{value:function(e){if(1===arguments.length)return this.splice(0,0,e);var t=n.call(arguments);return this.swap(0,0,t)},writable:!0,configurable:!0},clear:{value:function(){return this.splice(0,this.length)},writable:!0,configurable:!0}},p=Object.create(Array.prototype,d);t.observableArrayProperties=d}}),montageDefine("e3ee536","sorted-array",{dependencies:["./shim","./generic-collection","./listen/property-changes","./listen/range-changes","sorted-array"],factory:function(e,t,i){"use strict";function a(e,t,i,s){return this instanceof a?(Array.isArray(e)?(this.array=e,e=e.splice(0,e.length)):this.array=[],this.contentEquals=t||Object.equals,this.contentCompare=i||Object.compare,this.getDefault=s||Function.noop,this.length=0,this.addEach(e),void 0):new a(e,t,i,s)}function s(e,t,i){for(var a=0,s=e.length-1;s>=a;){var u=a+s>>1,n=i(t,e[u]);if(n>0)a=u+1;else{if(!(0>n))return u;s=u-1}}return-(a+1)}function u(e,t,i,a){var u=s(e,t,i);if(0>u)return-1;for(;u>0&&a(t,e[u-1]);)u--;return a(t,e[u])?u:-1}function n(e,t,i,a){var u=s(e,t,i);if(0>u)return-1;for(;e.length-1>u&&a(t,e[u+1]);)u++;return a(t,e[u])?u:-1}function r(e,t,i){var a=s(e,t,i);if(0>a)return-a-1;for(var u=e.length-1;u>a&&0===i(t,e[a+1]);)a++;return a}i.exports=a,e("./shim");var l=e("./generic-collection"),o=e("./listen/property-changes"),c=e("./listen/range-changes");a.SortedArray=a,Object.addEach(a.prototype,l.prototype),Object.addEach(a.prototype,o.prototype),Object.addEach(a.prototype,c.prototype),a.prototype.isSorted=!0,a.prototype.constructClone=function(e){return new this.constructor(e,this.contentEquals,this.contentCompare,this.getDefault)},a.prototype.has=function(e,t){if(t)throw Error("SortedSet#has does not support second argument: equals");var i=s(this.array,e,this.contentCompare);return i>=0&&this.contentEquals(this.array[i],e)},a.prototype.get=function(e,t){if(t)throw Error("SortedArray#get does not support second argument: equals");var i=u(this.array,e,this.contentCompare,this.contentEquals);return-1!==i?this.array[i]:this.getDefault(e)},a.prototype.add=function(e){var t=r(this.array,e,this.contentCompare);return this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([e],[],t),this.array.splice(t,0,e),this.length++,this.dispatchesRangeChanges&&this.dispatchRangeChange([e],[],t),!0},a.prototype["delete"]=function(e,t){if(t)throw Error("SortedArray#delete does not support second argument: equals");var i=u(this.array,e,this.contentCompare,this.contentEquals);return-1!==i?(this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([],[e],i),this.array.splice(i,1),this.length--,this.dispatchesRangeChanges&&this.dispatchRangeChange([],[e],i),!0):!1},a.prototype.deleteAll=function(e,t){if(t){var i=this.array.deleteAll(e,t);return this.length-=i,i}var a=u(this.array,e,this.contentCompare,this.contentEquals);if(-1!==a){for(var s=a;this.contentEquals(e,this.array[s]);)s++;var n=this.slice(a,s);return this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([],n,a),this.array.splice(a,n.length),this.length-=n.length,this.dispatchesRangeChanges&&this.dispatchRangeChange([],n,a),n.length}return 0},a.prototype.indexOf=function(e){return u(this.array,e,this.contentCompare,this.contentEquals)},a.prototype.lastIndexOf=function(e){return n(this.array,e,this.contentCompare,this.contentEquals)},a.prototype.find=function(e,t,i){if(t)throw Error("SortedArray#find does not support second argument: equals");if(i)throw Error("SortedArray#find does not support third argument: index");return u(this.array,e,this.contentCompare,this.contentEquals)},a.prototype.findLast=function(e,t,i){if(t)throw Error("SortedArray#findLast does not support second argument: equals");if(i)throw Error("SortedArray#findLast does not support third argument: index");return n(this.array,e,this.contentCompare,this.contentEquals)},a.prototype.push=function(){this.addEach(arguments)},a.prototype.unshift=function(){this.addEach(arguments)},a.prototype.pop=function(){var e=this.array.pop();return this.length=this.array.length,e},a.prototype.shift=function(){var e=this.array.shift();return this.length=this.array.length,e},a.prototype.slice=function(){return this.array.slice.apply(this.array,arguments)},a.prototype.splice=function(e,t){return this.swap(e,t,Array.prototype.slice.call(arguments,2))},a.prototype.swap=function(e,t,i){if(void 0===e&&void 0===t)return[];e=e||0,0>e&&(e+=this.length),void 0===t&&(t=1/0);var a=this.slice(e,e+t);return this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange(i,a,e),this.array.splice(e,t),this.length-=a.length,this.dispatchesRangeChanges&&this.dispatchRangeChange([],a,e),this.addEach(i),a},a.prototype.reduce=function(e,t){var i=arguments[2];return this.array.reduce(function(t,a,s){return e.call(i,t,a,s,this)},t,this)},a.prototype.reduceRight=function(){var e=arguments[2];return this.array.reduceRight(function(t,i,a){return callback.call(e,t,i,a,this)},basis,this)},a.prototype.min=function(){return this.length?this.array[0]:void 0},a.prototype.max=function(){return this.length?this.array[this.length-1]:void 0},a.prototype.one=function(){return this.array.one()},a.prototype.clear=function(){var e;this.dispatchesRangeChanges&&(e=this.array.slice(),this.dispatchBeforeRangeChange([],e,0)),this.length=0,this.array.clear(),this.dispatchesRangeChanges&&this.dispatchRangeChange([],e,0)},a.prototype.equals=function(e,t){return this.array.equals(e,t)},a.prototype.compare=function(e,t){return this.array.compare(e,t)},a.prototype.iterate=function(e,t){return new this.Iterator(this.array,e,t)},a.prototype.toJSON=function(){return this.toArray()},a.prototype.Iterator=Array.prototype.Iterator}}),montageDefine("e3ee536","sorted-set",{dependencies:["./shim","./generic-collection","./generic-set","./listen/property-changes","./listen/range-changes","./tree-log","sorted-set"],factory:function(e,t,i){"use strict";function a(e,t,i,s){return this instanceof a?(this.contentEquals=t||Object.equals,this.contentCompare=i||Object.compare,this.getDefault=s||Function.noop,this.root=null,this.length=0,this.addEach(e),void 0):new a(e,t,i,s)}function s(e){this.value=e,this.left=null,this.right=null,this.length=1}function u(e,t,i){if(this.set=e,this.prev=null,this.end=i,t){var a=this.set.findLeastGreaterThanOrEqual(t);a&&(this.set.splay(a.value),this.prev=a.getPrevious())}}i.exports=a,e("./shim");var n=e("./generic-collection"),r=e("./generic-set"),l=e("./listen/property-changes"),o=e("./listen/range-changes"),c=e("./tree-log");a.SortedSet=a,Object.addEach(a.prototype,n.prototype),Object.addEach(a.prototype,r.prototype),Object.addEach(a.prototype,l.prototype),Object.addEach(a.prototype,o.prototype),a.prototype.isSorted=!0,a.prototype.constructClone=function(e){return new this.constructor(e,this.contentEquals,this.contentCompare,this.getDefault)},a.prototype.has=function(e,t){if(t)throw Error("SortedSet#has does not support second argument: equals");return this.root?(this.splay(e),this.contentEquals(e,this.root.value)):!1},a.prototype.get=function(e,t){if(t)throw Error("SortedSet#get does not support second argument: equals");return this.root&&(this.splay(e),this.contentEquals(e,this.root.value))?this.root.value:this.getDefault(e)},a.prototype.add=function(e){var t=new this.Node(e);if(!this.root)return this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([e],[],0),this.root=t,this.length++,this.dispatchesRangeChanges&&this.dispatchRangeChange([e],[],0),!0;if(this.splay(e),!this.contentEquals(e,this.root.value)){var i=this.contentCompare(e,this.root.value);if(0===i)throw Error("SortedSet cannot contain incomparable but inequal values: "+e+" and "+this.root.value);return this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([e],[],this.root.index),0>i?(t.right=this.root,t.left=this.root.left,this.root.left=null,this.root.touch()):(t.left=this.root,t.right=this.root.right,this.root.right=null,this.root.touch()),t.touch(),this.root=t,this.length++,this.dispatchesRangeChanges&&this.dispatchRangeChange([e],[],this.root.index),!0}return!1},a.prototype["delete"]=function(e,t){if(t)throw Error("SortedSet#delete does not support second argument: equals");if(this.root&&(this.splay(e),this.contentEquals(e,this.root.value))){var i=this.root.index;if(this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([],[e],i),this.root.left){var a=this.root.right;this.root=this.root.left,this.splay(e),this.root.right=a}else this.root=this.root.right;return this.length--,this.root&&this.root.touch(),this.dispatchesRangeChanges&&this.dispatchRangeChange([],[e],i),!0}return!1},a.prototype.indexOf=function(e,t){if(t)throw Error("SortedSet#indexOf does not support second argument: startIndex");return this.root&&(this.splay(e),this.contentEquals(e,this.root.value))?this.root.index:-1},a.prototype.find=function(e,t,i){if(t)throw Error("SortedSet#find does not support second argument: equals");if(i)throw Error("SortedSet#find does not support third argument: index");return this.root&&(this.splay(e),this.contentEquals(e,this.root.value))?this.root:void 0},a.prototype.findGreatest=function(e){if(this.root){for(e=e||this.root;e.right;)e=e.right;return e}},a.prototype.findLeast=function(e){if(this.root){for(e=e||this.root;e.left;)e=e.left;return e}},a.prototype.findGreatestLessThanOrEqual=function(e){return this.root?(this.splay(e),this.contentCompare(this.root.value,e)>0?this.root.getPrevious():this.root):void 0},a.prototype.findGreatestLessThan=function(e){return this.root?(this.splay(e),this.contentCompare(this.root.value,e)>=0?this.root.getPrevious():this.root):void 0},a.prototype.findLeastGreaterThanOrEqual=function(e){return this.root?(this.splay(e),this.contentCompare(this.root.value,e)>=0?this.root:this.root.getNext()):void 0},a.prototype.findLeastGreaterThan=function(e){return this.root?(this.splay(e),0>=this.contentCompare(this.root.value,e)?this.root.getNext():this.root):void 0},a.prototype.pop=function(){if(this.root){var e=this.findGreatest();return this["delete"](e.value),e.value}},a.prototype.shift=function(){if(this.root){var e=this.findLeast();return this["delete"](e.value),e.value}},a.prototype.push=function(){this.addEach(arguments)},a.prototype.unshift=function(){this.addEach(arguments)},a.prototype.slice=function(e,t){e=e||0,t=t||this.length,0>e&&(e+=this.length),0>t&&(t+=this.length);var i=[];if(this.root)for(this.splayIndex(e);t>this.root.index&&(i.push(this.root.value),this.root.right);)this.splay(this.root.getNext().value);return i},a.prototype.splice=function(e,t){return this.swap(e,t,Array.prototype.slice.call(arguments,2))},a.prototype.swap=function(e,t,i){if(void 0===e&&void 0===t)return[];e=e||0,0>e&&(e+=this.length),void 0===t&&(t=1/0);var a=[];if(this.root){this.splayIndex(e);for(var s=0;t>s;s++){a.push(this.root.value);var u=this.root.getNext();if(this["delete"](this.root.value),!u)break;this.splay(u.value)}}return this.addEach(i),a},a.prototype.splay=function(e){var t,i,a,u,n,r;if(this.root){for(t=i=a=new this.Node,r=new this.Node,n=this.root;;){var l=this.contentCompare(e,n.value);if(0>l){if(!n.left)break;if(0>this.contentCompare(e,n.left.value)&&(u=n.left,n.left=u.right,n.touch(),u.right=n,u.touch(),n=u,!n.left))break;u=new s,u.right=n,u.left=r.left,r.left=u,a.left=n,a.touch(),a=n,n=n.left}else{if(!(l>0))break;if(!n.right)break;if(this.contentCompare(e,n.right.value)>0&&(u=n.right,n.right=u.left,n.touch(),u.left=n,u.touch(),n=u,!n.right))break;u=new s,u.left=n,u.right=r.right,r.right=u,i.right=n,i.touch(),i=n,n=n.right}}for(i.right=n.left,i.touch(),a.left=n.right,a.touch(),n.left=t.right,n.right=t.left;r.left;)r.left.right.touch(),r.left=r.left.left;for(;r.right;)r.right.left.touch(),r.right=r.right.right;n.touch(),this.root=n}},a.prototype.splayIndex=function(e){if(this.root){for(var t=this.root,i=this.root.index;i!==e;)if(i>e&&t.left)t=t.left,i-=1+(t.right?t.right.length:0);else{if(!(e>i&&t.right))break;t=t.right,i+=1+(t.left?t.left.length:0)}return this.splay(t.value),this.root.index===e}return!1},a.prototype.reduce=function(e,t,i){return this.root&&(t=this.root.reduce(e,t,0,i,this)),t},a.prototype.reduceRight=function(e,t,i){return this.root&&(t=this.root.reduceRight(e,t,this.length-1,i,this)),t},a.prototype.min=function(e){var t=this.findLeast(e);return t?t.value:void 0},a.prototype.max=function(e){var t=this.findGreatest(e);return t?t.value:void 0},a.prototype.one=function(){return this.min()},a.prototype.clear=function(){var e;this.dispatchesRangeChanges&&(e=this.toArray(),this.dispatchBeforeRangeChange([],e,0)),this.root=null,this.length=0,this.dispatchesRangeChanges&&this.dispatchRangeChange([],e,0)},a.prototype.iterate=function(e,t){return new this.Iterator(this,e,t)},a.prototype.Iterator=u,a.prototype.summary=function(){return this.root?this.root.summary():"()"},a.prototype.log=function(e,t,i,a){e=e||c.unicodeRound,t=t||this.logNode,i||(i=console.log,a=console),i=i.bind(a),this.root&&this.root.log(e,t,i,i)},a.prototype.logNode=function(e,t){t(" "+e.value)},a.logCharsets=c,a.prototype.Node=s,s.prototype.reduce=function(e,t,i,a,s,u){if(u=u||0,this.left){var n=this.left.length;t=this.left.reduce(e,t,i,a,s,u+1),i+=n}return t=e.call(a,t,this.value,i,s,this,u),i+=1,this.right&&(t=this.right.reduce(e,t,i,a,s,u+1)),t},s.prototype.reduceRight=function(e,t,i,a,s,u){return u=u||0,this.right&&(t=this.right.reduce(e,t,i,a,s,u+1),i-=this.right.length),t=e.call(a,t,this.value,this.value,s,this,u),i-=1,this.left&&(t=this.left.reduce(e,t,i,a,s,u+1)),t},s.prototype.touch=function(){this.length=1+(this.left?this.left.length:0)+(this.right?this.right.length:0),this.index=this.left?this.left.length:0},s.prototype.checkIntegrity=function(){var e=1;if(e+=this.left?this.left.checkIntegrity():0,e+=this.right?this.right.checkIntegrity():0,this.length!==e)throw Error("Integrity check failed: "+this.summary());return e},s.prototype.getNext=function(){var e=this;if(e.right){for(e=e.right;e.left;)e=e.left;return e}},s.prototype.getPrevious=function(){var e=this;if(e.left){for(e=e.left;e.right;)e=e.right;return e}},s.prototype.summary=function(){var e=this.value||"-";return e+=" <"+this.length,this.left||this.right?"("+e+" "+(this.left?this.left.summary():"()")+", "+(this.right?this.right.summary():"()")+")":"("+e+")"},s.prototype.log=function(e,t,i,a){var s,u=this;s=this.left&&this.right?e.intersection:this.left?e.branchUp:this.right?e.branchDown:e.through;var n;this.left&&this.left.log(e,t,function(t){n?a(e.strafe+" "+t):(n=!0,a(e.fromBelow+e.through+t))},function(e){a("  "+e)});var r;t(this,function(t){r?i((u.right?e.strafe:" ")+t):(r=!0,i(s+t))},function(t){a((u.left?e.strafe:" ")+t)});var l;this.right&&this.right.log(e,t,function(t){l?i("  "+t):(l=!0,i(e.fromAbove+e.through+t))},function(t){i(e.strafe+" "+t)})},u.prototype.next=function(){var e;if(e=this.prev?this.set.findLeastGreaterThan(this.prev.value):this.set.findLeast(),!e)throw StopIteration;if(void 0!==this.end&&this.set.contentCompare(e.value,this.end)>=0)throw StopIteration;return this.prev=e,e.value}}}),montageDefine("e3ee536","heap",{dependencies:["./listen/array-changes","./shim","./generic-collection","./listen/map-changes","./listen/range-changes","./listen/property-changes","heap"],factory:function(e,t,i){function a(e,t,i){return this instanceof a?(this.contentEquals=t||Object.equals,this.contentCompare=i||Object.compare,this.content=[],this.length=0,this.addEach(e),void 0):new a(e,t,i)}e("./listen/array-changes"),e("./shim");var s=e("./generic-collection"),u=e("./listen/map-changes"),n=e("./listen/range-changes"),r=e("./listen/property-changes");i.exports=a,a.Heap=a,Object.addEach(a.prototype,s.prototype),Object.addEach(a.prototype,r.prototype),Object.addEach(a.prototype,n.prototype),Object.addEach(a.prototype,u.prototype),a.prototype.constructClone=function(e){return new this.constructor(e,this.contentEquals,this.contentCompare)},a.prototype.push=function(e){this.content.push(e),this.float(this.content.length-1),this.length++},a.prototype.pop=function(){var e=this.content[0],t=this.content.pop();return this.content.length>0&&(this.content.set(0,t),this.sink(0)),this.length--,e},a.prototype.add=function(e){this.push(e)},a.prototype.indexOf=function(e){for(var t=0;this.length>t;t++)if(this.contentEquals(this.content[t],e))return t;return-1},a.prototype["delete"]=function(e,t){if(t)throw Error("Heap#delete does not support second argument: equals");var i=this.indexOf(e);if(-1===i)return!1;var a=this.content.pop();if(this.length=this.content.length,i===this.content.length)return!0;this.content.set(i,a);var s=this.contentCompare(a,e);return s>0?this.float(i):0>s&&this.sink(i),!0},a.prototype.peek=function(){return this.length?this.content[0]:void 0},a.prototype.max=function(){return this.peek()},a.prototype.one=function(){return this.peek()},a.prototype.float=function(e){for(var t=this.content[e];e>0;){var i=Math.floor((e+1)/2)-1,a=this.content[i];if(!(0>this.contentCompare(a,t)))break;this.content.set(i,t),this.content.set(e,a),e=i}},a.prototype.sink=function(e){for(var t,i,a,s,u,n,r=this.content.length,l=this.content[e];;){if(s=2*(e+1),a=s-1,n=!1,r>a){var t=this.content[a],o=this.contentCompare(t,l);o>0&&(u=a,n=!0)}if(r>s){var i=this.content[s],o=this.contentCompare(i,n?t:l);o>0&&(u=s,n=!0)}if(!n)break;this.content.set(e,this.content[u]),this.content.set(u,l),e=u}},a.prototype.clear=function(){this.content.clear(),this.length=0},a.prototype.reduce=function(e,t){var i=arguments[2];return this.content.reduce(function(t,a,s){return e.call(i,t,a,s,this)},t,this)},a.prototype.reduceRight=function(e,t){var i=arguments[2];return this.content.reduceRight(function(t,a,s){return e.call(i,t,a,s,this)},t,this)},a.prototype.toJSON=function(){return this.toArray()},a.prototype.makeObservable=function(){this.content.addRangeChangeListener(this,"content"),this.content.addBeforeRangeChangeListener(this,"content"),this.content.addMapChangeListener(this,"content"),this.content.addBeforeMapChangeListener(this,"content")},a.prototype.handleContentRangeChange=function(e,t,i){this.dispatchRangeChange(e,t,i)},a.prototype.handleContentRangeWillChange=function(e,t,i){this.dispatchBeforeRangeChange(e,t,i)},a.prototype.handleContentMapChange=function(e,t){this.dispatchMapChange(t,e)},a.prototype.handleContentMapWillChange=function(e,t){this.dispatchBeforeMapChange(t,e)}}}),montageDefine("e3ee536","generic-order",{dependencies:["./shim-object"],factory:function(e,t,i){function a(){throw Error("Can't construct. GenericOrder is a mixin.")}var s=e("./shim-object");i.exports=a,a.prototype.equals=function(e,t){return t=t||this.contentEquals||s.equals,this===e?!0:e?this.length===e.length&&this.zip(e).every(function(e){return t(e[0],e[1])}):!1},a.prototype.compare=function(e,t){if(t=t||this.contentCompare||s.compare,this===e)return 0;if(!e)return 1;var i=Math.min(this.length,e.length),a=this.zip(e).reduce(function(e,a,s){return 0===e?s>=i?e:t(a[0],a[1]):e},0);return 0===a?this.length-e.length:a},a.prototype.toJSON=function(){return this.toArray()}}}),montageDefine("e3ee536","list",{dependencies:["./shim","./generic-collection","./generic-order","./listen/property-changes","./listen/range-changes","list"],factory:function(e,t,i){"use strict";function a(e,t,i){if(!(this instanceof a))return new a(e,t,i);var s=this.head=new this.Node;s.next=s,s.prev=s,this.contentEquals=t||Object.equals,this.getDefault=i||Function.noop,this.length=0,this.addEach(e)}function s(e){this.head=e,this.at=e.next}function u(e){this.value=e,this.prev=null,this.next=null}i.exports=a,e("./shim");var n=e("./generic-collection"),r=e("./generic-order"),l=e("./listen/property-changes"),o=e("./listen/range-changes");a.List=a,Object.addEach(a.prototype,n.prototype),Object.addEach(a.prototype,r.prototype),Object.addEach(a.prototype,l.prototype),Object.addEach(a.prototype,o.prototype),a.prototype.constructClone=function(e){return new this.constructor(e,this.contentEquals,this.getDefault)},a.prototype.find=function(e,t,i){t=t||this.contentEquals;for(var a=this.head,s=this.scan(i,a.next);s!==a;){if(t(s.value,e))return s;s=s.next}},a.prototype.findLast=function(e,t,i){t=t||this.contentEquals;for(var a=this.head,s=this.scan(i,a.prev);s!==a;){if(t(s.value,e))return s;s=s.prev}},a.prototype.has=function(e,t){return!!this.find(e,t)},a.prototype.get=function(e,t){var i=this.find(e,t);return i?i.value:this.getDefault(e)},a.prototype["delete"]=function(e,t){var i=this.findLast(e,t);if(i){if(this.dispatchesRangeChanges){var a=[],s=[e];this.dispatchBeforeRangeChange(a,s,i.index)}return i["delete"](),this.length--,this.dispatchesRangeChanges&&(this.updateIndexes(i.next,i.index),this.dispatchRangeChange(a,s,i.index)),!0}return!1},a.prototype.deleteAll=function(e,t){t=t||this.contentEquals;for(var i=this.head,a=i.next,s=0;a!==i;)t(e,a.value)&&(a["delete"](),s++),a=a.next;return this.length-=s,s},a.prototype.clear=function(){var e,t;this.dispatchesRangeChanges&&(t=this.toArray(),e=[],this.dispatchBeforeRangeChange(e,t,0)),this.head.next=this.head.prev=this.head,this.length=0,this.dispatchesRangeChanges&&this.dispatchRangeChange(e,t,0)},a.prototype.add=function(e){var t=new this.Node(e);return this.dispatchesRangeChanges&&(t.index=this.length,this.dispatchBeforeRangeChange([e],[],t.index)),this.head.addBefore(t),this.length++,this.dispatchesRangeChanges&&this.dispatchRangeChange([e],[],t.index),!0},a.prototype.push=function(){var e=this.head;if(this.dispatchesRangeChanges){var t=Array.prototype.slice.call(arguments),i=[],a=this.length;this.dispatchBeforeRangeChange(t,i,a);var s=this.head.prev}for(var u=0;arguments.length>u;u++){var n=arguments[u],r=new this.Node(n);e.addBefore(r)}this.length+=arguments.length,this.dispatchesRangeChanges&&(this.updateIndexes(s.next,void 0===s.index?0:s.index+1),this.dispatchRangeChange(t,i,a))},a.prototype.unshift=function(){if(this.dispatchesRangeChanges){var e=Array.prototype.slice.call(arguments),t=[];this.dispatchBeforeRangeChange(e,t,0)}for(var i=this.head,a=0;arguments.length>a;a++){var s=arguments[a],u=new this.Node(s);i.addAfter(u),i=u}this.length+=arguments.length,this.dispatchesRangeChanges&&(this.updateIndexes(this.head.next,0),this.dispatchRangeChange(e,t,0))},a.prototype.pop=function(){var e,t=this.head;if(t.prev!==t){if(e=t.prev.value,this.dispatchesRangeChanges){var i=[],a=[e],s=this.length-1;this.dispatchBeforeRangeChange(i,a,s)}t.prev["delete"](),this.length--,this.dispatchesRangeChanges&&this.dispatchRangeChange(i,a,s)}return e},a.prototype.shift=function(){var e,t=this.head;if(t.prev!==t){if(e=t.next.value,this.dispatchesRangeChanges){var i=[],a=[e];this.dispatchBeforeRangeChange(i,a,0)}t.next["delete"](),this.length--,this.dispatchesRangeChanges&&(this.updateIndexes(this.head.next,0),this.dispatchRangeChange(i,a,0))}return e},a.prototype.peek=function(){return this.head!==this.head.next?this.head.next.value:void 0},a.prototype.poke=function(e){this.head!==this.head.next?this.head.next.value=e:this.push(e)},a.prototype.one=function(){return this.peek()},a.prototype.scan=function(e,t){var i=this.head;if("number"==typeof e){var a=e;if(a>=0)for(e=i.next;a&&(a--,e=e.next,e!=i););else for(e=i;0>a&&(a++,e=e.prev,e!=i););return e}return e||t},a.prototype.slice=function(e,t){var i=[],a=this.head;for(e=this.scan(e,a.next),t=this.scan(t,a);e!==t&&e!==a;)i.push(e.value),e=e.next;return i},a.prototype.splice=function(e,t){return this.swap(e,t,Array.prototype.slice.call(arguments,2))},a.prototype.swap=function(e,t,i){var a=e;e=this.scan(e,this.head),null==t&&(t=1/0),i=Array.from(i);for(var s=[],u=e;t--&&t>=0&&u!==this.head;)s.push(u.value),u=u.next;var n,r;this.dispatchesRangeChanges&&(n=e===this.head?this.length:e.prev===this.head?0:e.index,r=e.prev,this.dispatchBeforeRangeChange(i,s,n));for(var u=e,l=0,u=e;s.length>l;l++,u=u.next)u["delete"]();null==a&&u===this.head&&(u=this.head.next);for(var l=0;i.length>l;l++){var o=new this.Node(i[l]);u.addBefore(o)}return this.length+=i.length-s.length,this.dispatchesRangeChanges&&(e===this.head?this.updateIndexes(this.head.next,0):this.updateIndexes(r.next,r.index+1),this.dispatchRangeChange(i,s,n)),s},a.prototype.reverse=function(){if(this.dispatchesRangeChanges){var e=this.toArray(),t=e.reversed();this.dispatchBeforeRangeChange(t,e,0)}var i=this.head;do{var a=i.next;i.next=i.prev,i.prev=a,i=i.next}while(i!==this.head);return this.dispatchesRangeChanges&&this.dispatchRangeChange(t,e,0),this},a.prototype.sort=function(){this.swap(0,this.length,this.sorted())},a.prototype.reduce=function(e,t){for(var i=arguments[2],a=this.head,s=a.next;s!==a;)t=e.call(i,t,s.value,s,this),s=s.next;return t},a.prototype.reduceRight=function(e,t){for(var i=arguments[2],a=this.head,s=a.prev;s!==a;)t=e.call(i,t,s.value,s,this),s=s.prev;return t},a.prototype.updateIndexes=function(e,t){for(;e!==this.head;)e.index=t++,e=e.next},a.prototype.makeObservable=function(){this.head.index=-1,this.updateIndexes(this.head.next,0),this.dispatchesRangeChanges=!0},a.prototype.iterate=function(){return new s(this.head)},s.prototype.next=function(){if(this.at===this.head)throw StopIteration;var e=this.at.value;return this.at=this.at.next,e},a.prototype.Node=u,u.prototype["delete"]=function(){this.prev.next=this.next,this.next.prev=this.prev},u.prototype.addBefore=function(e){var t=this.prev;this.prev=e,e.prev=t,t.next=e,e.next=this},u.prototype.addAfter=function(e){var t=this.next;this.next=e,e.next=t,t.prev=e,e.prev=this}}}),montageDefine("e3ee536","fast-set",{dependencies:["./shim","./dict","./list","./generic-collection","./generic-set","./tree-log","./listen/property-changes","fast-set"],factory:function(e,t,i){"use strict";function a(e,t,i,s){if(!(this instanceof a))return new a(e,t,i,s);t=t||Object.equals,i=i||Object.hash,s=s||Function.noop,this.contentEquals=t,this.contentHash=i,this.getDefault=s;var u=this;this.buckets=new this.Buckets(null,function(){return new u.Bucket}),this.length=0,this.addEach(e)}e("./shim");var s=e("./dict"),u=e("./list"),n=e("./generic-collection"),r=e("./generic-set"),l=e("./tree-log"),o=e("./listen/property-changes");Object.prototype.hasOwnProperty,i.exports=a,a.FastSet=a,Object.addEach(a.prototype,n.prototype),Object.addEach(a.prototype,r.prototype),Object.addEach(a.prototype,o.prototype),a.prototype.Buckets=s,a.prototype.Bucket=u,a.prototype.constructClone=function(e){return new this.constructor(e,this.contentEquals,this.contentHash,this.getDefault)},a.prototype.has=function(e){var t=this.contentHash(e);return this.buckets.get(t).has(e)},a.prototype.get=function(e,t){if(t)throw Error("FastSet#get does not support second argument: equals");var i=this.contentHash(e),a=this.buckets;return a.has(i)?a.get(i).get(e):this.getDefault(e)},a.prototype["delete"]=function(e,t){if(t)throw Error("FastSet#delete does not support second argument: equals");var i=this.contentHash(e),a=this.buckets;if(a.has(i)){var s=a.get(i);if(s["delete"](e))return this.length--,0===s.length&&a["delete"](i),!0}return!1},a.prototype.clear=function(){this.buckets.clear(),this.length=0},a.prototype.add=function(e){var t=this.contentHash(e),i=this.buckets;return i.has(t)||i.set(t,new this.Bucket(null,this.contentEquals)),i.get(t).has(e)?!1:(i.get(t).add(e),this.length++,!0)},a.prototype.reduce=function(e,t){var i=arguments[2],a=this.buckets,s=0;return a.reduce(function(t,a){return a.reduce(function(t,a){return e.call(i,t,a,s++,this)},t,this)},t,this)},a.prototype.one=function(){return this.length>0?this.buckets.one().one():void 0},a.prototype.iterate=function(){return this.buckets.values().flatten().iterate()},a.prototype.log=function(e,t,i,a){e=e||l.unicodeSharp,t=t||this.logNode,i||(i=console.log,a=console),i=i.bind(a);var s=this.buckets,u=s.keys();u.forEach(function(n,r){var l,o;r===u.length-1?(l=e.fromAbove,o=" "):0===r?(l=e.branchDown,o=e.strafe):(l=e.fromBoth,o=e.strafe);var c=s.get(n);i.call(a,l+e.through+e.branchDown+" "+n),c.forEach(function(s,u){var n,r;u===c.head.prev?(n=e.fromAbove,r=" "):(n=e.fromBoth,r=e.strafe);var l;t(u,function(t){l?i.call(a,o+" "+r+"  "+t):(i.call(a,o+" "+n+e.through+e.through+t),l=!0)},function(t){i.call(a,o+" "+e.strafe+"  "+t)})})})},a.prototype.logNode=function(e,t){var i=e.value;Object(i)===i?JSON.stringify(i,null,4).split("\n").forEach(function(e){t(" "+e)}):t(" "+i)}}}),montageDefine("e3ee536","generic-set",{dependencies:[],factory:function(e,t,i){function a(){throw Error("Can't construct. GenericSet is a mixin.")}i.exports=a,a.prototype.isSet=!0,a.prototype.union=function(e){var t=this.constructClone(this);return t.addEach(e),t},a.prototype.intersection=function(e){return this.constructClone(this.filter(function(t){return e.has(t)}))},a.prototype.difference=function(e){var t=this.constructClone(this);return t.deleteEach(e),t},a.prototype.symmetricDifference=function(e){var t=this.union(e),i=this.intersection(e);return t.difference(i)},a.prototype.deleteAll=function(e){return+this["delete"](e)
},a.prototype.equals=function(e,t){var i=this;return e&&"function"==typeof e.reduce&&this.length===e.length&&e.reduce(function(e,a){return e&&i.has(a,t)},!0)},a.prototype.toJSON=function(){return this.toArray()},a.prototype.contains=function(e){return this.has(e)},a.prototype.remove=function(e){return this["delete"](e)},a.prototype.toggle=function(e){this.has(e)?this["delete"](e):this.add(e)}}}),montageDefine("e3ee536","listen/range-changes",{dependencies:["weak-map","../dict"],factory:function(e,t,i){"use strict";function a(){throw Error("Can't construct. RangeChanges is a mixin.")}var s=e("weak-map"),u=e("../dict"),n=new s;i.exports=a,a.prototype.getAllRangeChangeDescriptors=function(){return n.has(this)||n.set(this,u()),n.get(this)},a.prototype.getRangeChangeDescriptor=function(e){var t=this.getAllRangeChangeDescriptors();return e=e||"",t.has(e)||t.set(e,{isActive:!1,changeListeners:[],willChangeListeners:[]}),t.get(e)},a.prototype.addRangeChangeListener=function(e,t,i){!this.isObservable&&this.makeObservable&&this.makeObservable();var a,s=this.getRangeChangeDescriptor(t);a=i?s.willChangeListeners:s.changeListeners,a.push(e),Object.defineProperty(this,"dispatchesRangeChanges",{value:!0,writable:!0,configurable:!0,enumerable:!1});var u=this;return function(){u&&(u.removeRangeChangeListener(e,t,i),u=null)}},a.prototype.removeRangeChangeListener=function(e,t,i){var a,s=this.getRangeChangeDescriptor(t);a=i?s.willChangeListeners:s.changeListeners;var u=a.lastIndexOf(e);if(-1===u)throw Error("Can't remove range change listener: does not exist: token "+JSON.stringify(t));a.splice(u,1)},a.prototype.dispatchRangeChange=function(e,t,i,a){var s=this.getAllRangeChangeDescriptors(),u="Range"+(a?"WillChange":"Change");s.forEach(function(s,n){if(!s.isActive){s.isActive=!0;var r;r=a?s.willChangeListeners:s.changeListeners;var l="handle"+(n.slice(0,1).toUpperCase()+n.slice(1))+u;try{r.slice().forEach(function(s){if(!(0>r.indexOf(s)))if(s[l])s[l](e,t,i,this,a);else{if(!s.call)throw Error("Handler "+s+" has no method "+l+" and is not callable");s.call(this,e,t,i,this,a)}},this)}finally{s.isActive=!1}}},this)},a.prototype.addBeforeRangeChangeListener=function(e,t){return this.addRangeChangeListener(e,t,!0)},a.prototype.removeBeforeRangeChangeListener=function(e,t){return this.removeRangeChangeListener(e,t,!0)},a.prototype.dispatchBeforeRangeChange=function(e,t,i){return this.dispatchRangeChange(e,t,i,!0)}}}),montageDefine("e3ee536","listen/map-changes",{dependencies:["weak-map","../list","../dict"],factory:function(e,t,i){"use strict";function a(){throw Error("Can't construct. MapChanges is a mixin.")}var s=e("weak-map"),u=e("../list");i.exports=a,Object.prototype.hasOwnProperty;var n=new s,r=null;a.prototype.getAllMapChangeDescriptors=function(){return n.has(this)||(r||(r=e("../dict")),n.set(this,r())),n.get(this)},a.prototype.getMapChangeDescriptor=function(e){var t=this.getAllMapChangeDescriptors();return e=e||"",t.has(e)||t.set(e,{willChangeListeners:new u,changeListeners:new u}),t.get(e)},a.prototype.addMapChangeListener=function(e,t,i){!this.isObservable&&this.makeObservable&&this.makeObservable();var a,s=this.getMapChangeDescriptor(t);a=i?s.willChangeListeners:s.changeListeners,a.push(e),Object.defineProperty(this,"dispatchesMapChanges",{value:!0,writable:!0,configurable:!0,enumerable:!1});var u=this;return function(){u&&(u.removeMapChangeListener(e,t,i),u=null)}},a.prototype.removeMapChangeListener=function(e,t,i){var a,s=this.getMapChangeDescriptor(t);a=i?s.willChangeListeners:s.changeListeners;var u=a.findLast(e);if(!u)throw Error("Can't remove map change listener: does not exist: token "+JSON.stringify(t));u["delete"]()},a.prototype.dispatchMapChange=function(e,t,i){var a=this.getAllMapChangeDescriptors(),s="Map"+(i?"WillChange":"Change");a.forEach(function(a,u){if(!a.isActive){a.isActive=!0;var n;n=i?a.willChangeListeners:a.changeListeners;var r="handle"+(u.slice(0,1).toUpperCase()+u.slice(1))+s;try{n.forEach(function(i){if(i[r])i[r](t,e,this);else{if(!i.call)throw Error("Handler "+i+" has no method "+r+" and is not callable");i.call(i,t,e,this)}},this)}finally{a.isActive=!1}}},this)},a.prototype.addBeforeMapChangeListener=function(e,t){return this.addMapChangeListener(e,t,!0)},a.prototype.removeBeforeMapChangeListener=function(e,t){return this.removeMapChangeListener(e,t,!0)},a.prototype.dispatchBeforeMapChange=function(e,t){return this.dispatchMapChange(e,t,!0)}}}),montageDefine("e3ee536","dict",{dependencies:["./shim","./generic-collection","./generic-map","./listen/property-changes","dict"],factory:function(e,t,i){"use strict";function a(e,t){return this instanceof a?(t=t||Function.noop,this.getDefault=t,this.store=Object.create(null),this.length=0,this.addEach(e),void 0):new a(e,t)}e("./shim");var s=e("./generic-collection"),u=e("./generic-map"),n=e("./listen/property-changes");i.exports=a,a.Dict=a,Object.addEach(a.prototype,s.prototype),Object.addEach(a.prototype,u.prototype),Object.addEach(a.prototype,n.prototype),a.prototype.constructClone=function(e){return new this.constructor(e,this.getDefault)},a.prototype.assertString=function(e){if("string"!=typeof e)throw new TypeError("key must be a string but Got "+e)},Object.defineProperty(a.prototype,"$__proto__",{writable:!0}),Object.defineProperty(a.prototype,"_hasProto",{get:function(){return this.hasOwnProperty("$__proto__")&&void 0!==this._protoValue}}),Object.defineProperty(a.prototype,"_protoValue",{get:function(){return this.$__proto__},set:function(e){this.$__proto__=e}}),a.prototype.get=function(e,t){return this.assertString(e),"__proto__"===e?this._hasProto?this._protoValue:arguments.length>1?t:this.getDefault(e):e in this.store?this.store[e]:arguments.length>1?t:this.getDefault(e)},a.prototype.set=function(e,t){this.assertString(e);var i="__proto__"===e;return(i?this._hasProto:e in this.store)?(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(e,i?this._protoValue:this.store[e]),i?this._protoValue=t:this.store[e]=t,this.dispatchesMapChanges&&this.dispatchMapChange(e,t),!1):(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(e,void 0),this.length++,i?this._protoValue=t:this.store[e]=t,this.dispatchesMapChanges&&this.dispatchMapChange(e,t),!0)},a.prototype.has=function(e){return this.assertString(e),"__proto__"===e?this._hasProto:e in this.store},a.prototype["delete"]=function(e){return this.assertString(e),"__proto__"===e?this._hasProto?(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(e,this._protoValue),this._protoValue=void 0,this.length--,this.dispatchesMapChanges&&this.dispatchMapChange(e,void 0),!0):!1:e in this.store?(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(e,this.store[e]),delete this.store[e],this.length--,this.dispatchesMapChanges&&this.dispatchMapChange(e,void 0),!0):!1},a.prototype.clear=function(){var e;this._hasProto&&(this.dispatchesMapChanges&&this.dispatchBeforeMapChange("__proto__",this._protoValue),this._protoValue=void 0,this.dispatchesMapChanges&&this.dispatchMapChange("__proto__",void 0));for(e in this.store)this.dispatchesMapChanges&&this.dispatchBeforeMapChange(e,this.store[e]),delete this.store[e],this.dispatchesMapChanges&&this.dispatchMapChange(e,void 0);this.length=0},a.prototype.reduce=function(e,t,i){this._hasProto&&(t=e.call(i,t,"$__proto__","__proto__",this));var a=this.store;for(var s in this.store)t=e.call(i,t,a[s],s,this);return t},a.prototype.reduceRight=function(e,t,i){var a=this,s=this.store;return t=Object.keys(this.store).reduceRight(function(t,u){return e.call(i,t,s[u],u,a)},t),this._hasProto?e.call(i,t,this._protoValue,"__proto__",a):t},a.prototype.one=function(){var e;for(e in this.store)return this.store[e];return this._protoValue},a.prototype.toJSON=function(){return this.toObject()}}}),montageDefine("e3ee536","tree-log",{dependencies:[],factory:function(e,t,i){"use strict";function a(){}i.exports=a,a.ascii={intersection:"+",through:"-",branchUp:"+",branchDown:"+",fromBelow:".",fromAbove:"'",fromBoth:"+",strafe:"|"},a.unicodeRound={intersection:"╋",through:"━",branchUp:"┻",branchDown:"┳",fromBelow:"╭",fromAbove:"╰",fromBoth:"┣",strafe:"┃"},a.unicodeSharp={intersection:"╋",through:"━",branchUp:"┻",branchDown:"┳",fromBelow:"┏",fromAbove:"┗",fromBoth:"┣",strafe:"┃"}}}),montageDefine("cab98f5","parse",{dependencies:["collections/shim","./grammar"],factory:function(e,t,i){function a(e,t){if(Array.isArray(e))return{type:"tuple",args:e.map(function(e){return a(e,t)})};if(!t&&Object.prototype.hasOwnProperty.call(u,e))return u[e];try{var i=s.parse(e,t||Object.empty);return t||(u[e]=i),i}catch(n){throw n.message=n.message.replace(/[\s\.]+$/,"")+" "+" on line "+n.line+" column "+n.column,n}}e("collections/shim");var s=e("./grammar"),u={};i.exports=a}}),montageDefine("cab98f5","evaluate",{dependencies:["./parse","./compile-evaluator","./scope"],factory:function(e,t,i){function a(e,t,i,a,r){var l;l="string"==typeof e?s(e):e;var o=u(l),c=new n(t);return c.parameters=i,c.document=a,c.components=r,o(c)}var s=e("./parse"),u=e("./compile-evaluator"),n=e("./scope");i.exports=a}}),montageDefine("cab98f5","assign",{dependencies:["./parse","./compile-assigner","./scope"],factory:function(e,t,i){function a(e,t,i,a,r,l){var o;o="string"==typeof t?s(t):t;var c=u(o),m=new n(e);return m.parameters=a,m.document=r,m.components=l,c(i,m)}var s=e("./parse"),u=e("./compile-assigner"),n=e("./scope");i.exports=a}}),montageDefine("cab98f5","bind",{dependencies:["./parse","./algebra","./stringify","./compile-observer","./compile-binder","./compile-assigner","./observers","./binders","./scope"],factory:function(e,t,i){function a(e,t,i){i.target=e,i.targetPath=t;var a=i.source=i.source||e,o=i["<-"]||i["<->"]||"",c=i.twoWay="<->"in i;i.sourcePath=o,i.value;var m=i.parameters=i.parameters||a,d=i.document,p=i.components,h=i.trace,g=i.sourceScope=new v(a);g.parameters=m,g.document=d,g.components=p;var f=i.targetScope=new v(e);if(f.parameters=m,f.document=d,f.components=p,i.converter){var b=i.converter;b.convert&&(i.convert=b.convert.bind(b)),b.revert&&(i.revert=b.revert.bind(b))}else if(i.reverter){var q=i.reverter;q.convert&&(i.revert=q.convert.bind(q)),q.revert&&(i.convert=q.revert.bind(q))}var _=i.convert,y=i.revert,S=i.sourceSyntax=n(o),P=i.targetSyntax=n(t),C=r(P,S);if(P=C[0],S=C[1],c&&"rangeContent"===P.type)return u(f,P.args[0],g,S,_,y,i,h?{sourcePath:l(S),targetPath:l(P.args[0])}:null);h&&console.log("DEFINE BINDING",t,"<-",o,e);var D=s(f,P,g,S,_,i,h),C=r(S,P);S=C[0],P=C[1];var N=Function.noop;return c&&(h&&console.log("DEFINE BINDING",t,"->",o,a),N=s(g,S,f,P,y,i,h)),function(){D(),N()}}function s(e,t,i,a,s,u,n){var r=o(a);s&&(r=d.makeConverterObserver(r,s,i));var m=c(t);return m(r,i,e,u,n?{sourcePath:l(a),targetPath:l(t)}:null)}function u(e,t,i,a,s,u,n,r){function l(e,t,i){g||(g=!0,r&&console.log("RANGE CONTENT PROPAGATED",r.targetPath,"<-",r.sourcePath,"PLUS",e,"MINUS",t,"AT",i),v.swap(i,t.length,e),g=!1)}function c(e,t,i){g||(g=!0,r&&console.log("RANGE CONTENT PROPAGATED",r.targetPath,"->",r.sourcePath,"PLUS",e,"MINUS",t,"AT",i),h.swap(i,t.length,e),g=!1)}function d(){if(h!==v){r&&console.log("RANGE CONTENT BOUND",r.targetPath,"<->",r.sourcePath),g=!0;var t=p(h,l,i),a=p(v,c,e);return g=!1,function(){r&&console.log("RANGE CONTENT UNBOUND",r.targetPath,"<->",r.sourcePath),t(),a()}}}var v,h,g,f=o(a),b=o(t),q=m(a),_=m(t),y=Function.noop;g=!0;var S=b(function(e){y(),y=Function.noop,r&&console.log("RANGE CONTENT TARGET",r.targetPath,"SET TO",e),e&&e.addRangeChangeListener&&(v=e,h&&v?(r&&console.log("RANGE CONTENT TARGET REPLACES SOURCE",r.targetPath,"->",r.sourcePath,"WITH",v),g=!0,h.swap(0,h.length,v),g=!1,y=d()):h||g||(r&&console.log("RANGE CONTENT TARGET INITIALIZED TO COPY OF SOURCE",r.targetPath,"<-",tarce.sourcePath,"WITH",h),q(v.clone(),i)))},e);g=!1;var P=f(function(t){y(),y=Function.noop,r&&console.log("RANGE CONTENT SOURCE",r.sourcePath,"SET TO",t),t&&t.addRangeChangeListener&&(h=t,v&&h?(r&&console.log("RANGE CONTENT SOURCE REPLACES TARGET",r.targetPath,"<-",r.sourcePath,"WITH",h),g=!0,v.swap(0,v.length,h),g=!1,y=d()):v||_(h.clone(),e))},i);return v||h||q([],i),function(){y(),S(),P()}}var n=e("./parse"),r=e("./algebra"),l=e("./stringify"),o=e("./compile-observer"),c=e("./compile-binder"),m=e("./compile-assigner"),d=e("./observers"),p=d.observeRangeChange;e("./binders");var v=e("./scope");i.exports=a}}),montageDefine("cab98f5","compile-observer",{dependencies:["./observers","./operators"],factory:function(e,t,i){function a(e){return n.compile(e)}var s=e("./observers"),u=e("./operators");i.exports=a;var n=a.semantics={compilers:{property:s.makePropertyObserver,get:s.makeGetObserver,path:s.makePathObserver,"with":s.makeWithObserver,"if":s.makeConditionalObserver,parent:s.makeParentObserver,not:s.makeNotObserver,and:s.makeAndObserver,or:s.makeOrObserver,"default":s.makeDefaultObserver,defined:s.makeDefinedObserver,rangeContent:Function.identity,mapContent:Function.identity,keys:s.makeKeysObserver,values:s.makeValuesObserver,items:s.makeEntriesObserver,entries:s.makeEntriesObserver,toMap:s.makeToMapObserver,mapBlock:s.makeMapBlockObserver,filterBlock:s.makeFilterBlockObserver,everyBlock:s.makeEveryBlockObserver,someBlock:s.makeSomeBlockObserver,sortedBlock:s.makeSortedBlockObserver,sortedSetBlock:s.makeSortedSetBlockObserver,groupBlock:s.makeGroupBlockObserver,groupMapBlock:s.makeGroupMapBlockObserver,minBlock:s.makeMinBlockObserver,maxBlock:s.makeMaxBlockObserver,min:s.makeMinObserver,max:s.makeMaxObserver,enumerate:s.makeEnumerationObserver,reversed:s.makeReversedObserver,flatten:s.makeFlattenObserver,concat:s.makeConcatObserver,view:s.makeViewObserver,sum:s.makeSumObserver,average:s.makeAverageObserver,last:s.makeLastObserver,only:s.makeOnlyObserver,one:s.makeOneObserver,has:s.makeHasObserver,tuple:s.makeArrayObserver,range:s.makeRangeObserver,startsWith:s.makeStartsWithObserver,endsWith:s.makeEndsWithObserver,contains:s.makeContainsObserver,join:s.makeJoinObserver,toArray:s.makeToArrayObserver,asArray:s.makeToArrayObserver},compile:function(e){var t=this.compilers;if("literal"===e.type)return s.makeLiteralObserver(e.value);if("value"===e.type)return s.observeValue;if("parameters"===e.type)return s.observeParameters;if("element"===e.type)return s.makeElementObserver(e.id);if("component"===e.type)return s.makeComponentObserver(e.label,e);if("record"===e.type){var i={},a=e.args;for(var u in a)i[u]=this.compile(a[u]);return s.makeObjectObserver(i)}t.hasOwnProperty(e.type)||(t[e.type]=s.makeMethodObserverMaker(e.type));var n=e.args.map(this.compile,this);return t[e.type].apply(null,n)}},r=n.compilers;Object.keys(u).forEach(function(e){r[e]||(r[e]=s.makeOperatorObserverMaker(u[e]))}),r.toString=s.makeOperatorObserverMaker(u.toString)}}),montageDefine("cab98f5","scope",{dependencies:[],factory:function(e,t,i){function a(e){this.parent=null,this.value=e}i.exports=a,a.prototype.nest=function(e){var t=Object.create(this);return t.value=e,t.parent=this,t}}}),montageDefine("cab98f5","observers",{dependencies:["collections/shim","collections/listen/property-changes","collections/listen/array-changes","collections/sorted-array","collections/sorted-set","collections/map","collections/set","collections/heap","./scope","./operators","./parse","./compile-observer","./merge"],factory:function(e,t){function i(e){return function(t){return t(e)}}function a(e,t){return e(t.value)}function s(e,t){return e(t.parameters)}function u(e){return function(t,i){return t(i.document.getElementById(e))}}function n(e){return function(t,i){var a=i.components,s=a.getObjectByLabel||a.getComponentByLabel,u=s.call(a,e);return t(u)}}function r(e,t,i,a){function s(e,t,a){u&&u(),u=i(e,t,a)}if(null==e)return i();var u;return Ct.addOwnPropertyChangeListener(e,t,s,a.beforeChange),s(e[t],t,e),function(){u&&u(),Ct.removeOwnPropertyChangeListener(e,t,s,a.beforeChange)}}function l(e,t){return function(i,a){return t(function(t){return"string"!=typeof t&&"number"!=typeof t?i():e(function(e){return null==e?i():e.observeProperty?e.observeProperty(t,i,a):At(e,t,i,a)},a)},a)}}function o(e,t,i,a){function s(e,a,s){n(t,a)&&(u&&u(),u=i(e,t,s))}var u,n=e.contentEquals||Object.equals;return s(e.get(t),t,e),e.addMapChangeListener(s,a.beforeChange),function(){u&&u(),e.removeMapChangeListener(s)}}function c(e,t){return function(i,a){return e(function(e){return e?t(function(t){return null==t?i():e.observeGet?e.observeGet(t,i,a):xt(e,t,i,a)},a):i()},a)}}function m(e,t){return function(i,a){return i=_t(i),t(function(t){return e(function(e){return e?e.addRangeChangeListener?J(e,function(){return i((e.has||e.contains).call(e,t))},a):e.addMapChangeListener?nt(e,function(){return i(e.has(t))},a):i():i()},a)},a)}}function d(e){return function(t,i){for(var a=[],s=[],u=0;e.length>u;u++)a[u]=void 0,s[u]=function(e,t){return e(function(e){a.set(t,e)},i)}(e[u],u);var n=t(a);return function(){n&&n();for(var e=0;s.length>e;e++)n=s[e],n&&n()}}}function p(e){return function(t,i){var a={},s={};for(var u in e)(function(e,t){s[e]=void 0,a[e]=t(function(t){s[e]=t},i)})(u,e[u]);var n=t(s);return function(){n&&n();for(var e in a)n=a[e],n&&n()}}}function v(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return d(e)}function h(e){return function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];var a=d(t),s=st(a);return function(t,i){return s(function(i){return i.every(wt.defined)?t(e.apply(void 0,i)):t()},i)}}}function g(e){var t=e.slice(0,1).toUpperCase()+e.slice(1),i="make"+t+"Observer",a="observe"+t;return function(){var t=arguments[0],s=Array.prototype.slice.call(arguments,1),u=d(s),n=st(u);return function(u,r){return t(function(t){return t?t[i]?t[i].apply(t,s)(u,r):t[a]?t[a](u,r):n(function(i){return i.every(wt.defined)?"function"==typeof t[e]?u(t[e].apply(t,i)):u():u()},r):u()},r)}}}function f(e){return function(t,i){return e(function(e){return t(!e)},i)}}function b(e,t){return function(i,a){return e(function(e){return e?t(i,a):i(e)},a)}}function q(e,t){return function(i,a){return e(function(e){return e?i(e):t(i,a)},a)}}function _(e,t,i){return function(a,s){return e(function(e){return null==e?a():e?t(a,s):i(a,s)},s)}}function y(e){return function(t,i){return e(function(e){return t(null!=e)},i)}}function S(e,t){return function(i,a){return e(function(e){return null==e?t(i,a):i(e)},a)}}function P(e,t){return function(i,a){return e(function(e){function s(t){for(;e.length>t;t++)r[t].index=t}function u(e,i,u){Pt(r,u,i.length,e.map(function(e,t){return{index:u+t}})),s(u+e.length);var o,c,m=[],d=u,p=u+i.length;for(d=u,p=u+i.length;p>d;d++)c=l[d],c&&c();Pt(l,u,i.length,e.map(function(e,i){var s=r[u+i];return t(function(e){o?n.set(s.index,e):m[i]=e},a.nest(e))})),o=!0,n.swap(u,i.length,m)}if(!e)return i();var n=[],r=[],l=[],o=J(e,u,a),c=i(n,e);return function(){c&&c();for(var e=0,t=l.length;t>e;e++)c=l[e],c&&c();o()}},a)}}function C(e,t){var i=P(e,t);return function(e,t){return i(function(i,a){function s(e){for(;i.length>e;e++)l[e+1]=l[e]+!!i[e]}function u(e,t,i){var u=a.slice(i,i+e.length),r=t.map(Boolean).sum(),o=u.filter(function(t,i){return e[i]}),c=l[i],m=n.slice(c,c+r);(m.length!==o.length||m.some(function(e,t){return e!==o[t]}))&&n.swap(c,r,o),s(c)}if(!a)return e();var n=[],r=[],l=[0],o=J(i,u,t),c=e(n);return function(){c&&c();for(var e=0,t=r.length;t>e;e++)c=r[e],c&&c();o()}},t)}}function D(e,t){var i=M(t),a=P(e,i),s=function(e,t){return a(function(i){function a(e,t){u.deleteEach(t),u.addEach(e)}if(!i)return e();var s=[],u=Dt(s,N,E),n=J(i,a,t),r=e(s);return function(){r&&r(),n()}},t)};return It(s,ct)}function N(e,t){return Object.equals(e[1],t[1])}function E(e,t){return Object.compare(e[1],t[1])}function M(e){return function(t,i){return e(function(e){return t([i.value,e])},i)}}function w(e,t){var i=M(t),a=P(e,i),s=j(a,dt),u=P(s,$(dt));return function(e,t){function i(e,t){return e=r.get(e),t=r.get(t),Object.compare(e,t)}function a(e,t){return e=r.get(e),t=r.get(t),Object.equals(e,t)}function s(e,t){t.forEach(function(e){l["delete"](e[0]),r["delete"](e[0])}),e.forEach(function(e){r.set(e[0],e[1]),l.add(e[0])})}function n(e){return l.clear(),J(e,s,t)}var r=new Et,l=new Nt(null,a,i),o=e(l),c=u(n,t);return function(){o&&o(),c()}}}function A(e){return function(t,i){return e(function(e){function a(e,t,i){var a=s.length-i-t.length;s.swap(a,t.length,e.reversed())}if(!e)return t();var s=[],u=J(e,a,i),n=t(s);return function(){n&&n(),u()}},i)}}function x(e){return function(t,i){return e(function(e){function a(t){for(var i=t;e.length>i;i++)l[i].index=i,r[i+1]=e[i]?r[i]+e[i].length:r[i]}function s(e,t,s){var o=r[s],c=r[s+t.length],m=c-o;u.swap(o,m,[]),Pt(l,s,t.length,e.map(function(){return{index:null}})),a(s);for(var d,p=s,c=s+t.length;c>p;p++)d=n[p],d&&d();Pt(n,s,t.length,e.map(function(e,t){function n(e,t,i){a(o.index);var s=r[o.index]+i,n=r[o.index]+i+t.length,l=n-s;u.swap(s,l,e)}var o=l[s+t];return J(e,n,i)}))}if(!e)return t();var u=[],n=[],r=[0],l=[],o=J(e,s,i),c=t(u);return function(){c&&c();for(var e=0,t=n.length;t>e;e++)c=n[e],c&&c();o()}},i)}}function I(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return Lt(d(e))}function T(e,t){var i=Tt(e,t),a=l(i,jt);return ht(a,Boolean)}function L(e,t){var i=ht(t,wt.not),a=Tt(e,i),s=l(a,jt);return ht(s,wt.not)}function j(e,t){var i=O(e,t);return Rt(i)}function O(e,t){var i=M(t),a=P(e,i);return function(e,t){return a(function(i,a){function s(e,t){t.forEach(function(e){var t=u.get(e[1]);1===t.length?u["delete"](e[1]):t["delete"](e[0])}),e.forEach(function(e){var t,i=!u.has(e[1]);t=i?a.constructClone():u.get(e[1]),t.add(e[0]),i&&u.set(e[1],t)})}if(!i)return e();var u=Et(),n=J(i,s,t),r=e(u);return function(){n(),r&&r()}},t)}}function V(e,t,i){function a(e,t){return Object.compare(e[1],t[1])*i}var s=M(t),u=P(e,s);return function(e,t){return u(function(i){function s(e,t){n.addEach(e),n.deleteEach(t)}function u(t,i){return 0===i?t?e(t[0]):e():void 0}if(!i)return e();var n=new Mt(null,N,a),r=J(i,s,t),l=nt(n,u,t);return function(){r(),l()}},t)}}function F(e,t){return V(e,t,1)}function R(e,t){return V(e,t,-1)}function k(e){return V(e,a,1)}function z(e){return V(e,a,-1)}function U(e){return function(t){return function(i,a){return i=_t(i),t(function(t){if(!t)return i();var s=e(t,i);return J(t,function(e,t,a){return i(s(e,t,a))},a)},a)}}}function B(e){return"number"==typeof e&&!isNaN(e)}function Q(e,t,i){return i||(i=t,t=Ot),function(a,s){return e(function(e){function u(t,i,a){if(m){var s=t.length-i.length;r>=a?s>0?(c.swap(0,0,e.slice(r,r+s)),c.splice(n,c.length-n)):(c.splice(0,-s),c.swap(c.length,0,e.slice(r+c.length,r+n))):r+n>a&&(c.swap(a-r,i.length,t),s>0?c.splice(n,c.length-n):c.swap(c.length,0,e.slice(r+c.length,r+n)))}}if(!e)return a();var n,r,l,o,c=[],m=!1,d=J(e,u,s),p=i(function(t){t=+t,isNaN(t)&&(t=void 0);var i="number"==typeof t&&"number"==typeof r,a=Math.max(0,t);"number"==typeof o&&(a=Math.min(a,e.length-o)),m!==i?(i?c.swap(0,0,e.slice(o,o+a)):c.clear(),m=i):m&&l!==a&&(l>a?c.splice(t,l-a):c.swap(l,0,e.slice(o+l,o+a))),n=t,l=a},s),v=t(function(t){t=+t,isNaN(t)&&(t=void 0);var i="number"==typeof n&&"number"==typeof t,a=Math.max(0,t);"number"==typeof n&&(a=Math.min(a,e.length));var s=Math.max(0,n);if("number"==typeof a&&(s=Math.min(s,e.length-a)),m!==i)i?c.swap(0,c.length,e.slice(a,a+s)):c.clear(),m=i;else if(m&&o!==a){var u=Math.abs(a-o);l>u&&o>a?(c.swap(0,0,e.slice(a,o)),c.splice(s,c.length-s)):l>u&&a>o?(c.swap(c.length,0,e.slice(o+l,a+s)),c.splice(0,c.length-s)):c.swap(0,c.length,e.slice(a,a+s))}r=t,o=a,l=s},s),h=a(c);return function(){h&&h(),p(),v(),d()}},s)}}function G(e){return function(t,i){return e(function(e){function a(e){for(;u.length>e;e++)u[e].set(0,e)}function s(e,t,i){u.swap(i,t.length,e.map(function(e,t){return[i+t,e]})),a(i+e.length)}if(!e)return t();var u=[],n=J(e,s,i),r=t(u);return function(){r&&r(),n()}},i)}}function W(e){return function(t,i){var a=[],s=t(a),u=e(function(e){if(e>>>=0,null==e)a.clear();else if(e>a.length){for(var t=[],i=a.length;e>i;i++)t.push(i);a.swap(a.length,0,t)}else a.length>e&&a.splice(e,a.length)},i);return function(){s&&s(),u&&u()}}}function H(e,t){return function(i,a){return t(function(t){if("string"!=typeof t)return i();var s=RegExp("^"+RegExp.escape(t));return e(function(e){return"string"!=typeof e?i():i(s.test(e))},a)},a)}}function X(e,t){return function(i,a){return t(function(t){if("string"!=typeof t)return i();var s=RegExp(RegExp.escape(t)+"$");return e(function(e){return"string"!=typeof e?i():i(s.test(e))},a)},a)}}function Y(e,t){return function(i,a){return t(function(t){if("string"!=typeof t)return i();var s=RegExp(RegExp.escape(t));return e(function(e){return"string"!=typeof e?i():i(s.test(e))},a)},a)}}function K(e,t){return t=t||Vt,function(i,a){return e(function(e){return e?t(function(t){function s(){u&&u(),u=i(e.join(t))}if("string"!=typeof t)return i();var u,n=J(e,s,a);return function(){n(),u&&u()}},a):i()},a)}}function J(e,t,i){function a(e,i,a){s&&s(),s=t(e,i,a)}if(!e)return Function.noop;var s;if(!e.toArray)return Function.noop;if(!e.addRangeChangeListener)return Function.noop;a(e.toArray(),[],0);var u=e.addRangeChangeListener(a,null,i.beforeChange);return function(){s&&s(),u()}}function $(e){return function(t,i){return e(function(e){return Ft(e,t,i)},i)}}function Z(e,t,i){function a(i,a,r){if(u+=i.length-a.length,!(u>r+a.length&&u>r+i.length)){var l=0>u?null:e.get(u);s&&s(),s=t(l),n=l}}var s,u=-1,n=null,r=J(e,a,i);return function(){s&&s(),r&&r()}}function et(e){return function(t,i){return e(_t(function(e){return tt(e,t,i)}),i)}}function tt(e,t,i){function a(i,a){return s+=i.length-a.length,1!==s?t():t(e.only())}var s=0;return J(e,a,i)}function it(e){return function(t,i){return e(_t(function(e){return at(e,t,i)}),i)}}function at(e,t,i){function a(i,a){return s+=i.length-a.length,0===s?t():t(e.one())}var s=0;return J(e,a,i)}function st(e){return function(t,i){return e(function(e){return e&&e.addRangeChangeListener?J(e,function(){return t(e)},i):t(e)},i)}}function ut(e){return function(t,i){return e(function(e){return e&&e.addMapChangeListener?nt(e,function(){return t(e)},i):t(e)},i)}}function nt(e,t,i){function a(e,i,a){var u=s.get(i);s["delete"](i),u&&u(),u=t(e,i,a),void 0===e?u&&u():s.set(i,u)}if(e.addMapChangeListener){var s=new Et;e.forEach(a);var u=e.addMapChangeListener(a,i.beforeChange);return function(){s.forEach(function(e){e&&e()}),u()}}}function rt(e){return function(t,i){return e(function(e){return e?lt(e,t,i):t()},i)}}function lt(e,t,i){function a(e,t){var i,a;u.has(t)?null==e?(i=u.get(t),u["delete"](t),a=s.indexOf(i),s.splice(a,1)):(i=u.get(t),i.set(1,e)):(i=[t,e],u.set(t,i),s.push(i))}var s=[],u=Et(),n=t(s),r=nt(e,a,i);return function(){n&&n(),r&&r()}}function ot(e){var t=Rt(e);return It(t,ct)}function ct(e,t){return t.value?e(t.value[0]):e()}function mt(e){var t=Rt(e);return It(t,dt)}function dt(e,t){return t.value?e(t.value[1]):e()}function pt(e){return function(t,i){var a=new Et,s=t(a),u=e(function(e){if(a.clear(),e&&"object"==typeof e){if(e.addRangeChangeListener)return kt(function(e){function t(e,t){t.forEach(function(e){a["delete"](e[0])}),e.forEach(function(e){a.set(e[0],e[1])})}return J(e,t,i)},i.nest(e));if(e.addMapChangeListener)return nt(e,function(e,t){void 0===e?a["delete"](t):a.set(t,e)},i);var t=[],s=0;for(var u in e)t[s++]=At(e,u,function(e){void 0===e?a["delete"](u):a.set(u,e)},i);return function(){for(var e=0,i=t.length;i>e;e++)t[e]()}}},i)||Function.noop;return function(){s&&s(),u()}}}function vt(e){return function(t,i){return i.parent?e(t,i.parent):t()}}function ht(e,t,i){return function(a,s){return a=_t(a),e(function(e){return a(t.call(i,e))},s)}}function gt(e,t,i){return function(a,s){return a=_t(a),e(function(e){return e&&e.every(wt.defined)?a(t.apply(i,e)):void 0},s)}}function ft(t,i){var a=e("./parse"),s=e("./compile-observer");return function(e,u){return e=_t(e),i(function(i){if(null==i)return e();var n,r;try{n=a(i),r=s(n)}catch(l){return e()}return t(function(t){return r(e,u.nest(t))},u)},u)}}function bt(e,t){return function(i,a){return e(function(e){return null==e?i():t(function(e){return null==e?i():i(e)},a.nest(e))},a)}}function qt(e){return function(){var t=e.apply(this,arguments);return function(e,i){var a=[],s=t(function(e){function t(e,t,i){a.swap(i,t.length,e)}return e&&e.addRangeChangeListener?(zt(a,e),e.addRangeChangeListener(t,null,i.beforeChange),function(){e.removeRangeChangeListener(t,null,i.beforeChange)}):(a.clear(),void 0)},i),u=e(a);return function(){s&&s(),u&&u()}}}}function _t(e){var t;return function(i){if(i!==t){var a=e.apply(this,arguments);return t=i,a}}}function yt(e){e.forEach(function(e){e&&e()})}function St(e){var t;return function(){return t&&t(),t=e.apply(this,arguments),function(){t&&t(),t=void 0}}}function Pt(e,t,i,a){0>t?t=e.length+t:t>e.length&&(e.length=t),t+i>e.length?i=e.length-t:0>i&&(i=0);var s=a.length-i,u=e.length,n=e.length+s;if(s>0)for(var r=u-1;r>=t+i;r--){var l=r+s;r in e?e[l]=e[r]:(e[l]=void 0,delete e[l])}for(var r=0;a.length>r;r++)r in a?e[t+r]=a[r]:(e[t+r]=void 0,delete e[t+r]);if(0>s)for(var r=t+a.length;u-s>r;r++){var l=r-s;l in e?e[r]=e[l]:(e[r]=void 0,delete e[r])}e.length=n}e("collections/shim");var Ct=e("collections/listen/property-changes");e("collections/listen/array-changes");var Dt=e("collections/sorted-array"),Nt=e("collections/sorted-set"),Et=e("collections/map");e("collections/set");var Mt=e("collections/heap");e("./scope");var wt=e("./operators");t.makeLiteralObserver=i,t.observeValue=a,t.observeParameters=s,t.makeElementObserver=u,t.makeComponentObserver=n,t.observeProperty=r;var At=r;t.makePropertyObserver=l,t.observeKey=o,t.observeGet=o;var xt=o;t.makeGetObserver=c,t.makeHasObserver=m,t.makeObserversObserver=d,t.makeRecordObserver=p,t.makeObjectObserver=p,t.makeTupleObserver=v,t.makeArrayObserver=v,t.makeOperatorObserverMaker=h,t.makeMethodObserverMaker=g,t.makeNotObserver=f,t.makeAndObserver=b,t.makeOrObserver=q,t.makeConditionalObserver=_,t.makeDefinedObserver=y,t.makeDefaultObserver=S;var It=t.makeMapBlockObserver=qt(P),Tt=t.makeFilterBlockObserver=qt(C);t.makeSortedBlockObserver=D,t.makeSortedSetBlockObserver=w,t.makeReversedObserver=qt(A);var Lt=t.makeFlattenObserver=qt(x);t.makeConcatObserver=I,t.makeSomeBlockObserver=T,t.makeEveryBlockObserver=L,t.makeGroupBlockObserver=j,t.makeGroupMapBlockObserver=O,t.makeMaxBlockObserver=F,t.makeMinBlockObserver=R,t.makeMaxObserver=k,t.makeMinObserver=z;var jt=i("length");t.makeSumObserver=U(function(){var e=0;return function(t,i){return t=t.filter(B),i=i.filter(B),e+=t.sum()-i.sum()}}),t.makeAverageObserver=U(function(){var e=0,t=0;return function(i,a){return i=i.filter(B),a=a.filter(B),e+=i.sum()-a.sum(),t+=i.length-a.length,e/t}}),t.makeViewObserver=qt(Q);var Ot=i(0);t.makeEnumerateObserver=qt(G),t.makeEnumerationObserver=t.makeEnumerateObserver,t.makeRangeObserver=W,t.makeStartsWithObserver=H,t.makeEndsWithObserver=X,t.makeContainsObserver=Y,t.makeJoinObserver=K;var Vt=i("");t.observeRangeChange=J,t.makeLastObserver=$,t.observeLast=Z;var Ft=Z;t.makeOnlyObserver=et,t.observeOnly=tt,t.makeOneObserver=it,t.observeOne=at,t.makeRangeContentObserver=st,t.makeMapContentObserver=ut,t.observeMapChange=nt;var Rt=t.makeEntriesObserver=qt(rt);t.observeEntries=lt,t.makeKeysObserver=ot,t.observeEntryKey=ct,t.makeValuesObserver=mt,t.observeEntryValue=dt,t.makeToMapObserver=pt;var kt=It(j(a,ct),$(dt));t.makeParentObserver=vt,t.makeConverterObserver=ht,t.makeComputerObserver=gt,t.makePathObserver=ft,t.makeExpressionObserver=ft,t.makeWithObserver=bt,t.makeToArrayObserver=qt(Function.identity),t.makeAsArrayObserver=t.makeToArrayObserver;var zt=e("./merge").merge;t.makeUniq=_t,t.cancelEach=yt,t.autoCancelPrevious=St}}),montageDefine("cab98f5","stringify",{dependencies:["./parse","./language"],factory:function(e,t,i){"use strict";function a(e,t){return a.semantics.stringify(e,t)}function s(e){return function(t,i,a){var s=e+"{"+a(t.args[1],i)+"}";return"value"===t.args[0].type?s:a(t.args[0],i)+"."+s}}e("./parse");var u=e("./language").precedence,n=e("./language").operatorTypes;e("./language").operatorTokens,i.exports=a,a.semantics={makeBlockStringifier:s,stringify:function(e,t,i){function a(e){var i=n(e,t);
return i?i:"this"}var s,n=this.stringify.bind(this),r=this.stringifiers;if(r[e.type])s=r[e.type](e,t,n);else if(e.inline)s="&"+e.type+"("+e.args.map(a).join(", ")+")";else{var l;1===e.args.length&&"mapBlock"===e.args[0].type?(l=e.type+"{"+n(e.args[0].args[1],t)+"}",e=e.args[0]):l=e.type+"("+e.args.slice(1).map(a).join(", ")+")",s="value"===e.args[0].type?l:n(e.args[0],t)+"."+l}return!i||i.type===e.type&&"if"!==i.type||u.get(i.type).has(e.type)?s:"("+s+")"},stringifiers:{value:function(){return""},literal:function(e){return"string"==typeof e.value?"'"+e.value.replace("'","\\'")+"'":""+e.value},parameters:function(){return"$"},record:function(e,t,i){return"{"+Object.map(e.args,function(e,a){var s;return s="value"===e.type?"this":i(e,t),a+": "+s}).join(", ")+"}"},tuple:function(e,t,i){return"["+Object.map(e.args,function(e){return"value"===e.type?"this":i(e)}).join(", ")+"]"},component:function(e,t){var i;return t&&t.components&&e.component?t.components.getObjectLabel?i=t.components.getObjectLabel(e.component):t.components.getLabelForObject&&(i=t.components.getLabelForObject(e.component)):i=e.label,"@"+i},element:function(e){return"#"+e.id},mapBlock:s("map"),filterBlock:s("filter"),someBlock:s("some"),everyBlock:s("every"),sortedBlock:s("sorted"),sortedSetBlock:s("sortedSet"),groupBlock:s("group"),groupMapBlock:s("groupMap"),minBlock:s("min"),maxBlock:s("max"),property:function(e,t,i){return"value"===e.args[0].type?"string"==typeof e.args[1].value?e.args[1].value:"literal"===e.args[1].type?"."+e.args[1].value:"this["+i(e.args[1],t)+"]":"parameters"===e.args[0].type?"$"+e.args[1].value:"literal"===e.args[1].type&&/^[\w\d_]+$/.test(e.args[1].value)?i(e.args[0],t,{type:"scope"})+"."+e.args[1].value:i(e.args[0],{type:"scope"},t)+"["+i(e.args[1],t)+"]"},"with":function(e,t,i){var a=i(e.args[1],t,e);return i(e.args[0],t)+"."+a},not:function(e,t,i){return"equals"===e.args[0].type?i(e.args[0].args[0],t,{type:"equals"})+" != "+i(e.args[0].args[1],t,{type:"equals"}):"!"+i(e.args[0],t,e)},neg:function(e,t,i){return"-"+i(e.args[0],t,e)},toNumber:function(e,t,i){return"+"+i(e.args[0],t,e)},parent:function(e,t,i){return"^"+i(e.args[0],t,e)},"if":function(e,t,i){return i(e.args[0],t,e)+" ? "+i(e.args[1],t)+" : "+i(e.args[2],t)},event:function(e,t,i){return e.when+" "+e.event+" -> "+i(e.listener,t)},binding:function(e,t,i,a){var s=a(t.args[0],i)+" "+e+" "+a(t.args[1],i),u="",n=t.descriptor;if(n)for(var r in n)u+=", "+r+": "+a(n[r],i);return s+u},bind:function(e,t,i){return this.binding("<-",e,t,i)},bind2:function(e,t,i){return this.binding("<->",e,t,i)},assign:function(e,t,i){return i(e.args[0],t)+": "+i(e.args[1],t)},block:function(e,t,i){var a="@"+e.label;return e.connection&&("prototype"===e.connection?a+=" < ":"object"===e.connection&&(a+=" : "),a+=i({type:"literal",value:e.module}),e.exports&&"value"!==e.exports.type&&(a+=" "+i(e.exports,t))),a+" {\n"+e.statements.map(function(e){return"    "+i(e,t)+";\n"}).join("")+"}\n"},sheet:function(e,t,i){return"\n"+e.blocks.map(function(e){return i(e,t)}).join("\n")+"\n"}}},n.forEach(function(e,t){a.semantics.stringifiers[t]=function(t,i,a){return t.args.map(function(e){return a(e,i,t)}).join(" "+e+" ").trim()}})}}),montageDefine("cab98f5","expand",{dependencies:["collections/set","collections/map","./operators"],factory:function(e,t,i){function a(e,t){var i=a.semantics.expand.bind(a.semantics);return i(e,t,i)}var s=e("collections/set"),u=e("collections/map");e("./operators"),i.exports=a,a.semantics={reflexive:s(["literal","element","rangeContent","mapContent"]),traverseLeft:s(["with","mapBlock","filterBlock","someBlock","everyBlock","sortedBlock","groupBlock","groupMapBlock"]),expanders:u({value:function(e,t){return t.value||{type:"value"}},parameters:function(e,t){return t.parameters||{type:"parameters"}},record:function(e,t,i){var a={type:"record",args:[]};for(var s in e.args)a.args[s]=i(e.args[s],t,i);return a},component:function(e,t){return t.components&&e.component?{type:"component",label:t.components.getObjectLabel(e.component)}:e}}),expand:function(e,t,i){return this.expanders.has(e.type)?this.expanders.get(e.type)(e,t,i):this.traverseLeft.has(e.type)?{type:e.type,args:[i(e.args[0],t,i)].concat(e.args.slice(1))}:this.reflexive.has(e.type)?e:{type:e.type,args:e.args.map(function(e){return i(e,t,i)})}}}}}),montageDefine("cab98f5","bindings",{dependencies:["collections/map","./bind","./compute","./observe","./stringify"],factory:function(e,t){function i(e,t,i){if(t)for(var s in t)a(e,s,t[s],i);return e}function a(e,i,a,u){u=u||Object.empty;var n=s(e);if(d.call(n,i))throw Error("Can't bind to already bound target, "+JSON.stringify(i));return"<-"in a||"<->"in a||"compute"in a?(a.target=e,a.parameters=a.parameters||u.parameters,a.document=a.document||u.document,a.components=a.components||u.components,a.cancel="compute"in a?c(e,i,a):o(e,i,a),n[i]=a,t.count++):("get"in a||"set"in a||"writable"in a||(a.writable=!0),"configurable"in a||(a.configurable=!0),"enumerable"in a||(a.enumerable=!0),Object.defineProperty(e,i,a)),e}function s(e){return m.has(e)||m.set(e,{}),m.get(e)}function u(e,t){var i=s(e);return i[t]}function n(e){var t=s(e);for(var i in t)r(e,i)}function r(e,i){var a=s(e);if(!a[i])throw Error("Can't cancel non-existent binding to "+JSON.stringify(i));var u=a[i];if(u&&u.cancel){u.cancel(),delete a[i],t.count--;for(var i in a)return;m["delete"](e)}}var l=e("collections/map"),o=e("./bind"),c=e("./compute");e("./observe"),e("./stringify");var m=new l,d=Object.prototype.hasOwnProperty;t.count=0,t.bindings=m,t.defineBindings=i,t.defineBinding=a,t.getBindings=s,t.getBinding=u,t.cancelBindings=n,t.cancelBinding=r}}),montageDefine("cab98f5","grammar",{dependencies:[],factory:function(e,t,i){i.exports=function(){function e(e,t){function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i}function t(e,t,i,a,s){function u(e,t){function i(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+t(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+t(e)}).replace(/[\u0180-\u0FFF]/g,function(e){return"\\u0"+t(e)}).replace(/[\u1080-\uFFFF]/g,function(e){return"\\u"+t(e)})}var a,s;switch(e.length){case 0:a="end of input";break;case 1:a=e[0];break;default:a=e.slice(0,-1).join(", ")+" or "+e[e.length-1]}return s=t?'"'+i(t)+'"':"end of input","Expected "+a+" but "+s+" found."}this.expected=e,this.found=t,this.offset=i,this.line=a,this.column=s,this.name="SyntaxError",this.message=u(e,t)}function i(e){function i(t){function i(t,i,a){var s,u;for(s=i;a>s;s++)u=e.charAt(s),"\n"===u?(t.seenCR||t.line++,t.column=1,t.seenCR=!1):"\r"===u||"\u2028"===u||"\u2029"===u?(t.line++,t.column=1,t.seenCR=!0):(t.column++,t.seenCR=!1)}return Qs!==t&&(Qs>t&&(Qs=0,Gs={line:1,column:1,seenCR:!1}),i(Gs,Qs,t),Qs=t),Gs}function a(e){Ws>Us||(Us>Ws&&(Ws=Us,Hs=[]),Hs.push(e))}function s(e){var t=0;for(e.sort();e.length>t;)e[t-1]===e[t]?e.splice(t,1):t++}function u(){var e,t;return Xs++,e=l(),Xs--,null===e&&(t=null,0===Xs&&a(Z)),e}function n(){var t,i,s,n,r,l,o;if(t=Us,i=u(),null!==i){for(s=[],n=Us,44===e.charCodeAt(Us)?(r=tt,Us++):(r=null,0===Xs&&a(it)),null!==r?(l=k(),null!==l?(o=u(),null!==o?(r=[r,l,o],n=r):(Us=n,n=et)):(Us=n,n=et)):(Us=n,n=et);null!==n;)s.push(n),n=Us,44===e.charCodeAt(Us)?(r=tt,Us++):(r=null,0===Xs&&a(it)),null!==r?(l=k(),null!==l?(o=u(),null!==o?(r=[r,l,o],n=r):(Us=n,n=et)):(Us=n,n=et)):(Us=n,n=et);null!==s?(n=k(),null!==n?(Bs=t,i=at(i,s),null===i?(Us=t,t=i):t=i):(Us=t,t=et)):(Us=t,t=et)}else Us=t,t=et;return t}function r(){var t,i,s,u;return t=Us,40===e.charCodeAt(Us)?(i=st,Us++):(i=null,0===Xs&&a(ut)),null!==i?(s=k(),null!==s?(41===e.charCodeAt(Us)?(u=nt,Us++):(u=null,0===Xs&&a(rt)),null!==u?(Bs=t,i=lt(),null===i?(Us=t,t=i):t=i):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et),null===t&&(t=Us,40===e.charCodeAt(Us)?(i=st,Us++):(i=null,0===Xs&&a(ut)),null!==i?(s=n(),null!==s?(41===e.charCodeAt(Us)?(u=nt,Us++):(u=null,0===Xs&&a(rt)),null!==u?(Bs=t,i=ot(s),null===i?(Us=t,t=i):t=i):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et)),t}function l(){var t,i,s,n,r,l,c,m,d,p,v;return t=Us,i=o(),null!==i?(s=k(),null!==s?(n=Us,63===e.charCodeAt(Us)?(r=mt,Us++):(r=null,0===Xs&&a(dt)),null!==r?(l=k(),null!==l?(c=u(),null!==c?(m=k(),null!==m?(58===e.charCodeAt(Us)?(d=pt,Us++):(d=null,0===Xs&&a(vt)),null!==d?(p=k(),null!==p?(v=u(),null!==v?(r=[r,l,c,m,d,p,v],n=r):(Us=n,n=et)):(Us=n,n=et)):(Us=n,n=et)):(Us=n,n=et)):(Us=n,n=et)):(Us=n,n=et)):(Us=n,n=et),null===n&&(n=ct),null!==n?(Bs=t,i=ht(i,n),null===i?(Us=t,t=i):t=i):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et),t}function o(){var t,i,s,u,n,r,l,o;if(t=Us,i=c(),null!==i){for(s=[],u=Us,n=k(),null!==n?(e.substr(Us,2)===gt?(r=gt,Us+=2):(r=null,0===Xs&&a(ft)),null!==r?(l=k(),null!==l?(o=c(),null!==o?(n=[n,r,l,o],u=n):(Us=u,u=et)):(Us=u,u=et)):(Us=u,u=et)):(Us=u,u=et);null!==u;)s.push(u),u=Us,n=k(),null!==n?(e.substr(Us,2)===gt?(r=gt,Us+=2):(r=null,0===Xs&&a(ft)),null!==r?(l=k(),null!==l?(o=c(),null!==o?(n=[n,r,l,o],u=n):(Us=u,u=et)):(Us=u,u=et)):(Us=u,u=et)):(Us=u,u=et);null!==s?(Bs=t,i=bt(i,s),null===i?(Us=t,t=i):t=i):(Us=t,t=et)}else Us=t,t=et;return t}function c(){var t,i,s,u,n,r,l,o;if(t=Us,i=m(),null!==i){for(s=[],u=Us,n=k(),null!==n?(e.substr(Us,2)===qt?(r=qt,Us+=2):(r=null,0===Xs&&a(_t)),null!==r?(l=k(),null!==l?(o=m(),null!==o?(n=[n,r,l,o],u=n):(Us=u,u=et)):(Us=u,u=et)):(Us=u,u=et)):(Us=u,u=et);null!==u;)s.push(u),u=Us,n=k(),null!==n?(e.substr(Us,2)===qt?(r=qt,Us+=2):(r=null,0===Xs&&a(_t)),null!==r?(l=k(),null!==l?(o=m(),null!==o?(n=[n,r,l,o],u=n):(Us=u,u=et)):(Us=u,u=et)):(Us=u,u=et)):(Us=u,u=et);null!==s?(Bs=t,i=bt(i,s),null===i?(Us=t,t=i):t=i):(Us=t,t=et)}else Us=t,t=et;return t}function m(){var t,i,s,u,n,r,l,o,c;return t=Us,i=d(),null!==i?(s=Us,u=k(),null!==u?(n=Us,e.substr(Us,3)===yt?(r=yt,Us+=3):(r=null,0===Xs&&a(St)),null===r&&(e.substr(Us,2)===Pt?(r=Pt,Us+=2):(r=null,0===Xs&&a(Ct)),null===r&&(e.substr(Us,2)===Dt?(r=Dt,Us+=2):(r=null,0===Xs&&a(Nt)),null===r&&(r=Us,60===e.charCodeAt(Us)?(l=Et,Us++):(l=null,0===Xs&&a(Mt)),null!==l?(o=Us,Xs++,45===e.charCodeAt(Us)?(c=wt,Us++):(c=null,0===Xs&&a(At)),Xs--,null===c?o=ct:(Us=o,o=et),null!==o?(l=[l,o],r=l):(Us=r,r=et)):(Us=r,r=et),null===r&&(62===e.charCodeAt(Us)?(r=xt,Us++):(r=null,0===Xs&&a(It)),null===r&&(e.substr(Us,2)===Tt?(r=Tt,Us+=2):(r=null,0===Xs&&a(Lt)),null===r&&(e.substr(Us,2)===jt?(r=jt,Us+=2):(r=null,0===Xs&&a(Ot)))))))),null!==r&&(r=e.substring(n,Us)),n=r,null!==n?(r=k(),null!==r?(l=d(),null!==l?(u=[u,n,r,l],s=u):(Us=s,s=et)):(Us=s,s=et)):(Us=s,s=et)):(Us=s,s=et),null===s&&(s=ct),null!==s?(Bs=t,i=Vt(i,s),null===i?(Us=t,t=i):t=i):(Us=t,t=et)):(Us=t,t=et),t}function d(){var t,i,s,u,n,r,l,o;if(t=Us,i=p(),null!==i){for(s=[],u=Us,n=k(),null!==n?(r=Us,43===e.charCodeAt(Us)?(l=Ft,Us++):(l=null,0===Xs&&a(Rt)),null===l&&(45===e.charCodeAt(Us)?(l=wt,Us++):(l=null,0===Xs&&a(At))),null!==l&&(l=e.substring(r,Us)),r=l,null!==r?(l=k(),null!==l?(o=p(),null!==o?(n=[n,r,l,o],u=n):(Us=u,u=et)):(Us=u,u=et)):(Us=u,u=et)):(Us=u,u=et);null!==u;)s.push(u),u=Us,n=k(),null!==n?(r=Us,43===e.charCodeAt(Us)?(l=Ft,Us++):(l=null,0===Xs&&a(Rt)),null===l&&(45===e.charCodeAt(Us)?(l=wt,Us++):(l=null,0===Xs&&a(At))),null!==l&&(l=e.substring(r,Us)),r=l,null!==r?(l=k(),null!==l?(o=p(),null!==o?(n=[n,r,l,o],u=n):(Us=u,u=et)):(Us=u,u=et)):(Us=u,u=et)):(Us=u,u=et);null!==s?(Bs=t,i=bt(i,s),null===i?(Us=t,t=i):t=i):(Us=t,t=et)}else Us=t,t=et;return t}function p(){var t,i,s,u,n,r,l,o;if(t=Us,i=v(),null!==i){for(s=[],u=Us,n=k(),null!==n?(r=Us,42===e.charCodeAt(Us)?(l=kt,Us++):(l=null,0===Xs&&a(zt)),null===l&&(47===e.charCodeAt(Us)?(l=Ut,Us++):(l=null,0===Xs&&a(Bt)),null===l&&(37===e.charCodeAt(Us)?(l=Qt,Us++):(l=null,0===Xs&&a(Gt)),null===l&&(e.substr(Us,3)===Wt?(l=Wt,Us+=3):(l=null,0===Xs&&a(Ht))))),null!==l&&(l=e.substring(r,Us)),r=l,null!==r?(l=k(),null!==l?(o=v(),null!==o?(n=[n,r,l,o],u=n):(Us=u,u=et)):(Us=u,u=et)):(Us=u,u=et)):(Us=u,u=et);null!==u;)s.push(u),u=Us,n=k(),null!==n?(r=Us,42===e.charCodeAt(Us)?(l=kt,Us++):(l=null,0===Xs&&a(zt)),null===l&&(47===e.charCodeAt(Us)?(l=Ut,Us++):(l=null,0===Xs&&a(Bt)),null===l&&(37===e.charCodeAt(Us)?(l=Qt,Us++):(l=null,0===Xs&&a(Gt)),null===l&&(e.substr(Us,3)===Wt?(l=Wt,Us+=3):(l=null,0===Xs&&a(Ht))))),null!==l&&(l=e.substring(r,Us)),r=l,null!==r?(l=k(),null!==l?(o=v(),null!==o?(n=[n,r,l,o],u=n):(Us=u,u=et)):(Us=u,u=et)):(Us=u,u=et)):(Us=u,u=et);null!==s?(Bs=t,i=bt(i,s),null===i?(Us=t,t=i):t=i):(Us=t,t=et)}else Us=t,t=et;return t}function v(){var t,i,s,u,n,r,l,o;if(t=Us,i=h(),null!==i){for(s=[],u=Us,n=k(),null!==n?(r=Us,e.substr(Us,2)===Xt?(l=Xt,Us+=2):(l=null,0===Xs&&a(Yt)),null===l&&(e.substr(Us,2)===Kt?(l=Kt,Us+=2):(l=null,0===Xs&&a(Jt)),null===l&&(e.substr(Us,2)===$t?(l=$t,Us+=2):(l=null,0===Xs&&a(Zt)))),null!==l&&(l=e.substring(r,Us)),r=l,null!==r?(l=k(),null!==l?(o=h(),null!==o?(n=[n,r,l,o],u=n):(Us=u,u=et)):(Us=u,u=et)):(Us=u,u=et)):(Us=u,u=et);null!==u;)s.push(u),u=Us,n=k(),null!==n?(r=Us,e.substr(Us,2)===Xt?(l=Xt,Us+=2):(l=null,0===Xs&&a(Yt)),null===l&&(e.substr(Us,2)===Kt?(l=Kt,Us+=2):(l=null,0===Xs&&a(Jt)),null===l&&(e.substr(Us,2)===$t?(l=$t,Us+=2):(l=null,0===Xs&&a(Zt)))),null!==l&&(l=e.substring(r,Us)),r=l,null!==r?(l=k(),null!==l?(o=h(),null!==o?(n=[n,r,l,o],u=n):(Us=u,u=et)):(Us=u,u=et)):(Us=u,u=et)):(Us=u,u=et);null!==s?(Bs=t,i=bt(i,s),null===i?(Us=t,t=i):t=i):(Us=t,t=et)}else Us=t,t=et;return t}function h(){var t,i,s,u,n,r,l,o;if(t=Us,i=g(),null!==i){for(s=[],u=Us,n=k(),null!==n?(e.substr(Us,2)===ei?(r=ei,Us+=2):(r=null,0===Xs&&a(ti)),null!==r?(l=k(),null!==l?(o=g(),null!==o?(n=[n,r,l,o],u=n):(Us=u,u=et)):(Us=u,u=et)):(Us=u,u=et)):(Us=u,u=et);null!==u;)s.push(u),u=Us,n=k(),null!==n?(e.substr(Us,2)===ei?(r=ei,Us+=2):(r=null,0===Xs&&a(ti)),null!==r?(l=k(),null!==l?(o=g(),null!==o?(n=[n,r,l,o],u=n):(Us=u,u=et)):(Us=u,u=et)):(Us=u,u=et)):(Us=u,u=et);null!==s?(Bs=t,i=bt(i,s),null===i?(Us=t,t=i):t=i):(Us=t,t=et)}else Us=t,t=et;return t}function g(){var t,i,s;return t=Us,i=Us,33===e.charCodeAt(Us)?(s=ii,Us++):(s=null,0===Xs&&a(ai)),null===s&&(43===e.charCodeAt(Us)?(s=Ft,Us++):(s=null,0===Xs&&a(Rt)),null===s&&(45===e.charCodeAt(Us)?(s=wt,Us++):(s=null,0===Xs&&a(At)))),null!==s&&(s=e.substring(i,Us)),i=s,null!==i?(s=g(),null!==s?(Bs=t,i=si(i,s),null===i?(Us=t,t=i):t=i):(Us=t,t=et)):(Us=t,t=et),null===t&&(t=f()),t}function f(){var e,t,i,a;if(e=Us,t=_(),null!==t){for(i=[],a=b();null!==a;)i.push(a),a=b();null!==i?(Bs=e,t=ui(t,i),null===t?(Us=e,e=t):e=t):(Us=e,e=et)}else Us=e,e=et;return e}function b(){var t,i,s,n;return t=Us,46===e.charCodeAt(Us)?(i=ni,Us++):(i=null,0===Xs&&a(ri)),null!==i?(s=q(),null!==s?(Bs=t,i=li(s),null===i?(Us=t,t=i):t=i):(Us=t,t=et)):(Us=t,t=et),null===t&&(t=Us,91===e.charCodeAt(Us)?(i=oi,Us++):(i=null,0===Xs&&a(ci)),null!==i?(s=u(),null!==s?(93===e.charCodeAt(Us)?(n=mi,Us++):(n=null,0===Xs&&a(di)),null!==n?(Bs=t,i=pi(s),null===i?(Us=t,t=i):t=i):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et)),t}function q(){var t,i,s,n,l,o,c;return t=Us,i=Us,s=y(),null!==s&&(s=e.substring(i,Us)),i=s,null!==i?(123===e.charCodeAt(Us)?(s=vi,Us++):(s=null,0===Xs&&a(hi)),null!==s?(n=k(),null!==n?(l=u(),null!==l?(o=k(),null!==o?(125===e.charCodeAt(Us)?(c=gi,Us++):(c=null,0===Xs&&a(fi)),null!==c?(Bs=t,i=bi(i,l),null===i?(Us=t,t=i):t=i):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et),null===t&&(t=Us,i=Us,s=y(),null!==s&&(s=e.substring(i,Us)),i=s,null!==i?(s=r(),null!==s?(Bs=t,i=qi(i,s),null===i?(Us=t,t=i):t=i):(Us=t,t=et)):(Us=t,t=et),null===t&&(t=Us,i=O(),null!==i&&(Bs=t,i=_i(i)),null===i?(Us=t,t=i):t=i,null===t&&(t=Us,i=Us,s=y(),null!==s&&(s=e.substring(i,Us)),i=s,null!==i&&(Bs=t,i=yi(i)),null===i?(Us=t,t=i):t=i,null===t&&(t=Us,i=E(),null!==i&&(Bs=t,i=Si(i)),null===i?(Us=t,t=i):t=i,null===t&&(t=Us,i=M(),null!==i&&(Bs=t,i=Si(i)),null===i?(Us=t,t=i):t=i,null===t&&(t=Us,40===e.charCodeAt(Us)?(i=st,Us++):(i=null,0===Xs&&a(ut)),null!==i?(s=u(),null!==s?(41===e.charCodeAt(Us)?(n=nt,Us++):(n=null,0===Xs&&a(rt)),null!==n?(Bs=t,i=Si(s),null===i?(Us=t,t=i):t=i):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et))))))),t}function _(){var t,i,s,n;return t=E(),null===t&&(t=M(),null===t&&(t=S(),null===t&&(t=x(),null===t&&(t=Us,e.substr(Us,4)===Pi?(i=Pi,Us+=4):(i=null,0===Xs&&a(Ci)),null!==i&&(Bs=t,i=Di()),null===i?(Us=t,t=i):t=i,null===t&&(t=Us,e.substr(Us,4)===Ni?(i=Ni,Us+=4):(i=null,0===Xs&&a(Ei)),null!==i&&(Bs=t,i=Mi()),null===i?(Us=t,t=i):t=i,null===t&&(t=Us,e.substr(Us,5)===wi?(i=wi,Us+=5):(i=null,0===Xs&&a(Ai)),null!==i&&(Bs=t,i=xi()),null===i?(Us=t,t=i):t=i,null===t&&(t=Us,e.substr(Us,4)===Ii?(i=Ii,Us+=4):(i=null,0===Xs&&a(Ti)),null!==i&&(Bs=t,i=Li()),null===i?(Us=t,t=i):t=i,null===t&&(t=Us,64===e.charCodeAt(Us)?(i=ji,Us++):(i=null,0===Xs&&a(Oi)),null!==i?(s=Us,n=W(),null!==n&&(n=e.substring(s,Us)),s=n,null!==s?(Bs=t,i=Vi(s),null===i?(Us=t,t=i):t=i):(Us=t,t=et)):(Us=t,t=et),null===t&&(t=Us,36===e.charCodeAt(Us)?(i=Fi,Us++):(i=null,0===Xs&&a(Ri)),null!==i?(s=Us,n=y(),null!==n&&(n=e.substring(s,Us)),s=n,null!==s?(Bs=t,i=ki(s),null===i?(Us=t,t=i):t=i):(Us=t,t=et)):(Us=t,t=et),null===t&&(t=Us,36===e.charCodeAt(Us)?(i=Fi,Us++):(i=null,0===Xs&&a(Ri)),null!==i&&(Bs=t,i=zi()),null===i?(Us=t,t=i):t=i,null===t&&(t=Us,35===e.charCodeAt(Us)?(i=Ui,Us++):(i=null,0===Xs&&a(Bi)),null!==i?(s=Us,n=y(),null!==n&&(n=e.substring(s,Us)),s=n,null!==s?(Bs=t,i=Qi(s),null===i?(Us=t,t=i):t=i):(Us=t,t=et)):(Us=t,t=et),null===t&&(t=Us,38===e.charCodeAt(Us)?(i=Gi,Us++):(i=null,0===Xs&&a(Wi)),null!==i?(s=Us,n=y(),null!==n&&(n=e.substring(s,Us)),s=n,null!==s?(n=r(),null!==n?(Bs=t,i=Hi(s,n),null===i?(Us=t,t=i):t=i):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et),null===t&&(t=Us,94===e.charCodeAt(Us)?(i=Xi,Us++):(i=null,0===Xs&&a(Yi)),null!==i?(s=_(),null!==s?(Bs=t,i=Ki(s),null===i?(Us=t,t=i):t=i):(Us=t,t=et)):(Us=t,t=et),null===t&&(t=Us,40===e.charCodeAt(Us)?(i=st,Us++):(i=null,0===Xs&&a(ut)),null!==i?(s=u(),null!==s?(41===e.charCodeAt(Us)?(n=nt,Us++):(n=null,0===Xs&&a(rt)),null!==n?(Bs=t,i=Ji(s),null===i?(Us=t,t=i):t=i):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et),null===t&&(t=Us,i=q(),null!==i&&(Bs=t,i=$i(i)),null===i?(Us=t,t=i):t=i,null===t&&(t=Us,i=[],null!==i&&(Bs=t,i=Zi()),null===i?(Us=t,t=i):t=i)))))))))))))))),t}function y(){var t,i;if(Xs++,t=[],ta.test(e.charAt(Us))?(i=e.charAt(Us),Us++):(i=null,0===Xs&&a(ia)),null!==i)for(;null!==i;)t.push(i),ta.test(e.charAt(Us))?(i=e.charAt(Us),Us++):(i=null,0===Xs&&a(ia));else t=et;return Xs--,null===t&&(i=null,0===Xs&&a(ea)),t}function S(){var t,i,s,u;if(Xs++,t=Us,39===e.charCodeAt(Us)?(i=sa,Us++):(i=null,0===Xs&&a(ua)),null!==i){for(s=[],u=P();null!==u;)s.push(u),u=P();null!==s?(39===e.charCodeAt(Us)?(u=sa,Us++):(u=null,0===Xs&&a(ua)),null!==u?(Bs=t,i=na(s),null===i?(Us=t,t=i):t=i):(Us=t,t=et)):(Us=t,t=et)}else Us=t,t=et;if(null===t)if(t=Us,34===e.charCodeAt(Us)?(i=ra,Us++):(i=null,0===Xs&&a(la)),null!==i){for(s=[],u=C();null!==u;)s.push(u),u=C();null!==s?(34===e.charCodeAt(Us)?(u=ra,Us++):(u=null,0===Xs&&a(la)),null!==u?(Bs=t,i=na(s),null===i?(Us=t,t=i):t=i):(Us=t,t=et)):(Us=t,t=et)}else Us=t,t=et;return Xs--,null===t&&(i=null,0===Xs&&a(aa)),t}function P(){var t,i;return oa.test(e.charAt(Us))?(t=e.charAt(Us),Us++):(t=null,0===Xs&&a(ca)),null===t&&(t=Us,e.substr(Us,2)===ma?(i=ma,Us+=2):(i=null,0===Xs&&a(da)),null!==i&&(Bs=t,i=pa()),null===i?(Us=t,t=i):t=i,null===t&&(t=D())),t}function C(){var t,i;return va.test(e.charAt(Us))?(t=e.charAt(Us),Us++):(t=null,0===Xs&&a(ha)),null===t&&(t=Us,e.substr(Us,2)===ga?(i=ga,Us+=2):(i=null,0===Xs&&a(fa)),null!==i&&(Bs=t,i=ba()),null===i?(Us=t,t=i):t=i,null===t&&(t=D())),t}function D(){var t,i,s,u,n,r,l,o;return t=Us,e.substr(Us,2)===qa?(i=qa,Us+=2):(i=null,0===Xs&&a(_a)),null!==i&&(Bs=t,i=ya()),null===i?(Us=t,t=i):t=i,null===t&&(t=Us,e.substr(Us,2)===Sa?(i=Sa,Us+=2):(i=null,0===Xs&&a(Pa)),null!==i&&(Bs=t,i=Ca()),null===i?(Us=t,t=i):t=i,null===t&&(t=Us,e.substr(Us,2)===Da?(i=Da,Us+=2):(i=null,0===Xs&&a(Na)),null!==i&&(Bs=t,i=Ea()),null===i?(Us=t,t=i):t=i,null===t&&(t=Us,e.substr(Us,2)===Ma?(i=Ma,Us+=2):(i=null,0===Xs&&a(wa)),null!==i&&(Bs=t,i=Aa()),null===i?(Us=t,t=i):t=i,null===t&&(t=Us,e.substr(Us,2)===xa?(i=xa,Us+=2):(i=null,0===Xs&&a(Ia)),null!==i&&(Bs=t,i=Ta()),null===i?(Us=t,t=i):t=i,null===t&&(t=Us,e.substr(Us,2)===La?(i=La,Us+=2):(i=null,0===Xs&&a(ja)),null!==i&&(Bs=t,i=Oa()),null===i?(Us=t,t=i):t=i,null===t&&(t=Us,e.substr(Us,2)===Va?(i=Va,Us+=2):(i=null,0===Xs&&a(Fa)),null!==i&&(Bs=t,i=Ra()),null===i?(Us=t,t=i):t=i,null===t&&(t=Us,e.substr(Us,2)===ka?(i=ka,Us+=2):(i=null,0===Xs&&a(za)),null!==i&&(Bs=t,i=Ua()),null===i?(Us=t,t=i):t=i,null===t&&(t=Us,e.substr(Us,2)===Ba?(i=Ba,Us+=2):(i=null,0===Xs&&a(Qa)),null!==i?(s=Us,u=Us,n=N(),null!==n?(r=N(),null!==r?(l=N(),null!==l?(o=N(),null!==o?(n=[n,r,l,o],u=n):(Us=u,u=et)):(Us=u,u=et)):(Us=u,u=et)):(Us=u,u=et),null!==u&&(u=e.substring(s,Us)),s=u,null!==s?(Bs=t,i=Ga(s),null===i?(Us=t,t=i):t=i):(Us=t,t=et)):(Us=t,t=et))))))))),t}function N(){var t;return Wa.test(e.charAt(Us))?(t=e.charAt(Us),Us++):(t=null,0===Xs&&a(Ha)),t}function E(){var t,i,s,u,r,l;return t=Us,91===e.charCodeAt(Us)?(i=oi,Us++):(i=null,0===Xs&&a(ci)),null!==i?(s=k(),null!==s?(93===e.charCodeAt(Us)?(u=mi,Us++):(u=null,0===Xs&&a(di)),null!==u?(Bs=t,i=Xa(),null===i?(Us=t,t=i):t=i):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et),null===t&&(t=Us,91===e.charCodeAt(Us)?(i=oi,Us++):(i=null,0===Xs&&a(ci)),null!==i?(s=k(),null!==s?(u=n(),null!==u?(r=k(),null!==r?(93===e.charCodeAt(Us)?(l=mi,Us++):(l=null,0===Xs&&a(di)),null!==l?(Bs=t,i=Ya(u),null===i?(Us=t,t=i):t=i):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et)),t}function M(){var t,i,s,u,n,r;return t=Us,123===e.charCodeAt(Us)?(i=vi,Us++):(i=null,0===Xs&&a(hi)),null!==i?(s=k(),null!==s?(125===e.charCodeAt(Us)?(u=gi,Us++):(u=null,0===Xs&&a(fi)),null!==u?(n=k(),null!==n?(Bs=t,i=Ka(),null===i?(Us=t,t=i):t=i):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et),null===t&&(t=Us,123===e.charCodeAt(Us)?(i=vi,Us++):(i=null,0===Xs&&a(hi)),null!==i?(s=k(),null!==s?(u=w(),null!==u?(125===e.charCodeAt(Us)?(n=gi,Us++):(n=null,0===Xs&&a(fi)),null!==n?(r=k(),null!==r?(Bs=t,i=Ja(u),null===i?(Us=t,t=i):t=i):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et)),t}function w(){var t,i,s,u,n,r,l;if(t=Us,i=A(),null!==i){for(s=[],u=Us,44===e.charCodeAt(Us)?(n=tt,Us++):(n=null,0===Xs&&a(it)),null!==n?(r=k(),null!==r?(l=A(),null!==l?(n=[n,r,l],u=n):(Us=u,u=et)):(Us=u,u=et)):(Us=u,u=et);null!==u;)s.push(u),u=Us,44===e.charCodeAt(Us)?(n=tt,Us++):(n=null,0===Xs&&a(it)),null!==n?(r=k(),null!==r?(l=A(),null!==l?(n=[n,r,l],u=n):(Us=u,u=et)):(Us=u,u=et)):(Us=u,u=et);null!==s?(Bs=t,i=$a(i,s),null===i?(Us=t,t=i):t=i):(Us=t,t=et)}else Us=t,t=et;return t}function A(){var t,i,s,n,r;return t=Us,i=Us,s=y(),null!==s&&(s=e.substring(i,Us)),i=s,null!==i?(58===e.charCodeAt(Us)?(s=pt,Us++):(s=null,0===Xs&&a(vt)),null!==s?(n=k(),null!==n?(r=u(),null!==r?(Bs=t,i=Za(i,r),null===i?(Us=t,t=i):t=i):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et),t}function x(){var t,i,s;return Xs++,t=Us,i=Us,s=I(),null!==s&&(s=e.substring(i,Us)),i=s,null!==i&&(Bs=t,i=ts(i)),null===i?(Us=t,t=i):t=i,Xs--,null===t&&(i=null,0===Xs&&a(es)),t}function I(){var e,t,i,a;return e=Us,t=T(),null!==t?(i=L(),null!==i?(a=j(),null!==a?(t=[t,i,a],e=t):(Us=e,e=et)):(Us=e,e=et)):(Us=e,e=et),null===e&&(e=Us,t=T(),null!==t?(i=L(),null!==i?(t=[t,i],e=t):(Us=e,e=et)):(Us=e,e=et),null===e&&(e=Us,t=T(),null!==t?(i=j(),null!==i?(t=[t,i],e=t):(Us=e,e=et)):(Us=e,e=et),null===e&&(e=T()))),e}function T(){var t,i,s,u;return t=Us,i=R(),null!==i?(s=O(),null!==s?(i=[i,s],t=i):(Us=t,t=et)):(Us=t,t=et),null===t&&(t=F(),null===t&&(t=Us,45===e.charCodeAt(Us)?(i=wt,Us++):(i=null,0===Xs&&a(At)),null!==i?(s=R(),null!==s?(u=O(),null!==u?(i=[i,s,u],t=i):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et),null===t&&(t=Us,45===e.charCodeAt(Us)?(i=wt,Us++):(i=null,0===Xs&&a(At)),null!==i?(s=F(),null!==s?(i=[i,s],t=i):(Us=t,t=et)):(Us=t,t=et)))),t}function L(){var t,i,s;return t=Us,46===e.charCodeAt(Us)?(i=ni,Us++):(i=null,0===Xs&&a(ri)),null!==i?(s=O(),null!==s?(i=[i,s],t=i):(Us=t,t=et)):(Us=t,t=et),t}function j(){var e,t,i;return e=Us,t=V(),null!==t?(i=O(),null!==i?(t=[t,i],e=t):(Us=e,e=et)):(Us=e,e=et),e}function O(){var e,t;if(e=[],t=F(),null!==t)for(;null!==t;)e.push(t),t=F();else e=et;return e}function V(){var t,i,s;return t=Us,is.test(e.charAt(Us))?(i=e.charAt(Us),Us++):(i=null,0===Xs&&a(as)),null!==i?(ss.test(e.charAt(Us))?(s=e.charAt(Us),Us++):(s=null,0===Xs&&a(us)),null===s&&(s=ct),null!==s?(i=[i,s],t=i):(Us=t,t=et)):(Us=t,t=et),t}function F(){var t;return ns.test(e.charAt(Us))?(t=e.charAt(Us),Us++):(t=null,0===Xs&&a(rs)),t}function R(){var t;return ls.test(e.charAt(Us))?(t=e.charAt(Us),Us++):(t=null,0===Xs&&a(os)),t}function k(){var e,t;for(e=[],t=z(),null===t&&(t=U());null!==t;)e.push(t),t=z(),null===t&&(t=U());return e}function z(){var t,i;return Xs++,ms.test(e.charAt(Us))?(t=e.charAt(Us),Us++):(t=null,0===Xs&&a(ds)),null===t&&(ps.test(e.charAt(Us))?(t=e.charAt(Us),Us++):(t=null,0===Xs&&a(vs))),Xs--,null===t&&(i=null,0===Xs&&a(cs)),t}function U(){var t,i;return Xs++,gs.test(e.charAt(Us))?(t=e.charAt(Us),Us++):(t=null,0===Xs&&a(fs)),Xs--,null===t&&(i=null,0===Xs&&a(hs)),t}function B(){var e,t,i,a;if(e=Us,t=k(),null!==t){for(i=[],a=Q();null!==a;)i.push(a),a=Q();null!==i?(a=k(),null!==a?(Bs=e,t=bs(i),null===t?(Us=e,e=t):e=t):(Us=e,e=et)):(Us=e,e=et)}else Us=e,e=et;return e}function Q(){var t,i,s,u,n,r,l,o,c,m;return t=Us,64===e.charCodeAt(Us)?(i=ji,Us++):(i=null,0===Xs&&a(Oi)),null!==i?(s=Us,u=W(),null!==u&&(u=e.substring(s,Us)),s=u,null!==s?(u=k(),null!==u?(n=G(),null===n&&(n=ct),null!==n?(123===e.charCodeAt(Us)?(r=vi,Us++):(r=null,0===Xs&&a(hi)),null!==r?(l=k(),null!==l?(o=H(),null!==o?(125===e.charCodeAt(Us)?(c=gi,Us++):(c=null,0===Xs&&a(fi)),null!==c?(m=k(),null!==m?(Bs=t,i=qs(s,n,o),null===i?(Us=t,t=i):t=i):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et),t}function G(){var t,i,s,n,r,l,o,c;return t=Us,60===e.charCodeAt(Us)?(i=Et,Us++):(i=null,0===Xs&&a(Mt)),null===i&&(58===e.charCodeAt(Us)?(i=pt,Us++):(i=null,0===Xs&&a(vt))),null!==i?(s=k(),null!==s?(n=S(),null===n&&(n=ct),null!==n?(r=k(),null!==r?(l=Us,o=Us,Xs++,123===e.charCodeAt(Us)?(c=vi,Us++):(c=null,0===Xs&&a(hi)),Xs--,null===c?o=ct:(Us=o,o=et),null!==o?(c=u(),null!==c?(o=[o,c],l=o):(Us=l,l=et)):(Us=l,l=et),null===l&&(l=ct),null!==l?(o=k(),null!==o?(Bs=t,i=_s(i,n,l),null===i?(Us=t,t=i):t=i):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et),null===t&&(t=Us,i=k(),null!==i&&(Bs=t,i=ys()),null===i?(Us=t,t=i):t=i),t}function W(){var t,i,s,u,n,r,l;if(t=Us,i=[],Ss.test(e.charAt(Us))?(s=e.charAt(Us),Us++):(s=null,0===Xs&&a(Ps)),null!==s)for(;null!==s;)i.push(s),Ss.test(e.charAt(Us))?(s=e.charAt(Us),Us++):(s=null,0===Xs&&a(Ps));else i=et;if(null!==i){if(s=[],u=Us,58===e.charCodeAt(Us)?(n=pt,Us++):(n=null,0===Xs&&a(vt)),null!==n){if(r=[],Ss.test(e.charAt(Us))?(l=e.charAt(Us),Us++):(l=null,0===Xs&&a(Ps)),null!==l)for(;null!==l;)r.push(l),Ss.test(e.charAt(Us))?(l=e.charAt(Us),Us++):(l=null,0===Xs&&a(Ps));else r=et;null!==r?(n=[n,r],u=n):(Us=u,u=et)}else Us=u,u=et;for(;null!==u;)if(s.push(u),u=Us,58===e.charCodeAt(Us)?(n=pt,Us++):(n=null,0===Xs&&a(vt)),null!==n){if(r=[],Ss.test(e.charAt(Us))?(l=e.charAt(Us),Us++):(l=null,0===Xs&&a(Ps)),null!==l)for(;null!==l;)r.push(l),Ss.test(e.charAt(Us))?(l=e.charAt(Us),Us++):(l=null,0===Xs&&a(Ps));else r=et;null!==r?(n=[n,r],u=n):(Us=u,u=et)}else Us=u,u=et;null!==s?(i=[i,s],t=i):(Us=t,t=et)}else Us=t,t=et;return t}function H(){var t,i,s,u,n,r,l,o,c;if(t=Us,i=X(),null!==i)if(s=k(),null!==s){for(u=[],n=Us,59===e.charCodeAt(Us)?(r=Cs,Us++):(r=null,0===Xs&&a(Ds)),null!==r?(l=k(),null!==l?(o=X(),null!==o?(c=k(),null!==c?(r=[r,l,o,c],n=r):(Us=n,n=et)):(Us=n,n=et)):(Us=n,n=et)):(Us=n,n=et);null!==n;)u.push(n),n=Us,59===e.charCodeAt(Us)?(r=Cs,Us++):(r=null,0===Xs&&a(Ds)),null!==r?(l=k(),null!==l?(o=X(),null!==o?(c=k(),null!==c?(r=[r,l,o,c],n=r):(Us=n,n=et)):(Us=n,n=et)):(Us=n,n=et)):(Us=n,n=et);null!==u?(59===e.charCodeAt(Us)?(n=Cs,Us++):(n=null,0===Xs&&a(Ds)),null===n&&(n=ct),null!==n?(r=k(),null!==r?(Bs=t,i=at(i,u),null===i?(Us=t,t=i):t=i):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et)}else Us=t,t=et;else Us=t,t=et;return null===t&&(t=Us,i=X(),null!==i?(s=k(),null!==s?(59===e.charCodeAt(Us)?(u=Cs,Us++):(u=null,0===Xs&&a(Ds)),null===u&&(u=ct),null!==u?(n=k(),null!==n?(Bs=t,i=Ns(i),null===i?(Us=t,t=i):t=i):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et),null===t&&(t=Us,i=k(),null!==i&&(Bs=t,i=lt()),null===i?(Us=t,t=i):t=i)),t}function X(){var t,i,s,n,r,l,o,c,m,d,p,v,h,g,f,b,q;if(t=Us,e.substr(Us,2)===Es?(i=Es,Us+=2):(i=null,0===Xs&&a(Ms)),null===i&&(e.substr(Us,6)===ws?(i=ws,Us+=6):(i=null,0===Xs&&a(As))),null!==i?(32===e.charCodeAt(Us)?(s=xs,Us++):(s=null,0===Xs&&a(Is)),null!==s?(n=k(),null!==n?(r=Us,l=y(),null!==l&&(l=e.substring(r,Us)),r=l,null!==r?(l=k(),null!==l?(e.substr(Us,2)===Ts?(o=Ts,Us+=2):(o=null,0===Xs&&a(Ls)),null!==o?(c=k(),null!==c?(m=u(),null!==m?(d=k(),null!==d?(Bs=t,i=js(i,r,m),null===i?(Us=t,t=i):t=i):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et),null===t){if(t=Us,i=u(),null!==i)if(s=k(),null!==s)if(58===e.charCodeAt(Us)?(n=pt,Us++):(n=null,0===Xs&&a(vt)),null===n&&(e.substr(Us,3)===Os?(n=Os,Us+=3):(n=null,0===Xs&&a(Vs)),null===n&&(e.substr(Us,2)===Fs?(n=Fs,Us+=2):(n=null,0===Xs&&a(Rs)))),null!==n)if(r=k(),null!==r)if(l=u(),null!==l)if(o=k(),null!==o){for(c=[],m=Us,44===e.charCodeAt(Us)?(d=tt,Us++):(d=null,0===Xs&&a(it)),null!==d?(p=k(),null!==p?(v=Us,h=y(),null!==h&&(h=e.substring(v,Us)),v=h,null!==v?(h=k(),null!==h?(58===e.charCodeAt(Us)?(g=pt,Us++):(g=null,0===Xs&&a(vt)),null!==g?(f=k(),null!==f?(b=u(),null!==b?(q=k(),null!==q?(d=[d,p,v,h,g,f,b,q],m=d):(Us=m,m=et)):(Us=m,m=et)):(Us=m,m=et)):(Us=m,m=et)):(Us=m,m=et)):(Us=m,m=et)):(Us=m,m=et)):(Us=m,m=et);null!==m;)c.push(m),m=Us,44===e.charCodeAt(Us)?(d=tt,Us++):(d=null,0===Xs&&a(it)),null!==d?(p=k(),null!==p?(v=Us,h=y(),null!==h&&(h=e.substring(v,Us)),v=h,null!==v?(h=k(),null!==h?(58===e.charCodeAt(Us)?(g=pt,Us++):(g=null,0===Xs&&a(vt)),null!==g?(f=k(),null!==f?(b=u(),null!==b?(q=k(),null!==q?(d=[d,p,v,h,g,f,b,q],m=d):(Us=m,m=et)):(Us=m,m=et)):(Us=m,m=et)):(Us=m,m=et)):(Us=m,m=et)):(Us=m,m=et)):(Us=m,m=et)):(Us=m,m=et);null!==c?(Bs=t,i=ks(i,n,l,c),null===i?(Us=t,t=i):t=i):(Us=t,t=et)}else Us=t,t=et;else Us=t,t=et;else Us=t,t=et;else Us=t,t=et;else Us=t,t=et;else Us=t,t=et;null===t&&(t=Us,i=Us,s=y(),null!==s&&(s=e.substring(i,Us)),i=s,null!==i?(s=k(),null!==s?(n=u(),null!==n?(r=k(),null!==r?(Bs=t,i=zs(i,n),null===i?(Us=t,t=i):t=i):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et)):(Us=t,t=et))}return t}var Y,K=arguments.length>1?arguments[1]:{},J={expression:u,sheet:B},$=u,Z="expression",et=null,tt=",",it='","',at=function(e,t){for(var i=[e],a=0;t.length>a;a++)i.push(t[a][2]);return i},st="(",ut='"("',nt=")",rt='")"',lt=function(){return[]},ot=function(e){return e},ct="",mt="?",dt='"?"',pt=":",vt='":"',ht=function(e,t){if(t){var i=t[2],a=t[6];return{type:"if",args:[e,i,a]}}return e},gt="||",ft='"||"',bt=function(e,t){for(var i=0;t.length>i;i++)e={type:Ys[t[i][1]],args:[e,t[i][3]]};return e},qt="&&",_t='"&&"',yt="<=>",St='"<=>"',Pt="<=",Ct='"<="',Dt=">=",Nt='">="',Et="<",Mt='"<"',wt="-",At='"-"',xt=">",It='">"',Tt="==",Lt='"=="',jt="!=",Ot='"!="',Vt=function(e,t){if(t){var i=t[1],a=t[3];return"!="===i?{type:"not",args:[{type:"equals",args:[e,a]}]}:{type:Ys[i],args:[e,a]}}return e},Ft="+",Rt='"+"',kt="*",zt='"*"',Ut="/",Bt='"/"',Qt="%",Gt='"%"',Wt="rem",Ht='"rem"',Xt="**",Yt='"**"',Kt="//",Jt='"//"',$t="%%",Zt='"%%"',ei="??",ti='"??"',ii="!",ai='"!"',si=function(e,t){return{type:Ks[e],args:[t]}},ui=function(e,t){for(var i=0;t.length>i;i++)e=t[i](e);return e},ni=".",ri='"."',li=function(e){return e},oi="[",ci='"["',mi="]",di='"]"',pi=function(e){return function(t){return{type:"property",args:[t,e]}}},vi="{",hi='"{"',gi="}",fi='"}"',bi=function(e,t){return Js[e]?function(i){return{type:Js[e],args:[i,t]}
}:"value"===t.type?function(t){return{type:e,args:[t]}}:function(i){return{type:e,args:[{type:"mapBlock",args:[i,t]}]}}},qi=function(e,t){return function(i){return{type:e,args:[i].concat(t)}}},_i=function(e){return function(t){return{type:"property",args:[t,{type:"literal",value:+e.join("")}]}}},yi=function(e){return function(t){return{type:"property",args:[t,{type:"literal",value:e}]}}},Si=function(e){return function(t){return{type:"with",args:[t,e]}}},Pi="this",Ci='"this"',Di=function(){return{type:"value"}},Ni="true",Ei='"true"',Mi=function(){return{type:"literal",value:!0}},wi="false",Ai='"false"',xi=function(){return{type:"literal",value:!1}},Ii="null",Ti='"null"',Li=function(){return{type:"literal",value:null}},ji="@",Oi='"@"',Vi=function(e){return{type:"component",label:e}},Fi="$",Ri='"$"',ki=function(e){return{type:"property",args:[{type:"parameters"},{type:"literal",value:e}]}},zi=function(){return{type:"parameters"}},Ui="#",Bi='"#"',Qi=function(e){return{type:"element",id:e}},Gi="&",Wi='"&"',Hi=function(e,t){return{type:e,args:t,inline:!0}},Xi="^",Yi='"^"',Ki=function(e){return{type:"parent",args:[e]}},Ji=function(e){return e},$i=function(e){return e({type:"value"})},Zi=function(){return{type:"value"}},ea="word",ta=/^[a-zA-Z_0-9\-]/,ia="[a-zA-Z_0-9\\-]",aa="string",sa="'",ua='"\'"',na=function(e){return{type:"literal",value:e.join("")}},ra='"',la='"\\""',oa=/^[^'\\\0-\x1F]/,ca="[^'\\\\\\0-\\x1F]",ma="\\'",da='"\\\\\'"',pa=function(){return"'"},va=/^[^"\\\0-\x1F]/,ha='[^"\\\\\\0-\\x1F]',ga='\\"',fa='"\\\\\\""',ba=function(){return'"'},qa="\\\\",_a='"\\\\\\\\"',ya=function(){return"\\"},Sa="\\/",Pa='"\\\\/"',Ca=function(){return"/"},Da="\\b",Na='"\\\\b"',Ea=function(){return"\b"},Ma="\\f",wa='"\\\\f"',Aa=function(){return"\f"},xa="\\n",Ia='"\\\\n"',Ta=function(){return"\n"},La="\\r",ja='"\\\\r"',Oa=function(){return"\r"},Va="\\t",Fa='"\\\\t"',Ra=function(){return"	"},ka="\\0",za='"\\\\0"',Ua=function(){return"\0"},Ba="\\u",Qa='"\\\\u"',Ga=function(e){return String.fromCharCode(parseInt(e,16))},Wa=/^[0-9a-fA-F]/,Ha="[0-9a-fA-F]",Xa=function(){return{type:"tuple",args:[]}},Ya=function(e){return{type:"tuple",args:e}},Ka=function(){return{type:"record",args:[]}},Ja=function(e){return{type:"record",args:e}},$a=function(e,t){var i={};i[e[0]]=e[1];for(var a=0;t.length>a;a++)i[t[a][2][0]]=t[a][2][1];return i},Za=function(e,t){return[e,t]},es="number",ts=function(e){return{type:"literal",value:+e}},is=/^[eE]/,as="[eE]",ss=/^[+\-]/,us="[+\\-]",ns=/^[0-9]/,rs="[0-9]",ls=/^[1-9]/,os="[1-9]",cs="whitespace",ms=/^[\t\x0B\f \xA0\uFEFF]/,ds="[\\t\\x0B\\f \\xA0\\uFEFF]",ps=/^[ \xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000]/,vs="[ \\xA0\\u1680\\u180E\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200A\\u202F\\u205F\\u3000]",hs="line terminator",gs=/^[\n\r\u2028\u2029]/,fs="[\\n\\r\\u2028\\u2029]",bs=function(e){return{type:"sheet",blocks:e}},qs=function(e,t,i){return{type:"block",connection:t.connection,module:t.module,exports:t.exports,label:e,statements:i}},_s=function(e,t,i){return{connection:{"<":"prototype",":":"object"}[e],module:t&&t.value,exports:""!==i?i[1]:void 0}},ys=function(){return{}},Ss=/^[a-zA-Z_0-9]/,Ps="[a-zA-Z_0-9]",Cs=";",Ds='";"',Ns=function(e){return[e]},Es="on",Ms='"on"',ws="before",As='"before"',xs=" ",Is='" "',Ts="->",Ls='"->"',js=function(e,t,i){return{type:"event",when:e,event:t,listener:i}},Os="<->",Vs='"<->"',Fs="<-",Rs='"<-"',ks=function(e,t,i,a){var s={type:$s[t],args:[e,i]};if(a.length){for(var u={},n=0;a.length>n;n++)u[a[n][2]]=a[n][6];s.descriptor=u}return s},zs=function(e,t){return{type:"unit",name:e,value:t}},Us=0,Bs=0,Qs=0,Gs={line:1,column:1,seenCR:!1},Ws=0,Hs=[],Xs=0;if("startRule"in K){if(!(K.startRule in J))throw Error("Can't start parsing from rule \""+K.startRule+'".');$=J[K.startRule]}var Ys={"**":"pow","//":"root","%%":"log","*":"mul","/":"div","%":"mod",rem:"rem","+":"add","-":"sub","<":"lt",">":"gt","<=":"le",">=":"ge","==":"equals","<=>":"compare","??":"default","&&":"and","||":"or","<-":"bind","<->":"bind2",":":"assign"},Ks={"+":"toNumber","-":"neg","!":"not","^":"parent"},Js={map:"mapBlock",filter:"filterBlock",some:"someBlock",every:"everyBlock",sorted:"sortedBlock",sortedSet:"sortedSetBlock",group:"groupBlock",groupMap:"groupMapBlock",min:"minBlock",max:"maxBlock"},$s={":":"assign","<-":"bind","<->":"bind2"};if(Y=$(),null!==Y&&Us===e.length)return Y;throw s(Hs),Bs=Math.max(Us,Ws),new t(Hs,e.length>Bs?e.charAt(Bs):null,Bs,i(Bs).line,i(Bs).column)}return e(t,Error),{SyntaxError:t,parse:i}}()}}),montageDefine("cab98f5","compile-evaluator",{dependencies:["collections/shim-object","collections/map","collections/sorted-set","./operators","./scope","./parse"],factory:function(e,t,i){function a(e){return a.semantics.compile(e)}var s=e("collections/shim-object"),u=e("collections/map"),n=e("collections/sorted-set"),r=e("./operators");e("./scope"),i.exports=a;var l={literal:function(e){return function(){return e.value}},value:function(){return function(e){return e.value}},parameters:function(){return function(e){return e.parameters}},element:function(e){return function(t){return t.document.getElementById(e.id)}},component:function(e){return function(t){return t.components.getObjectByLabel(e.label)}},tuple:function(e){var t=e.args.map(this.compile,this);return function(e){return t.map(function(t){return t(e)})}},record:function(e){var t=e.args,i={};for(var a in t)i[a]=this.compile(t[a]);return function(e){var t={};for(var a in i)t[a]=i[a](e);return t}}},o={mapBlock:function(e,t){return function(i){return e(i).map(function(e){return t(i.nest(e))})}},filterBlock:function(e,t){return function(i){return e(i).filter(function(e){return t(i.nest(e))})}},someBlock:function(e,t){return function(i){return e(i).some(function(e){return t(i.nest(e))})}},everyBlock:function(e,t){return function(i){return e(i).every(function(e){return t(i.nest(e))})}},sortedBlock:function(e,t){return function(i){return e(i).sorted(Function.by(function(e){return t(i.nest(e))}))}},sortedSetBlock:function(e,t){return function(i){function a(e){return t(i.nest(e))}function u(e,t){return s.compare(a(e),a(t))}function r(e,t){return s.equals(a(e),a(t))}return new n(e(i),r,u)}},groupBlock:function(e,t){return function(i){return e(i).group(function(e){return t(i.nest(e))})}},groupMapBlock:function(e,t){return function(i){return new u(e(i).group(function(e){return t(i.nest(e))}))}},minBlock:function(e,t){return function(i){return e(i).min(Function.by(function(e){return t(i.nest(e))}))}},maxBlock:function(e,t){return function(i){return e(i).max(Function.by(function(e){return t(i.nest(e))}))}},parent:function(e){return function(t){return e(t.parent)}},"with":function(e,t){return function(i){return t(i.nest(e(i)))}},"if":function(e,t,i){return function(a){var s=e(a);return null!=s?s?t(a):i(a):void 0}},not:function(e){return function(t){return!e(t)}},and:function(e,t){return function(i){return e(i)&&t(i)}},or:function(e,t){return function(i){return e(i)||t(i)}},"default":function(e,t){return function(i){var a=e(i);return null==a&&(a=t(i)),a}},defined:function(e){return function(t){var i=e(t);return null!=i}},path:function(t,i){return function(s){var u=t(s),n=i(s),r=e("./parse");try{var l=r(n),o=a(l);return o(s.nest(u))}catch(c){}}}},c=s.clone(r,1);s.addEach(c,{property:function(e,t){return e[t]},get:function(e,t){return e.get(t)},mapContent:Function.identity,rangeContent:Function.identity,view:function(e,t,i){return e.slice(t,t+i)}}),a.semantics={compilers:l,argCompilers:o,operators:c,compile:function(e){var t=this.compilers,i=this.argCompilers,a=this.operators;if(t.hasOwnProperty(e.type))return t[e.type].call(this,e);if(i.hasOwnProperty(e.type)){var s=e.args.map(this.compile,this);return i[e.type].apply(null,s)}a.hasOwnProperty(e.type)||(a[e.type]=function(t){var i=Array.prototype.slice.call(arguments,1);if(!t[e.type])throw new TypeError("Can't call "+JSON.stringify(e.type)+" of "+t);return t[e.type].apply(t,i)});var u=a[e.type],s=e.args.map(this.compile,this);return function(e){var t=s.map(function(t){return t(e)});return t.every(r.defined)?u.apply(null,t):void 0}}}}}),montageDefine("cab98f5","algebra",{dependencies:[],factory:function(e,t,i){function a(e,t){return a.semantics.solve(e,t)}i.exports=a,a.semantics={solve:function(e,t){for(;;){for(;this.simplifiers.hasOwnProperty(e.type);){var i=this.simplifiers[e.type](e);if(!i)break;e=i}var a=this.rotateTargetToSource.hasOwnProperty(e.type),s=this.rotateSourceToTarget.hasOwnProperty(t.type);if(!a&&!s)break;a?(t=this.rotateTargetToSource[e.type](e,t),e=e.args[0]):s&&(e=this.rotateSourceToTarget[t.type](e,t),t=t.args[0])}return[e,t]},simplifiers:{not:function(e){var t=e.args[0];return"not"===t.type?t.args[0]:void 0},add:function(e){var t=e.args[0];return"literal"===t.type&&""===t.value?{type:"toString",args:[e.args[1]]}:void 0},someBlock:function(e){return{type:"not",args:[{type:"everyBlock",args:[e.args[0],{type:"not",args:[e.args[1]]}]}]}}},rotateTargetToSource:{reflect:function(e,t){return{type:e.type,args:[t]}},invert:function(e,t,i){return{type:i,args:[t,e.args[1]]}},toNumber:function(e,t){return this.reflect(e,t)},toString:function(e,t){return this.reflect(e,t)},not:function(e,t){return this.reflect(e,t)},neg:function(e,t){return this.reflect(e,t)},add:function(e,t){return this.invert(e,t,"sub")},sub:function(e,t){return this.invert(e,t,"add")},mul:function(e,t){return this.invert(e,t,"div")},div:function(e,t){return this.invert(e,t,"mul")},pow:function(e,t){return this.invert(e,t,"root")},root:function(e,t){return this.invert(e,t,"pow")},join:function(e,t){return this.invert(e,t,"split")},split:function(e,t){return this.invert(e,t,"join")}},rotateSourceToTarget:{rangeContent:function(e,t){return"rangeContent"===e.type?e:{type:t.type,args:[e]}}}}}}),montageDefine("cab98f5","compile-binder",{dependencies:["./compile-observer","./observers","./binders","./algebra"],factory:function(e,t,i){function a(e){return a.semantics.compile(e)}var s=e("./compile-observer");e("./observers");var u=e("./binders"),n=e("./algebra"),r={type:"value"},l={type:"literal",value:!0};i.exports=a,a.semantics={compilers:{property:u.makePropertyBinder,get:u.makeGetBinder,has:u.makeHasBinder,only:u.makeOnlyBinder,one:u.makeOneBinder,rangeContent:u.makeRangeContentBinder,mapContent:u.makeMapContentBinder,reversed:u.makeReversedBinder,and:u.makeAndBinder,or:u.makeOrBinder},compile:function(e){var t=this.compilers;if("default"===e.type)return this.compile(e.args[0]);if("literal"===e.type){if(null==e.value)return Function.noop;throw Error("Can't bind to literal: "+e.value)}if("equals"===e.type){var i=this.compile(e.args[0]),a=s(e.args[1]);return u.makeEqualityBinder(i,a)}if("if"===e.type){var o=s(e.args[0]),c=this.compile(e.args[1]),m=this.compile(e.args[2]);return u.makeConditionalBinder(o,c,m)}if("and"===e.type||"or"===e.type){var d=n(e.args[0],r),p=n(e.args[1],r),i=this.compile(d[0]),v=this.compile(p[0]),h=s(d[1]),g=s(p[1]),f=s(e.args[0]),a=s(e.args[1]);return this.compilers[e.type](i,v,f,a,h,g)}if("everyBlock"===e.type){var b=s(e.args[0]),q=n(e.args[1],l),_=this.compile(q[0]),y=s(q[1]);return u.makeEveryBlockBinder(b,_,y)}if("rangeContent"===e.type){var S,P=s(e.args[0]);try{S=this.compile(e.args[0])}catch(C){S=Function.noop}return u.makeRangeContentBinder(P,S)}if("defined"===e.type){var S=this.compile(e.args[0]);return u.makeDefinedBinder(S)}if("parent"===e.type){var S=this.compile(e.args[0]);return u.makeParentBinder(S)}if("with"===e.type){var P=s(e.args[0]),S=this.compile(e.args[1]);return u.makeWithBinder(P,S)}if(t.hasOwnProperty(e.type)){var D=e.args.map(s,s.semantics);return t[e.type].apply(null,D)}throw Error("Can't compile binder for "+JSON.stringify(e.type))}}}}),montageDefine("cab98f5","compile-assigner",{dependencies:["./compile-evaluator","./algebra","./scope"],factory:function(e,t,i){function a(e){return a.semantics.compile(e)}var s=e("./compile-evaluator"),u=e("./algebra");e("./scope");var n={type:"value"},r={type:"literal",value:!0},l={type:"literal",value:!1};i.exports=a,a.semantics={compile:function(e){var t=this.compilers;if("equals"===e.type){var i=this.compile(e.args[0]),a=this.compileEvaluator(e.args[1]);return t.equals(i,a)}if("if"===e.type){var s=this.compileEvaluator(e.args[0]),r=this.compile(e.args[1]),l=this.compile(e.args[2]);return t["if"](s,r,l)}if("and"===e.type||"or"===e.type){var o=u(e.args[0],n),c=u(e.args[1],n),m=this.compileEvaluator(e.args[0]),a=this.compileEvaluator(e.args[1]),d=this.compileEvaluator(o[1]),p=this.compileEvaluator(c[1]),i=this.compile(o[0]),v=this.compile(c[0]);return t[e.type](i,v,m,a,d,p)}if("everyBlock"===e.type){var h=this.compileEvaluator(e.args[0]),g=u(e.args[1],{type:"literal",value:!0}),f=this.compile(g[0]),b=this.compileEvaluator(g[1]);return t.everyBlock(h,f,b)}if("parent"===e.type){var q=this.compile(e.args[0]);return function(e,t){return q(e,t.parent)}}if(t.hasOwnProperty(e.type)){var _=e.args.map(this.compileEvaluator,this.compileEvaluator.semantics);return t[e.type].apply(null,_)}throw Error("Can't compile assigner for "+JSON.stringify(e.type))},compileEvaluator:s,compilers:{property:function(e,t){return function(i,a){var s=e(a);if(s){var u=t(a);null!=u&&(Array.isArray(s)?s.set(u,i):s[u]=i)}}},get:function(e,t){return function(i,a){var s=e(a);if(s){var u=t(a);null!=u&&s.set(u,i)}}},has:function(e,t){return function(i,a){var s=e(a);if(s){var u=t(a);null!=i&&(i?(s.has||s.contains).call(s,u)||s.add(u):(s.has||s.contains).call(s,u)&&(s.remove||s["delete"]).call(s,u))}}},equals:function(e,t){return function(i,a){return i?e(t(a),a):void 0}},"if":function(e,t,i){return function(a,s){var u=e(s);return null!=u?u?t(a,s):i(a,s):void 0}},and:function(e,t,i,a,s,u){return function(n,l){null!=n&&(n?(e(s(r),l),t(u(r),l)):e(i(l)&&!a(l),l))}},or:function(e,t,i,a,s,u){return function(n,r){null!=n&&(n?e(i(r)||!a(r),r):(e(s(l),r),t(u(l),r)))}},rangeContent:function(e){return function(t,i){var a=e(i);a&&(t?a.swap(0,a.length,t):a.clear())}},mapContent:function(e){return function(t,i){var a=e(i);a&&(a.clear(),i.value&&a.addEach(t))}},reversed:function(e){return function(t,i){var a=e(i);a&&a.swap(0,a.length,t.reversed())}},everyBlock:function(e,t,i){return function(a,s){if(a){var u=e(s),n=i(s);u.forEach(function(e){t(n,s.nest(e))})}}}}}}}),montageDefine("cab98f5","binders",{dependencies:["./scope","./observers"],factory:function(e,t){function i(){return Error("").stack.replace(/^.*\n.*\n/,"\n")}function a(e,t,a,s,u,n){return a(C(function(a){if(!u.isActive)try{u.isActive=!0,n&&console.log("SET",n.targetPath,"TO",a,"ON",e,"BECAUSE",n.sourcePath,i()),Array.isArray(e)&&t>>>0===t?e.set(t,a):e[t]=a}finally{u.isActive=!1}}),s)}function s(e,t){return function(i,a,s,u,n){return t(C(function(t){return null!=t?e(C(function(e){return null!=e?e.bindProperty?e.bindProperty(t,i,a,u,n):T(e,t,i,a,u,n):void 0}),s):void 0}),s)}}function u(e,t,a,s,u,n){return a(C(function(a){if(!u.isActive)try{u.isActive=!0,n&&console.log("SET FOR KEY",t,"TO",a,"ON",e,"BECAUSE",n.sourcePath,i()),e.set(t,a)}finally{u.isActive=!1}}),s)}function n(e,t){return function(i,a,s,u,n){return e(C(function(e){return e?t(C(function(t){return null!=t?L(e,t,i,a,u,n):void 0}),s):void 0}),s)}}function r(e,t){return function(a,s,u,n,r){return e(C(function(e){return e?t(C(function(t){return null!=t?a(C(function(a){if(a)(e.has||e.contains).call(e,t)||(r&&console.log("ADD",t,"TO",r.targetPath,"BECAUSE",r.sourcePath,i()),e.add(t));else for(;(e.has||e.contains).call(e,t);)r&&console.log("REMOVE",t,"FROM",r.targetPath,"BECAUSE",r.sourcePath,i()),(e.remove||e["delete"]).call(e,t)}),s):void 0}),u):void 0}),u)}}function l(e,t){return function(a,s,u,n,r){return a(C(function(a){return a?(r&&console.log("BIND",r.targetPath,"TO",r.sourcePath,i()),e(t,s,s,n,r),function(){r&&console.log("UNBIND",r.targetPath,"FROM",r.sourcePath,i())}):void 0}),u)}}function o(e,t,i){return function(a,s,u,n,r){return a(C(function(a){return a?e(C(function(e){function a(e,a,l){N(s.slice(l,l+a.length)),s.swap(l,a.length,e.map(function(e){var a=u.nest(e);return t(i,a,a,n,r)}))}if(e){var s=[],l=D(e,a,u);return function(){N(s),l()}}}),u):void 0}),s)}}function c(e,t,i,a,s,u){var n=E(a),r=w(i,n);return function(i,a,n,l,o){return i(C(function(i){if(null!=i){if(i){var a=e(s,x,n,l,o),c=t(u,x,n,l,o);return function(){a(),c()}}return e(r,n,n,l,o)}}),a)}}function m(e,t,i,a,s,u){var n=E(a),r=M(i,n);return function(i,a,n,l,o){return i(C(function(i){if(null!=i){if(i)return e(r,n,n,l,o);var a=e(s,I,n,l,o),c=t(u,I,n,l,o);return function(){a(),c()}}}),a)}}function d(e,t,i){return function(a,s,u,n,r){return e(C(function(e){return null!=e?e?t(a,s,u,n,r):i(a,s,u,n,r):void 0}),s)}}function p(e){return function(t,i,a){return e(C(function(e){return e?t(C(function(t){null!=t&&(e.splice?e.splice(0,e.length,t):e.clear&&e.add&&(e.clear(),e.add(t)))}),i):void 0}),a)}}function v(e){return function(t,i,a){return e(C(function(e){return e?t(C(function(t){null!=t&&t!==e.one()&&(e.splice?e.splice(0,e.length,t):e.clear&&e.add&&(e.clear(),e.add(t)))}),i):void 0}),a)}}function h(e,t){return function(a,s,u,n,r){return e(C(function(e){return e?a(C(function(t){function a(t,a,s){y(e)||(r&&console.log("SWAPPING",a,"FOR",t,"AT",s,"ON",r.targetPath,i()),e.swap?e.swap(s,a.length,t):e.add&&(e.remove||e["delete"])&&(t.forEach(e.add,e),a.forEach(e.remove||e["delete"],e)))}if(t!==e){if(!t)return e.clear(),void 0;if(t.addRangeChangeListener)return t.addRangeChangeListener(a),a(Array.from(t),Array.from(e),0),function(){t.removeRangeChangeListener(a)}}}),s):t(P.makeLiteralObserver([]),s,u,n,r)}),u)}}function g(e){return function(t,a,s,u,n){return e(C(function(e){return e?t(C(function(t){function a(t,a){if(!u.isActive)try{u.isActive=!0,void 0===t?(n&&n&&console.log("DELETED",n.targetPath,"FOR KEY",a,"ON",e,"BECAUSE",n.sourcePath,i()),Array.isArray(e)?e.splice(a,1):e["delete"](a)):(n&&n&&console.log("SET",n.targetPath,"FOR KEY",a,"TO",t,"ON",e,"BECAUSE",n.sourcePath,i()),e.set(a,t))}finally{u.isActive=!1}}return t?(e.clear(),t.forEach(a),t.addMapChangeListener(a)):(e.clear(),void 0)}),a):void 0}),s)}}function f(e){return function(t,i,a){return e(C(function(e){return e?t(C(function(t){function i(t,i,a){if(!y(e)){var s=e.length-a-i.length;e.swap(s,i.length,t.reversed())}}return t?(t.addRangeChangeListener(i),i(t,e,0),function(){t.removeRangeChangeListener(i)}):(e.clear(),void 0)}),i):void 0}),a)}}function b(e){return function(t,i,a,s,u){return t(C(function(t){return t?Function.noop:e(A,i,a,s,u)}),a)}}function q(e){return function(t,i,a,s,u){return a.parent?e(t,i,a.parent,s,u):void 0}}function _(e,t){return function(i,a,s,u,n){return e(C(function(e){return null!=e?t(i,a,s.nest(e),u,n):void 0}),s)}}function y(e){return e.getRangeChangeDescriptor&&e.getRangeChangeDescriptor().isActive}var S=e("./scope"),P=e("./observers"),C=P.autoCancelPrevious,D=P.observeRangeChange,N=P.cancelEach,E=P.makeNotObserver,M=P.makeOrObserver,w=P.makeAndObserver;P.observeValue;var A=P.makeLiteralObserver(),x=new S(!0),I=new S(!1);t.bindProperty=a;var T=a;t.makePropertyBinder=s,t.bindGet=u;var L=u;t.makeGetBinder=n,t.makeHasBinder=r,t.makeEqualityBinder=l,t.makeEveryBlockBinder=o,t.makeAndBinder=c,t.makeOrBinder=m,t.makeConditionalBinder=d,t.makeOnlyBinder=p,t.makeOneBinder=v,t.makeRangeContentBinder=h,t.makeMapContentBinder=g,t.makeReversedBinder=f,t.makeDefinedBinder=b,t.makeParentBinder=q,t.makeWithBinder=_}}),montageDefine("cab98f5","operators",{dependencies:["collections/shim-object","collections/shim-regexp","collections/map","collections/set"],factory:function(e,t){e("collections/shim-object"),e("collections/shim-regexp");var i=e("collections/map"),a=e("collections/set");t.toNumber=function(e){return+e},t.toString=function(e){return null==e?e:"string"==typeof e||"number"==typeof e?""+e:null},t.toArray=Array.from,t.toMap=i,t.toSet=a,t.not=function(e){return!e},t.neg=function(e){return-e},t.pow=function(e,t){return Math.pow(e,t)},t.root=function(e,t){return Math.pow(e,1/t)},t.log=function(e,t){return Math.log(e)/Math.log(t)},t.mul=function(e,t){return e*t},t.div=function(e,t){return e/t},t.mod=function(e,t){return(e%t+t)%t},t.rem=function(e,t){return e%t},t.add=function(e,t){return e+t},t.sub=function(e,t){return e-t},t.ceil=function(e){return Math.ceil(e)},t.floor=function(e){return Math.floor(e)},t.round=function(e){return Math.round(e)},t.lt=function(e,t){return 0>Object.compare(e,t)},t.gt=function(e,t){return Object.compare(e,t)>0},t.le=function(e,t){return 0>=Object.compare(e,t)},t.ge=function(e,t){return Object.compare(e,t)>=0},t.equals=Object.equals,t.compare=Object.compare,t.and=function(e,t){return e&&t},t.or=function(e,t){return e||t},t.defined=function(e){return null!=e},t.startsWith=function(e,t){var i=RegExp("^"+RegExp.escape(t));return i.test(e)},t.endsWith=function(e,t){var i=RegExp(RegExp.escape(t)+"$");return i.test(e)},t.contains=function(e,t){var i=RegExp(RegExp.escape(t));return i.test(e)},t.join=function(e,t){return e.join(t||"")},t.split=function(e,t){return e.split(t||"")},t.range=function(e){for(var t=[],i=0;e>i;i++)t.push(i);return t},t.last=function(e){return e.get(e.length-1)}}}),montageDefine("cab98f5","compute",{dependencies:["./parse","./compile-observer","./compile-binder","./observers","./scope"],factory:function(e,t,i){function a(e,t,i){i.target=e,i.targetPath=t;var a=i.source=i.source||e,o=i.args,c=i.compute,m=i.parameters=i.parameters||a,d=i.document,p=i.components,v=i.trace,h=i.sourceScope=new l(a);h.parameters=m,h.document=d,h.components=p;var g=i.targetScope=new l(e);g.parameters=m,g.document=d,g.components=p;var f=o.map(function(e){return s(e)}).map(function(e){if("rangeContent"===e.type){var t=u(e.args[0]);return r.makeRangeContentObserver(t)}if("mapContent"===e.type){var t=u(e.args[0]);return r.makeMapContentObserver(t)}return u(e)}),b=r.makeRangeContentObserver(r.makeObserversObserver(f)),q=r.makeComputerObserver(b,c,e),_=s(t),y=n(_);return y(q,h,g,i,v?{sourcePath:o.join(", "),targetPath:t}:void 0)}var s=e("./parse"),u=e("./compile-observer"),n=e("./compile-binder"),r=e("./observers"),l=e("./scope");i.exports=a}}),montageDefine("cab98f5","observe",{dependencies:["./parse","./compile-observer","./observers","./scope"],factory:function(e,t,i){function a(e,t,i){var a;a="function"==typeof i?{change:i}:i,a=a||o,a.source=e,a.sourcePath=t;var c=a.parameters=a.parameters||e,m=a.document,d=a.components,p=a.beforeChange,v=a.contentChange,h=new l(e);h.parameters=c,h.document=m,h.components=d,h.beforeChange=p;var g=s(t),f=u(g);return v===!0&&(f=n.makeRangeContentObserver(f)),f(r(function(t){if(t){if("function"!=typeof v)return a.change.apply(e,arguments);if("function"==typeof v)return t.addRangeChangeListener(v),function(){t.removeRangeChangeListener(v)}}}),h)}var s=e("./parse"),u=e("./compile-observer"),n=e("./observers"),r=n.autoCancelPrevious,l=e("./scope");i.exports=a;var o={}}}),montageDefine("cab98f5","merge",{dependencies:["collections/shim"],factory:function(e,t){"use strict";function i(e,t){for(var i,a=(t.length+1)*(e.length+1),s=Array(a),u=Array(t.length+1),n=Array(t.length+1),r=0;e.length+1>r;r++){for(var l=0;t.length+1>l;l++){var o,c;if(0===r&&0===l)o=" ",c=0;else if(0===r)o="insert",c=l;else if(0===l)o="delete",c=r;else if(e[r-1]===t[l-1])o="retain",c=n[l-1];else{var m=u[l-1],d=n[l];m>d?(o="delete",c=d+1):(o="insert",c=m+1)}s[r+l*(e.length+1)]=o,u[l]=c}i=u,u=n,n=i}return{edges:s,cost:n[t.length],source:t,target:e}}function a(e){for(var t,i,a=[],s=e.edges,u=t=e.target.length,n=e.source.length;t||n;){var r=s[t+n*(u+1)];if("delete"===r){if(i&&"delete"===i[0])i[1]++;else{var l=["delete",1];i=l,a.push(l)}t--}else if("insert"===r){if(i&&"insert"===i[0])i[1]++;else{var l=["insert",1];i=l,a.push(l)}n--}else if("retain"===r){var l=["retain",1];i&&"retain"===i[0]?i[1]++:(i=l,a.push(l)),t--,n--}}return a.reverse(),a}function s(e,t){return a(i(e,t))}function u(e,t){for(var i=s(e,t),a=[],u=0,n=0,r=0;i.length>r;){var l=i[r++];if("insert"===l[0])a.push([n,0,t.slice(n,n+l[1])]),n+=l[1];else if("delete"===l[0])if(i.length>r&&"insert"===i[r][0]){var o=i[r++];a.push([n,l[1],t.slice(n,n+o[1])]),u+=l[1],n+=o[1]}else a.push([n,l[1]]),u+=l[1];else"retain"==l[0]&&(u+=l[1],n+=l[1])}return a}function n(e,t){for(var i=0;t.length>i;i++)e.swap.apply(e,t[i])}function r(e,t){n(e,u(e,t))}e("collections/shim"),t.graphOt=i,t.traceOt=a,t.ot=s,t.diff=u,t.apply=n,t.merge=r}}),montageDefine("cab98f5","language",{dependencies:["collections/set","collections/dict"],factory:function(e,t){var i=e("collections/set"),a=e("collections/dict"),s=t.precedence=a(),u=t.precedenceLevels=[["tuple","record"],["literal","value","parameters","property","element","component","mapBlock","filterBlock","sortedBlock","groupBlock","groupMapBlock","with"],["not","neg","number","parent"],["scope"],["default"],["pow","root","log"],["mul","div","mod","rem"],["add","sub"],["equals","lt","gt","le","ge","compare"],["and"],["or"],["if"]];u.forEach(function(e){var t=i(s.keys());e.forEach(function(e){s.set(e,t)})});var n=t.operatorTokens=a({"**":"pow","//":"root","%%":"log","*":"mul","/":"div","%":"mod",rem:"rem","+":"add","-":"sub","<":"lt",">":"gt","<=":"le",">=":"ge","==":"equals","<=>":"compare","!=":"notEquals","??":"default","&&":"and","||":"or","?":"then",":":"else"});t.operatorTypes=a(n.map(function(e,t){return[e,t]}))}}),montageDefine("da18248","weak-map",{dependencies:[],factory:function(e,t,i){(function(){"use strict";function e(t){t.permitHostObjects___&&t.permitHostObjects___(e)}function t(e){return!(e.substr(0,p.length)==p&&"___"===e.substr(e.length-3))}function a(e){if(e!==Object(e))throw new TypeError("Not an object: "+e);var t=e[v];if(t&&t.key===e)return t;if(!d(e))return void 0;t={key:e};try{return m(e,v,{value:t,writable:!1,enumerable:!1,configurable:!1}),t}catch(i){return void 0}}function s(e){return e.prototype=null,Object.freeze(e)}function u(){b||"undefined"==typeof console||(b=!0,console.warn("WeakMap should be invoked as new WeakMap(), not WeakMap(). This will be an error in the future."))}if("undefined"==typeof ses||!ses.ok||ses.ok()){"undefined"!=typeof ses&&(ses.weakMapPermitHostObjects=e);var n=!1;if("function"==typeof WeakMap){var r=WeakMap;if("undefined"!=typeof navigator&&/Firefox/.test(navigator.userAgent));else{var l=new r,o=Object.freeze({});if(l.set(o,1),1===l.get(o))return i.exports=WeakMap,void 0;n=!0}}Object.prototype.hasOwnProperty;var c=Object.getOwnPropertyNames,m=Object.defineProperty,d=Object.isExtensible,p="weakmap:",v=p+"ident:"+Math.random()+"___";if("undefined"!=typeof crypto&&"function"==typeof crypto.getRandomValues&&"function"==typeof ArrayBuffer&&"function"==typeof Uint8Array){var h=new ArrayBuffer(25),g=new Uint8Array(h);crypto.getRandomValues(g),v=p+"rand:"+Array.prototype.map.call(g,function(e){return(e%36).toString(36)}).join("")+"___"}if(m(Object,"getOwnPropertyNames",{value:function(e){return c(e).filter(t)}}),"getPropertyNames"in Object){var f=Object.getPropertyNames;m(Object,"getPropertyNames",{value:function(e){return f(e).filter(t)}})}(function(){var e=Object.freeze;m(Object,"freeze",{value:function(t){return a(t),e(t)}});var t=Object.seal;m(Object,"seal",{value:function(e){return a(e),t(e)}});var i=Object.preventExtensions;m(Object,"preventExtensions",{value:function(e){return a(e),i(e)}})})();var b=!1,q=0,_=function(){function e(e,t){var i,s=a(e);return s?o in s?s[o]:t:(i=r.indexOf(e),i>=0?l[i]:t)}function t(e){var t=a(e);return t?o in t:r.indexOf(e)>=0}function i(e,t){var i,s=a(e);return s?s[o]=t:(i=r.indexOf(e),i>=0?l[i]=t:(i=r.length,l[i]=t,r[i]=e)),this}function n(e){var t,i,s=a(e);return s?o in s&&delete s[o]:(t=r.indexOf(e),0>t?!1:(i=r.length-1,r[t]=void 0,l[t]=l[i],r[t]=r[i],r.length=i,l.length=i,!0))}this instanceof _||u();var r=[],l=[],o=q++;return Object.create(_.prototype,{get___:{value:s(e)},has___:{value:s(t)},set___:{value:s(i)},delete___:{value:s(n)}})};_.prototype=Object.create(Object.prototype,{get:{value:function(e,t){return this.get___(e,t)},writable:!0,configurable:!0},has:{value:function(e){return this.has___(e)},writable:!0,configurable:!0},set:{value:function(e,t){return this.set___(e,t)},writable:!0,configurable:!0},"delete":{value:function(e){return this.delete___(e)},writable:!0,configurable:!0}}),"function"==typeof r?function(){function t(){function t(e,t){return c?o.has(e)?o.get(e):c.get___(e,t):o.get(e,t)}function i(e){return o.has(e)||(c?c.has___(e):!1)}function a(e){var t=!!o["delete"](e);return c?c.delete___(e)||t:t}this instanceof _||u();var l,o=new r,c=void 0,m=!1;return l=n?function(e,t){return o.set(e,t),o.has(e)||(c||(c=new _),c.set(e,t)),this}:function(e,t){if(m)try{o.set(e,t)}catch(i){c||(c=new _),c.set___(e,t)}else o.set(e,t);return this},Object.create(_.prototype,{get___:{value:s(t)},has___:{value:s(i)},set___:{value:s(l)},delete___:{value:s(a)},permitHostObjects___:{value:s(function(t){if(t!==e)throw Error("bogus call to permitHostObjects___");m=!0})}})}n&&"undefined"!=typeof Proxy&&(Proxy=void 0),t.prototype=_.prototype,i.exports=t,Object.defineProperty(WeakMap.prototype,"constructor",{value:WeakMap,enumerable:!1,configurable:!0,writable:!0})}():("undefined"!=typeof Proxy&&(Proxy=void 0),i.exports=_)}})()}});