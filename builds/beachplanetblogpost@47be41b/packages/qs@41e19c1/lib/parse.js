var Utils=require("./utils"),internals={delimiter:"&",depth:5,arrayLimit:20,parametersLimit:1e3};internals.parseValues=function(e,i){i="string"==typeof i?i:internals.delimiter;for(var t={},s=e.split(i,internals.parametersLimit),a=0,u=s.length;u>a;++a){var n=s[a],r=-1===n.indexOf("]=")?n.indexOf("="):n.indexOf("]=")+1;if(-1===r)t[Utils.decode(n)]="";else{var l=Utils.decode(n.slice(0,r)),o=Utils.decode(n.slice(r+1));t[l]=t[l]?[].concat(t[l]).concat(o):o}}return t},internals.parseObject=function(e,i){if(!e.length)return i;var t=e.shift(),s={};if("[]"===t)s=[],s=s.concat(internals.parseObject(e,i));else{var a="["===t[0]&&"]"===t[t.length-1]?t.slice(1,t.length-1):t,u=parseInt(a,10);!isNaN(u)&&t!==a&&internals.arrayLimit>=u?(s=[],s[u]=internals.parseObject(e,i)):s[a]=internals.parseObject(e,i)}return s},internals.parseKeys=function(e,i,t){if(e){var s=/^([^\[\]]*)/,a=/(\[[^\[\]]*\])/g,u=s.exec(e);if(!Object.prototype.hasOwnProperty(u[1])){var n=[];u[1]&&n.push(u[1]);for(var r=0;null!==(u=a.exec(e))&&t>r;)++r,Object.prototype.hasOwnProperty(u[1].replace(/\[|\]/g,""))||n.push(u[1]);return u&&n.push("["+e.slice(u.index)+"]"),internals.parseObject(n,i)}}},module.exports=function(e,i,t){if(""===e||null===e||e===void 0)return{};"number"!=typeof i&&(t=i,i=internals.depth);var s="string"==typeof e?internals.parseValues(e,t):Utils.clone(e),a={};for(var u in s)if(s.hasOwnProperty(u)){var n=internals.parseKeys(u,s[u],i);a=Utils.merge(a,n)}return Utils.compact(a)};