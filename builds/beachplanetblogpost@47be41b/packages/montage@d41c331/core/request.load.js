montageDefine("d41c331","core/request",{dependencies:["./promise"],factory:function(e,t,n){var i=e("./promise").Promise;t=n.exports=function(e){e=t.normalizeRequest(e);var n=i.defer(),r=e.xhr||new XMLHttpRequest;r.open(e.method,e.url,!0),r.onload=function(){var e={status:r.status,headers:t.parseResponseHeaders(r.getAllResponseHeaders()),body:r.response,xhr:r};n.resolve(e)},r.onerror=function(){n.reject(Error("Could not load"))};var a=e.headers;for(var s in a){var o=a[s];if(Array.isArray(o))for(var l=0;o.length>l;l++)r.setRequestHeader(s,o[l]);else r.setRequestHeader(s,o)}var c=e.options;for(var u in c)r[u]=c[u];return e.overrideMimeType&&r.overrideMimeType(e.overrideMimeType),r.send(e.body),n.promise},t.request=t,t.makeOk=function(e){return function(n){n=t.normalizeRequest(n);var r=n.url;return i.when(e(n),function(e){if(e.status>=200&&300>e.status)return e;var t=Error("Could not load "+JSON.stringify(r)+": "+e.status+" "+e.xhr.statusText);throw t.response=e,t})}},t.ok=t.makeOk(t.request),t.makeJson=function(e){return function(n){n=t.normalizeRequest(n);var r=n.url;return n.headers.accept=n.headers.accept||"application/json",n.headers["content-type"]=n.headers["content-type"]||"application/json","object"==typeof n.body&&(n.body=JSON.stringify(n.body)),n.overrideMimeType=n.overrideMimeType||"application/json",n.options.responseType=n.options.responseType||"json",i.when(e(n),function(e){if(null===e.body||"string"==typeof e.body)try{e.body=JSON.parse(e.body)}catch(t){throw Error("Could not parse JSON from "+JSON.stringify(r)+": "+t.message)}return e})}},t.json=t.makeJson(t.request),t.normalizeRequest=function(e){return"string"==typeof e&&(e={url:e}),e.method=e.method||"GET",e.headers=e.headers||{},e.options=e.options||{},e},t.parseResponseHeaders=function(e){var t={};return e?(e.replace(/^([^:]+):(.*)$/gm,function(e,n,i){n=n.trim().toLowerCase(),i=i.trim(),n in t?("string"==typeof t[n]&&(t[n]=[t[n]]),t[n].push(i)):t[n]=i}),t):t}}});