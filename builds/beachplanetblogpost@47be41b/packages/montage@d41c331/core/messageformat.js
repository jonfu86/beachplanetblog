(function(e){function t(e,n){var i;if(e&&n&&(t.locale[e]=n),i=e=e||"en",n=n||t.locale[i=t.Utils.getFallbackLocale(e)],!n)throw Error("Plural Function not found for locale: "+e);this.pluralFunc=n,this.locale=e,this.fallbackLocale=i}t.locale={en:function(e){return 1===e?"one":"other"}},t.SafeString=function(e){this.string=e},t.SafeString.prototype.toString=function(){return""+this.string},t.Utils={numSub:function(e,t,n){return e.replace(/^#|[^\\]#/g,function(e){var i=e&&2===e.length?e.charAt(0):"";return i+'" + (function(){ var x = '+t+';\nif( isNaN(x) ){\nthrow new Error("MessageFormat: `"+lastkey_'+n+'+"` isnt a number.");\n}\nreturn x;\n})() + "'})},escapeExpression:function(e){var n={"\n":"\\n",'"':'\\"'},i=/[\n"]/g,r=/[\n"]/,a=function(e){return n[e]||"&amp;"};return e instanceof t.SafeString?""+e:null===e||e===!1?"":r.test(e)?e.replace(i,a):e},getFallbackLocale:function(e){for(var n=e.indexOf("-")>=0?"-":"_";!t.locale.hasOwnProperty(e);)if(e=e.substring(0,e.lastIndexOf(n)),0===e.length)return null;return e}};var n=function(){var e={parse:function(e,t){function n(e,t,n){for(var i=e,r=n-e.length,a=0;r>a;a++)i=t+i;return i}function i(e){var t=e.charCodeAt(0);if(255>=t)var i="x",r=2;else var i="u",r=4;return"\\"+i+n(t.toString(16).toUpperCase(),"0",r)}function r(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/[\x80-\uFFFF]/g,i)+'"'}function a(e){O>P||(P>O&&(O=P,D=[]),D.push(e))}function s(){var e="start@"+P,t=z[e];if(t)return P=t.nextPos,t.result;var n=P,i=o(),r=null!==i?function(e){return{type:"program",program:e}}(i):null;if(null!==r)var a=r;else{var a=null;P=n}return z[e]={nextPos:P,result:a},a}function o(){var e="messageFormatPattern@"+P,t=z[e];if(t)return P=t.nextPos,t.result;var n=P,i=P,r=_();if(null!==r){for(var a=[],s=l();null!==s;){a.push(s);var s=l()}if(null!==a)var o=[r,a];else{var o=null;P=i}}else{var o=null;P=i}var c=null!==o?function(e,t){var n=[];e&&e.val&&n.push(e);for(var i in t)t.hasOwnProperty(i)&&n.push(t[i]);return{type:"messageFormatPattern",statements:n}}(o[0],o[1]):null;if(null!==c)var u=c;else{var u=null;P=n}return z[e]={nextPos:P,result:u},u}function l(){var t="messageFormatPatternRight@"+P,n=z[t];if(n)return P=n.nextPos,n.result;var i=P,r=P;if("{"===e.substr(P,1)){var s="{";P+=1}else{var s=null;A&&a('"{"')}if(null!==s){var o=x();if(null!==o){var l=c();if(null!==l){var u=x();if(null!==u){if("}"===e.substr(P,1)){var h="}";P+=1}else{var h=null;A&&a('"}"')}if(null!==h){var d=_();if(null!==d)var p=[s,o,l,u,h,d];else{var p=null;P=r}}else{var p=null;P=r}}else{var p=null;P=r}}else{var p=null;P=r}}else{var p=null;P=r}}else{var p=null;P=r}var m=null!==p?function(e,t){var n=[];return e&&n.push(e),t&&t.val&&n.push(t),{type:"messageFormatPatternRight",statements:n}}(p[2],p[5]):null;if(null!==m)var f=m;else{var f=null;P=i}return z[t]={nextPos:P,result:f},f}function c(){var t="messageFormatElement@"+P,n=z[t];if(n)return P=n.nextPos,n.result;var i=P,r=P,s=y();if(null!==s){var o=P;if(","===e.substr(P,1)){var l=",";P+=1}else{var l=null;A&&a('","')}if(null!==l){var c=u();if(null!==c)var h=[l,c];else{var h=null;P=o}}else{var h=null;P=o}var d=null!==h?h:"";if(null!==d)var p=[s,d];else{var p=null;P=r}}else{var p=null;P=r}var m=null!==p?function(e,t){var n={type:"messageFormatElement",argumentIndex:e};return t&&t.length?n.elementFormat=t[1]:n.output=!0,n}(p[0],p[1]):null;if(null!==m)var f=m;else{var f=null;P=i}return z[t]={nextPos:P,result:f},f}function u(){var t="elementFormat@"+P,n=z[t];if(n)return P=n.nextPos,n.result;var i=P,r=P,s=x();if(null!==s){if("plural"===e.substr(P,6)){var o="plural";P+=6}else{var o=null;A&&a('"plural"')}if(null!==o){var l=x();if(null!==l){if(","===e.substr(P,1)){var c=",";P+=1}else{var c=null;A&&a('","')}if(null!==c){var u=x();if(null!==u){var p=h();if(null!==p){var m=x();if(null!==m)var f=[s,o,l,c,u,p,m];else{var f=null;P=r}}else{var f=null;P=r}}else{var f=null;P=r}}else{var f=null;P=r}}else{var f=null;P=r}}else{var f=null;P=r}}else{var f=null;P=r}var g=null!==f?function(e,t){return{type:"elementFormat",key:e,val:t.val}}(f[1],f[5]):null;if(null!==g)var v=g;else{var v=null;P=i}if(null!==v)var _=v;else{var y=P,b=P,C=x();if(null!==C){if("select"===e.substr(P,6)){var L="select";P+=6}else{var L=null;A&&a('"select"')}if(null!==L){var w=x();if(null!==w){if(","===e.substr(P,1)){var M=",";P+=1}else{var M=null;A&&a('","')}if(null!==M){var E=x();if(null!==E){var T=d();if(null!==T){var S=x();if(null!==S)var O=[C,L,w,M,E,T,S];else{var O=null;P=b}}else{var O=null;P=b}}else{var O=null;P=b}}else{var O=null;P=b}}else{var O=null;P=b}}else{var O=null;P=b}}else{var O=null;P=b}var D=null!==O?function(e,t){return{type:"elementFormat",key:e,val:t.val}}(O[1],O[5]):null;if(null!==D)var R=D;else{var R=null;P=y}if(null!==R)var _=R;else var _=null}return z[t]={nextPos:P,result:_},_}function h(){var e="pluralStyle@"+P,t=z[e];if(t)return P=t.nextPos,t.result;var n=P,i=p(),r=null!==i?function(e){return{type:"pluralStyle",val:e}}(i):null;if(null!==r)var a=r;else{var a=null;P=n}return z[e]={nextPos:P,result:a},a}function d(){var e="selectStyle@"+P,t=z[e];if(t)return P=t.nextPos,t.result;var n=P,i=f(),r=null!==i?function(e){return{type:"selectStyle",val:e}}(i):null;if(null!==r)var a=r;else{var a=null;P=n}return z[e]={nextPos:P,result:a},a}function p(){var e="pluralFormatPattern@"+P,t=z[e];if(t)return P=t.nextPos,t.result;var n=P,i=P,r=m(),a=null!==r?r:"";if(null!==a){for(var s=[],o=g();null!==o;){s.push(o);var o=g()}if(null!==s)var l=[a,s];else{var l=null;P=i}}else{var l=null;P=i}var c=null!==l?function(e,t){var n={type:"pluralFormatPattern",pluralForms:t};return n.offset=e?e:0,n}(l[0],l[1]):null;if(null!==c)var u=c;else{var u=null;P=n}return z[e]={nextPos:P,result:u},u}function m(){var t="offsetPattern@"+P,n=z[t];if(n)return P=n.nextPos,n.result;var i=P,r=P,s=x();if(null!==s){if("offset"===e.substr(P,6)){var o="offset";P+=6}else{var o=null;A&&a('"offset"')}if(null!==o){var l=x();if(null!==l){if(":"===e.substr(P,1)){var c=":";P+=1}else{var c=null;A&&a('":"')}if(null!==c){var u=x();if(null!==u){var h=L();if(null!==h){var d=x();if(null!==d)var p=[s,o,l,c,u,h,d];else{var p=null;P=r}}else{var p=null;P=r}}else{var p=null;P=r}}else{var p=null;P=r}}else{var p=null;P=r}}else{var p=null;P=r}}else{var p=null;P=r}var m=null!==p?function(e){return e}(p[5]):null;if(null!==m)var f=m;else{var f=null;P=i}return z[t]={nextPos:P,result:f},f}function f(){var e="selectFormatPattern@"+P,t=z[e];if(t)return P=t.nextPos,t.result;for(var n=P,i=[],r=g();null!==r;){i.push(r);var r=g()}var a=null!==i?function(e){return{type:"selectFormatPattern",pluralForms:e}}(i):null;if(null!==a)var s=a;else{var s=null;P=n}return z[e]={nextPos:P,result:s},s}function g(){var t="pluralForms@"+P,n=z[t];if(n)return P=n.nextPos,n.result;var i=P,r=P,s=x();if(null!==s){var l=v();if(null!==l){var c=x();if(null!==c){if("{"===e.substr(P,1)){var u="{";P+=1}else{var u=null;A&&a('"{"')}if(null!==u){var h=x();if(null!==h){var d=o();if(null!==d){var p=x();if(null!==p){if("}"===e.substr(P,1)){var m="}";P+=1}else{var m=null;A&&a('"}"')}if(null!==m)var f=[s,l,c,u,h,d,p,m];else{var f=null;P=r}}else{var f=null;P=r}}else{var f=null;P=r}}else{var f=null;P=r}}else{var f=null;P=r}}else{var f=null;P=r}}else{var f=null;P=r}}else{var f=null;P=r}var g=null!==f?function(e,t){return{type:"pluralForms",key:e,val:t}}(f[1],f[5]):null;if(null!==g)var _=g;else{var _=null;P=i}return z[t]={nextPos:P,result:_},_}function v(){var t="stringKey@"+P,n=z[t];if(n)return P=n.nextPos,n.result;var i=P,r=y(),s=null!==r?function(e){return e}(r):null;if(null!==s)var o=s;else{var o=null;P=i}if(null!==o)var l=o;else{var c=P,u=P;if("="===e.substr(P,1)){var h="=";P+=1}else{var h=null;A&&a('"="')}if(null!==h){var d=L();if(null!==d)var p=[h,d];else{var p=null;P=u}}else{var p=null;P=u}var m=null!==p?function(e){return e}(p[1]):null;if(null!==m)var f=m;else{var f=null;P=c}if(null!==f)var l=f;else var l=null}return z[t]={nextPos:P,result:l},l}function _(){var e="string@"+P,t=z[e];if(t)return P=t.nextPos,t.result;var n=P,i=P,r=x();if(null!==r){var a=[],s=P,o=x();if(null!==o){var l=b();if(null!==l){var c=x();if(null!==c)var u=[o,l,c];else{var u=null;P=s}}else{var u=null;P=s}}else{var u=null;P=s}for(;null!==u;){a.push(u);var s=P,o=x();if(null!==o){var l=b();if(null!==l){var c=x();if(null!==c)var u=[o,l,c];else{var u=null;P=s}}else{var u=null;P=s}}else{var u=null;P=s}}if(null!==a)var h=[r,a];else{var h=null;P=i}}else{var h=null;P=i}var d=null!==h?function(e,t){for(var n=[],i=0;t.length>i;++i)for(var r=0;t[i].length>r;++r)n.push(t[i][r]);return{type:"string",val:e+n.join("")}}(h[0],h[1]):null;if(null!==d)var p=d;else{var p=null;P=n}return z[e]={nextPos:P,result:p},p}function y(){var t="id@"+P,n=z[t];if(n)return P=n.nextPos,n.result;var i=P,r=P,s=x();if(null!==s){if(null!==e.substr(P).match(/^[a-zA-Z$_]/)){var o=e.charAt(P);P++}else{var o=null;A&&a("[a-zA-Z$_]")}if(null!==o){var l=[];if(null!==e.substr(P).match(/^[^ 	\n\r,.+={}]/)){var c=e.charAt(P);P++}else{var c=null;A&&a("[^ 	\\n\\r,.+={}]")}for(;null!==c;)if(l.push(c),null!==e.substr(P).match(/^[^ 	\n\r,.+={}]/)){var c=e.charAt(P);P++}else{var c=null;A&&a("[^ 	\\n\\r,.+={}]")}if(null!==l){var u=x();if(null!==u)var h=[s,o,l,u];else{var h=null;P=r}}else{var h=null;P=r}}else{var h=null;P=r}}else{var h=null;P=r}var d=null!==h?function(e,t){return e+(t?t.join(""):"")}(h[1],h[2]):null;if(null!==d)var p=d;else{var p=null;P=i}return z[t]={nextPos:P,result:p},p}function b(){var e="chars@"+P,t=z[e];if(t)return P=t.nextPos,t.result;var n=P,i=C();if(null!==i)for(var r=[];null!==i;){r.push(i);var i=C()}else var r=null;var a=null!==r?function(e){return e.join("")}(r):null;if(null!==a)var s=a;else{var s=null;P=n}return z[e]={nextPos:P,result:s},s}function C(){var t="char@"+P,n=z[t];if(n)return P=n.nextPos,n.result;var i=P;if(null!==e.substr(P).match(/^[^{}\\\0- 	\n\r]/)){var r=e.charAt(P);P++}else{var r=null;A&&a("[^{}\\\\\\0- 	\\n\\r]")}var s=null!==r?function(e){return e}(r):null;if(null!==s)var o=s;else{var o=null;P=i}if(null!==o)var l=o;else{var c=P;if("\\#"===e.substr(P,2)){var u="\\#";P+=2}else{var u=null;A&&a('"\\\\#"')}var h=null!==u?function(){return"\\#"}():null;if(null!==h)var d=h;else{var d=null;P=c}if(null!==d)var l=d;else{var p=P;if("\\{"===e.substr(P,2)){var m="\\{";P+=2}else{var m=null;A&&a('"\\\\{"')}var f=null!==m?function(){return"{"}():null;if(null!==f)var g=f;else{var g=null;P=p}if(null!==g)var l=g;else{var v=P;if("\\}"===e.substr(P,2)){var _="\\}";P+=2}else{var _=null;A&&a('"\\\\}"')}var y=null!==_?function(){return"}"}():null;if(null!==y)var b=y;else{var b=null;P=v}if(null!==b)var l=b;else{var C=P,L=P;if("\\u"===e.substr(P,2)){var x="\\u";P+=2}else{var x=null;A&&a('"\\\\u"')}if(null!==x){var M=w();if(null!==M){var E=w();if(null!==E){var T=w();if(null!==T){var S=w();if(null!==S)var O=[x,M,E,T,S];else{var O=null;P=L}}else{var O=null;P=L}}else{var O=null;P=L}}else{var O=null;P=L}}else{var O=null;P=L}var D=null!==O?function(e,t,n,i){return String.fromCharCode(parseInt("0x"+e+t+n+i))}(O[1],O[2],O[3],O[4]):null;if(null!==D)var R=D;else{var R=null;P=C}if(null!==R)var l=R;else var l=null}}}}return z[t]={nextPos:P,result:l},l}function L(){var t="digits@"+P,n=z[t];if(n)return P=n.nextPos,n.result;var i=P;if(null!==e.substr(P).match(/^[0-9]/)){var r=e.charAt(P);P++}else{var r=null;A&&a("[0-9]")}if(null!==r)for(var s=[];null!==r;)if(s.push(r),null!==e.substr(P).match(/^[0-9]/)){var r=e.charAt(P);P++}else{var r=null;A&&a("[0-9]")}else var s=null;var o=null!==s?function(e){return parseInt(e.join(""),10)}(s):null;if(null!==o)var l=o;else{var l=null;P=i}return z[t]={nextPos:P,result:l},l}function w(){var t="hexDigit@"+P,n=z[t];if(n)return P=n.nextPos,n.result;if(null!==e.substr(P).match(/^[0-9a-fA-F]/)){var i=e.charAt(P);P++}else{var i=null;A&&a("[0-9a-fA-F]")}return z[t]={nextPos:P,result:i},i}function x(){var e="_@"+P,t=z[e];if(t)return P=t.nextPos,t.result;var n=A;A=!1;for(var i=P,r=[],s=M();null!==s;){r.push(s);var s=M()}var o=null!==r?function(e){return e.join("")}(r):null;if(null!==o)var l=o;else{var l=null;P=i}return A=n,A&&null===l&&a("whitespace"),z[e]={nextPos:P,result:l},l}function M(){var t="whitespace@"+P,n=z[t];if(n)return P=n.nextPos,n.result;if(null!==e.substr(P).match(/^[ 	\n\r]/)){var i=e.charAt(P);P++}else{var i=null;A&&a("[ 	\\n\\r]")}return z[t]={nextPos:P,result:i},i}function E(){function t(e){e.sort();for(var t=null,n=[],i=0;e.length>i;i++)e[i]!==t&&(n.push(e[i]),t=e[i]);switch(n.length){case 0:return"end of input";case 1:return n[0];default:return n.slice(0,n.length-1).join(", ")+" or "+n[n.length-1]}}var n=t(D),i=Math.max(P,O),a=e.length>i?r(e.charAt(i)):"end of input";return"Expected "+n+" but "+a+" found."}function T(){for(var t=1,n=1,i=!1,r=0;O>r;r++){var a=e.charAt(r);"\n"===a?(i||t++,n=1,i=!1):"\r"===a|"\u2028"===a||"\u2029"===a?(t++,n=1,i=!0):(n++,i=!1)}return{line:t,column:n}}var S={_:x,"char":C,chars:b,digits:L,elementFormat:u,hexDigit:w,id:y,messageFormatElement:c,messageFormatPattern:o,messageFormatPatternRight:l,offsetPattern:m,pluralFormatPattern:p,pluralForms:g,pluralStyle:h,selectFormatPattern:f,selectStyle:d,start:s,string:_,stringKey:v,whitespace:M};if(void 0!==t){if(void 0===S[t])throw Error("Invalid rule name: "+r(t)+".")}else t="start";var P=0,A=!0,O=0,D=[],z={},R=S[t]();if(null===R||P!==e.length){var I=T();throw new this.SyntaxError(E(),I.line,I.column)}return R},toSource:function(){return this._source}};return e.SyntaxError=function(e,t,n){this.name="SyntaxError",this.message=e,this.line=t,this.column=n},e.SyntaxError.prototype=Error.prototype,e}();t.prototype.parse=function(){return n.parse.apply(n,arguments)},t.prototype.precompile=function(e){function n(e,s){s=s||{};var o,l,c,u="";switch(e.type){case"program":return n(e.program);case"messageFormatPattern":for(o=0;e.statements.length>o;++o)u+=n(e.statements[o],s);return a.begin+u+a.end;case"messageFormatPatternRight":for(o=0;e.statements.length>o;++o)u+=n(e.statements[o],s);return u;case"messageFormatElement":return s.pf_count=s.pf_count||0,u+='if(!d){\nthrow new Error("MessageFormat: No data passed to function.");\n}\n',e.output?u+='r += d["'+e.argumentIndex+'"];\n':(c="lastkey_"+(s.pf_count+1),u+="var "+c+' = "'+e.argumentIndex+'";\n',u+="var k_"+(s.pf_count+1)+"=d["+c+"];\n",u+=n(e.elementFormat,s)),u;case"elementFormat":return"select"===e.key?(u+=n(e.val,s),u+="r += (pf_"+s.pf_count+"[ k_"+(s.pf_count+1)+" ] || pf_"+s.pf_count+'[ "other" ])( d );\n'):"plural"===e.key&&(u+=n(e.val,s),u+="if ( pf_"+s.pf_count+"[ k_"+(s.pf_count+1)+' + "" ] ) {\n',u+="r += pf_"+s.pf_count+"[ k_"+(s.pf_count+1)+' + "" ]( d ); \n',u+="}\nelse {\n",u+="r += (pf_"+s.pf_count+'[ MessageFormat.locale["'+i.fallbackLocale+'"]( k_'+(s.pf_count+1)+" - off_"+s.pf_count+" ) ] || pf_"+s.pf_count+'[ "other" ] )( d );\n',u+="}\n"),u;case"pluralFormatPattern":for(s.pf_count=s.pf_count||0,u+="var off_"+s.pf_count+" = "+e.offset+";\n",u+="var pf_"+s.pf_count+" = { \n",r=!0,o=0;e.pluralForms.length>o;++o)"other"===e.pluralForms[o].key&&(r=!1),l?u+=",\n":l=1,u+='"'+e.pluralForms[o].key+'" : '+n(e.pluralForms[o].val,function(){var e=JSON.parse(JSON.stringify(s));return e.pf_count++,e}());if(u+="\n};\n",r)throw Error("No 'other' form found in pluralFormatPattern "+s.pf_count);return u;case"selectFormatPattern":for(s.pf_count=s.pf_count||0,u+="var off_"+s.pf_count+" = 0;\n",u+="var pf_"+s.pf_count+" = { \n",r=!0,o=0;e.pluralForms.length>o;++o)"other"===e.pluralForms[o].key&&(r=!1),l?u+=",\n":l=1,u+='"'+e.pluralForms[o].key+'" : '+n(e.pluralForms[o].val,function(){var e=JSON.parse(JSON.stringify(s));return e.pf_count++,e}());if(u+="\n};\n",r)throw Error("No 'other' form found in selectFormatPattern "+s.pf_count);return u;case"string":return'r += "'+t.Utils.numSub(t.Utils.escapeExpression(e.val),"k_"+s.pf_count+" - off_"+(s.pf_count-1),s.pf_count)+'";\n';default:throw Error("Bad AST type: "+e.type)}}var i=this,r=!1,a={begin:'function(d){\nvar r = "";\n',end:"return r;\n}"};return n(e)},t.prototype.compile=function(e){return Function("MessageFormat","return "+this.precompile(this.parse(e)))(t)},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=t),exports.MessageFormat=t):"function"==typeof define&&define.amd?define(function(){return t}):e.MessageFormat=t})(this);