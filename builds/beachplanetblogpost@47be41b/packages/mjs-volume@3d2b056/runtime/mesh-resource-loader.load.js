montageDefine("3d2b056","runtime/mesh-resource-loader",{dependencies:["runtime/resource-loader"],factory:function(t,e){var n=t("runtime/resource-loader").ResourceLoader;e.MeshResourceLoader=Object.create(n,{meshes:{value:null,writable:!0},fireMeshesDidLoadIfNeeded:{value:function(){var t=Object.keys(this._trackedIds);t&&0==t.length&&this.delegate&&this.delegate.meshesDidLoad&&this.delegate.meshesDidLoad(this.meshes)}},resourceAvailable:{value:function(t){this._removeTrackedId(t),this.fireMeshesDidLoadIfNeeded()}},_fetchResources:{value:function(t,e){var n=this.webGLRenderer.webGLContext,i=Object.keys(e);i.forEach(function(i){var a=this.webGLRenderer.resourceManager.getResource(e[i],t,n);null==a&&this._addTrackedId(i)},this)}},_fetchAllResources:{value:function(t){this.webGLRenderer.webGLContext,this._fetchResources(this.webGLRenderer.vertexAttributeBufferDelegate,t.vertexBuffers,!0),this._fetchResources(this.webGLRenderer.indicesDelegate,t.allIndices),this._fetchResources(this.webGLRenderer.textureDelegate,t.textures),this._fetchResources(this.webGLRenderer.programDelegate,t.programs),this.fireMeshesDidLoadIfNeeded()}},_trackProgramsFromMaterial:{value:function(t,e){var n=t.technique;if(n)for(var i in n.passes){var a=n.passes[i],r=a.instanceProgram;r&&(e[r.program.id]=r.program,this._addTrackedId(r.program.id))}}},_trackTexturesFromMaterial:{value:function(t,e){var n=t.parameters;if(n){var i=Object.keys(n);i.length>0&&i.forEach(function(t){var i=n[t];if(i&&i.value){var a=i.value;"texture"===a.type&&(e[a.id]=a,this._addTrackedId(a.id))}},this)}}},_trackIndicesFromPrimitive:{value:function(t,e){var n=t.indices;e[n.id]=n,this._addTrackedId(n.id)}},_trackVertexBuffersFromPrimitive:{value:function(t,e){for(var n in t.semantics){var i=t.semantics[n];e[i.id]=i,this._addTrackedId(i.id)}}},_trackMesh:{value:function(t,e){t.primitives.forEach(function(t){this._trackTexturesFromMaterial(t.material,e.textures),this._trackIndicesFromPrimitive(t,e.allIndices),this._trackVertexBuffersFromPrimitive(t,e.vertexBuffers),this._trackProgramsFromMaterial(t.material,e.programs)},this)}},_trackMeshes:{value:function(t){this.meshes.forEach(function(e){this._trackMesh(e,t,this.webGLRenderer)},this)}},loadMeshes:{value:function(){var t={};t.textures={},t.allIndices={},t.vertexBuffers={},t.programs={},this._trackMeshes(t),this._fetchAllResources(t,this.webGLRenderer)}},init:{value:function(t,e,n){return this.delegate=n,this.webGLRenderer=e,this.meshes=t,e.resourceManager.observers.push(this),this}}})}});