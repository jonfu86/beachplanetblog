montageDefine("3d2b056","runtime/glsl-program",{dependencies:["runtime/dependencies/gl-matrix"],factory:function(t,e){t("runtime/dependencies/gl-matrix");var n=e.GLSLProgram=Object.create(Object.prototype,{VERTEX_SHADER:{value:"x-shader/x-vertex"},FRAGMENT_SHADER:{value:"x-shader/x-fragment"},_shaders:{enumerable:!1,value:null,writable:!0},shaders:{enumerable:!1,get:function(){return this._shaders},set:function(t){this._shaders=t}},_errorLogs:{enumerable:!1,value:null,writable:!0},errorLogs:{enumerable:!1,get:function(){return this._errorLogs},set:function(t){this._errorLogs=t}},_pendingCommits:{value:null,writable:!0},pendingCommits:{get:function(){return this._pendingCommits},set:function(t){this._pendingCommits=t}},_symbolToLocation:{value:null,writable:!0},symbolToLocation:{enumerable:!1,get:function(){return this._symbolToLocation},set:function(t){this._symbolToLocation=t}},_symbolToActiveInfo:{enumerable:!1,value:null,writable:!0},symbolToActiveInfo:{get:function(){return this._symbolToActiveInfo},set:function(t){this._symbolToActiveInfo=t}},_semanticToSymbol:{value:null,writable:!0},semanticToSymbol:{enumerable:!1,get:function(){return this._semanticToSymbol},set:function(t){this._semanticToSymbol=t}},_symbolToSemantic:{value:null,writable:!0},symbolToSemantic:{get:function(){return this._symbolToSemantic},set:function(t){this._symbolToSemantic=t}},_symbolToValue:{value:null,writable:!0},symbolToValue:{get:function(){return this._symbolToValue},set:function(t){this._symbolToValue=t}},_uniformSymbols:{value:null,writable:!0},uniformSymbols:{enumerable:!1,get:function(){return this._uniformSymbols},set:function(t){this._uniformSymbols=t}},_attributeSymbols:{value:null,writable:!0},attributeSymbols:{enumerable:!1,get:function(){return this._attributeSymbols},set:function(t){this._attributeSymbols=t}},_GLProgram:{enumerable:!1,value:null,writable:!0},GLProgram:{enumerable:!1,get:function(){return this._GLProgram},set:function(t){this._GLProgram=t}},getTypeForSymbol:{value:function(t){var e=null,n=this.symbolToActiveInfo[t];return n&&(e=n.type),e}},getLocationForSymbol:{value:function(t){return this.symbolToLocation[t]}},getSymbolForSemantic:{value:function(t){return this.semanticToSymbol[t]}},setSymbolForSemantic:{value:function(t,e){if("none"===t&&(t=null),"none"===e&&(e=null),!this.symbolToActiveInfo[t])return!1;if(e&&this.semanticToSymbol[e])return!1;if(t){var n=this.symbolToSemantic[t];n&&n!==e&&(this.semanticToSymbol[n]=null),this.symbolToSemantic[t]=e}return e&&(this.semanticToSymbol[e]=t),!0}},setSemanticForSymbol:{value:function(t,e){this.setSymbolForSemantic(t,e)}},getSemanticForSymbol:{value:function(t){return this.symbolToSemantic[t]}},setValueForSymbol:{value:function(t,e){var n=this.symbolToValue[t],i=this.getTypeForSymbol(t),a=WebGLRenderingContext.prototype;if(null!=e&&null!=n){if(i===a.FLOAT){if(e===n)return}else if(i===a.FLOAT_MAT4){if(16==e.length&&mat4.equal(n,e))return}else if(i===a.FLOAT_MAT3){if(9==e.length&&mat3.equal(n,e))return}else if(i===a.FLOAT_VEC3){if(3==e.length&&vec3.equal(n,e))return}else if(i===a.FLOAT_VEC4){if(4==e.length&&vec4.equal(n,e))return}else if(i===a.FLOAT_VEC2&&2==e.length&&vec4.equal(n,e))return}else i===a.FLOAT_MAT4?16===e.length&&(n=mat4.create()):i===a.FLOAT_MAT3?n=mat3.create():i===a.FLOAT_VEC3?n=vec3.create():i===a.FLOAT_VEC4?n=vec4.create():i===a.FLOAT_VEC2&&(n=vec2.create());null!==this.symbolToActiveInfo[t]&&-1===this.pendingCommits.indexOf(t)&&this.pendingCommits.push(t),null!=e&&(i===a.FLOAT_MAT4?16===e.length&&(e=mat4.set(e,n)):i===a.FLOAT_MAT3?e=mat3.set(e,n):i===a.FLOAT_VEC3?e=vec3.set(e,n):i===a.FLOAT_VEC4?e=vec4.set(e,n):i===a.FLOAT_VEC2&&(e=vec2.set(e,n))),this.symbolToValue[t]=e}},getValueForSymbol:{value:function(t){return this.symbolToValue[t]}},_commitSwitch:{value:function(){var t=WebGLRenderingContext.prototype,e=[];return e[t.FLOAT_MAT2]=function(t,e,n,i){t.uniformMatrix2fv(e,n,i)},e[t.FLOAT_MAT3]=function(t,e,n,i){t.uniformMatrix3fv(e,n,i)},e[t.FLOAT_MAT4]=function(t,e,n,i){t.uniformMatrix4fv(e,n,i)},e[t.FLOAT]=function(t,e,n,i){t.uniform1f(e,i)},e[t.FLOAT_VEC2]=function(t,e,n,i){t.uniform2fv(e,i)},e[t.FLOAT_VEC3]=function(t,e,n,i){t.uniform3fv(e,i)},e[t.FLOAT_VEC4]=function(t,e,n,i){t.uniform4fv(e,i)},e[t.INT]=function(t,e,n,i){t.uniform1i(e,i)},e[t.SAMPLER_2D]=function(t,e,n,i){t.uniform1i(e,i)},e[t.SAMPLER_CUBE]=function(t,e,n,i){t.uniform1i(e,i)},e}()},commit:{value:function(t){if(this.pendingCommits.length){for(var e,n=this.pendingCommits.length-1;e=this.pendingCommits[n--];)this._commitSwitch[this.getTypeForSymbol(e)](t,this.symbolToLocation[e],!1,this.getValueForSymbol(e));this.pendingCommits.length=0}}},use:{value:function(t,e){t.useProgram(this.GLProgram),e&&this.commit(t)}},createShaderWithSourceAndType:{value:function(t,e,n){var i;if("x-shader/x-fragment"===n)i=t.createShader(t.FRAGMENT_SHADER);else{if("x-shader/x-vertex"!==n)return null;i=t.createShader(t.VERTEX_SHADER)}return t.shaderSource(i,e),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS)?i:(this.errorLogs=t.getShaderInfoLog(i),null)}},build:{value:function(t){var e,i,a=this.shaders[n.VERTEX_SHADER],r=this.shaders[n.FRAGMENT_SHADER],s=!1,o=this.createShaderWithSourceAndType(t,a,n.VERTEX_SHADER);if(null==o)return!1;var l=this.createShaderWithSourceAndType(t,r,n.FRAGMENT_SHADER);if(null==l)return!1;if(this.GLProgram=t.createProgram(),t.attachShader(this.GLProgram,o),t.attachShader(this.GLProgram,l),t.linkProgram(this.GLProgram),t.getProgramParameter(this.GLProgram,t.LINK_STATUS)){this.pendingCommits=[],this.symbolToActiveInfo={},this.symbolToValue={},this.symbolToLocation={},this.uniformSymbols=[],this.attributeSymbols=[],this.symbolToSemantic={},this.semanticToSymbol={};var c=t.getParameter(t.CURRENT_PROGRAM);t.useProgram(this.GLProgram);var h=t.getProgramParameter(this.GLProgram,t.ACTIVE_UNIFORMS);for(e=0;h>e;e++){i=t.getActiveUniform(this.GLProgram,e);var u=i.name,p=u.indexOf("[0]");-1!=p&&(u=u.substring(0,p)),this.symbolToActiveInfo[u]=i,this.symbolToLocation[u]=t.getUniformLocation(this.GLProgram,u),this.uniformSymbols.push(u)}var d=t.getProgramParameter(this.GLProgram,t.ACTIVE_ATTRIBUTES);for(e=0;d>e;e++)i=t.getActiveAttrib(this.GLProgram,e),this.symbolToActiveInfo[i.name]=i,this.symbolToLocation[i.name]=t.getAttribLocation(this.GLProgram,i.name),this.attributeSymbols.push(i.name);s=!0,t.useProgram(c)}return this.errorLogs=t.getProgramInfoLog(this.GLProgram),s}},initWithShaders:{value:function(t){this.shaders=t}},initWithProgram:{value:function(t){this.shaders=t.shaders,this.semanticToSymbol=t.semanticToSymbol,this.symbolToSemantic=t.symbolToSemantic}}})}});