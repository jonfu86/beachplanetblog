montageDefine("3d2b056","runtime/utilities",{dependencies:["runtime/dependencies/gl-matrix"],factory:function(t,e){t("runtime/dependencies/gl-matrix"),e.BBox=Object.create(Object.prototype,{_dirty:{value:!0,writable:!0},_size:{value:null,writable:!0},_min:{value:null,writable:!0},_max:{value:null,writable:!0},min:{get:function(){return this._min},set:function(t){this._min=t,this._dirty=!0}},max:{get:function(){return this._max},set:function(t){this._max=t,this._dirty=!0}},init:{value:function(t,e){return this.min=t,this.max=e,this}},size:{get:function(){if(this._dirty){var t=this.min,e=this.max;this._size=[e[0]-t[0],e[1]-t[1],e[2]-t[2]],this._dirty=!1}return this._size}},computeScaleFactor:{value:function(){var t=this.size,e=t[0]>t[1]?t[0]:t[1];return e=t[2]>e?t[2]:e,e=1/e}},computeUnitMatrix:{value:function(t){var e=this.size,n=this.min;null==t&&(t=[0,0,0]);var i=this.computeScaleFactor(),r=mat4.scale(mat4.identity(),[i,i,i]),a=vec3.createFrom(t[0]-(e[0]/2+n[0]),t[1]-(e[1]/2+n[1]),t[2]-(e[2]/2+n[2])),s=mat4.translate(r,[a[0],a[1],a[2]]);return s}}}),e.Utilities=Object.create(Object.prototype,{vec3Min:{value:function(t,e){e[0]<t[0]&&(t[0]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[2]<t[2]&&(t[2]=e[2])}},vec3Max:{value:function(t,e){e[0]>t[0]&&(t[0]=e[0]),e[1]>t[1]&&(t[1]=e[1]),e[2]>t[2]&&(t[2]=e[2])}},mergeBBox:{value:function(t,e){var n=t[0],i=t[1],r=e[0],a=e[1],s=[n[0]<r[0]?n[0]:r[0],n[1]<r[1]?n[1]:r[1],n[2]<r[2]?n[2]:r[2]],o=[i[0]>a[0]?i[0]:a[0],i[1]>a[1]?i[1]:a[1],i[2]>a[2]?i[2]:a[2]];return[s,o]}},computeBBOXFromVec3Array:{value:function(t){if(0===t.length)return null;for(var e=[t[0][0],t[0][1],t[0][2]],n=[t[0][0],t[0][1],t[0][2]],i=0;8>i;i++)t[i][0]<e[0]&&(e[0]=t[i][0]),t[i][1]<e[1]&&(e[1]=t[i][1]),t[i][2]<e[2]&&(e[2]=t[i][2]),t[i][0]>n[0]&&(n[0]=t[i][0]),t[i][1]>n[1]&&(n[1]=t[i][1]),t[i][2]>n[2]&&(n[2]=t[i][2]);return[e,n]}},transformBBox:{value:function(t,e){var n=t[0],i=t[1],r=0,a=1,s=2,o=mat4.multiplyVec3(e,vec3.createFrom(n[r],n[a],n[s])),l=mat4.multiplyVec3(e,vec3.createFrom(i[r],n[a],n[s])),c=mat4.multiplyVec3(e,vec3.createFrom(n[r],i[a],n[s])),h=mat4.multiplyVec3(e,vec3.createFrom(i[r],i[a],n[s])),u=mat4.multiplyVec3(e,vec3.createFrom(n[r],n[a],i[s])),p=mat4.multiplyVec3(e,vec3.createFrom(i[r],n[a],i[s])),d=mat4.multiplyVec3(e,vec3.createFrom(n[r],i[a],i[s])),m=mat4.multiplyVec3(e,vec3.createFrom(i[r],i[a],i[s]));return this.computeBBOXFromVec3Array([o,l,c,h,u,p,d,m])}},rayIntersectsMesh:{value:function(t,e,n,i,r){var a=e.verticesBuffer;if(null===a)return!1;var s=!1,o=e.primitives.length;vec3.create(),vec3.create(),vec3.create();for(var l=0;o>l;l++){var c=e.primitives[l];if(r){var h=r.materials;if(h&&-1==h.indexOf(c.material.name))continue}if(!(null!==c.material.inputs.transparency&&c.material.inputs.transparency!==void 0&&1>c.material.inputs.transparency)){var u=c.boundingBox;if(this.intersectsBBOX(u,t))return!0}}return s}},intersectsBBOX:{value:function(t,e){var n,i,r,a,s,o,l=0,c=1,h=2,u=e[1],p=e[0],d=t[0],m=t[1];return u[l]>=0?(n=(d[l]-p[l])/u[l],i=(m[l]-p[l])/u[l]):(n=(m[l]-p[l])/u[l],i=(d[l]-p[l])/u[l]),u[c]>=0?(r=(d[c]-p[c])/u[c],a=(m[c]-p[c])/u[c]):(r=(m[c]-p[c])/u[c],a=(d[c]-p[c])/u[c]),n>a||r>i?!1:(r>n&&(n=r),i>a&&(i=a),u[h]>=0?(s=(d[h]-p[h])/u[h],o=(m[h]-p[h])/u[h]):(s=(m[h]-p[h])/u[h],o=(d[h]-p[h])/u[h]),n>o||s>i?!1:(s>n&&(n=s),i>o&&(i=o),!0))}},inverpolateAxisAngle:{value:function(t,e,n,r){var a=0,s=1,o=2,l=s,c=t,h=e;if(l==a){vec3.normalize(c),vec3.normalize(h);var u=vec3.create();vec3.cross(c,h,u),Math.sqrt(vec3.dot(c,c)),Math.sqrt(vec3.dot(h,h));var p=Math.acos(vec3.dot(c,h)),d=mat4.identity();mat4.rotate(d,p*n,u),mat4.multiplyVec3(d,c,u),vec3.normalize(u);var m=c[3]+(h[3]-c[3])*n;quat4.fromAngleAxis(m,u,r)}else if(l==s){for(i=0;r.length>i;i++){var g=c[i],f=h[i];h[i]=g+(f-g)*n}quat4.fromAngleAxis(h[3],h,r)}else l==o&&quat4.slerp(t,e,n,r)}},interpolateVec:{value:function(t,e,n,r){for(i=0;r.length>i;i++){var a=t[i],s=e[i];r[i]=a+(s-a)*n}}},idx:{value:function(t,e){return 4*t+e}},decomposeMat4:{value:function(t,e,n,i){var r,a,s=mat4.create(),o=mat4.create();mat4.create(),mat4.create();var l=[vec3.create(),vec3.create(),vec3.create()];mat4.set(t,s);var c,h;for(r=0;4>r;r++)for(a=0;4>a;a++)c=this.idx(r,a),h=this.idx(3,3),s[c]/=s[h];for(mat4.set(s,o),r=0;3>r;r++)c=this.idx(r,3),o[c]=0;for(c=this.idx(3,3),o[c]=1,(0!=s[this.idx(0,3)]||0!=s[this.idx(1,3)]||0!=s[this.idx(2,3)])&&(s[this.idx(0,3)]=0,s[this.idx(1,3)]=0,s[this.idx(2,3)]=0,s[this.idx(3,3)]=1),e&&(e[0]=s[this.idx(3,0)],e[1]=s[this.idx(3,1)],e[2]=s[this.idx(3,2)]),s[this.idx(3,0)]=0,s[this.idx(3,1)]=0,s[this.idx(3,2)]=0,r=0;3>r;r++)l[r][0]=s[this.idx(r,0)],l[r][1]=s[this.idx(r,1)],l[r][2]=s[this.idx(r,2)];null!=i&&(i[0]=vec3.length(l[0]),i[1]=vec3.length(l[1]),i[2]=vec3.length(l[2])),vec3.normalize(l[0]),vec3.normalize(l[1]),vec3.normalize(l[2]);var u=vec3.create();if(vec3.cross(l[1],l[2],u),0>vec3.dot(l[0],u))for(r=0;3>r;r++)null!=i&&(i[r]*=-1),l[r][0]*=-1,l[r][1]*=-1,l[r][2]*=-1;null!=n&&(n[0]=.5*Math.sqrt(Math.max(1+l[0][0]-l[1][1]-l[2][2],0)),n[1]=.5*Math.sqrt(Math.max(1-l[0][0]+l[1][1]-l[2][2],0)),n[2]=.5*Math.sqrt(Math.max(1-l[0][0]-l[1][1]+l[2][2],0)),n[3]=.5*Math.sqrt(Math.max(1+l[0][0]+l[1][1]+l[2][2],0)),l[2][1]>l[1][2]&&(n[0]=-n[0]),l[0][2]>l[2][0]&&(n[1]=-n[1]),l[1][0]>l[0][1]&&(n[2]=-n[2]))}}})}});