montageDefine("3d2b056","runtime/scene-renderer",{dependencies:["runtime/dependencies/gl-matrix","runtime/technique","runtime/pass","runtime/builtin-assets","runtime/dependencies/o3dgc"],factory:function(t,e){t("runtime/dependencies/gl-matrix");var n=t("runtime/technique").Technique,i=t("runtime/pass").ScenePass,r=t("runtime/builtin-assets").BuiltInAssets,a=t("runtime/dependencies/o3dgc").o3dgc;e.SceneRenderer=Object.create(Object.prototype,{loadPickingTechnique:{value:function(){var t=this,e=r.assetWithName("pickingTechnique");e.then(function(e){t.technique.rootPass.scenePassRenderer.pickingTechnique=e},function(){},function(){})}},createTechniqueIfNeeded:{value:function(){if(!this._technique){this._technique=Object.create(n).init();var t=Object.create(i).init();this._technique.passes={defaultPass:t}}}},_webGLRenderer:{value:null,writable:!0},_technique:{value:null,writable:!0},technique:{get:function(){return this._technique},set:function(t){this._technique=t}},compressedMeshDelegate:{value:{str2ab:function(t){for(var e=new ArrayBuffer(t.length),n=new Uint8Array(e),i=0,r=t.length;r>i;i++)n[i]=t.charCodeAt(i);return e},decode:function(t,e){if(t){if(e)var n=new a.BinaryStream(this.str2ab(t));else var n=new a.BinaryStream(t);var i=new a.SC3DMCDecoder,r=new a.Timer,s=new a.IndexedFaceSet;r.Tic(),i.DecodeHeader(s,n),r.Toc(),console.log("DecodeHeader time (ms) "+r.GetElapsedTime());var o=12*s.GetNCoord()+12*s.GetNNormal(),l=new ArrayBuffer(o),c=new ArrayBuffer(6*s.GetNCoordIndex()),h=0;s.GetNCoordIndex()>0&&s.SetCoordIndex(new Uint16Array(c,0,3*s.GetNCoordIndex())),s.GetNCoord()>0&&(s.SetCoord(new Float32Array(l,h,3*s.GetNCoord())),h+=12*s.GetNCoord()),s.GetNNormal()>0&&(s.SetNormal(new Float32Array(l,h,3*s.GetNNormal())),h+=12*s.GetNNormal());for(var u=s.GetNumFloatAttributes(),p=0;u>p;++p)s.GetNFloatAttribute(p)>0&&s.SetFloatAttribute(p,new Float32Array(s.GetFloatAttributeDim(p)*s.GetNFloatAttribute(p)));return r.Tic(),i.DecodePlayload(s,n),r.Toc(),s}},handleError:function(t,e){console.log("ERROR:vertexAttributeBufferDelegate:"+t+" :"+e)},decompressAttribsInner_:function(t,e,n,i,r,a,s,o){for(var l=0,c=e;n>c;c++){var h=t.charCodeAt(c);l+=h>>1^-(1&h),i[r]=o*(l+s),r+=a}},decompressIndices_:function(t,e,n,i,r){for(var a=0,s=0;n>s;s++){var o=t.charCodeAt(e++);i[r++]=a-o,0==o&&a++}},decompressMesh:function(t,e,n,i){for(var r=n.decodeScales.length,a=n.decodeOffsets,s=n.decodeScales,o=e.attribRange[0],l=e.attribRange[1],c=o,h=new Float32Array(r*l),u=0;r>u;u++){var p=c+l,d=s[u];d&&this.decompressAttribsInner_(t,c,p,h,u,r,a[u],d),c=p}e.indexRange[0];var m=3*e.indexRange[1],g=new Uint16Array(m);this.decompressIndices_(t,c,m,g,0),i(h,g,null,e)},convert:function(t,e,n){var i=n.mesh.compression;if("won-compression"==i.type){var r=i.indexRange;r&&(r[0]+3*r[1],this.decompressMesh(e,i,i,function(t,e){n.renderer.setupCompressedMesh(n.mesh,t,e)}))}else{var a=0;if(n.mesh,i.compressedData){var s=i.compressedData;a=s.verticesCount;var o=this.decode(e,"ascii"===s.mode),l=o.GetCoordIndex(),c=o.GetCoord(),h=o.GetNNormal()>0?o.GetNormal():null;n.renderer.setupCompressedMesh2(n.mesh,a,c,h,o,s.floatAttributesIndexes,l)}}return e},resourceAvailable:function(){}}},scene:{get:function(){return this.technique.rootPass.scene},set:function(t){var e=this,n=this.technique.rootPass.scene;n!=t&&(this.technique.rootPass.scene=t,this.scene.rootNode.apply(function(t){t.meshes&&t.meshes.forEach(function(t){if(t.compression){var n="text";t.compression.compressedData.mode&&"binary"==t.compression.compressedData.mode&&(n="arraybuffer"),t.compression.compressedData.requestType=n,e.webGLRenderer.resourceManager.getResource(t.compression.compressedData,e.compressedMeshDelegate,{mesh:t,renderer:e.webGLRenderer})}},this)},!0,null))}},webGLRenderer:{get:function(){return this._webGLRenderer},set:function(t){this._webGLRenderer=t}},init:{value:function(t){return this.webGLRenderer=t,this.createTechniqueIfNeeded(),this.loadPickingTechnique(),this}},render:{value:function(t,e){this.technique&&this.technique.execute(this.webGLRenderer,t,e)}}})}});