montageDefine("3d2b056","runtime/dependencies/o3dgc",{dependencies:[],factory:function(e,i){i.o3dgc=function(){"use strict";function e(){var e,i,t;return i=new ArrayBuffer(4),e=new Uint32Array(i),t=new Uint8Array(i),e[0]=1,1===t[0]?o.O3DGC_LITTLE_ENDIAN:o.O3DGC_BIG_ENDIAN}function i(e,i,t,a){var s,u,n,r,l,c,m;for(s=-1,u=!1,r=i.m_value,l=0,n=l;r>n;++n){if(e.Equal(t[n].m_id)){u=!0;break}if(e.Less(t[n].m_id)){for(i.m_value<o.O3DGC_SC3DMC_MAX_PREDICTION_NEIGHBORS&&++i.m_value,c=i.m_value-1;c>n;--c)for(t[c].m_id.m_a=t[c-1].m_id.m_a,t[c].m_id.m_b=t[c-1].m_id.m_b,t[c].m_id.m_c=t[c-1].m_id.m_c,m=0;a>m;++m)t[c].m_pred[m]=t[c-1].m_pred[m];t[n].m_id.m_a=e.m_a,t[n].m_id.m_b=e.m_b,t[n].m_id.m_c=e.m_c,s=n,u=!0;break}}return!u&&i.m_value<o.O3DGC_SC3DMC_MAX_PREDICTION_NEIGHBORS&&(s=i.m_value++,t[s].m_id.m_a=e.m_a,t[s].m_id.m_b=e.m_b,t[s].m_id.m_c=e.m_c),s}function t(e,i){var t,a,s;t=Math.abs(e.m_x),a=Math.abs(e.m_y),s=Math.abs(e.m_z),s>=t&&s>=a?e.m_z>=0?(i.m_z=0,i.m_x=e.m_x,i.m_y=e.m_y):(i.m_z=1,i.m_x=-e.m_x,i.m_y=-e.m_y):a>=t&&a>=s?e.m_y>=0?(i.m_z=2,i.m_x=e.m_z,i.m_y=e.m_x):(i.m_z=3,i.m_x=-e.m_z,i.m_y=-e.m_x):e.m_x>=0?(i.m_z=4,i.m_x=e.m_y,i.m_y=e.m_z):(i.m_z=5,i.m_x=-e.m_y,i.m_y=-e.m_z)}function a(e){return 0>e?-1-2*e:2*e}function s(e){return 1&e?-(e+1>>>1):e>>>1}function u(e,t,a,s,u,n,r,o){var c,m,d,p,v,h;for(h=new l.SC3DMCTriplet(-1,-1,-1),m=0;3>m;++m)if(p=e[3*t+m],a>p&&(h.m_a=-1,h.m_b=-1,h.m_c=p,d=i(h,s,u,n),-1!==d))for(c=p*o,v=0;n>v;++v)u[d].m_pred[v]=r[c+v]}function n(e,t,a,s,u,n,r,o,c,m){var d,p,v,h,g,f,b,q,_,y,S,P,C,N,D,M,E,A;if(d=3*t,A=new l.SC3DMCTriplet(-1,-1,-1),e[d]===a?(f=e[d+1],b=e[d+2]):e[d+1]===a?(f=e[d],b=e[d+2]):(f=e[d],b=e[d+1]),a>f&&a>b)for(P=c.Begin(f),C=c.End(f),N=P;C>N&&(D=m[N],!(0>D));++N){for(p=3*D,q=-1,M=!1,S=0;3>S;++S)_=e[p+S],_===b?M=!0:a>_&&_!==f&&(q=_);if(-1!==q&&M&&(b>f?(A.m_a=f,A.m_b=b):(A.m_a=b,A.m_b=f),A.m_c=-q-1,E=i(A,s,u,n),-1!==E))for(v=f*o,h=b*o,g=q*o,y=0;n>y;++y)u[E].m_pred[y]=r[v+y]+r[h+y]-r[g+y]}}function r(e,i,t,a,s){var u,n,r,o,c,m,d,p,v,h;for(h=new l.Vec3,p=new l.Vec3,v=new l.Vec3,r=3*a,n=0;r>n;++n)s[n]=0;for(o=0;i>o;++o)u=3*o,c=3*e[u],m=3*e[u+1],d=3*e[u+2],p.m_x=t[m]-t[c],p.m_y=t[m+1]-t[c+1],p.m_z=t[m+2]-t[c+2],v.m_x=t[d]-t[c],v.m_y=t[d+1]-t[c+1],v.m_z=t[d+2]-t[c+2],h.m_x=p.m_y*v.m_z-p.m_z*v.m_y,h.m_y=p.m_z*v.m_x-p.m_x*v.m_z,h.m_z=p.m_x*v.m_y-p.m_y*v.m_x,s[c]+=h.m_x,s[c+1]+=h.m_y,s[c+2]+=h.m_z,s[m]+=h.m_x,s[m+1]+=h.m_y,s[m+2]+=h.m_z,s[d]+=h.m_x,s[d+1]+=h.m_y,s[d+2]+=h.m_z}var l,o;return l={},o={},o.O3DGC_BINARY_STREAM_BITS_PER_SYMBOL0=7,o.O3DGC_BINARY_STREAM_MAX_SYMBOL0=127,o.O3DGC_BINARY_STREAM_BITS_PER_SYMBOL1=6,o.O3DGC_BINARY_STREAM_MAX_SYMBOL1=63,o.O3DGC_BINARY_STREAM_NUM_SYMBOLS_UINT32=5,o.O3DGC_BIG_ENDIAN=0,o.O3DGC_LITTLE_ENDIAN=1,o.O3DGC_MAX_DOUBLE=1.79769e308,o.O3DGC_MIN_LONG=-2147483647,o.O3DGC_MAX_LONG=2147483647,o.O3DGC_MAX_UCHAR8=255,o.O3DGC_MAX_TFAN_SIZE=256,o.O3DGC_MAX_ULONG=4294967295,o.O3DGC_SC3DMC_START_CODE=497,o.O3DGC_DV_START_CODE=498,o.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES=256,o.O3DGC_SC3DMC_MAX_NUM_INT_ATTRIBUTES=256,o.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES=32,o.O3DGC_SC3DMC_MAX_PREDICTION_NEIGHBORS=2,o.O3DGC_SC3DMC_BINARIZATION_FL=0,o.O3DGC_SC3DMC_BINARIZATION_BP=1,o.O3DGC_SC3DMC_BINARIZATION_FC=2,o.O3DGC_SC3DMC_BINARIZATION_AC=3,o.O3DGC_SC3DMC_BINARIZATION_AC_EGC=4,o.O3DGC_SC3DMC_BINARIZATION_ASCII=5,o.O3DGC_STREAM_TYPE_UNKOWN=0,o.O3DGC_STREAM_TYPE_ASCII=1,o.O3DGC_STREAM_TYPE_BINARY=2,o.O3DGC_SC3DMC_NO_PREDICTION=0,o.O3DGC_SC3DMC_DIFFERENTIAL_PREDICTION=1,o.O3DGC_SC3DMC_XOR_PREDICTION=2,o.O3DGC_SC3DMC_ADAPTIVE_DIFFERENTIAL_PREDICTION=3,o.O3DGC_SC3DMC_CIRCULAR_DIFFERENTIAL_PREDICTION=4,o.O3DGC_SC3DMC_PARALLELOGRAM_PREDICTION=5,o.O3DGC_SC3DMC_SURF_NORMALS_PREDICTION=6,o.O3DGC_SC3DMC_ENCODE_MODE_QBCR=0,o.O3DGC_SC3DMC_ENCODE_MODE_SVA=1,o.O3DGC_SC3DMC_ENCODE_MODE_TFAN=2,o.O3DGC_DYNAMIC_VECTOR_ENCODE_MODE_LIFT=0,o.O3DGC_MIN_NEIGHBORS_SIZE=128,o.O3DGC_MIN_NUM_NEIGHBORS_SIZE=16,o.O3DGC_TFANS_MIN_SIZE_ALLOCATED_VERTICES_BUFFER=128,o.O3DGC_TFANS_MIN_SIZE_TFAN_SIZE_BUFFER=8,o.O3DGC_DEFAULT_VECTOR_SIZE=32,l.O3DGC_IFS_FLOAT_ATTRIBUTE_TYPE_UNKOWN=0,l.O3DGC_IFS_FLOAT_ATTRIBUTE_TYPE_POSITION=1,l.O3DGC_IFS_FLOAT_ATTRIBUTE_TYPE_NORMAL=2,l.O3DGC_IFS_FLOAT_ATTRIBUTE_TYPE_COLOR=3,l.O3DGC_IFS_FLOAT_ATTRIBUTE_TYPE_TEXCOORD=4,l.O3DGC_IFS_FLOAT_ATTRIBUTE_TYPE_WEIGHT=5,l.O3DGC_IFS_INT_ATTRIBUTE_TYPE_UNKOWN=0,l.O3DGC_IFS_INT_ATTRIBUTE_TYPE_INDEX=1,l.O3DGC_IFS_INT_ATTRIBUTE_TYPE_JOINT_ID=2,l.O3DGC_IFS_INT_ATTRIBUTE_TYPE_INDEX_BUFFER_ID=3,l.O3DGC_OK=0,l.O3DGC_ERROR_BUFFER_FULL=1,l.O3DGC_ERROR_CORRUPTED_STREAM=5,l.O3DGC_ERROR_NON_SUPPORTED_FEATURE=6,l.O3DGC_ERROR_AC=7,l.SC3DMCStats=function(){this.m_timeCoord=0,this.m_timeNormal=0,this.m_timeCoordIndex=0,this.m_timeFloatAttribute=new Float32Array(o.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES),this.m_timeIntAttribute=new Float32Array(o.O3DGC_SC3DMC_MAX_NUM_INT_ATTRIBUTES),this.m_timeReorder=0,this.m_streamSizeCoord=0,this.m_streamSizeNormal=0,this.m_streamSizeCoordIndex=0,this.m_streamSizeFloatAttribute=new Uint32Array(o.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES),this.m_streamSizeIntAttribute=new Uint32Array(o.O3DGC_SC3DMC_MAX_NUM_INT_ATTRIBUTES)},l.SC3DMCTriplet=function(e,i,t){this.m_a=e,this.m_b=i,this.m_c=t},l.SC3DMCTriplet.prototype.Less=function(e){var i;return i=this.m_c!==e.m_c?this.m_c<e.m_c:this.m_b!==e.m_b?this.m_b<e.m_b:this.m_a<e.m_a},l.SC3DMCTriplet.prototype.Equal=function(e){return this.m_c===e.m_c&&this.m_b===e.m_b&&this.m_a===e.m_a},l.SC3DMCPredictor=function(){this.m_id=new l.SC3DMCTriplet(-1,-1,-1),this.m_pred=new Float32Array(o.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES)},void 0===window.performance&&(window.performance={}),window.performance.now||(o.nowOffset=Date.now(),performance.timing&&performance.timing.navigationStart&&(o.nowOffset=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-o.nowOffset}),l.Timer=function(){this.m_start=0,this.m_end=0},l.Timer.prototype.Tic=function(){this.m_start=window.performance.now()},l.Timer.prototype.Toc=function(){this.m_end=window.performance.now()},l.Timer.prototype.GetElapsedTime=function(){return this.m_end-this.m_start},l.Vec3=function(e,i,t){this.m_x=e,this.m_y=i,this.m_z=t},l.Vec3.prototype.Set=function(e,i,t){this.m_x=e,this.m_y=i,this.m_z=t},l.Vec3.prototype.Sub=function(e,i){this.m_x=e.m_x-i.m_x,this.m_y=e.m_y-i.m_y,this.m_z=e.m_z-i.m_z},l.Vec3.prototype.Add=function(e,i){this.m_x=e.m_x+i.m_x,this.m_y=e.m_y+i.m_y,this.m_z=e.m_z+i.m_z},l.Vec3.prototype.SelfAdd=function(e){this.m_x+=e.m_x,this.m_y+=e.m_y,this.m_z+=e.m_z},l.Vec3.prototype.Cross=function(e,i){this.m_x=e.m_y*i.m_z-e.m_z*i.m_y,this.m_y=e.m_z*i.m_x-e.m_x*i.m_z,this.m_z=e.m_x*i.m_y-e.m_y*i.m_x},l.Vec3.prototype.GetNorm=function(){return Math.sqrt(this.m_x*this.m_x+this.m_y*this.m_y+this.m_z*this.m_z)},o.CubeToSphere={0:function(e,i){i.m_x=e.m_x,i.m_y=e.m_y,i.m_z=Math.sqrt(Math.max(0,1-i.m_x*i.m_x-i.m_y*i.m_y))},1:function(e,i){i.m_x=-e.m_x,i.m_y=-e.m_y,i.m_z=-Math.sqrt(Math.max(0,1-i.m_x*i.m_x-i.m_y*i.m_y))},2:function(e,i){i.m_z=e.m_x,i.m_x=e.m_y,i.m_y=Math.sqrt(Math.max(0,1-i.m_x*i.m_x-i.m_z*i.m_z))},3:function(e,i){i.m_z=-e.m_x,i.m_x=-e.m_y,i.m_y=-Math.sqrt(Math.max(0,1-i.m_x*i.m_x-i.m_z*i.m_z))},4:function(e,i){i.m_y=e.m_x,i.m_z=e.m_y,i.m_x=Math.sqrt(Math.max(0,1-i.m_y*i.m_y-i.m_z*i.m_z))},5:function(e,i){i.m_y=-e.m_x,i.m_z=-e.m_y,i.m_x=-Math.sqrt(Math.max(0,1-i.m_y*i.m_y-i.m_z*i.m_z))}},l.Iterator=function(){this.m_count=0},l.NumberRef=function(){this.m_value=0},l.BinaryStream=function(i){this.m_endianness=e(),this.m_buffer=i,this.m_stream=new Uint8Array(this.m_buffer),this.m_localBuffer=new ArrayBuffer(4),this.m_localBufferViewUChar8=new Uint8Array(this.m_localBuffer),this.m_localBufferViewFloat32=new Float32Array(this.m_localBuffer),this.m_localBufferViewUInt32=new Uint32Array(this.m_localBuffer)},l.BinaryStream.prototype.ReadFloat32Bin=function(e){return this.m_endianness===o.O3DGC_BIG_ENDIAN?(this.m_localBufferViewUChar8[3]=this.m_stream[e.m_count++],this.m_localBufferViewUChar8[2]=this.m_stream[e.m_count++],this.m_localBufferViewUChar8[1]=this.m_stream[e.m_count++],this.m_localBufferViewUChar8[0]=this.m_stream[e.m_count++]):(this.m_localBufferViewUChar8[0]=this.m_stream[e.m_count++],this.m_localBufferViewUChar8[1]=this.m_stream[e.m_count++],this.m_localBufferViewUChar8[2]=this.m_stream[e.m_count++],this.m_localBufferViewUChar8[3]=this.m_stream[e.m_count++]),this.m_localBufferViewFloat32[0]},l.BinaryStream.prototype.ReadUInt32Bin=function(e){return this.m_endianness===o.O3DGC_BIG_ENDIAN?(this.m_localBufferViewUChar8[3]=this.m_stream[e.m_count++],this.m_localBufferViewUChar8[2]=this.m_stream[e.m_count++],this.m_localBufferViewUChar8[1]=this.m_stream[e.m_count++],this.m_localBufferViewUChar8[0]=this.m_stream[e.m_count++]):(this.m_localBufferViewUChar8[0]=this.m_stream[e.m_count++],this.m_localBufferViewUChar8[1]=this.m_stream[e.m_count++],this.m_localBufferViewUChar8[2]=this.m_stream[e.m_count++],this.m_localBufferViewUChar8[3]=this.m_stream[e.m_count++]),this.m_localBufferViewUInt32[0]},l.BinaryStream.prototype.ReadUChar8Bin=function(e){return this.m_stream[e.m_count++]},l.BinaryStream.prototype.ReadUInt32ASCII=function(e){var i,t,a;for(i=0,t=0,a=0;o.O3DGC_BINARY_STREAM_NUM_SYMBOLS_UINT32>a;++a)i+=this.m_stream[e.m_count++]<<t>>>0,t+=o.O3DGC_BINARY_STREAM_BITS_PER_SYMBOL0;return i},l.BinaryStream.prototype.ReadFloat32ASCII=function(e){var i=this.ReadUInt32ASCII(e);return this.m_endianness===o.O3DGC_BIG_ENDIAN?(this.m_localBufferViewUChar8[3]=i&o.O3DGC_MAX_UCHAR8,i>>>=8,this.m_localBufferViewUChar8[2]=i&o.O3DGC_MAX_UCHAR8,i>>>=8,this.m_localBufferViewUChar8[1]=i&o.O3DGC_MAX_UCHAR8,i>>>=8,this.m_localBufferViewUChar8[0]=i&o.O3DGC_MAX_UCHAR8):(this.m_localBufferViewUChar8[0]=i&o.O3DGC_MAX_UCHAR8,i>>>=8,this.m_localBufferViewUChar8[1]=i&o.O3DGC_MAX_UCHAR8,i>>>=8,this.m_localBufferViewUChar8[2]=i&o.O3DGC_MAX_UCHAR8,i>>>=8,this.m_localBufferViewUChar8[3]=i&o.O3DGC_MAX_UCHAR8),this.m_localBufferViewFloat32[0]},l.BinaryStream.prototype.ReadIntASCII=function(e){return s(this.ReadUIntASCII(e))},l.BinaryStream.prototype.ReadUIntASCII=function(e){var i,t,a;if(a=this.m_stream[e.m_count++],a===o.O3DGC_BINARY_STREAM_MAX_SYMBOL0){i=0;do t=this.m_stream[e.m_count++],a+=t>>>1<<i>>>0,i+=o.O3DGC_BINARY_STREAM_BITS_PER_SYMBOL1;while(1&t)}return a},l.BinaryStream.prototype.ReadUCharASCII=function(e){return this.m_stream[e.m_count++]},l.BinaryStream.prototype.ReadFloat32=function(e,i){return i===o.O3DGC_STREAM_TYPE_ASCII?this.ReadFloat32ASCII(e):this.ReadFloat32Bin(e)},l.BinaryStream.prototype.ReadUInt32=function(e,i){return i===o.O3DGC_STREAM_TYPE_ASCII?this.ReadUInt32ASCII(e):this.ReadUInt32Bin(e)},l.BinaryStream.prototype.ReadUChar=function(e,i){return i===o.O3DGC_STREAM_TYPE_ASCII?this.ReadUCharASCII(e):this.ReadUChar8Bin(e)},l.BinaryStream.prototype.GetBuffer=function(e,i){return new Uint8Array(this.m_buffer,e.m_count,i)},o.O3DGC_AC_MIN_LENGTH=16777216,o.O3DGC_AC_MAX_LENGTH=4294967295,o.O3DGC_AC_BM_LENGTH_SHIFT=13,o.O3DGC_AC_BM_MAX_COUNT=1<<o.O3DGC_AC_BM_LENGTH_SHIFT>>>0,o.O3DGC_AC_DM_LENGTH_SHIFT=15,o.O3DGC_AC_DM_MAX_COUNT=1<<o.O3DGC_AC_DM_LENGTH_SHIFT>>>0,l.StaticBitModel=function(){this.m_bit0Prob=1<<o.O3DGC_AC_BM_LENGTH_SHIFT-1>>>0},l.StaticBitModel.prototype.SetProbability=function(e){this.m_bit0Prob=Math.floor(e*(1<<o.O3DGC_AC_BM_LENGTH_SHIFT>>>0))},l.AdaptiveBitModel=function(){this.m_updateCycle=4,this.m_bitsUntilUpdate=4,this.m_bit0Prob=1<<o.O3DGC_AC_BM_LENGTH_SHIFT-1>>>0,this.m_bit0Count=1,this.m_bitCount=2},l.AdaptiveBitModel.prototype.Reset=function(){this.m_updateCycle=4,this.m_bitsUntilUpdate=4,this.m_bit0Prob=1<<o.O3DGC_AC_BM_LENGTH_SHIFT-1>>>0,this.m_bit0Count=1,this.m_bitCount=2},l.AdaptiveBitModel.prototype.Update=function(){(this.m_bitCount+=this.m_updateCycle)>o.O3DGC_AC_BM_MAX_COUNT&&(this.m_bitCount=this.m_bitCount+1>>>1,this.m_bit0Count=this.m_bit0Count+1>>>1,this.m_bit0Count===this.m_bitCount&&++this.m_bitCount);var e=Math.floor(2147483648/this.m_bitCount);this.m_bit0Prob=this.m_bit0Count*e>>>31-o.O3DGC_AC_BM_LENGTH_SHIFT,this.m_updateCycle=5*this.m_updateCycle>>>2,this.m_updateCycle>64&&(this.m_updateCycle=64),this.m_bitsUntilUpdate=this.m_updateCycle},l.AdaptiveDataModel=function(){this.m_buffer={},this.m_distribution={},this.m_symbolCount={},this.m_decoderTable={},this.m_totalCount=0,this.m_updateCycle=0,this.m_symbolsUntilUpdate=0,this.m_dataSymbols=0,this.m_lastSymbol=0,this.m_tableSize=0,this.m_tableShift=0},l.AdaptiveDataModel.prototype.Update=function(){var e,i,t,a,s,u,n;if((this.m_totalCount+=this.m_updateCycle)>o.O3DGC_AC_DM_MAX_COUNT)for(this.m_totalCount=0,e=0;this.m_dataSymbols>e;++e)this.m_totalCount+=this.m_symbolCount[e]=this.m_symbolCount[e]+1>>>1;if(i=0,t=0,a=Math.floor(2147483648/this.m_totalCount),0===this.m_tableSize)for(s=0;this.m_dataSymbols>s;++s)this.m_distribution[s]=a*i>>>31-o.O3DGC_AC_DM_LENGTH_SHIFT,i+=this.m_symbolCount[s];else{for(s=0;this.m_dataSymbols>s;++s)for(this.m_distribution[s]=a*i>>>31-o.O3DGC_AC_DM_LENGTH_SHIFT,i+=this.m_symbolCount[s],n=this.m_distribution[s]>>>this.m_tableShift;n>t;)this.m_decoderTable[++t]=s-1;for(this.m_decoderTable[0]=0;this.m_tableSize>=t;)this.m_decoderTable[++t]=this.m_dataSymbols-1}this.m_updateCycle=5*this.m_updateCycle>>>2,u=this.m_dataSymbols+6<<3>>>0,this.m_updateCycle>u&&(this.m_updateCycle=u),this.m_symbolsUntilUpdate=this.m_updateCycle},l.AdaptiveDataModel.prototype.Reset=function(){var e;if(0!==this.m_dataSymbols){for(this.m_totalCount=0,this.m_updateCycle=this.m_dataSymbols,e=0;this.m_dataSymbols>e;++e)this.m_symbolCount[e]=1;this.Update(),this.m_symbolsUntilUpdate=this.m_updateCycle=this.m_dataSymbols+6>>>1}},l.AdaptiveDataModel.prototype.SetAlphabet=function(e){if(2>e||e>2048)return Console.log("invalid number of data symbols"),l.O3DGC_ERROR_AC;if(this.m_dataSymbols!==e)if(this.m_dataSymbols=e,this.m_lastSymbol=this.m_dataSymbols-1,this.m_dataSymbols>16){for(var i=3;this.m_dataSymbols>1<<i+2>>>0;)++i;this.m_tableSize=1<<i>>>0,this.m_tableShift=o.O3DGC_AC_DM_LENGTH_SHIFT-i,this.m_buffer=new ArrayBuffer(4*(2*this.m_dataSymbols+this.m_tableSize+2)),this.m_distribution=new Uint32Array(this.m_buffer,0,this.m_dataSymbols),this.m_symbolCount=new Uint32Array(this.m_buffer,4*this.m_dataSymbols,this.m_dataSymbols),this.m_decoderTable=new Uint32Array(this.m_buffer,8*this.m_dataSymbols,this.m_tableSize+2)}else this.m_tableSize=this.m_tableShift=0,this.m_buffer=new ArrayBuffer(8*this.m_dataSymbols),this.m_distribution=new Uint32Array(this.m_buffer,0,this.m_dataSymbols),this.m_symbolCount=new Uint32Array(this.m_buffer,4*this.m_dataSymbols,this.m_dataSymbols),this.m_decoderTable={};return this.Reset(),l.O3DGC_OK},l.ArithmeticDecoder=function(){this.m_codeBuffer={},this.m_acShift=0,this.m_base=0,this.m_value=0,this.m_length=0,this.m_bufferSize=0,this.m_mode=0},l.ArithmeticDecoder.prototype.SetBuffer=function(e,i){return 0===e?(Console.log("invalid codec buffer size"),l.O3DGC_ERROR_AC):0!==this.m_mode?(Console.log("cannot set buffer while encoding or decoding"),l.O3DGC_ERROR_AC):(this.m_bufferSize=e,this.m_codeBuffer=i,void 0)},l.ArithmeticDecoder.prototype.StartDecoder=function(){return 0!==this.m_mode?(Console.log("cannot start decoder"),l.O3DGC_ERROR_AC):0===this.m_bufferSize?(Console.log("no code buffer set"),l.O3DGC_ERROR_AC):(this.m_mode=2,this.m_length=o.O3DGC_AC_MAX_LENGTH,this.m_acShift=3,this.m_value=(this.m_codeBuffer[0]<<24|this.m_codeBuffer[1]<<16|this.m_codeBuffer[2]<<8|this.m_codeBuffer[3])>>>0,void 0)},l.ArithmeticDecoder.prototype.StopDecoder=function(){return 2!==this.m_mode?(Console.log("invalid to stop decoder"),l.O3DGC_ERROR_AC):(this.m_mode=0,void 0)},l.ArithmeticDecoder.prototype.GetBit=function(){this.m_length>>>=1;var e=this.m_value>=this.m_length;return e&&(this.m_value-=this.m_length),this.m_length<o.O3DGC_AC_MIN_LENGTH&&this.RenormDecInterval(),e},l.ArithmeticDecoder.prototype.GetBits=function(e){var i=Math.floor(this.m_value/(this.m_length>>>=e));return this.m_value-=this.m_length*i,this.m_length<o.O3DGC_AC_MIN_LENGTH&&this.RenormDecInterval(),i},l.ArithmeticDecoder.prototype.DecodeStaticBitModel=function(e){var i,t;return i=e.m_bit0Prob*(this.m_length>>>o.O3DGC_AC_BM_LENGTH_SHIFT),t=this.m_value>=i,t?(this.m_value-=i,this.m_length-=i):this.m_length=i,this.m_length<o.O3DGC_AC_MIN_LENGTH&&this.RenormDecInterval(),t},l.ArithmeticDecoder.prototype.DecodeAdaptiveBitModel=function(e){var i,t;return i=e.m_bit0Prob*(this.m_length>>>o.O3DGC_AC_BM_LENGTH_SHIFT),t=this.m_value>=i,t?(this.m_value-=i,this.m_length-=i):(this.m_length=i,++e.m_bit0Count),this.m_length<o.O3DGC_AC_MIN_LENGTH&&this.RenormDecInterval(),0===--e.m_bitsUntilUpdate&&e.Update(),t},l.ArithmeticDecoder.prototype.DecodeAdaptiveDataModel=function(e){var i,t,a,s,u,n,r,l;if(s=this.m_length,e.m_tableSize>0){for(n=Math.floor(this.m_value/(this.m_length>>>=o.O3DGC_AC_DM_LENGTH_SHIFT)),u=n>>>e.m_tableShift,t=e.m_decoderTable[u],i=e.m_decoderTable[u+1]+1;i>t+1;)l=t+i>>>1,e.m_distribution[l]>n?i=l:t=l;a=e.m_distribution[t]*this.m_length,t!==e.m_lastSymbol&&(s=e.m_distribution[t+1]*this.m_length)}else{a=t=0,this.m_length>>>=o.O3DGC_AC_DM_LENGTH_SHIFT,l=(i=e.m_dataSymbols)>>>1;do r=this.m_length*e.m_distribution[l],r>this.m_value?(i=l,s=r):(t=l,a=r);while((l=t+i>>>1)!==t)}return this.m_value-=a,this.m_length=s-a,this.m_length<o.O3DGC_AC_MIN_LENGTH&&this.RenormDecInterval(),++e.m_symbolCount[t],0===--e.m_symbolsUntilUpdate&&e.Update(!1),t},l.ArithmeticDecoder.prototype.ExpGolombDecode=function(e,i,t){var a,s,u;a=0,s=0;do u=this.DecodeAdaptiveBitModel(t),u&&(a+=1<<e>>>0,e++);while(u);for(;e--;)this.DecodeStaticBitModel(i)&&(s=(s|1<<e)>>>0);return a+s},l.ArithmeticDecoder.prototype.RenormDecInterval=function(){do this.m_value=(this.m_value<<8|this.m_codeBuffer[++this.m_acShift])>>>0,this.m_length=this.m_length<<8>>>0;while(this.m_length<o.O3DGC_AC_MIN_LENGTH)},l.ArithmeticDecoder.prototype.DecodeIntACEGC=function(e,i,t,a,u){var n=this.DecodeAdaptiveDataModel(e);return n===u&&(n+=this.ExpGolombDecode(a,i,t)),s(n)},l.ArithmeticDecoder.prototype.DecodeUIntACEGC=function(e,i,t,a,s){var u=this.DecodeAdaptiveDataModel(e);return u===s&&(u+=this.ExpGolombDecode(a,i,t)),u},l.FIFO=function(){this.m_data={},this.m_allocated=0,this.m_size=0,this.m_start=0,this.m_end=0},l.FIFO.prototype.Clear=function(){this.m_start=this.m_end=this.m_size=0},l.FIFO.prototype.GetAllocatedSize=function(){return this.m_allocated},l.FIFO.prototype.GetSize=function(){return this.m_size},l.FIFO.prototype.Allocate=function(e){return e>this.m_allocated&&(this.m_allocated=e,this.m_data=new Int32Array(this.m_allocated)),this.Clear(),l.O3DGC_OK},l.FIFO.prototype.PopFirst=function(){--this.m_size;var e=this.m_start++;return this.m_start===this.m_allocated&&(this.m_end=0),this.m_data[e]},l.FIFO.prototype.PushBack=function(e){--this.m_size,this.m_data[this.m_end]=e,++this.m_size,++this.m_end,this.m_end===this.m_allocated&&(this.m_end=0)},l.IndexedFaceSet=function(){this.m_nCoordIndex=0,this.m_nCoord=0,this.m_nNormal=0,this.m_numFloatAttributes=0,this.m_numIntAttributes=0,this.m_creaseAngle=30,this.m_ccw=!0,this.m_solid=!0,this.m_convex=!0,this.m_isTriangularMesh=!0,this.m_coordMin=new Float32Array(3),this.m_coordMax=new Float32Array(3),this.m_normalMin=new Float32Array(3),this.m_normalMax=new Float32Array(3),this.m_nFloatAttribute=new Uint32Array(o.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES),this.m_nIntAttribute=new Uint32Array(o.O3DGC_SC3DMC_MAX_NUM_INT_ATTRIBUTES),this.m_dimFloatAttribute=new Uint32Array(o.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES),this.m_dimIntAttribute=new Uint32Array(o.O3DGC_SC3DMC_MAX_NUM_INT_ATTRIBUTES),this.m_typeFloatAttribute=new Uint32Array(o.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES),this.m_typeIntAttribute=new Uint32Array(o.O3DGC_SC3DMC_MAX_NUM_INT_ATTRIBUTES),this.m_minFloatAttributeBuffer=new ArrayBuffer(4*o.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES*o.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES),this.m_minFloatAttribute=new Float32Array(this.m_minFloatAttributeBuffer),this.m_maxFloatAttributeBuffer=new ArrayBuffer(4*o.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES*o.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES),this.m_maxFloatAttribute=new Float32Array(this.m_maxFloatAttributeBuffer),this.m_coordIndex={},this.m_coord={},this.m_normal={},this.m_floatAttribute=[],this.m_intAttribute=[]},l.IndexedFaceSet.prototype.GetNCoordIndex=function(){return this.m_nCoordIndex},l.IndexedFaceSet.prototype.GetNCoordIndex=function(){return this.m_nCoordIndex},l.IndexedFaceSet.prototype.GetNCoord=function(){return this.m_nCoord},l.IndexedFaceSet.prototype.GetNNormal=function(){return this.m_nNormal},l.IndexedFaceSet.prototype.GetNFloatAttribute=function(e){return this.m_nFloatAttribute[e]},l.IndexedFaceSet.prototype.GetNIntAttribute=function(e){return this.m_nIntAttribute[e]},l.IndexedFaceSet.prototype.GetNumFloatAttributes=function(){return this.m_numFloatAttributes},l.IndexedFaceSet.prototype.GetNumIntAttributes=function(){return this.m_numIntAttributes},l.IndexedFaceSet.prototype.GetCoordMinArray=function(){return this.m_coordMin},l.IndexedFaceSet.prototype.GetCoordMaxArray=function(){return this.m_coordMax},l.IndexedFaceSet.prototype.GetNormalMinArray=function(){return this.m_normalMin},l.IndexedFaceSet.prototype.GetNormalMaxArray=function(){return this.m_normalMax},l.IndexedFaceSet.prototype.GetFloatAttributeMinArray=function(e){return new Float32Array(this.m_minFloatAttributeBuffer,4*e*o.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES,this.GetFloatAttributeDim(e))},l.IndexedFaceSet.prototype.GetFloatAttributeMaxArray=function(e){return new Float32Array(this.m_maxFloatAttributeBuffer,4*e*o.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES,this.GetFloatAttributeDim(e))},l.IndexedFaceSet.prototype.GetFloatAttributeDim=function(e){return this.m_dimFloatAttribute[e]},l.IndexedFaceSet.prototype.GetIntAttributeDim=function(e){return this.m_dimIntAttribute[e]},l.IndexedFaceSet.prototype.GetFloatAttributeType=function(e){return this.m_typeFloatAttribute[e]},l.IndexedFaceSet.prototype.GetIntAttributeType=function(e){return this.m_typeIntAttribute[e]},l.IndexedFaceSet.prototype.GetFloatAttributeMax=function(e,i){return this.m_maxFloatAttribute[e*o.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES+i]},l.IndexedFaceSet.prototype.GetCreaseAngle=function(){return this.m_creaseAngle},l.IndexedFaceSet.prototype.GetCreaseAngle=function(){return this.m_creaseAngle},l.IndexedFaceSet.prototype.GetCCW=function(){return this.m_ccw},l.IndexedFaceSet.prototype.GetSolid=function(){return this.m_solid},l.IndexedFaceSet.prototype.GetConvex=function(){return this.m_convex},l.IndexedFaceSet.prototype.GetIsTriangularMesh=function(){return this.m_isTriangularMesh},l.IndexedFaceSet.prototype.GetCoordIndex=function(){return this.m_coordIndex},l.IndexedFaceSet.prototype.GetCoordIndex=function(){return this.m_coordIndex},l.IndexedFaceSet.prototype.GetCoord=function(){return this.m_coord},l.IndexedFaceSet.prototype.GetNormal=function(){return this.m_normal},l.IndexedFaceSet.prototype.GetFloatAttribute=function(e){return this.m_floatAttribute[e]},l.IndexedFaceSet.prototype.GetIntAttribute=function(e){return this.m_intAttribute[e]},l.IndexedFaceSet.prototype.SetNCoordIndex=function(e){this.m_nCoordIndex=e},l.IndexedFaceSet.prototype.SetNNormalIndex=function(){},l.IndexedFaceSet.prototype.SetNormalPerVertex=function(){},l.IndexedFaceSet.prototype.SetNFloatAttributeIndex=function(){},l.IndexedFaceSet.prototype.SetNIntAttributeIndex=function(){},l.IndexedFaceSet.prototype.SetFloatAttributePerVertex=function(){},l.IndexedFaceSet.prototype.SetIntAttributePerVertex=function(){},l.IndexedFaceSet.prototype.SetNCoord=function(e){this.m_nCoord=e},l.IndexedFaceSet.prototype.SetNNormal=function(e){this.m_nNormal=e},l.IndexedFaceSet.prototype.SetNumFloatAttributes=function(e){this.m_numFloatAttributes=e},l.IndexedFaceSet.prototype.SetNumIntAttributes=function(e){this.m_numIntAttributes=e},l.IndexedFaceSet.prototype.SetCreaseAngle=function(e){this.m_creaseAngle=e},l.IndexedFaceSet.prototype.SetCCW=function(e){this.m_ccw=e},l.IndexedFaceSet.prototype.SetSolid=function(e){this.m_solid=e},l.IndexedFaceSet.prototype.SetConvex=function(e){this.m_convex=e},l.IndexedFaceSet.prototype.SetIsTriangularMesh=function(e){this.m_isTriangularMesh=e},l.IndexedFaceSet.prototype.SetCoordMin=function(e,i){this.m_coordMin[e]=i},l.IndexedFaceSet.prototype.SetCoordMax=function(e,i){this.m_coordMax[e]=i},l.IndexedFaceSet.prototype.SetNormalMin=function(e,i){this.m_normalMin[e]=i},l.IndexedFaceSet.prototype.SetNormalMax=function(e,i){this.m_normalMax[e]=i},l.IndexedFaceSet.prototype.SetNFloatAttribute=function(e,i){this.m_nFloatAttribute[e]=i},l.IndexedFaceSet.prototype.SetNIntAttribute=function(e,i){this.m_nIntAttribute[e]=i},l.IndexedFaceSet.prototype.SetFloatAttributeDim=function(e,i){this.m_dimFloatAttribute[e]=i},l.IndexedFaceSet.prototype.SetIntAttributeDim=function(e,i){this.m_dimIntAttribute[e]=i},l.IndexedFaceSet.prototype.SetFloatAttributeType=function(e,i){this.m_typeFloatAttribute[e]=i},l.IndexedFaceSet.prototype.SetIntAttributeType=function(e,i){this.m_typeIntAttribute[e]=i},l.IndexedFaceSet.prototype.SetFloatAttributeMin=function(e,i,t){this.m_minFloatAttribute[e*o.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES+i]=t},l.IndexedFaceSet.prototype.SetFloatAttributeMax=function(e,i,t){this.m_maxFloatAttribute[e*o.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES+i]=t},l.IndexedFaceSet.prototype.SetCoordIndex=function(e){this.m_coordIndex=e},l.IndexedFaceSet.prototype.SetCoord=function(e){this.m_coord=e},l.IndexedFaceSet.prototype.SetNormal=function(e){this.m_normal=e},l.IndexedFaceSet.prototype.SetFloatAttribute=function(e,i){this.m_floatAttribute[e]=i},l.IndexedFaceSet.prototype.SetIntAttribute=function(e,i){this.m_intAttribute[e]=i},l.SC3DMCEncodeParams=function(){var e;for(this.m_numFloatAttributes=0,this.m_numIntAttributes=0,this.m_floatAttributeQuantBits=new Uint32Array(o.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES),this.m_floatAttributePredMode=new Uint32Array(o.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES),this.m_intAttributePredMode=new Uint32Array(o.O3DGC_SC3DMC_MAX_NUM_INT_ATTRIBUTES),this.m_encodeMode=o.O3DGC_SC3DMC_ENCODE_MODE_TFAN,this.m_streamTypeMode=o.O3DGC_STREAM_TYPE_ASCII,this.m_coordQuantBits=14,this.m_normalQuantBits=8,this.m_coordPredMode=o.O3DGC_SC3DMC_PARALLELOGRAM_PREDICTION,this.m_normalPredMode=o.O3DGC_SC3DMC_SURF_NORMALS_PREDICTION,e=0;o.O3DGC_SC3DMC_MAX_NUM_FLOAT_ATTRIBUTES>e;++e)this.m_floatAttributePredMode[e]=o.O3DGC_SC3DMC_PARALLELOGRAM_PREDICTION;for(e=0;o.O3DGC_SC3DMC_MAX_NUM_INT_ATTRIBUTES>e;++e)this.m_intAttributePredMode[e]=o.O3DGC_SC3DMC_DIFFERENTIAL_PREDICTION},l.SC3DMCEncodeParams.prototype.GetStreamType=function(){return this.m_streamTypeMode},l.SC3DMCEncodeParams.prototype.GetEncodeMode=function(){return this.m_encodeMode},l.SC3DMCEncodeParams.prototype.GetNumFloatAttributes=function(){return this.m_numFloatAttributes},l.SC3DMCEncodeParams.prototype.GetNumIntAttributes=function(){return this.m_numIntAttributes},l.SC3DMCEncodeParams.prototype.GetCoordQuantBits=function(){return this.m_coordQuantBits},l.SC3DMCEncodeParams.prototype.GetNormalQuantBits=function(){return this.m_normalQuantBits},l.SC3DMCEncodeParams.prototype.GetFloatAttributeQuantBits=function(e){return this.m_floatAttributeQuantBits[e]},l.SC3DMCEncodeParams.prototype.GetCoordPredMode=function(){return this.m_coordPredMode},l.SC3DMCEncodeParams.prototype.GetNormalPredMode=function(){return this.m_normalPredMode},l.SC3DMCEncodeParams.prototype.GetFloatAttributePredMode=function(e){return this.m_floatAttributePredMode[e]},l.SC3DMCEncodeParams.prototype.GetIntAttributePredMode=function(e){return this.m_intAttributePredMode[e]},l.SC3DMCEncodeParams.prototype.GetCoordPredMode=function(){return this.m_coordPredMode},l.SC3DMCEncodeParams.prototype.GetNormalPredMode=function(){return this.m_normalPredMode},l.SC3DMCEncodeParams.prototype.GetFloatAttributePredMode=function(e){return this.m_floatAttributePredMode[e]},l.SC3DMCEncodeParams.prototype.GetIntAttributePredMode=function(e){return this.m_intAttributePredMode[e]},l.SC3DMCEncodeParams.prototype.SetStreamType=function(e){this.m_streamTypeMode=e},l.SC3DMCEncodeParams.prototype.SetEncodeMode=function(e){this.m_encodeMode=e},l.SC3DMCEncodeParams.prototype.SetNumFloatAttributes=function(e){this.m_numFloatAttributes=e},l.SC3DMCEncodeParams.prototype.SetNumIntAttributes=function(e){this.m_numIntAttributes=e},l.SC3DMCEncodeParams.prototype.SetCoordQuantBits=function(e){this.m_coordQuantBits=e},l.SC3DMCEncodeParams.prototype.SetNormalQuantBits=function(e){this.m_normalQuantBits=e},l.SC3DMCEncodeParams.prototype.SetFloatAttributeQuantBits=function(e,i){this.m_floatAttributeQuantBits[e]=i},l.SC3DMCEncodeParams.prototype.SetCoordPredMode=function(e){this.m_coordPredMode=e},l.SC3DMCEncodeParams.prototype.SetNormalPredMode=function(e){this.m_normalPredMode=e},l.SC3DMCEncodeParams.prototype.SetFloatAttributePredMode=function(e,i){this.m_floatAttributePredMode[e]=i},l.SC3DMCEncodeParams.prototype.SetIntAttributePredMode=function(e,i){this.m_intAttributePredMode[e]=i},l.AdjacencyInfo=function(){this.m_neighborsSize=0,this.m_numNeighborsSize=0,this.m_numElements=0,this.m_neighbors={},this.m_numNeighbors={}},l.AdjacencyInfo.prototype.Allocate=function(e,i){return this.m_numElements=e,i>this.m_neighborsSize&&(this.m_neighborsSize=i,this.m_neighbors=new Int32Array(this.m_neighborsSize)),e>this.m_numNeighborsSize&&(this.m_numNeighborsSize=e,this.m_numNeighbors=new Int32Array(this.m_numNeighborsSize)),l.O3DGC_OK},l.AdjacencyInfo.prototype.AllocateNumNeighborsArray=function(e){return e>this.m_numNeighborsSize&&(this.m_numNeighborsSize=e,this.m_numNeighbors=new Int32Array(this.m_numNeighborsSize)),this.m_numElements=e,l.O3DGC_OK},l.AdjacencyInfo.prototype.AllocateNeighborsArray=function(){var e;for(e=1;this.m_numElements>e;++e)this.m_numNeighbors[e]+=this.m_numNeighbors[e-1];return this.m_numNeighbors[this.m_numElements-1]>this.m_neighborsSize&&(this.m_neighborsSize=this.m_numNeighbors[this.m_numElements-1],this.m_neighbors=new Int32Array(this.m_neighborsSize)),l.O3DGC_OK},l.AdjacencyInfo.prototype.ClearNumNeighborsArray=function(){var e;for(e=0;this.m_numElements>e;++e)this.m_numNeighbors[e]=0;return l.O3DGC_OK},l.AdjacencyInfo.prototype.ClearNeighborsArray=function(){var e;for(e=0;this.m_neighborsSize>e;++e)this.m_neighbors[e]=-1;return l.O3DGC_OK},l.AdjacencyInfo.prototype.Begin=function(e){return e>0?this.m_numNeighbors[e-1]:0},l.AdjacencyInfo.prototype.End=function(e){return this.m_numNeighbors[e]},l.AdjacencyInfo.prototype.AddNeighbor=function(e,i){var t,a,s;for(a=this.Begin(e),s=this.End(e),t=a;s>t;++t)if(-1===this.m_neighbors[t])return this.m_neighbors[t]=i,l.O3DGC_OK;return l.O3DGC_ERROR_BUFFER_FULL},l.AdjacencyInfo.prototype.GetNeighbor=function(e){return this.m_neighbors[e]},l.AdjacencyInfo.prototype.GetNumNeighbors=function(e){return this.End(e)-this.Begin(e)},l.AdjacencyInfo.prototype.GetNumNeighborsBuffer=function(){return this.m_numNeighbors},l.AdjacencyInfo.prototype.GetNeighborsBuffer=function(){return this.m_neighbors},l.Vector=function(){this.m_data={},this.m_allocated=0,this.m_size=0},l.Vector.prototype.Clear=function(){this.m_size=0},l.Vector.prototype.Get=function(e){return this.m_data[e]},l.Vector.prototype.GetAllocatedSize=function(){return this.m_allocated},l.Vector.prototype.GetSize=function(){return this.m_size},l.Vector.prototype.GetBuffer=function(){return this.m_data},l.Vector.prototype.SetSize=function(e){this.m_size=e},l.Vector.prototype.Allocate=function(e){var i,t;if(e>this.m_allocated){if(this.m_allocated=e,t=new Int32Array(this.m_allocated),this.m_size>0)for(i=0;this.m_size>i;++i)t[i]=this.m_data[i];this.m_data=t}},l.Vector.prototype.PushBack=function(e){var i,t;if(this.m_size===this.m_allocated){if(this.m_allocated*=2,this.m_allocated<o.O3DGC_DEFAULT_VECTOR_SIZE&&(this.m_allocated=o.O3DGC_DEFAULT_VECTOR_SIZE),t=new Int32Array(this.m_allocated),this.m_size>0)for(i=0;this.m_size>i;++i)t[i]=this.m_data[i];this.m_data=t}this.m_data[this.m_size++]=e},l.CompressedTriangleFans=function(){this.m_numTFANs=new l.Vector,this.m_degrees=new l.Vector,this.m_configs=new l.Vector,this.m_operations=new l.Vector,this.m_indices=new l.Vector,this.m_trianglesOrder=new l.Vector,this.m_streamType=o.O3DGC_STREAM_TYPE_UNKOWN
},l.CompressedTriangleFans.prototype.GetStreamType=function(){return this.m_streamType},l.CompressedTriangleFans.prototype.SetStreamType=function(e){this.m_streamType=e},l.CompressedTriangleFans.prototype.Clear=function(){return this.m_numTFANs.Clear(),this.m_degrees.Clear(),this.m_configs.Clear(),this.m_operations.Clear(),this.m_indices.Clear(),l.O3DGC_OK},l.CompressedTriangleFans.prototype.Allocate=function(e,i){return this.m_numTFANs.Allocate(e),this.m_degrees.Allocate(2*e),this.m_configs.Allocate(2*e),this.m_operations.Allocate(2*e),this.m_indices.Allocate(2*e),this.m_trianglesOrder.Allocate(i),this.Clear(),l.O3DGC_OK},l.CompressedTriangleFans.prototype.PushNumTFans=function(e){this.m_numTFANs.PushBack(e)},l.CompressedTriangleFans.prototype.ReadNumTFans=function(e){return this.m_numTFANs.Get(e.m_count++)},l.CompressedTriangleFans.prototype.PushDegree=function(e){this.m_degrees.PushBack(e)},l.CompressedTriangleFans.prototype.ReadDegree=function(e){return this.m_degrees.Get(e.m_count++)},l.CompressedTriangleFans.prototype.PushConfig=function(e){this.m_configs.PushBack(e)},l.CompressedTriangleFans.prototype.ReadConfig=function(e){return this.m_configs.Get(e.m_count++)},l.CompressedTriangleFans.prototype.PushOperation=function(e){this.m_operations.PushBack(e)},l.CompressedTriangleFans.prototype.ReadOperation=function(e){return this.m_operations.Get(e.m_count++)},l.CompressedTriangleFans.prototype.PushIndex=function(e){this.m_indices.PushBack(e)},l.CompressedTriangleFans.prototype.ReadIndex=function(e){return this.m_indices.Get(e.m_count++)},l.CompressedTriangleFans.prototype.PushTriangleIndex=function(e){this.m_trianglesOrder.PushBack(a(e))},l.CompressedTriangleFans.prototype.ReadTriangleIndex=function(e){return s(this.m_trianglesOrder.Get(e.m_count++))},l.CompressedTriangleFans.prototype.LoadUIntData=function(e,i,t){var a,s;for(i.ReadUInt32ASCII(t),a=i.ReadUInt32ASCII(t),e.Allocate(a),e.Clear(),s=0;a>s;++s)e.PushBack(i.ReadUIntASCII(t));return l.O3DGC_OK},l.CompressedTriangleFans.prototype.LoadIntData=function(e,i,t){var a,s;for(i.ReadUInt32ASCII(t),a=i.ReadUInt32ASCII(t),e.Allocate(a),e.Clear(),s=0;a>s;++s)e.PushBack(i.ReadIntASCII(t));return l.O3DGC_OK},l.CompressedTriangleFans.prototype.LoadBinData=function(e,i,t){var a,s,u,n;for(i.ReadUInt32ASCII(t),a=i.ReadUInt32ASCII(t),e.Allocate(a*o.O3DGC_BINARY_STREAM_BITS_PER_SYMBOL0),e.Clear(),u=0;a>u;)for(s=i.ReadUCharASCII(t),n=0;o.O3DGC_BINARY_STREAM_BITS_PER_SYMBOL0>n;++n)e.PushBack(1&s),s>>>=1,++u;return l.O3DGC_OK},l.CompressedTriangleFans.prototype.LoadUIntAC=function(e,i,t,a){var s,u,n,r,o,c,m;if(s=t.ReadUInt32Bin(a)-12,u=t.ReadUInt32Bin(a),0===u)return l.O3DGC_OK;for(n=t.ReadUInt32Bin(a),r=t.GetBuffer(a,s),a.m_count+=s,e.Allocate(u),o=new l.ArithmeticDecoder,o.SetBuffer(s,r),o.StartDecoder(),c=new l.AdaptiveDataModel,c.SetAlphabet(i+1),m=0;u>m;++m)e.PushBack(o.DecodeAdaptiveDataModel(c)+n);return l.O3DGC_OK},l.CompressedTriangleFans.prototype.LoadIntACEGC=function(e,i,t,a){var s,u,n,r,c,m,d,p,v,h;if(s=t.ReadUInt32Bin(a)-12,u=t.ReadUInt32Bin(a),0===u)return l.O3DGC_OK;for(n=t.ReadUInt32Bin(a)-o.O3DGC_MAX_LONG,r=t.GetBuffer(a,s),a.m_count+=s,e.Allocate(u),c=new l.ArithmeticDecoder,c.SetBuffer(s,r),c.StartDecoder(),m=new l.AdaptiveDataModel,m.SetAlphabet(i+2),d=new l.StaticBitModel,p=new l.AdaptiveBitModel,h=0;u>h;++h)v=c.DecodeAdaptiveDataModel(m),v===i&&(v+=c.ExpGolombDecode(0,d,p)),e.PushBack(v+n);return l.O3DGC_OK},l.CompressedTriangleFans.prototype.LoadBinAC=function(e,i,t){var a,s,u,n,r,o;if(a=i.ReadUInt32Bin(t)-8,s=i.ReadUInt32Bin(t),0===s)return l.O3DGC_OK;for(u=i.GetBuffer(t,a),t.m_count+=a,e.Allocate(s),n=new l.ArithmeticDecoder,n.SetBuffer(a,u),n.StartDecoder(),r=new l.AdaptiveBitModel,o=0;s>o;++o)e.PushBack(n.DecodeAdaptiveBitModel(r));return l.O3DGC_OK},l.CompressedTriangleFans.prototype.Load=function(e,i,t,a){return a===o.O3DGC_STREAM_TYPE_ASCII?(this.LoadUIntData(this.m_numTFANs,e,i),this.LoadUIntData(this.m_degrees,e,i),this.LoadUIntData(this.m_configs,e,i),this.LoadBinData(this.m_operations,e,i),this.LoadIntData(this.m_indices,e,i),t&&this.LoadUIntData(this.m_trianglesOrder,e,i)):(this.LoadIntACEGC(this.m_numTFANs,4,e,i),this.LoadIntACEGC(this.m_degrees,16,e,i),this.LoadUIntAC(this.m_configs,10,e,i),this.LoadBinAC(this.m_operations,e,i),this.LoadIntACEGC(this.m_indices,8,e,i),t&&this.LoadIntACEGC(this.m_trianglesOrder,16,e,i)),l.O3DGC_OK},l.TriangleFans=function(){this.m_verticesAllocatedSize=0,this.m_sizeTFANAllocatedSize=0,this.m_numTFANs=0,this.m_numVertices=0,this.m_sizeTFAN={},this.m_vertices={}},l.TriangleFans.prototype.Allocate=function(e,i){return this.m_numTFANs=0,this.m_numVertices=0,i>this.m_verticesAllocatedSize&&(this.m_verticesAllocatedSize=i,this.m_vertices=new Int32Array(this.m_verticesAllocatedSize)),e>this.m_sizeTFANAllocatedSize&&(this.m_sizeTFANAllocatedSize=e,this.m_sizeTFAN=new Int32Array(this.m_sizeTFANAllocatedSize)),l.O3DGC_OK},l.TriangleFans.prototype.Clear=function(){return this.m_numTFANs=0,this.m_numVertices=0,l.O3DGC_OK},l.TriangleFans.prototype.AddVertex=function(e){var i,t;if(++this.m_numVertices,this.m_numVertices>this.m_verticesAllocatedSize){for(this.m_verticesAllocatedSize*=2,t=new Int32Array(this.m_verticesAllocatedSize),i=0;this.m_numVertices>i;++i)t[i]=this.m_vertices[i];this.m_vertices=t}return this.m_vertices[this.m_numVertices-1]=e,++this.m_sizeTFAN[this.m_numTFANs-1],l.O3DGC_OK},l.TriangleFans.prototype.AddTFAN=function(){var e,i;if(++this.m_numTFANs,this.m_numTFANs>this.m_sizeTFANAllocatedSize){for(this.m_sizeTFANAllocatedSize*=2,i=new Int32Array(this.m_sizeTFANAllocatedSize),e=0;this.m_numTFANs>e;++e)i[e]=this.m_sizeTFAN[e];this.m_sizeTFAN=i}return this.m_sizeTFAN[this.m_numTFANs-1]=this.m_numTFANs>1?this.m_sizeTFAN[this.m_numTFANs-2]:0,l.O3DGC_OK},l.TriangleFans.prototype.Begin=function(e){return e>0?this.m_sizeTFAN[e-1]:0},l.TriangleFans.prototype.End=function(e){return this.m_sizeTFAN[e]},l.TriangleFans.prototype.GetVertex=function(e){return this.m_vertices[e]},l.TriangleFans.prototype.GetTFANSize=function(e){return this.End(e)-this.Begin(e)},l.TriangleFans.prototype.GetNumTFANs=function(){return this.m_numTFANs},l.TriangleFans.prototype.GetNumVertices=function(){return this.m_numVertices},l.TriangleListDecoder=function(){this.m_itNumTFans=new l.Iterator,this.m_itDegree=new l.Iterator,this.m_itConfig=new l.Iterator,this.m_itOperation=new l.Iterator,this.m_itIndex=new l.Iterator,this.m_maxNumVertices=0,this.m_maxNumTriangles=0,this.m_numTriangles=0,this.m_numVertices=0,this.m_tempTrianglesSize=0,this.m_vertexCount=0,this.m_triangleCount=0,this.m_numConqueredTriangles=0,this.m_numVisitedVertices=0,this.m_triangles={},this.m_tempTriangles={},this.m_visitedVertices={},this.m_visitedVerticesValence={},this.m_vertexToTriangle=new l.AdjacencyInfo,this.m_ctfans=new l.CompressedTriangleFans,this.m_tfans=new l.TriangleFans,this.m_streamType=o.O3DGC_STREAM_TYPE_ASCII,this.m_decodeTrianglesOrder=!1,this.m_decodeVerticesOrder=!1,this.m_processConfig={0:function(e,i){var t;for(e.m_tfans.AddVertex(e.m_visitedVertices[0]),t=1;i-1>t;++t)e.m_visitedVertices[e.m_numVisitedVertices++]=e.m_vertexCount,e.m_tfans.AddVertex(e.m_vertexCount++);e.m_tfans.AddVertex(e.m_visitedVertices[1])},1:function(e,i,t){var a,s,u;for(e.m_tfans.AddVertex(e.m_visitedVertices[0]),a=1;i-1>a;++a)s=e.m_ctfans.ReadOperation(e.m_itOperation),1===s?(u=e.m_ctfans.ReadIndex(e.m_itIndex),0>u?e.m_tfans.AddVertex(e.m_visitedVertices[-u-1]):e.m_tfans.AddVertex(u+t)):(e.m_visitedVertices[e.m_numVisitedVertices++]=e.m_vertexCount,e.m_tfans.AddVertex(e.m_vertexCount++));e.m_tfans.AddVertex(e.m_visitedVertices[1])},2:function(e,i){var t;for(t=0;i-1>t;++t)e.m_visitedVertices[e.m_numVisitedVertices++]=e.m_vertexCount,e.m_tfans.AddVertex(e.m_vertexCount++);e.m_tfans.AddVertex(e.m_visitedVertices[0])},3:function(e,i){var t;for(t=0;i-1>t;++t)e.m_visitedVertices[e.m_numVisitedVertices++]=e.m_vertexCount,e.m_tfans.AddVertex(e.m_vertexCount++);e.m_tfans.AddVertex(e.m_visitedVertices[1])},4:function(e,i){var t;for(e.m_tfans.AddVertex(e.m_visitedVertices[0]),t=1;i>t;++t)e.m_visitedVertices[e.m_numVisitedVertices++]=e.m_vertexCount,e.m_tfans.AddVertex(e.m_vertexCount++)},5:function(e,i){var t;for(e.m_tfans.AddVertex(e.m_visitedVertices[1]),t=1;i>t;++t)e.m_visitedVertices[e.m_numVisitedVertices++]=e.m_vertexCount,e.m_tfans.AddVertex(e.m_vertexCount++)},6:function(e,i){var t;for(t=0;i>t;++t)e.m_visitedVertices[e.m_numVisitedVertices++]=e.m_vertexCount,e.m_tfans.AddVertex(e.m_vertexCount++)},7:function(e,i){var t;for(e.m_tfans.AddVertex(e.m_visitedVertices[1]),t=1;i-1>t;++t)e.m_visitedVertices[e.m_numVisitedVertices++]=e.m_vertexCount,e.m_tfans.AddVertex(e.m_vertexCount++);e.m_tfans.AddVertex(e.m_visitedVertices[0])},8:function(e,i,t){var a,s,u;for(e.m_tfans.AddVertex(e.m_visitedVertices[1]),a=1;i-1>a;++a)s=e.m_ctfans.ReadOperation(e.m_itOperation),1===s?(u=e.m_ctfans.ReadIndex(e.m_itIndex),0>u?e.m_tfans.AddVertex(e.m_visitedVertices[-u-1]):e.m_tfans.AddVertex(u+t)):(e.m_visitedVertices[e.m_numVisitedVertices++]=e.m_vertexCount,e.m_tfans.AddVertex(e.m_vertexCount++));e.m_tfans.AddVertex(e.m_visitedVertices[0])},9:function(e,i,t){var a,s,u;for(a=0;i>a;++a)s=e.m_ctfans.ReadOperation(e.m_itOperation),1===s?(u=e.m_ctfans.ReadIndex(e.m_itIndex),0>u?e.m_tfans.AddVertex(e.m_visitedVertices[-u-1]):e.m_tfans.AddVertex(u+t)):(e.m_visitedVertices[e.m_numVisitedVertices++]=e.m_vertexCount,e.m_tfans.AddVertex(e.m_vertexCount++))}}},l.TriangleListDecoder.prototype.GetStreamType=function(){return this.m_streamType},l.TriangleListDecoder.prototype.GetReorderTriangles=function(){return this.m_decodeTrianglesOrder},l.TriangleListDecoder.prototype.GetReorderVertices=function(){return this.m_decodeVerticesOrder},l.TriangleListDecoder.prototype.SetStreamType=function(e){this.m_streamType=e},l.TriangleListDecoder.prototype.GetVertexToTriangle=function(){return this.m_vertexToTriangle},l.TriangleListDecoder.prototype.Reorder=function(){var e,i,t,a,u,n,r,o;if(this.m_decodeTrianglesOrder)for(e=this.m_triangles,i=this.m_numTriangles,t=this.m_ctfans.m_trianglesOrder.m_data,n=this.m_tempTriangles,n.set(e),a=0,u=0,o=0;i>o;++o)r=s(t[a++])+u,e[3*r]=n[3*o],e[3*r+1]=n[3*o+1],e[3*r+2]=n[3*o+2],u=r+1;return l.O3DGC_OK},l.TriangleListDecoder.prototype.CompueLocalConnectivityInfo=function(e){var i,t,a,s,u,n,r,o,c,m,d,p,v,h,g,f,b,q,_;for(i=this.m_visitedVertices,t=this.m_visitedVerticesValence,a=this.m_triangles,s=this.m_vertexToTriangle,u=s.Begin(e),n=s.End(e),r=0,c=0,b=0,d=u;b>=0&&n>d;++d)if(b=s.GetNeighbor(d),b>=0)for(++r,q=3*b,v=0;3>v;++v)if(_=a[q+v],_>e){for(o=!1,p=0;c>p;++p){if(_===i[p]){t[p]++,o=!0;break}if(i[p]>_){for(++c,h=c-1;h>p;--h)i[h]=i[h-1],t[h]=t[h-1];i[p]=_,t[p]=1,o=!0;break}}o||(i[c]=_,t[c]=1,c++)}if(c>2)for(g=1;c>g;++g)if(1===t[g])for(f=g;f>0&&t[f]<t[f-1];)m=t[f],t[f]=t[f-1],t[f-1]=m,m=i[f],i[f]=i[f-1],i[f-1]=m,--f;return this.m_numConqueredTriangles=r,this.m_numVisitedVertices=c,l.O3DGC_OK},l.TriangleListDecoder.prototype.DecompressTFAN=function(e){var i,t,a,s,u,n,r,o,c,m,d,p,v,h,g,f,b,q,_;if(i=this.m_vertexToTriangle,t=this.m_triangles,a=this.m_itDegree,s=this.m_itConfig,u=this.m_tfans,r=this.m_processConfig,o=this.m_ctfans,c=this.m_triangleCount,m=this.m_numConqueredTriangles,n=o.ReadNumTFans(this.m_itNumTFans),n>0)for(q=0;n>q;++q)for(u.AddTFAN(),d=o.ReadDegree(a)+2-m,p=o.ReadConfig(s),v=u.GetNumVertices(),u.AddVertex(e),r[p](this,d,e),h=u.GetNumVertices(),g=u.GetVertex(v+1),_=v+2;h>_;++_)f=u.GetVertex(_),b=3*c,t[b++]=e,t[b++]=g,t[b]=f,i.AddNeighbor(e,c),i.AddNeighbor(g,c),i.AddNeighbor(f,c),g=f,c++;return this.m_triangleCount=c,l.O3DGC_OK},l.TriangleListDecoder.prototype.Decompress=function(){var e;for(e=0;this.m_numVertices>e;++e)e===this.m_vertexCount&&this.m_vertexCount++,this.CompueLocalConnectivityInfo(e),this.DecompressTFAN(e);return l.O3DGC_OK},l.TriangleListDecoder.prototype.Init=function(e,i,t,a){var s,u;for(this.m_numTriangles=i,this.m_numVertices=t,this.m_triangles=e,this.m_vertexCount=0,this.m_triangleCount=0,this.m_itNumTFans.m_count=0,this.m_itDegree.m_count=0,this.m_itConfig.m_count=0,this.m_itOperation.m_count=0,this.m_itIndex.m_count=0,this.m_numVertices>this.m_maxNumVertices&&(this.m_maxNumVertices=this.m_numVertices,this.m_visitedVerticesValence=new Int32Array(this.m_numVertices),this.m_visitedVertices=new Int32Array(this.m_numVertices)),this.m_decodeTrianglesOrder&&this.m_tempTrianglesSize<this.m_numTriangles&&(this.m_tempTrianglesSize=this.m_numTriangles,this.m_tempTriangles=new Int32Array(3*this.m_tempTrianglesSize)),this.m_ctfans.SetStreamType(this.m_streamType),this.m_ctfans.Allocate(this.m_numVertices,this.m_numTriangles),this.m_tfans.Allocate(2*this.m_numVertices,8*this.m_numVertices),this.m_vertexToTriangle.AllocateNumNeighborsArray(t),u=this.m_vertexToTriangle.GetNumNeighborsBuffer(),s=0;t>s;++s)u[s]=a;return this.m_vertexToTriangle.AllocateNeighborsArray(),this.m_vertexToTriangle.ClearNeighborsArray(),l.O3DGC_OK},l.TriangleListDecoder.prototype.Decode=function(e,i,t,a,s){var u,n;return u=a.ReadUChar(s,this.m_streamType),this.m_decodeTrianglesOrder=0!==(2&u),this.m_decodeVerticesOrder=0!==(1&u),this.m_decodeVerticesOrder?l.O3DGC_ERROR_NON_SUPPORTED_FEATURE:(n=a.ReadUInt32(s,this.m_streamType),this.Init(e,i,t,n),this.m_ctfans.Load(a,s,this.m_decodeTrianglesOrder,this.m_streamType),this.Decompress(),l.O3DGC_OK)},l.SC3DMCDecoder=function(){var e;for(this.m_iterator=new l.Iterator,this.m_streamSize=0,this.m_params=new l.SC3DMCEncodeParams,this.m_triangleListDecoder=new l.TriangleListDecoder,this.m_quantFloatArray={},this.m_orientation={},this.m_normals={},this.m_quantFloatArraySize=0,this.m_normalsSize=0,this.m_orientationSize=0,this.m_stats=new l.SC3DMCStats,this.m_streamType=o.O3DGC_STREAM_TYPE_UNKOWN,this.m_neighbors=[],this.m_idelta=new Float32Array(o.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES),this.m_minNormal=new Float32Array(2),this.m_maxNormal=new Float32Array(2),this.m_minNormal[0]=this.m_minNormal[1]=-2,this.m_maxNormal[0]=this.m_maxNormal[1]=2,e=0;o.O3DGC_SC3DMC_MAX_DIM_ATTRIBUTES>e;++e)this.m_neighbors[e]=new l.SC3DMCPredictor},l.SC3DMCDecoder.prototype.GetStats=function(){return this.m_stats},l.SC3DMCDecoder.prototype.DecodeHeader=function(e,i){var t,a,s,u,n,r;if(t=this.m_iterator.m_count,a=i.ReadUInt32(this.m_iterator,o.O3DGC_STREAM_TYPE_BINARY),a!==o.O3DGC_SC3DMC_START_CODE){if(this.m_iterator.m_count=t,a=i.ReadUInt32(this.m_iterator,o.O3DGC_STREAM_TYPE_ASCII),a!==o.O3DGC_SC3DMC_START_CODE)return l.O3DGC_ERROR_CORRUPTED_STREAM;this.m_streamType=o.O3DGC_STREAM_TYPE_ASCII}else this.m_streamType=o.O3DGC_STREAM_TYPE_BINARY;if(this.m_streamSize=i.ReadUInt32(this.m_iterator,this.m_streamType),this.m_params.SetEncodeMode(i.ReadUChar(this.m_iterator,this.m_streamType)),e.SetCreaseAngle(i.ReadFloat32(this.m_iterator,this.m_streamType)),s=i.ReadUChar(this.m_iterator,this.m_streamType),e.SetCCW(1===(1&s)),e.SetSolid(1===(2&s)),e.SetConvex(1===(4&s)),e.SetIsTriangularMesh(1===(8&s)),e.SetNCoord(i.ReadUInt32(this.m_iterator,this.m_streamType)),e.SetNNormal(i.ReadUInt32(this.m_iterator,this.m_streamType)),e.SetNumFloatAttributes(i.ReadUInt32(this.m_iterator,this.m_streamType)),e.SetNumIntAttributes(i.ReadUInt32(this.m_iterator,this.m_streamType)),e.GetNCoord()>0){for(e.SetNCoordIndex(i.ReadUInt32(this.m_iterator,this.m_streamType)),u=0;3>u;++u)e.SetCoordMin(u,i.ReadFloat32(this.m_iterator,this.m_streamType)),e.SetCoordMax(u,i.ReadFloat32(this.m_iterator,this.m_streamType));this.m_params.SetCoordQuantBits(i.ReadUChar(this.m_iterator,this.m_streamType))}if(e.GetNNormal()>0){for(e.SetNNormalIndex(i.ReadUInt32(this.m_iterator,this.m_streamType)),u=0;3>u;++u)e.SetNormalMin(u,i.ReadFloat32(this.m_iterator,this.m_streamType)),e.SetNormalMax(u,i.ReadFloat32(this.m_iterator,this.m_streamType));e.SetNormalPerVertex(1===i.ReadUChar(this.m_iterator,this.m_streamType)),this.m_params.SetNormalQuantBits(i.ReadUChar(this.m_iterator,this.m_streamType))}for(n=0;e.GetNumFloatAttributes()>n;++n)if(e.SetNFloatAttribute(n,i.ReadUInt32(this.m_iterator,this.m_streamType)),e.GetNFloatAttribute(n)>0){for(e.SetNFloatAttributeIndex(n,i.ReadUInt32(this.m_iterator,this.m_streamType)),r=i.ReadUChar(this.m_iterator,this.m_streamType),e.SetFloatAttributeDim(n,r),u=0;r>u;++u)e.SetFloatAttributeMin(n,u,i.ReadFloat32(this.m_iterator,this.m_streamType)),e.SetFloatAttributeMax(n,u,i.ReadFloat32(this.m_iterator,this.m_streamType));e.SetFloatAttributePerVertex(n,1===i.ReadUChar(this.m_iterator,this.m_streamType)),e.SetFloatAttributeType(n,i.ReadUChar(this.m_iterator,this.m_streamType)),this.m_params.SetFloatAttributeQuantBits(n,i.ReadUChar(this.m_iterator,this.m_streamType))}for(n=0;e.GetNumIntAttributes()>n;++n)e.SetNIntAttribute(n,i.ReadUInt32(this.m_iterator,this.m_streamType)),e.GetNIntAttribute(n)>0&&(e.SetNIntAttributeIndex(n,i.ReadUInt32(this.m_iterator,this.m_streamType)),e.SetIntAttributeDim(n,i.ReadUChar(this.m_iterator,this.m_streamType)),e.SetIntAttributePerVertex(n,1===i.ReadUChar(this.m_iterator,this.m_streamType)),e.SetIntAttributeType(n,i.ReadUChar(this.m_iterator,this.m_streamType)));return l.O3DGC_OK},l.SC3DMCDecoder.prototype.DecodeIntArrayBinary=function(e,i,t,a,s,n,r){var c,m,d,p,v,h,g,f,b,q,_,y,S,P,C,N,D,M,E,A,w,x,I,T,L,V,j,O,F,R,k,U;if(b=this.m_iterator,q=this.m_streamType,y=new l.ArithmeticDecoder,S=new l.StaticBitModel,P=new l.AdaptiveBitModel,C=new l.AdaptiveDataModel,C.SetAlphabet(o.O3DGC_SC3DMC_MAX_PREDICTION_NEIGHBORS+1),N=this.m_triangleListDecoder.GetVertexToTriangle(),D=N.m_neighbors,M=s.GetCoordIndex(),E=i*t,A=b.m_count,w=r.ReadUInt32(b,q),x=r.ReadUChar(b,q),I=7&x>>>4,n.m_value=7&x,w-=b.m_count-A,T=new l.Iterator,T.m_count=b.m_count+w,L=0,V=0,j=new l.SC3DMCTriplet(-1,-1,-1),I!==o.O3DGC_SC3DMC_BINARIZATION_AC_EGC)return l.O3DGC_ERROR_CORRUPTED_STREAM;for(f=r.GetBuffer(b,w),b.m_count+=w,y.SetBuffer(w,f),y.StartDecoder(),L=y.ExpGolombDecode(0,S,P),V=y.ExpGolombDecode(0,S,P),O=new l.AdaptiveDataModel,O.SetAlphabet(V+2),F=this.m_neighbors,R=this.m_normals,k=new l.NumberRef,c=n.m_value!==o.O3DGC_SC3DMC_NO_PREDICTION,U=0;i>U;++U){if(k.m_value=0,N.GetNumNeighbors(U)>0&&c)for(h=N.Begin(U),g=N.End(U),p=h;g>p&&(v=D[p],!(0>v));++p)u(M,v,U,k,F,t,e,a);if(k.m_value>1)for(m=y.DecodeAdaptiveDataModel(C),d=0;t>d;++d)_=y.DecodeIntACEGC(O,S,P,L,V),e[U*a+d]=_+F[m].m_pred[d];else if(U>0&&n.m_value!==o.O3DGC_SC3DMC_NO_PREDICTION)for(d=0;t>d;++d)_=y.DecodeIntACEGC(O,S,P,L,V),e[U*a+d]=_+e[(U-1)*a+d];else for(d=0;t>d;++d)_=y.DecodeUIntACEGC(O,S,P,L,V),e[U*a+d]=_}return b.m_count=T.m_count,l.O3DGC_OK},l.SC3DMCDecoder.prototype.DecodeIntArrayASCII=function(e,i,t,a,s,n,r){var c,m,d,p,v,h,g,f,b,q,_,y,S,P,C,N,D,M,E,A,w,x,I,T;if(m=this.m_iterator,d=this.m_streamType,v=this.m_triangleListDecoder.GetVertexToTriangle(),h=v.m_neighbors,g=s.GetCoordIndex(),f=i*t,b=m.m_count,q=r.ReadUInt32(m,d),_=r.ReadUChar(m,d),y=7&_>>>4,n.m_value=7&_,q-=m.m_count-b,S=new l.Iterator,S.m_count=m.m_count+q,P=new l.SC3DMCTriplet(-1,-1,-1),y!==o.O3DGC_SC3DMC_BINARIZATION_ASCII)return l.O3DGC_ERROR_CORRUPTED_STREAM;for(r.ReadUInt32(S,d),C=this.m_neighbors,N=this.m_normals,D=new l.NumberRef,c=n.m_value!==o.O3DGC_SC3DMC_NO_PREDICTION,M=0;i>M;++M){if(D.m_value=0,v.GetNumNeighbors(M)>0&&c)for(E=v.Begin(M),A=v.End(M),w=E;A>w&&(x=h[w],!(0>x));++w)u(g,x,M,D,C,t,e,a);if(D.m_value>1)for(T=r.ReadUCharASCII(S),I=0;t>I;++I)p=r.ReadIntASCII(m),e[M*a+I]=p+C[T].m_pred[I];else if(M>0&&n.m_value!==o.O3DGC_SC3DMC_NO_PREDICTION)for(I=0;t>I;++I)p=r.ReadIntASCII(m),e[M*a+I]=p+e[(M-1)*a+I];else for(I=0;t>I;++I)p=r.ReadUIntASCII(m),e[M*a+I]=p}return m.m_count=S.m_count,l.O3DGC_OK},l.SC3DMCDecoder.prototype.DecodeIntArray=function(e,i,t,a,s,u,n){return this.m_streamType===o.O3DGC_STREAM_TYPE_ASCII?this.DecodeIntArrayASCII(e,i,t,a,s,u,n):this.DecodeIntArrayBinary(e,i,t,a,s,u,n)},l.SC3DMCDecoder.prototype.ProcessNormals=function(e){var i,a,s,u,n,o,c,m,d,p,v,h,g,f,b;for(s=e.GetNNormal(),u=3*e.GetNNormal(),u>this.m_normalsSize&&(this.m_normalsSize=u,this.m_normals=new Float32Array(this.m_normalsSize)),n=this.m_normals,o=this.m_quantFloatArray,c=this.m_orientation,m=e.GetCoordIndex(),r(m,e.GetNCoordIndex(),o,s,n),d=new l.Vec3,p=new l.Vec3,v=0;s>v;++v)i=3*v,d.m_x=n[i],d.m_y=n[i+1],d.m_z=n[i+2],b=Math.sqrt(d.m_x*d.m_x+d.m_y*d.m_y+d.m_z*d.m_z),0===b&&(b=1),t(d,p),h=p.m_x/b,g=p.m_y/b,f=p.m_z+c[v],c[v]=f,f>>>1!==p.m_z>>>1&&(h=0,g=0),a=2*v,n[a]=h,n[a+1]=g;return l.O3DGC_OK},l.SC3DMCDecoder.prototype.IQuantize=function(e,i,t,a,s,u,n,r){var c,m,d,p,v,h;if(r.m_value===o.O3DGC_SC3DMC_SURF_NORMALS_PREDICTION)for(h=o.CubeToSphere,p=this.m_orientation,v=this.m_normals,m=new l.Vec3(0,0,0),d=new l.Vec3(0,0,0),this.IQuantizeFloatArray(e,i,t,a,this.m_minNormal,this.m_maxNormal,n+1),c=0;i>c;++c)m.m_x=e[a*c]+v[2*c],m.m_y=e[a*c+1]+v[2*c+1],m.m_z=p[c],h[m.m_z](m,d),e[a*c]=d.m_x,e[a*c+1]=d.m_y,e[a*c+2]=d.m_z;else this.IQuantizeFloatArray(e,i,t,a,s,u,n)},l.SC3DMCDecoder.prototype.DecodeFloatArrayBinary=function(e,i,t,a,r,c,m,d,p,v){var h,g,f,b,q,_,y,S,P,C,N,D,M,E,A,w,x,I,T,L,V,j,O,F,R,k,U,z,B,Q,G,W,H,X,Y,K;if(x=this.m_iterator,I=this.m_orientation,T=this.m_streamType,V=new l.ArithmeticDecoder,j=new l.StaticBitModel,O=new l.AdaptiveBitModel,F=new l.AdaptiveDataModel,h=o.O3DGC_SC3DMC_MAX_PREDICTION_NEIGHBORS,F.SetAlphabet(h+1),R=this.m_triangleListDecoder.GetVertexToTriangle(),k=R.m_neighbors,U=d.GetCoordIndex(),z=i*t,B=x.m_count,Q=v.ReadUInt32(x,T),G=v.ReadUChar(x,T),W=7&G>>>4,p.m_value=7&G,Q-=x.m_count-B,H=new l.Iterator,H.m_count=x.m_count+Q,X=0,Y=0,W!==o.O3DGC_SC3DMC_BINARIZATION_AC_EGC)return l.O3DGC_ERROR_CORRUPTED_STREAM;if(_=v.GetBuffer(x,Q),x.m_count+=Q,V.SetBuffer(Q,_),V.StartDecoder(),X=V.ExpGolombDecode(0,j,O),Y=V.ExpGolombDecode(0,j,O),K=new l.AdaptiveDataModel,K.SetAlphabet(Y+2),p.m_value===o.O3DGC_SC3DMC_SURF_NORMALS_PREDICTION){for(z>this.m_orientationSize&&(this.m_orientationSize=z,this.m_orientation=new Int8Array(this.m_orientationSize),I=this.m_orientation),q=new l.AdaptiveDataModel,q.SetAlphabet(12),D=0;i>D;++D)I[D]=s(V.DecodeAdaptiveDataModel(q));this.ProcessNormals(d),t=2}for(z>this.m_quantFloatArraySize&&(this.m_quantFloatArraySize=z,this.m_quantFloatArray=new Int32Array(this.m_quantFloatArraySize)),y=this.m_quantFloatArray,S=this.m_neighbors,P=this.m_normals,C=new l.NumberRef,g=p.m_value!==o.O3DGC_SC3DMC_NO_PREDICTION,f=p.m_value===o.O3DGC_SC3DMC_PARALLELOGRAM_PREDICTION,M=0;i>M;++M){if(C.m_value=0,R.GetNumNeighbors(M)>0&&g){if(A=R.Begin(M),w=R.End(M),f)for(E=A;w>E&&(N=k[E],!(0>N));++E)n(U,N,M,C,S,t,y,a,R,k);if(h>C.m_value)for(E=A;w>E&&(N=k[E],!(0>N));++E)u(U,N,M,C,S,t,y,a)}if(C.m_value>1)for(b=V.DecodeAdaptiveDataModel(F),D=0;t>D;++D)L=V.DecodeIntACEGC(K,j,O,X,Y),y[M*a+D]=L+S[b].m_pred[D];else if(M>0&&g)for(D=0;t>D;++D)L=V.DecodeIntACEGC(K,j,O,X,Y),y[M*a+D]=L+y[(M-1)*a+D];else for(D=0;t>D;++D)L=V.DecodeUIntACEGC(K,j,O,X,Y),y[M*a+D]=L}return x.m_count=H.m_count,this.IQuantize(e,i,t,a,r,c,m,p),l.O3DGC_OK},l.SC3DMCDecoder.prototype.DecodeFloatArrayASCII=function(e,i,t,a,s,r,c,m,d,p){var v,h,g,f,b,q,_,y,S,P,C,N,D,M,E,A,w,x,I,T,L,V,j,O,F,R,k;if(v=o.O3DGC_SC3DMC_MAX_PREDICTION_NEIGHBORS,f=this.m_iterator,b=this.m_orientation,q=this.m_streamType,y=this.m_triangleListDecoder.GetVertexToTriangle(),S=y.m_neighbors,P=m.GetCoordIndex(),C=i*t,N=f.m_count,D=p.ReadUInt32(f,q),M=p.ReadUChar(f,q),E=7&M>>>4,d.m_value=7&M,D-=f.m_count-N,A=new l.Iterator,A.m_count=f.m_count+D,E!==o.O3DGC_SC3DMC_BINARIZATION_ASCII)return l.O3DGC_ERROR_CORRUPTED_STREAM;if(p.ReadUInt32(A,q),d.m_value===o.O3DGC_SC3DMC_SURF_NORMALS_PREDICTION){for(i>this.m_orientationSize&&(this.m_orientationSize=i,this.m_orientation=new Int8Array(this.m_orientationSize),b=this.m_orientation),R=0;i>R;++R)b[R]=p.ReadIntASCII(f);this.ProcessNormals(m),t=2}for(C>this.m_quantFloatArraySize&&(this.m_quantFloatArraySize=C,this.m_quantFloatArray=new Int32Array(this.m_quantFloatArraySize)),w=this.m_quantFloatArray,x=this.m_neighbors,I=this.m_normals,T=new l.NumberRef,h=d.m_value!==o.O3DGC_SC3DMC_NO_PREDICTION,g=d.m_value===o.O3DGC_SC3DMC_PARALLELOGRAM_PREDICTION,L=0;i>L;++L){if(T.m_value=0,y.GetNumNeighbors(L)>0&&h){if(j=y.Begin(L),O=y.End(L),g)for(V=j;O>V&&(F=S[V],!(0>F));++V)n(P,F,L,T,x,t,w,a,y,S);if(v>T.m_value)for(V=j;O>V&&(F=S[V],!(0>F));++V)u(P,F,L,T,x,t,w,a)}if(T.m_value>1)for(k=p.ReadUCharASCII(A),R=0;t>R;++R)_=p.ReadIntASCII(f),w[L*a+R]=_+x[k].m_pred[R];else if(L>0&&d.m_value!==o.O3DGC_SC3DMC_NO_PREDICTION)for(R=0;t>R;++R)_=p.ReadIntASCII(f),w[L*a+R]=_+w[(L-1)*a+R];else for(R=0;t>R;++R)_=p.ReadUIntASCII(f),w[L*a+R]=_}return f.m_count=A.m_count,this.IQuantize(e,i,t,a,s,r,c,d),l.O3DGC_OK},l.SC3DMCDecoder.prototype.DecodeFloatArray=function(e,i,t,a,s,u,n,r,l,c){return this.m_streamType===o.O3DGC_STREAM_TYPE_ASCII?this.DecodeFloatArrayASCII(e,i,t,a,s,u,n,r,l,c):this.DecodeFloatArrayBinary(e,i,t,a,s,u,n,r,l,c)},l.SC3DMCDecoder.prototype.IQuantizeFloatArray=function(e,i,t,a,s,u,n){var r,o,c,m,d;for(r=this.m_idelta,o=this.m_quantFloatArray,c=0;t>c;++c)m=u[c]-s[c],r[c]=m>0?m/((1<<n>>>0)-1):1;for(d=0;i>d;++d)for(c=0;t>c;++c)e[d*a+c]=o[d*a+c]*r[c]+s[c];return l.O3DGC_OK},l.SC3DMCDecoder.prototype.DecodePlayload=function(e,i){var t,a,s,u,n,r,o;if(t=this.m_params,a=this.m_iterator,s=this.m_stats,u=new l.NumberRef,n=new l.Timer,r=l.O3DGC_OK,this.m_triangleListDecoder.SetStreamType(this.m_streamType),s.m_streamSizeCoordIndex=a.m_count,n.Tic(),this.m_triangleListDecoder.Decode(e.GetCoordIndex(),e.GetNCoordIndex(),e.GetNCoord(),i,a),n.Toc(),s.m_timeCoordIndex=n.GetElapsedTime(),s.m_streamSizeCoordIndex=a.m_count-s.m_streamSizeCoordIndex,s.m_streamSizeCoord=a.m_count,n.Tic(),e.GetNCoord()>0&&(r=this.DecodeFloatArray(e.GetCoord(),e.GetNCoord(),3,3,e.GetCoordMinArray(),e.GetCoordMaxArray(),t.GetCoordQuantBits(),e,u,i),t.SetCoordPredMode(u.m_value)),r!==l.O3DGC_OK)return r;if(n.Toc(),s.m_timeCoord=n.GetElapsedTime(),s.m_streamSizeCoord=a.m_count-s.m_streamSizeCoord,s.m_streamSizeNormal=a.m_count,n.Tic(),e.GetNNormal()>0&&(r=this.DecodeFloatArray(e.GetNormal(),e.GetNNormal(),3,3,e.GetNormalMinArray(),e.GetNormalMaxArray(),t.GetNormalQuantBits(),e,u,i),t.SetNormalPredMode(u.m_value)),r!==l.O3DGC_OK)return r;for(n.Toc(),s.m_timeNormal=n.GetElapsedTime(),s.m_streamSizeNormal=a.m_count-s.m_streamSizeNormal,o=0;e.GetNumFloatAttributes()>o;++o)s.m_streamSizeFloatAttribute[o]=a.m_count,n.Tic(),r=this.DecodeFloatArray(e.GetFloatAttribute(o),e.GetNFloatAttribute(o),e.GetFloatAttributeDim(o),e.GetFloatAttributeDim(o),e.GetFloatAttributeMinArray(o),e.GetFloatAttributeMaxArray(o),t.GetFloatAttributeQuantBits(o),e,u,i),t.SetFloatAttributePredMode(o,u.m_value),n.Toc(),s.m_timeFloatAttribute[o]=n.GetElapsedTime(),s.m_streamSizeFloatAttribute[o]=a.m_count-s.m_streamSizeFloatAttribute[o];if(r!==l.O3DGC_OK)return r;for(o=0;e.GetNumIntAttributes()>o;++o)s.m_streamSizeIntAttribute[o]=a.m_count,n.Tic(),r=this.DecodeIntArray(e.GetIntAttribute(o),e.GetNIntAttribute(o),e.GetIntAttributeDim(o),e.GetIntAttributeDim(o),e,u,i),t.SetIntAttributePredMode(o,u.m_value),n.Toc(),s.m_timeIntAttribute[o]=n.GetElapsedTime(),s.m_streamSizeIntAttribute[o]=a.m_count-s.m_streamSizeIntAttribute[o];return r!==l.O3DGC_OK?r:(n.Tic(),this.m_triangleListDecoder.Reorder(),n.Toc(),s.m_timeReorder=n.GetElapsedTime(),r)},l.DVEncodeParams=function(){this.m_encodeMode=o.O3DGC_DYNAMIC_VECTOR_ENCODE_MODE_LIFT,this.m_streamTypeMode=o.O3DGC_STREAM_TYPE_ASCII,this.m_quantBits=10},l.DVEncodeParams.prototype.GetStreamType=function(){return this.m_streamTypeMode},l.DVEncodeParams.prototype.GetEncodeMode=function(){return this.m_encodeMode},l.DVEncodeParams.prototype.GetQuantBits=function(){return this.m_quantBits},l.DVEncodeParams.prototype.SetStreamType=function(e){this.m_streamTypeMode=e},l.DVEncodeParams.prototype.SetEncodeMode=function(e){this.m_encodeMode=e},l.DVEncodeParams.prototype.SetQuantBits=function(e){this.m_quantBits=e},l.DynamicVector=function(){this.m_num=0,this.m_dim=0,this.m_stride=0,this.m_max={},this.m_min={},this.m_vectors={}},l.DynamicVector.prototype.GetNVector=function(){return this.m_num},l.DynamicVector.prototype.GetDimVector=function(){return this.m_dim},l.DynamicVector.prototype.GetStride=function(){return this.m_stride},l.DynamicVector.prototype.GetMinArray=function(){return this.m_min},l.DynamicVector.prototype.GetMaxArray=function(){return this.m_max},l.DynamicVector.prototype.GetVectors=function(){return this.m_vectors},l.DynamicVector.prototype.GetMin=function(e){return this.m_min[e]},l.DynamicVector.prototype.GetMax=function(e){return this.m_max[e]},l.DynamicVector.prototype.SetNVector=function(e){this.m_num=e},l.DynamicVector.prototype.SetDimVector=function(e){this.m_dim=e},l.DynamicVector.prototype.SetStride=function(e){this.m_stride=e},l.DynamicVector.prototype.SetMinArray=function(e){this.m_min=e},l.DynamicVector.prototype.SetMaxArray=function(e){this.m_max=e},l.DynamicVector.prototype.SetMin=function(e,i){this.m_min[e]=i},l.DynamicVector.prototype.SetMax=function(e,i){this.m_max[e]=i},l.DynamicVector.prototype.SetVectors=function(e){this.m_vectors=e},l.DynamicVectorDecoder=function(){this.m_streamSize=0,this.m_maxNumVectors=0,this.m_numVectors=0,this.m_dimVectors=0,this.m_quantVectors={},this.m_iterator=new l.Iterator,this.m_streamType=o.O3DGC_STREAM_TYPE_UNKOWN,this.m_params=new l.DVEncodeParams},l.DynamicVectorDecoder.prototype.GetStreamType=function(){return this.m_streamType},l.DynamicVectorDecoder.prototype.GetIterator=function(){return this.m_iterator},l.DynamicVectorDecoder.prototype.SetStreamType=function(e){this.m_streamType=e},l.DynamicVectorDecoder.prototype.SetIterator=function(e){this.m_iterator=e},l.DynamicVectorDecoder.prototype.IUpdate=function(e,i,t){var a,s;for(s=t-1,a=2,e[i]-=e[i+1]>>1;s>a;)e[i+a]-=e[i+a-1]+e[i+a+1]+2>>2,a+=2;return a===s&&(e[i+a]-=e[i+a-1]>>1),l.O3DGC_OK},l.DynamicVectorDecoder.prototype.IPredict=function(e,i,t){var a,s;for(s=t-1,a=1;s>a;)e[i+a]+=e[i+a-1]+e[i+a+1]+1>>1,a+=2;return a===s&&(e[i+a]+=e[i+a-1]),l.O3DGC_OK},l.DynamicVectorDecoder.prototype.Merge=function(e,i,t){var a,s,u,n,r;for(s=(t>>1)+(1&t),u=s-1,n=s;u>0;){for(a=u;n>a;a+=2)r=e[i+a],e[i+a]=e[i+a+1],e[i+a+1]=r;--u,++n}return l.O3DGC_OK},l.DynamicVectorDecoder.prototype.ITransform=function(e,i,t){var a,s,u,n;for(a=t,s=0,u=0,s+=(1&a)<<u++>>>0;a>1;)a=(a>>1)+((1&a)>>>0),s+=(1&a)<<u++>>>0;for(n=u-2;n>=0;--n)a=(a<<1>>>0)-(1&s>>>n)>>>0,this.Merge(e,i,a),this.IUpdate(e,i,a),this.IPredict(e,i,a);return l.O3DGC_OK},l.DynamicVectorDecoder.prototype.IQuantize=function(e,i,t,a,s,u,n){var r,o,c,m,d,p;for(r=this.m_quantVectors,m=i*t,d=0;t>d;++d)for(o=u[d]-s[d],c=o>0?o/((1<<n>>>0)-1):1,p=0;i>p;++p)e[p*a+d]=r[p+d*i]*c+s[d];return l.O3DGC_OK},l.DynamicVectorDecoder.prototype.DecodeHeader=function(e,i){var t,a,s,u;if(t=this.m_iterator,a=t.m_count,s=i.ReadUInt32(t,o.O3DGC_STREAM_TYPE_BINARY),s!==o.O3DGC_DV_START_CODE){if(t.m_count=a,s=i.ReadUInt32(t,o.O3DGC_STREAM_TYPE_ASCII),s!==o.O3DGC_DV_START_CODE)return l.O3DGC_ERROR_CORRUPTED_STREAM;this.m_streamType=o.O3DGC_STREAM_TYPE_ASCII}else this.m_streamType=o.O3DGC_STREAM_TYPE_BINARY;return u=this.m_streamType,this.m_streamSize=i.ReadUInt32(t,u),this.m_params.SetEncodeMode(i.ReadUChar(t,u)),e.SetNVector(i.ReadUInt32(t,u)),e.GetNVector()>0&&(e.SetDimVector(i.ReadUInt32(t,u)),this.m_params.SetQuantBits(i.ReadUChar(t,u))),l.O3DGC_OK},l.DynamicVectorDecoder.prototype.DecodePlayload=function(e,i){var t,a,s,u,n,r,c,m,d,p,v,h,g,f,b,q,_,y,S;for(a=this.m_iterator,s=this.m_streamType,u=l.O3DGC_OK,n=a.m_count,r=i.ReadUInt32(a,s),c=e.GetDimVector(),m=e.GetNVector(),t=c*m,d=0;e.GetDimVector()>d;++d)e.SetMin(d,i.ReadFloat32(a,s)),e.SetMax(d,i.ReadFloat32(a,s));if(p=new l.ArithmeticDecoder,v=new l.StaticBitModel,h=new l.AdaptiveBitModel,r-=a.m_count-n,g=0,f=0,s===o.O3DGC_STREAM_TYPE_BINARY&&(b=i.GetBuffer(a,r),a.m_count+=r,p.SetBuffer(r,b),p.StartDecoder(),g=p.ExpGolombDecode(0,v,h),f=p.ExpGolombDecode(0,v,h)),q=new l.AdaptiveDataModel,q.SetAlphabet(f+2),t>this.m_maxNumVectors&&(this.m_maxNumVectors=t,this.m_quantVectors=new Int32Array(this.m_maxNumVectors)),_=this.m_quantVectors,s===o.O3DGC_STREAM_TYPE_ASCII)for(y=0;m>y;++y)for(S=0;c>S;++S)_[S*m+y]=i.ReadIntASCII(a);else for(y=0;m>y;++y)for(S=0;c>S;++S)_[S*m+y]=p.DecodeIntACEGC(q,v,h,g,f);
for(S=0;c>S;++S)this.ITransform(_,S*m,m);return this.IQuantize(e.GetVectors(),m,c,e.GetStride(),e.GetMinArray(),e.GetMaxArray(),this.m_params.GetQuantBits()),u},l}()}}),montageDefine("3d2b056","runtime/dependencies/gl-matrix",{dependencies:[],factory:function(e,i,t){var a=window;(function(e,s){"object"==typeof i?t.exports=s(a):"function"==typeof define&&define.amd?define([],function(){return s(e)}):s(e)})(this,function(e){"use strict";function i(e){return u=e}function t(){return u="undefined"!=typeof Float32Array?Float32Array:Array}var a=1e-6,s={};(function(){if("undefined"!=typeof Float32Array){var e=new Float32Array(1),i=new Int32Array(e.buffer);s.invsqrt=function(t){var a=.5*t;e[0]=t;var s=1.5;i[0]=1597463007-(i[0]>>1);var u=e[0];return u*(s-a*u*u)}}else s.invsqrt=function(e){return 1/Math.sqrt(e)}})();var u=null;t();var n={};n.create=function(e){var i=new u(3);return e?(i[0]=e[0],i[1]=e[1],i[2]=e[2]):i[0]=i[1]=i[2]=0,i},n.createFrom=function(e,i,t){var a=new u(3);return a[0]=e,a[1]=i,a[2]=t,a},n.set=function(e,i){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i},n.equal=function(e,i){return e===i||a>Math.abs(e[0]-i[0])&&a>Math.abs(e[1]-i[1])&&a>Math.abs(e[2]-i[2])},n.add=function(e,i,t){return t&&e!==t?(t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t):(e[0]+=i[0],e[1]+=i[1],e[2]+=i[2],e)},n.subtract=function(e,i,t){return t&&e!==t?(t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t):(e[0]-=i[0],e[1]-=i[1],e[2]-=i[2],e)},n.multiply=function(e,i,t){return t&&e!==t?(t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t):(e[0]*=i[0],e[1]*=i[1],e[2]*=i[2],e)},n.negate=function(e,i){return i||(i=e),i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i},n.scale=function(e,i,t){return t&&e!==t?(t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t):(e[0]*=i,e[1]*=i,e[2]*=i,e)},n.normalize=function(e,i){i||(i=e);var t=e[0],a=e[1],s=e[2],u=Math.sqrt(t*t+a*a+s*s);return u?1===u?(i[0]=t,i[1]=a,i[2]=s,i):(u=1/u,i[0]=t*u,i[1]=a*u,i[2]=s*u,i):(i[0]=0,i[1]=0,i[2]=0,i)},n.cross=function(e,i,t){t||(t=e);var a=e[0],s=e[1],u=e[2],n=i[0],r=i[1],l=i[2];return t[0]=s*l-u*r,t[1]=u*n-a*l,t[2]=a*r-s*n,t},n.length=function(e){var i=e[0],t=e[1],a=e[2];return Math.sqrt(i*i+t*t+a*a)},n.squaredLength=function(e){var i=e[0],t=e[1],a=e[2];return i*i+t*t+a*a},n.dot=function(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]},n.direction=function(e,i,t){t||(t=e);var a=e[0]-i[0],s=e[1]-i[1],u=e[2]-i[2],n=Math.sqrt(a*a+s*s+u*u);return n?(n=1/n,t[0]=a*n,t[1]=s*n,t[2]=u*n,t):(t[0]=0,t[1]=0,t[2]=0,t)},n.lerp=function(e,i,t,a){return a||(a=e),a[0]=e[0]+t*(i[0]-e[0]),a[1]=e[1]+t*(i[1]-e[1]),a[2]=e[2]+t*(i[2]-e[2]),a},n.dist=function(e,i){var t=i[0]-e[0],a=i[1]-e[1],s=i[2]-e[2];return Math.sqrt(t*t+a*a+s*s)};var r=null,l=new u(4);n.unproject=function(e,i,t,a,s){s||(s=e),r||(r=v.create());var u=r,n=l;return n[0]=2*(e[0]-a[0])/a[2]-1,n[1]=2*(e[1]-a[1])/a[3]-1,n[2]=2*e[2]-1,n[3]=1,v.multiply(t,i,u),v.inverse(u)?(v.multiplyVec4(u,n),0===n[3]?null:(s[0]=n[0]/n[3],s[1]=n[1]/n[3],s[2]=n[2]/n[3],s)):null};var o=n.createFrom(1,0,0),c=n.createFrom(0,1,0),m=n.createFrom(0,0,1),d=n.create();n.rotationTo=function(e,i,t){t||(t=h.create());var a=n.dot(e,i),s=d;if(a>=1)h.set(g,t);else if(1e-6-1>a)n.cross(o,e,s),1e-6>n.length(s)&&n.cross(c,e,s),1e-6>n.length(s)&&n.cross(m,e,s),n.normalize(s),h.fromAngleAxis(Math.PI,s,t);else{var u=Math.sqrt(2*(1+a)),r=1/u;n.cross(e,i,s),t[0]=s[0]*r,t[1]=s[1]*r,t[2]=s[2]*r,t[3]=.5*u,h.normalize(t)}return t[3]>1?t[3]=1:-1>t[3]&&(t[3]=-1),t},n.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+"]"};var p={};p.create=function(e){var i=new u(9);return e?(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8]):i[0]=i[1]=i[2]=i[3]=i[4]=i[5]=i[6]=i[7]=i[8]=0,i},p.createFrom=function(e,i,t,a,s,n,r,l,o){var c=new u(9);return c[0]=e,c[1]=i,c[2]=t,c[3]=a,c[4]=s,c[5]=n,c[6]=r,c[7]=l,c[8]=o,c},p.determinant=function(e){var i=e[0],t=e[1],a=e[2],s=e[3],u=e[4],n=e[5],r=e[6],l=e[7],o=e[8];return i*(o*u-n*l)+t*(-o*s+n*r)+a*(l*s-u*r)},p.inverse=function(e,i){var t,a=e[0],s=e[1],u=e[2],n=e[3],r=e[4],l=e[5],o=e[6],c=e[7],m=e[8],d=m*r-l*c,v=-m*n+l*o,h=c*n-r*o,g=a*d+s*v+u*h;return g?(t=1/g,i||(i=p.create()),i[0]=d*t,i[1]=(-m*s+u*c)*t,i[2]=(l*s-u*r)*t,i[3]=v*t,i[4]=(m*a-u*o)*t,i[5]=(-l*a+u*n)*t,i[6]=h*t,i[7]=(-c*a+s*o)*t,i[8]=(r*a-s*n)*t,i):null},p.multiply=function(e,i,t){t||(t=e);var a=e[0],s=e[1],u=e[2],n=e[3],r=e[4],l=e[5],o=e[6],c=e[7],m=e[8],d=i[0],p=i[1],v=i[2],h=i[3],g=i[4],f=i[5],b=i[6],q=i[7],_=i[8];return t[0]=d*a+p*n+v*o,t[1]=d*s+p*r+v*c,t[2]=d*u+p*l+v*m,t[3]=h*a+g*n+f*o,t[4]=h*s+g*r+f*c,t[5]=h*u+g*l+f*m,t[6]=b*a+q*n+_*o,t[7]=b*s+q*r+_*c,t[8]=b*u+q*l+_*m,t},p.multiplyVec2=function(e,i,t){t||(t=i);var a=i[0],s=i[1];return t[0]=a*e[0]+s*e[3]+e[6],t[1]=a*e[1]+s*e[4]+e[7],t},p.multiplyVec3=function(e,i,t){t||(t=i);var a=i[0],s=i[1],u=i[2];return t[0]=a*e[0]+s*e[3]+u*e[6],t[1]=a*e[1]+s*e[4]+u*e[7],t[2]=a*e[2]+s*e[5]+u*e[8],t},p.set=function(e,i){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i},p.equal=function(e,i){return e===i||a>Math.abs(e[0]-i[0])&&a>Math.abs(e[1]-i[1])&&a>Math.abs(e[2]-i[2])&&a>Math.abs(e[3]-i[3])&&a>Math.abs(e[4]-i[4])&&a>Math.abs(e[5]-i[5])&&a>Math.abs(e[6]-i[6])&&a>Math.abs(e[7]-i[7])&&a>Math.abs(e[8]-i[8])},p.identity=function(e){return e||(e=p.create()),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},p.transpose=function(e,i){if(!i||e===i){var t=e[1],a=e[2],s=e[5];return e[1]=e[3],e[2]=e[6],e[3]=t,e[5]=e[7],e[6]=a,e[7]=s,e}return i[0]=e[0],i[1]=e[3],i[2]=e[6],i[3]=e[1],i[4]=e[4],i[5]=e[7],i[6]=e[2],i[7]=e[5],i[8]=e[8],i},p.toMat4=function(e,i){return i||(i=v.create()),i[15]=1,i[14]=0,i[13]=0,i[12]=0,i[11]=0,i[10]=e[8],i[9]=e[7],i[8]=e[6],i[7]=0,i[6]=e[5],i[5]=e[4],i[4]=e[3],i[3]=0,i[2]=e[2],i[1]=e[1],i[0]=e[0],i},p.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+"]"};var v={};v.create=function(e){var i=new u(16);return e&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i},v.createFrom=function(e,i,t,a,s,n,r,l,o,c,m,d,p,v,h,g){var f=new u(16);return f[0]=e,f[1]=i,f[2]=t,f[3]=a,f[4]=s,f[5]=n,f[6]=r,f[7]=l,f[8]=o,f[9]=c,f[10]=m,f[11]=d,f[12]=p,f[13]=v,f[14]=h,f[15]=g,f},v.set=function(e,i){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},v.equal=function(e,i){return e===i||a>Math.abs(e[0]-i[0])&&a>Math.abs(e[1]-i[1])&&a>Math.abs(e[2]-i[2])&&a>Math.abs(e[3]-i[3])&&a>Math.abs(e[4]-i[4])&&a>Math.abs(e[5]-i[5])&&a>Math.abs(e[6]-i[6])&&a>Math.abs(e[7]-i[7])&&a>Math.abs(e[8]-i[8])&&a>Math.abs(e[9]-i[9])&&a>Math.abs(e[10]-i[10])&&a>Math.abs(e[11]-i[11])&&a>Math.abs(e[12]-i[12])&&a>Math.abs(e[13]-i[13])&&a>Math.abs(e[14]-i[14])&&a>Math.abs(e[15]-i[15])},v.identity=function(e){return e||(e=v.create()),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},v.transpose=function(e,i){if(!i||e===i){var t=e[1],a=e[2],s=e[3],u=e[6],n=e[7],r=e[11];return e[1]=e[4],e[2]=e[8],e[3]=e[12],e[4]=t,e[6]=e[9],e[7]=e[13],e[8]=a,e[9]=u,e[11]=e[14],e[12]=s,e[13]=n,e[14]=r,e}return i[0]=e[0],i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=e[1],i[5]=e[5],i[6]=e[9],i[7]=e[13],i[8]=e[2],i[9]=e[6],i[10]=e[10],i[11]=e[14],i[12]=e[3],i[13]=e[7],i[14]=e[11],i[15]=e[15],i},v.determinant=function(e){var i=e[0],t=e[1],a=e[2],s=e[3],u=e[4],n=e[5],r=e[6],l=e[7],o=e[8],c=e[9],m=e[10],d=e[11],p=e[12],v=e[13],h=e[14],g=e[15];return p*c*r*s-o*v*r*s-p*n*m*s+u*v*m*s+o*n*h*s-u*c*h*s-p*c*a*l+o*v*a*l+p*t*m*l-i*v*m*l-o*t*h*l+i*c*h*l+p*n*a*d-u*v*a*d-p*t*r*d+i*v*r*d+u*t*h*d-i*n*h*d-o*n*a*g+u*c*a*g+o*t*r*g-i*c*r*g-u*t*m*g+i*n*m*g},v.inverse=function(e,i){i||(i=e);var t,a=e[0],s=e[1],u=e[2],n=e[3],r=e[4],l=e[5],o=e[6],c=e[7],m=e[8],d=e[9],p=e[10],v=e[11],h=e[12],g=e[13],f=e[14],b=e[15],q=a*l-s*r,_=a*o-u*r,y=a*c-n*r,S=s*o-u*l,P=s*c-n*l,C=u*c-n*o,N=m*g-d*h,D=m*f-p*h,M=m*b-v*h,E=d*f-p*g,A=d*b-v*g,w=p*b-v*f,x=q*w-_*A+y*E+S*M-P*D+C*N;return x?(t=1/x,i[0]=(l*w-o*A+c*E)*t,i[1]=(-s*w+u*A-n*E)*t,i[2]=(g*C-f*P+b*S)*t,i[3]=(-d*C+p*P-v*S)*t,i[4]=(-r*w+o*M-c*D)*t,i[5]=(a*w-u*M+n*D)*t,i[6]=(-h*C+f*y-b*_)*t,i[7]=(m*C-p*y+v*_)*t,i[8]=(r*A-l*M+c*N)*t,i[9]=(-a*A+s*M-n*N)*t,i[10]=(h*P-g*y+b*q)*t,i[11]=(-m*P+d*y-v*q)*t,i[12]=(-r*E+l*D-o*N)*t,i[13]=(a*E-s*D+u*N)*t,i[14]=(-h*S+g*_-f*q)*t,i[15]=(m*S-d*_+p*q)*t,i):null},v.toRotationMat=function(e,i){return i||(i=v.create()),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},v.toMat3=function(e,i){return i||(i=p.create()),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],i},v.toInverseMat3=function(e,i){var t,a=e[0],s=e[1],u=e[2],n=e[4],r=e[5],l=e[6],o=e[8],c=e[9],m=e[10],d=m*r-l*c,v=-m*n+l*o,h=c*n-r*o,g=a*d+s*v+u*h;return g?(t=1/g,i||(i=p.create()),i[0]=d*t,i[1]=(-m*s+u*c)*t,i[2]=(l*s-u*r)*t,i[3]=v*t,i[4]=(m*a-u*o)*t,i[5]=(-l*a+u*n)*t,i[6]=h*t,i[7]=(-c*a+s*o)*t,i[8]=(r*a-s*n)*t,i):null},v.multiply=function(e,i,t){t||(t=e);var a=e[0],s=e[1],u=e[2],n=e[3],r=e[4],l=e[5],o=e[6],c=e[7],m=e[8],d=e[9],p=e[10],v=e[11],h=e[12],g=e[13],f=e[14],b=e[15],q=i[0],_=i[1],y=i[2],S=i[3];return t[0]=q*a+_*r+y*m+S*h,t[1]=q*s+_*l+y*d+S*g,t[2]=q*u+_*o+y*p+S*f,t[3]=q*n+_*c+y*v+S*b,q=i[4],_=i[5],y=i[6],S=i[7],t[4]=q*a+_*r+y*m+S*h,t[5]=q*s+_*l+y*d+S*g,t[6]=q*u+_*o+y*p+S*f,t[7]=q*n+_*c+y*v+S*b,q=i[8],_=i[9],y=i[10],S=i[11],t[8]=q*a+_*r+y*m+S*h,t[9]=q*s+_*l+y*d+S*g,t[10]=q*u+_*o+y*p+S*f,t[11]=q*n+_*c+y*v+S*b,q=i[12],_=i[13],y=i[14],S=i[15],t[12]=q*a+_*r+y*m+S*h,t[13]=q*s+_*l+y*d+S*g,t[14]=q*u+_*o+y*p+S*f,t[15]=q*n+_*c+y*v+S*b,t},v.multiply3=function(e,i,t){t||(t=e);var a=e[0],s=e[1],u=e[2],n=e[3],r=e[4],l=e[5],o=e[6],c=e[7],m=e[8],d=e[9],p=e[10],v=e[11],h=e[12],g=e[13],f=e[14],b=e[15],q=i[0],_=i[1],y=i[2],S=0;return t[0]=q*a+_*r+y*m+S*h,t[1]=q*s+_*l+y*d+S*g,t[2]=q*u+_*o+y*p+S*f,t[3]=q*n+_*c+y*v+S*b,q=i[4],_=i[5],y=i[6],S=0,t[4]=q*a+_*r+y*m+S*h,t[5]=q*s+_*l+y*d+S*g,t[6]=q*u+_*o+y*p+S*f,t[7]=q*n+_*c+y*v+S*b,q=i[8],_=i[9],y=i[10],S=0,t[8]=q*a+_*r+y*m+S*h,t[9]=q*s+_*l+y*d+S*g,t[10]=q*u+_*o+y*p+S*f,t[11]=q*n+_*c+y*v+S*b,t},v.multiplyVec3=function(e,i,t){t||(t=i);var a=i[0],s=i[1],u=i[2];return t[0]=e[0]*a+e[4]*s+e[8]*u+e[12],t[1]=e[1]*a+e[5]*s+e[9]*u+e[13],t[2]=e[2]*a+e[6]*s+e[10]*u+e[14],t},v.rotateVec3=function(e,i,t){t||(t=i);var a=i[0],s=i[1],u=i[2];return t[0]=e[0]*a+e[4]*s+e[8]*u,t[1]=e[1]*a+e[5]*s+e[9]*u,t[2]=e[2]*a+e[6]*s+e[10]*u,t},v.multiplyVec4=function(e,i,t){t||(t=i);var a=i[0],s=i[1],u=i[2],n=i[3];return t[0]=e[0]*a+e[4]*s+e[8]*u+e[12]*n,t[1]=e[1]*a+e[5]*s+e[9]*u+e[13]*n,t[2]=e[2]*a+e[6]*s+e[10]*u+e[14]*n,t[3]=e[3]*a+e[7]*s+e[11]*u+e[15]*n,t},v.translate=function(e,i,t){var a,s,u,n,r,l,o,c,m,d,p,v,h=i[0],g=i[1],f=i[2];return t&&e!==t?(a=e[0],s=e[1],u=e[2],n=e[3],r=e[4],l=e[5],o=e[6],c=e[7],m=e[8],d=e[9],p=e[10],v=e[11],t[0]=a,t[1]=s,t[2]=u,t[3]=n,t[4]=r,t[5]=l,t[6]=o,t[7]=c,t[8]=m,t[9]=d,t[10]=p,t[11]=v,t[12]=a*h+r*g+m*f+e[12],t[13]=s*h+l*g+d*f+e[13],t[14]=u*h+o*g+p*f+e[14],t[15]=n*h+c*g+v*f+e[15],t):(e[12]=e[0]*h+e[4]*g+e[8]*f+e[12],e[13]=e[1]*h+e[5]*g+e[9]*f+e[13],e[14]=e[2]*h+e[6]*g+e[10]*f+e[14],e[15]=e[3]*h+e[7]*g+e[11]*f+e[15],e)},v.scale=function(e,i,t){var a=i[0],s=i[1],u=i[2];return t&&e!==t?(t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t[3]=e[3]*a,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*u,t[9]=e[9]*u,t[10]=e[10]*u,t[11]=e[11]*u,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t):(e[0]*=a,e[1]*=a,e[2]*=a,e[3]*=a,e[4]*=s,e[5]*=s,e[6]*=s,e[7]*=s,e[8]*=u,e[9]*=u,e[10]*=u,e[11]*=u,e)},v.rotate=function(e,i,t,a){var s,u,n,r,l,o,c,m,d,p,v,h,g,f,b,q,_,y,S,P,C,N,D,M,E=t[0],A=t[1],w=t[2],x=Math.sqrt(E*E+A*A+w*w);return x?(1!==x&&(x=1/x,E*=x,A*=x,w*=x),s=Math.sin(i),u=Math.cos(i),n=1-u,r=e[0],l=e[1],o=e[2],c=e[3],m=e[4],d=e[5],p=e[6],v=e[7],h=e[8],g=e[9],f=e[10],b=e[11],q=E*E*n+u,_=A*E*n+w*s,y=w*E*n-A*s,S=E*A*n-w*s,P=A*A*n+u,C=w*A*n+E*s,N=E*w*n+A*s,D=A*w*n-E*s,M=w*w*n+u,a?e!==a&&(a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]):a=e,a[0]=r*q+m*_+h*y,a[1]=l*q+d*_+g*y,a[2]=o*q+p*_+f*y,a[3]=c*q+v*_+b*y,a[4]=r*S+m*P+h*C,a[5]=l*S+d*P+g*C,a[6]=o*S+p*P+f*C,a[7]=c*S+v*P+b*C,a[8]=r*N+m*D+h*M,a[9]=l*N+d*D+g*M,a[10]=o*N+p*D+f*M,a[11]=c*N+v*D+b*M,a):null},v.rotateX=function(e,i,t){var a=Math.sin(i),s=Math.cos(i),u=e[4],n=e[5],r=e[6],l=e[7],o=e[8],c=e[9],m=e[10],d=e[11];return t?e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]):t=e,t[4]=u*s+o*a,t[5]=n*s+c*a,t[6]=r*s+m*a,t[7]=l*s+d*a,t[8]=u*-a+o*s,t[9]=n*-a+c*s,t[10]=r*-a+m*s,t[11]=l*-a+d*s,t},v.rotateY=function(e,i,t){var a=Math.sin(i),s=Math.cos(i),u=e[0],n=e[1],r=e[2],l=e[3],o=e[8],c=e[9],m=e[10],d=e[11];return t?e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]):t=e,t[0]=u*s+o*-a,t[1]=n*s+c*-a,t[2]=r*s+m*-a,t[3]=l*s+d*-a,t[8]=u*a+o*s,t[9]=n*a+c*s,t[10]=r*a+m*s,t[11]=l*a+d*s,t},v.rotateZ=function(e,i,t){var a=Math.sin(i),s=Math.cos(i),u=e[0],n=e[1],r=e[2],l=e[3],o=e[4],c=e[5],m=e[6],d=e[7];return t?e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]):t=e,t[0]=u*s+o*a,t[1]=n*s+c*a,t[2]=r*s+m*a,t[3]=l*s+d*a,t[4]=u*-a+o*s,t[5]=n*-a+c*s,t[6]=r*-a+m*s,t[7]=l*-a+d*s,t},v.frustum=function(e,i,t,a,s,u,n){n||(n=v.create());var r=i-e,l=a-t,o=u-s;return n[0]=2*s/r,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=2*s/l,n[6]=0,n[7]=0,n[8]=(i+e)/r,n[9]=(a+t)/l,n[10]=-(u+s)/o,n[11]=-1,n[12]=0,n[13]=0,n[14]=-(2*u*s)/o,n[15]=0,n},v.perspective=function(e,i,t,a,s){var u=t*Math.tan(e*Math.PI/360),n=u*i;return v.frustum(-n,n,-u,u,t,a,s)},v.ortho=function(e,i,t,a,s,u,n){n||(n=v.create());var r=i-e,l=a-t,o=u-s;return n[0]=2/r,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=2/l,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=-2/o,n[11]=0,n[12]=-(e+i)/r,n[13]=-(a+t)/l,n[14]=-(u+s)/o,n[15]=1,n},v.lookAt=function(e,i,t,a){a||(a=v.create());var s,u,n,r,l,o,c,m,d,p,h=e[0],g=e[1],f=e[2],b=t[0],q=t[1],_=t[2],y=i[0],S=i[1],P=i[2];return h===y&&g===S&&f===P?v.identity(a):(c=h-y,m=g-S,d=f-P,p=1/Math.sqrt(c*c+m*m+d*d),c*=p,m*=p,d*=p,s=q*d-_*m,u=_*c-b*d,n=b*m-q*c,p=Math.sqrt(s*s+u*u+n*n),p?(p=1/p,s*=p,u*=p,n*=p):(s=0,u=0,n=0),r=m*n-d*u,l=d*s-c*n,o=c*u-m*s,p=Math.sqrt(r*r+l*l+o*o),p?(p=1/p,r*=p,l*=p,o*=p):(r=0,l=0,o=0),a[0]=s,a[1]=r,a[2]=c,a[3]=0,a[4]=u,a[5]=l,a[6]=m,a[7]=0,a[8]=n,a[9]=o,a[10]=d,a[11]=0,a[12]=-(s*h+u*g+n*f),a[13]=-(r*h+l*g+o*f),a[14]=-(c*h+m*g+d*f),a[15]=1,a)},v.fromRotationTranslation=function(e,i,t){t||(t=v.create());var a=e[0],s=e[1],u=e[2],n=e[3],r=a+a,l=s+s,o=u+u,c=a*r,m=a*l,d=a*o,p=s*l,h=s*o,g=u*o,f=n*r,b=n*l,q=n*o;return t[0]=1-(p+g),t[1]=m+q,t[2]=d-b,t[3]=0,t[4]=m-q,t[5]=1-(c+g),t[6]=h+f,t[7]=0,t[8]=d+b,t[9]=h-f,t[10]=1-(c+p),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},v.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+"]"};var h={};h.create=function(e){var i=new u(4);return e?(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]):i[0]=i[1]=i[2]=i[3]=0,i},h.createFrom=function(e,i,t,a){var s=new u(4);return s[0]=e,s[1]=i,s[2]=t,s[3]=a,s},h.set=function(e,i){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i},h.equal=function(e,i){return e===i||a>Math.abs(e[0]-i[0])&&a>Math.abs(e[1]-i[1])&&a>Math.abs(e[2]-i[2])&&a>Math.abs(e[3]-i[3])},h.identity=function(e){return e||(e=h.create()),e[0]=0,e[1]=0,e[2]=0,e[3]=1,e};var g=h.identity();h.calculateW=function(e,i){var t=e[0],a=e[1],s=e[2];return i&&e!==i?(i[0]=t,i[1]=a,i[2]=s,i[3]=-Math.sqrt(Math.abs(1-t*t-a*a-s*s)),i):(e[3]=-Math.sqrt(Math.abs(1-t*t-a*a-s*s)),e)},h.dot=function(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]+e[3]*i[3]},h.inverse=function(e,i){var t=e[0],a=e[1],s=e[2],u=e[3],n=t*t+a*a+s*s+u*u,r=n?1/n:0;return i&&e!==i?(i[0]=-e[0]*r,i[1]=-e[1]*r,i[2]=-e[2]*r,i[3]=e[3]*r,i):(e[0]*=-r,e[1]*=-r,e[2]*=-r,e[3]*=r,e)},h.conjugate=function(e,i){return i&&e!==i?(i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i):(e[0]*=-1,e[1]*=-1,e[2]*=-1,e)},h.length=function(e){var i=e[0],t=e[1],a=e[2],s=e[3];return Math.sqrt(i*i+t*t+a*a+s*s)},h.normalize=function(e,i){i||(i=e);var t=e[0],a=e[1],s=e[2],u=e[3],n=Math.sqrt(t*t+a*a+s*s+u*u);return 0===n?(i[0]=0,i[1]=0,i[2]=0,i[3]=0,i):(n=1/n,i[0]=t*n,i[1]=a*n,i[2]=s*n,i[3]=u*n,i)},h.add=function(e,i,t){return t&&e!==t?(t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t):(e[0]+=i[0],e[1]+=i[1],e[2]+=i[2],e[3]+=i[3],e)},h.multiply=function(e,i,t){t||(t=e);var a=e[0],s=e[1],u=e[2],n=e[3],r=i[0],l=i[1],o=i[2],c=i[3];return t[0]=a*c+n*r+s*o-u*l,t[1]=s*c+n*l+u*r-a*o,t[2]=u*c+n*o+a*l-s*r,t[3]=n*c-a*r-s*l-u*o,t},h.multiplyVec3=function(e,i,t){t||(t=i);var a=i[0],s=i[1],u=i[2],n=e[0],r=e[1],l=e[2],o=e[3],c=o*a+r*u-l*s,m=o*s+l*a-n*u,d=o*u+n*s-r*a,p=-n*a-r*s-l*u;return t[0]=c*o+p*-n+m*-l-d*-r,t[1]=m*o+p*-r+d*-n-c*-l,t[2]=d*o+p*-l+c*-r-m*-n,t},h.scale=function(e,i,t){return t&&e!==t?(t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t):(e[0]*=i,e[1]*=i,e[2]*=i,e[3]*=i,e)},h.toMat3=function(e,i){i||(i=p.create());var t=e[0],a=e[1],s=e[2],u=e[3],n=t+t,r=a+a,l=s+s,o=t*n,c=t*r,m=t*l,d=a*r,v=a*l,h=s*l,g=u*n,f=u*r,b=u*l;return i[0]=1-(d+h),i[1]=c+b,i[2]=m-f,i[3]=c-b,i[4]=1-(o+h),i[5]=v+g,i[6]=m+f,i[7]=v-g,i[8]=1-(o+d),i},h.toMat4=function(e,i){i||(i=v.create());var t=e[0],a=e[1],s=e[2],u=e[3],n=t+t,r=a+a,l=s+s,o=t*n,c=t*r,m=t*l,d=a*r,p=a*l,h=s*l,g=u*n,f=u*r,b=u*l;return i[0]=1-(d+h),i[1]=c+b,i[2]=m-f,i[3]=0,i[4]=c-b,i[5]=1-(o+h),i[6]=p+g,i[7]=0,i[8]=m+f,i[9]=p-g,i[10]=1-(o+d),i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},h.slerp=function(e,i,t,a){a||(a=e);var s,u,n,r,l=e[0]*i[0]+e[1]*i[1]+e[2]*i[2]+e[3]*i[3],o=1;return 0>l&&(l=-l,o=-1),Math.abs(l)>=1?(a!==e&&(a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[3]),a):(s=Math.acos(l),u=Math.sqrt(1-l*l),.001>Math.abs(u)?(a[0]=.5*e[0]+.5*i[0],a[1]=.5*e[1]+.5*i[1],a[2]=.5*e[2]+.5*i[2],a[3]=.5*e[3]+.5*i[3],a):(n=Math.sin((1-t)*s)/u,r=Math.sin(t*s)/u,a[0]=e[0]*n+i[0]*o*r,a[1]=e[1]*n+i[1]*o*r,a[2]=e[2]*n+i[2]*o*r,a[3]=e[3]*n+i[3]*o*r,a))},h.fromRotationMatrix=function(e,i){i||(i=h.create());var t=p.create();p.transpose(e,t);var a,s=t[0]+t[4]+t[8];if(s>0)a=Math.sqrt(s+1),i[3]=.5*a,a=.5/a,i[0]=(t[7]-t[5])*a,i[1]=(t[2]-t[6])*a,i[2]=(t[3]-t[1])*a;else{var u=h.fromRotationMatrix.s_iNext=h.fromRotationMatrix.s_iNext||[1,2,0],n=0;t[4]>t[0]&&(n=1),t[8]>t[3*n+n]&&(n=2);var r=u[n],l=u[r];a=Math.sqrt(t[3*n+n]-t[3*r+r]-t[3*l+l]+1),i[n]=.5*a,a=.5/a,i[3]=(t[3*l+r]-t[3*r+l])*a,i[r]=(t[3*r+n]+t[3*n+r])*a,i[l]=(t[3*l+n]+t[3*n+l])*a}return i},p.toQuat4=h.fromRotationMatrix,function(){var e=p.create();h.fromAxes=function(i,t,a,s){return e[0]=t[0],e[3]=t[1],e[6]=t[2],e[1]=a[0],e[4]=a[1],e[7]=a[2],e[2]=i[0],e[5]=i[1],e[8]=i[2],h.fromRotationMatrix(e,s)}}(),h.identity=function(e){return e||(e=h.create()),e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},h.fromAngleAxis=function(e,i,t){t||(t=h.create());var a=.5*e,s=Math.sin(a);return t[3]=Math.cos(a),t[0]=s*i[0],t[1]=s*i[1],t[2]=s*i[2],t},h.toAngleAxis=function(e,i){i||(i=e);var t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(t>0){i[3]=2*Math.acos(e[3]);var a=s.invsqrt(t);i[0]=e[0]*a,i[1]=e[1]*a,i[2]=e[2]*a}else i[3]=0,i[0]=1,i[1]=0,i[2]=0;return i},h.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+"]"};var f={};f.create=function(e){var i=new u(2);return e?(i[0]=e[0],i[1]=e[1]):(i[0]=0,i[1]=0),i},f.createFrom=function(e,i){var t=new u(2);return t[0]=e,t[1]=i,t},f.add=function(e,i,t){return t||(t=i),t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},f.subtract=function(e,i,t){return t||(t=i),t[0]=e[0]-i[0],t[1]=e[1]-i[1],t},f.multiply=function(e,i,t){return t||(t=i),t[0]=e[0]*i[0],t[1]=e[1]*i[1],t},f.divide=function(e,i,t){return t||(t=i),t[0]=e[0]/i[0],t[1]=e[1]/i[1],t},f.scale=function(e,i,t){return t||(t=e),t[0]=e[0]*i,t[1]=e[1]*i,t},f.dist=function(e,i){var t=i[0]-e[0],a=i[1]-e[1];return Math.sqrt(t*t+a*a)},f.set=function(e,i){return i[0]=e[0],i[1]=e[1],i},f.equal=function(e,i){return e===i||a>Math.abs(e[0]-i[0])&&a>Math.abs(e[1]-i[1])},f.negate=function(e,i){return i||(i=e),i[0]=-e[0],i[1]=-e[1],i},f.normalize=function(e,i){i||(i=e);var t=e[0]*e[0]+e[1]*e[1];return t>0?(t=Math.sqrt(t),i[0]=e[0]/t,i[1]=e[1]/t):i[0]=i[1]=0,i},f.cross=function(e,i,t){var a=e[0]*i[1]-e[1]*i[0];return t?(t[0]=t[1]=0,t[2]=a,t):a},f.length=function(e){var i=e[0],t=e[1];return Math.sqrt(i*i+t*t)},f.squaredLength=function(e){var i=e[0],t=e[1];return i*i+t*t},f.dot=function(e,i){return e[0]*i[0]+e[1]*i[1]},f.direction=function(e,i,t){t||(t=e);var a=e[0]-i[0],s=e[1]-i[1],u=a*a+s*s;return u?(u=1/Math.sqrt(u),t[0]=a*u,t[1]=s*u,t):(t[0]=0,t[1]=0,t[2]=0,t)},f.lerp=function(e,i,t,a){return a||(a=e),a[0]=e[0]+t*(i[0]-e[0]),a[1]=e[1]+t*(i[1]-e[1]),a},f.str=function(e){return"["+e[0]+", "+e[1]+"]"};var b={};b.create=function(e){var i=new u(4);return e?(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]):i[0]=i[1]=i[2]=i[3]=0,i},b.createFrom=function(e,i,t,a){var s=new u(4);return s[0]=e,s[1]=i,s[2]=t,s[3]=a,s},b.set=function(e,i){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i},b.equal=function(e,i){return e===i||a>Math.abs(e[0]-i[0])&&a>Math.abs(e[1]-i[1])&&a>Math.abs(e[2]-i[2])&&a>Math.abs(e[3]-i[3])},b.identity=function(e){return e||(e=b.create()),e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},b.transpose=function(e,i){if(!i||e===i){var t=e[1];return e[1]=e[2],e[2]=t,e}return i[0]=e[0],i[1]=e[2],i[2]=e[1],i[3]=e[3],i},b.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},b.inverse=function(e,i){i||(i=e);var t=e[0],a=e[1],s=e[2],u=e[3],n=t*u-s*a;return n?(n=1/n,i[0]=u*n,i[1]=-a*n,i[2]=-s*n,i[3]=t*n,i):null},b.multiply=function(e,i,t){t||(t=e);var a=e[0],s=e[1],u=e[2],n=e[3];return t[0]=a*i[0]+s*i[2],t[1]=a*i[1]+s*i[3],t[2]=u*i[0]+n*i[2],t[3]=u*i[1]+n*i[3],t},b.rotate=function(e,i,t){t||(t=e);var a=e[0],s=e[1],u=e[2],n=e[3],r=Math.sin(i),l=Math.cos(i);return t[0]=a*l+s*r,t[1]=a*-r+s*l,t[2]=u*l+n*r,t[3]=u*-r+n*l,t},b.multiplyVec2=function(e,i,t){t||(t=i);var a=i[0],s=i[1];return t[0]=a*e[0]+s*e[1],t[1]=a*e[2]+s*e[3],t},b.scale=function(e,i,t){t||(t=e);var a=e[0],s=e[1],u=e[2],n=e[3],r=i[0],l=i[1];return t[0]=a*r,t[1]=s*l,t[2]=u*r,t[3]=n*l,t},b.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+"]"};var q={};return q.create=function(e){var i=new u(4);return e?(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]):(i[0]=0,i[1]=0,i[2]=0,i[3]=0),i},q.createFrom=function(e,i,t,a){var s=new u(4);return s[0]=e,s[1]=i,s[2]=t,s[3]=a,s},q.add=function(e,i,t){return t||(t=i),t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},q.subtract=function(e,i,t){return t||(t=i),t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t},q.multiply=function(e,i,t){return t||(t=i),t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t},q.divide=function(e,i,t){return t||(t=i),t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t},q.scale=function(e,i,t){return t||(t=e),t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},q.set=function(e,i){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i},q.equal=function(e,i){return e===i||a>Math.abs(e[0]-i[0])&&a>Math.abs(e[1]-i[1])&&a>Math.abs(e[2]-i[2])&&a>Math.abs(e[3]-i[3])},q.negate=function(e,i){return i||(i=e),i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=-e[3],i},q.length=function(e){var i=e[0],t=e[1],a=e[2],s=e[3];return Math.sqrt(i*i+t*t+a*a+s*s)},q.squaredLength=function(e){var i=e[0],t=e[1],a=e[2],s=e[3];return i*i+t*t+a*a+s*s},q.lerp=function(e,i,t,a){return a||(a=e),a[0]=e[0]+t*(i[0]-e[0]),a[1]=e[1]+t*(i[1]-e[1]),a[2]=e[2]+t*(i[2]-e[2]),a[3]=e[3]+t*(i[3]-e[3]),a},q.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+"]"},e&&(e.glMatrixArrayType=u,e.MatrixArray=u,e.setMatrixArrayType=i,e.determineMatrixArrayType=t,e.glMath=s,e.vec2=f,e.vec3=n,e.vec4=q,e.mat2=b,e.mat3=p,e.mat4=v,e.quat4=h),{glMatrixArrayType:u,MatrixArray:u,setMatrixArrayType:i,determineMatrixArrayType:t,glMath:s,vec2:f,vec3:n,vec4:q,mat2:b,mat3:p,mat4:v,quat4:h}})}}),montageDefine("3d2b056","ui/scene-view.reel/scene-view",{dependencies:["runtime/dependencies/gl-matrix","montage","montage/ui/component","runtime/glsl-program","runtime/helpers/resource-manager","runtime/glTF-scene","runtime/glTF-node","runtime/scene","runtime/node","runtime/scene-renderer","runtime/glTF-material","runtime/utilities","montage/core/dom","montage/core/geometry/point","montage/composer/translate-composer","runtime/builtin-assets","runtime/webgl-renderer","runtime/projection","runtime/animation","runtime/camera","runtime/scene-helper","controllers/camera-controller","runtime/transform","runtime/component-3d","runtime/action-dispatcher","montage/core/application","runtime/dependencies/webgl-debug"],factory:function(e,i){e("runtime/dependencies/gl-matrix");var t=e("montage").Montage,a=e("montage/ui/component").Component;e("runtime/glsl-program").GLSLProgram,e("runtime/helpers/resource-manager").ResourceManager,e("runtime/glTF-scene").glTFScene,e("runtime/glTF-node").glTFNode;var s=e("runtime/scene").Scene;e("runtime/node").Node;var u=e("runtime/scene-renderer").SceneRenderer;e("runtime/glTF-material").glTFMaterial,e("runtime/utilities").Utilities;var n=e("montage/core/dom"),r=e("montage/core/geometry/point").Point,l=e("montage/composer/translate-composer").TranslateComposer,o=e("runtime/builtin-assets").BuiltInAssets,c=e("runtime/webgl-renderer").WebGLRenderer;e("runtime/projection").Projection;var m=e("runtime/animation").BasicAnimation;e("runtime/camera").Camera;var d=e("runtime/utilities").BBox,p=e("runtime/scene-helper").SceneHelper,v=e("controllers/camera-controller").CameraController,h=e("runtime/transform").Transform,g=e("runtime/component-3d").Component3D,f=e("runtime/action-dispatcher").ActionDispatcher,b=e("montage/core/application").Application;e("runtime/dependencies/webgl-debug"),i.SceneView=a.specialize({automaticallyCyclesThroughViewPoints:{value:!0,writable:!0},allowsProgressiveSceneLoading:{value:!1,writable:!0},allowsViewPointControl:{value:!0,writable:!0},scene:{get:function(){return this._scene},set:function(e){if(e){if(e.isLoaded()===!1)return e.addOwnPropertyChangeListener("status",this),void 0;this.needsDraw=!0}this.scene!=e&&(this.sceneWillChange(e),this._scene=e,this.sceneDidChange())}},viewPoint:{get:function(){return this._viewPoint},set:function(e){var i=this._viewPoint?this._viewPoint.id:null,t=e?e.id:null;if(i!=t){var a=null;this._viewPoint&&e&&this._viewPoint.scene==e.scene&&(a=this._viewPoint),this.viewPointWillChange(a,e),this._viewPoint=e;var s=this.getAnimationManager();s&&(s.sceneTime=0),e&&this.scene&&null==this._viewPoint.scene&&(this._viewPoint.scene=this.scene),this.viewPointDidChange()}}},play:{value:function(){switch(this._state){case this.PAUSE:case this.STOP:this._lastTime=Date.now(),this._state=this.PLAY,this.needsDraw=!0;break;default:}this._state=this.PLAY}},pause:{value:function(){this._state=this.PAUSE}},stop:{value:function(){var e=this.getAnimationManager();e&&(e.sceneTime=0),this._state=this.STOP,this.needsDraw=!0}},loops:{value:!0,writable:!0},STOP:{value:0,writable:!0},PLAY:{value:1,writable:!0},PAUSE:{value:2,writable:!0},_internalViewPoint:{value:null,writable:!0},_firstFrameDidRender:{value:!1,writable:!0},_sceneResourcesLoaded:{value:!1,writable:!0},_scene:{value:null,writable:!0},_consideringPointerForPicking:{writable:!0,value:!1},_mousePosition:{writable:!0,value:null},_showGradient:{value:!1,writable:!0},_showReflection:{value:!1,writable:!0},_showBBOX:{value:!1,writable:!0},_width:{value:null,writable:!0},_height:{value:null,writable:!0},_lastTime:{value:0,writable:!0},_state:{value:0,writable:!0},_viewPoint:{value:null,writable:!0},_sceneRenderer:{value:null,writable:!0},_disableRendering:{value:!1,writable:!0},_contextAttributes:{value:null,writable:!0},_shouldForceClear:{value:!1,writable:!0},_viewPointIndex:{value:0,writable:!0},_cameraController:{value:null,writable:!0},_defaultViewPoint:{value:null,writable:!0},translateComposer:{value:null,writable:!0},scaleFactor:{get:function(){return this._isiPad()?1:window.devicePixelRatio||1}},selectedNode:{value:null,writable:!0},cameraController:{get:function(){return null==this._cameraController&&(this._cameraController=t.create(v)),this._cameraController}},sceneTimeWillChange:{value:function(){}},sceneTimeDidChange:{value:function(){if(null!=this.scene&&null!=this.scene.glTFElement){var e=this.scene.glTFElement.endTime;if(-1!==e&&null!=this.sceneView){var i=this.scene.glTFElement.animationManager;if(i.sceneTime/1e3>e&&1==this.automaticallyCyclesThroughViewPoints){var t=this.sceneView._viewPointIndex,a=p.getViewPoints(this.scene);if(a.length>0){var s,u=0;do i.sceneTime=0,u++,t=++t%a.length,s=a[t];while(a.length>u&&0==i.nodeHasAnimatedAncestor(s.glTFElement));this.sceneView.viewPoint=s}}}}}},sceneWillChange:{value:function(){this.getResourceManager()&&this.getResourceManager().reset(),this._firstFrameDidRender=!1,this.delegate&&this.delegate.sceneWillChange&&this.delegate.sceneWillChange(),this._scene&&(this._scene.removeEventListener("cursorUpdate",this),this._scene.removeEventListener("materialUpdate",this),this._scene.removeEventListener("textureUpdate",this),b.removeEventListener("sceneNodeSelected",this))}},sceneDidChange:{value:function(){this._scene&&(this._sceneResourcesLoaded=!1,this._scene.addEventListener("cursorUpdate",this),this._scene.addEventListener("textureUpdate",this),this._scene.addEventListener("materialUpdate",this),b.addEventListener("sceneNodeSelected",this),this.applyScene(),this.delegate&&this.delegate.sceneDidChange&&this.delegate.sceneDidChange())}},resourceAvailable:{value:function(){if(0==this.allowsProgressiveSceneLoading){var e=this.getResourceManager();e&&0==e.hasPendingRequests()&&(this.needsDraw=!0)}}},handleTextureUpdate:{value:function(e){var i=this.getResourceManager();if(i&&this.sceneRenderer&&this.sceneRenderer.webGLRenderer){var t=this.sceneRenderer.webGLRenderer.webGLContext,a=i.getResource(e.detail.value,this.sceneRenderer.webGLRenderer.textureDelegate,t);a&&this.resourceAvailable()}}},handleMaterialUpdate:{value:function(){this.needsDraw=!0}},handleCursorUpdate:{value:function(e){null!=this.element&&(this.element.style.cursor=e.detail)}},constructor:{value:function(){this.super()}},animationDidStart:{value:function(){this.needsDraw=!0,this.element.style.cursor="default"}},animationDidStop:{value:function(){}},animationDidUpdate:{value:function(e){var i=this._viewPointAnimationStep,t=e.extras.previousViewPoint;null==this.__matrix&&(this.__matrix=mat4.create()),null==this.__transform&&(this.__transform=Object.create(h).init());var a=t.glTFElement.transform,s=this.viewPoint.glTFElement.transform;a.interpolateToTransform(s,i,this.__transform),mat4.multiply(this.viewPoint.glTFElement.parent.worldMatrix,this.__transform.matrix,this.__matrix),this._internalViewPoint.transform.matrix=this.__matrix}},viewPointWillChange:{value:function(e,i){if(this.sceneRenderer&&i&&this.scene.glTFElement){var t=this.getAnimationManager(),a=0==t.nodeHasAnimatedAncestor(i.glTFElement);if(0==a&&null!=e&&(a|=0==t.nodeHasAnimatedAncestor(e.glTFElement)),a&&null!=e){var s=Object.create(m).init();s.path="_viewPointAnimationStep",s.target=this,s.delegate=this,s.from=Number(0),s.to=Number(1),s.duration=1e3,s.timingFunction="ease-out",s.extras.previousViewPoint=e,t.playAnimation(s),s.animationWasAddedToTarget()}}}},viewPointDidChange:{value:function(){this.cameraController.viewPoint=this.viewPoint,this.sceneRenderer&&this._viewPoint&&this.scene&&this.scene.glTFElement&&(this.sceneRenderer.technique.rootPass.viewPoint=this._internalViewPoint,this._viewPointIndex=this._getViewPointIndex(this.viewPoint),this.needsDraw=!0)}},viewPoint:{get:function(){return this._viewPoint},set:function(e){var i=this._viewPoint?this._viewPoint.id:null,t=e?e.id:null;if(i!=t){var a=null;this._viewPoint&&e&&this._viewPoint.scene==e.scene&&(a=this._viewPoint),this.viewPointWillChange(a,e),this._viewPoint=e;var s=this.getAnimationManager();s&&(s.sceneTime=0),e&&this.scene&&null==this._viewPoint.scene&&(this._viewPoint.scene=this.scene),this.viewPointDidChange()
}}},canvas:{get:function(){return this.templateObjects?this.templateObjects.canvas:null}},sceneRenderer:{get:function(){return this._sceneRenderer},set:function(e){e!=this._sceneRenderer&&(this._sceneRenderer=e)}},handleStatusChange:{value:function(e,i,t){"loaded"===e&&(this.scene=t,this.needsDraw=!0,this.scene.glTFElement&&this.scene.glTFElement.animationManager&&this.scene.glTFElement.animationManager&&(this.scene.glTFElement.animationManager.delegate=this))}},_getViewPointIndex:{value:function(e){for(var i=p.getGLTFViewPoints(e.scene),t=0;i.length>t;t++)if(i[t].baseId===e.id)return t;return 0}},applyScene:{value:function(){var e=this.scene,i=e.glTFElement,t=this;if(this.sceneRenderer&&this.sceneRenderer.technique.rootPass){if(i){var a=p.getViewPoints(e),s=a.length>0;if(s){var u=!1;this.viewPoint&&this.viewPoint.scene&&(u=this.viewPoint.scene===this.scene),u===!1&&(this.viewPoint=a[0])}else{var n=i.rootNode.getBoundingBox(!0);Object.create(d).init(n[0],n[1]),i.rootNode.transform._updateDirtyFlag(!1);var r=this.scene.glTFElement,n=r.rootNode.getBoundingBox(!0),l=[(n[0][0]+n[1][0])/2,(n[0][1]+n[1][1])/2,(n[0][2]+n[1][2])/2];l[2];var o=[l[0],l[1],l[2]];o[2]+=n[1][0]-n[0][0]+(n[1][2]-n[0][2]),this._defaultViewPoint=p.createNodeIncludingCamera("camera01",e);var c=p.getGLTFCamera(this._defaultViewPoint);c.projection.zfar=o[2]+n[1][2]-n[0][2],this._defaultViewPoint.glTFElement.transform.translation=o,this.viewPoint=this._defaultViewPoint}this.sceneRenderer.scene=i}if(this.viewPoint&&(null==this.viewPoint.scene&&(this.viewPoint.scene=e),this.sceneRenderer&&this.viewPointDidChange()),this.allowsProgressiveSceneLoading===!1){var m=this.scene.prepareToRender(this.sceneRenderer.webGLRenderer);m.then(function(){t._sceneResourcesLoaded=!0,t.needsDraw=!0},function(){},function(){})}else this.needsDraw=!0}}},getRelativePositionToCanvas:{value:function(e){return n.convertPointFromPageToNode(this.canvas,r.create().init(e.pageX,e.pageY))}},_isiPad:{value:function(){return!!navigator.userAgent.match(/iPad/i)}},enterDocument:{value:function(){window.addEventListener("resize",this,!0);var e=this;setTimeout(function(){e.captureResize()},500),this.scene&&(this.scene.dispatchEventNamed("enteredDocument",!0,!1,this),this.scene.loadCSSStyles()),this.element.addEventListener("wheel",function(i){1==e.allowsViewPointControl&&null!=e.scene&&e.scene.rootNode&&(e.cameraController.node=e.scene.rootNode,e.cameraController.zoom(i)),i.stopPropagation(),i.preventDefault()},!1),this.element.addEventListener("gesturestart",function(e){e.preventDefault()},!1),this.element.addEventListener("gesturechange",function(e){e.preventDefault()},!1);var i=this.translateComposer;i.addEventListener("translate",function(i){1==e.allowsViewPointControl&&null!=e.scene&&e.scene.rootNode&&(e.cameraController.node=e.scene.rootNode,e.cameraController.translate(i)),e.needsDraw=!0}),i.addEventListener("translateStart",function(i){1==e.allowsViewPointControl&&null!=e.scene&&e.scene.rootNode&&(e.cameraController.node=e.scene.rootNode,e.cameraController.beginTranslate(i))},!1),i.addEventListener("translateEnd",function(i){1==e.allowsViewPointControl&&null!=e.scene&&e.scene.rootNode&&(e.cameraController.node=e.scene.rootNode,e.cameraController.endTranslate(i))},!1),this.addComposerForElement(i,this.canvas);var a;a=void 0!==window.onwheel?"wheel":"mousewheel",this.canvas.removeEventListener(a,i,!0),this.canvas.removeEventListener(a,i,!1);var n=!1;n&&(this.canvas=WebGLDebugUtils.makeLostContextSimulatingCanvas(this.canvas));var r={premultipliedAlpha:!0,antialias:!0,preserveDrawingBuffer:!1},l=this.canvas.getContext("experimental-webgl",r)||this.canvas.getContext("webgl",r);if(null==l)return console.log("Please check that your browser enables & supports WebGL"),void 0;this._contextAttributes=l.getContextAttributes();var m=!1;if(this._contextAttributes&&(m=this._contextAttributes.antialias),0==m&&console.log("WARNING: anti-aliasing is not supported/enabled"),navigator){var d=null!=navigator.userAgent.match(/iPad/i);if(0==d){var v=navigator.userAgent;d=/iPad/i.test(v)||/iPhone OS 3_1_2/i.test(v)||/iPhone OS 3_2_2/i.test(v)}d&&(this._shouldForceClear=!0)}var h=Object.create(c).initWithWebGLContext(l);l.enable(l.DEPTH_TEST);var g=null;this.sceneRenderer=Object.create(u),this.sceneRenderer.init(h,g);var b=this.getResourceManager();b.isObserving()||(b.observers.push(this),b.startObserving()),this.scene&&this.applyScene(),this.canvas.addEventListener("webglcontextlost",function(i){console.log("context was lost"),i.preventDefault(),e.getResourceManager.stopObserving(),e.sceneRenderer.webGLRenderer.resourceManager.reset(),e.needsDraw=!1,e._disableRendering=!0},!1),this.canvas.addEventListener("webglcontextrestored",function(i){console.log("context was restored"),i.preventDefault(),l.enable(l.DEPTH_TEST),e.needsDraw=!0,e._disableRendering=!1},!1),n&&setTimeout(function(){e.canvas.loseContext()},5e3);var e=this,q=o.assetWithName("gradient");q.then(function(i){var a=t.create(s).init(i);e.gradientRenderer=Object.create(u),e.gradientRenderer.init(h,null),e.gradientRenderer.scene=a.glTFElement;var n=p.getViewPoints(a);n&&n.length&&(e.gradientRenderer.technique.rootPass.viewPoint=n[0].glTFElement),e.needsDraw=!0},function(){},function(){}),this.actionDispatcher=f.create().initWithScene(this.scene),this.needsDraw=!0,this.canvas.addEventListener("touchstart",this.start.bind(this),!0),this.canvas.addEventListener("touchend",this.end.bind(this),!0),this.canvas.addEventListener("touchcancel",this.end.bind(this),!0),this.canvas.addEventListener("touchmove",this.move.bind(this),!0),this.canvas.addEventListener("gesturechange",this,!0),this.canvas.addEventListener("mousedown",this.start.bind(this),!0),this.canvas.addEventListener("mouseup",this.end.bind(this),!0),this.canvas.addEventListener("mousemove",this.move.bind(this),!0),this.canvas.addEventListener("wheel",this,!0)}},exitDocument:{value:function(){window.removeEventListener("resize",this,!0)}},captureMousewheel:{value:function(){this.needsDraw=!0}},captureWheel:{value:function(){this.needsDraw=!0}},captureGesturechange:{value:function(){this.needsDraw=!0}},_TOUCH_DOWN:{value:0},_TOUCH_UP:{value:1},_TOUCH_MOVE:{value:2},_eventType:{value:-1,writable:!0},_previousEventType:{value:-1,writable:!0},_lastHandledComponent:{value:null,writable:!0},_previousHandledComponent:{value:null,writable:!0},handleSelectedNode:{value:function(e){var i=null,t=this._previousHandledComponent,a=t?t.component3D:null;if(this._eventType===this._TOUCH_UP&&(t&&a&&a.handleActionOnGlTFElement(t,g._TOUCH_UP),this._eventType=-1),e&&(i=this.scene.glTFElement.ids[e],this._eventType===this._TOUCH_DOWN)){var s=p.createNodeFromGlTFElementIfNeeded(i,this.scene);b.dispatchEventNamed("sceneNodeSelected",!0,!0,s)}t&&a&&this._previousEventType===this._TOUCH_MOVE&&i!==t&&a.handleActionOnGlTFElement(t,g._EXIT),this._eventType===this._TOUCH_MOVE&&i!==t?i?this.actionDispatcher.dispatchActionOnGlTFElement(g._ENTER,i):this._eventType=-1:i&&this._eventType===this._TOUCH_DOWN&&(this.actionDispatcher.dispatchActionOnGlTFElement(g._TOUCH_DOWN,i),this._eventType=-1),this._previousHandledComponent=i,this._previousEventType=this._eventType}},move:{value:function(e){var i=this.getRelativePositionToCanvas(e);this._mousePosition=[i.x*this.scaleFactor,this.height-i.y*this.scaleFactor],this._eventType=this._TOUCH_MOVE,this.needsDraw=!0}},start:{value:function(e){e.preventDefault(),this._consideringPointerForPicking=!0;var i=this.getRelativePositionToCanvas(e);this._mousePosition=[i.x*this.scaleFactor,this.height-i.y*this.scaleFactor],this._state===this.PLAY&&this.pause(),this._eventType=this._TOUCH_DOWN,this.needsDraw=!0}},end:{value:function(e){if(this._consideringPointerForPicking&&e.target===this.canvas&&e.preventDefault(),this._state===this.PAUSE&&this.scene&&this.viewPoint&&this.scene.glTFElement){var i=this.getAnimationManager();i.nodeHasAnimatedAncestor(this.viewPoint.glTFElement)&&this.play()}this._consideringPointerForPicking=!1,this._eventType=this._TOUCH_UP,this.handleSelectedNode(null),this._mousePosition=null}},getWebGLRenderer:{value:function(){return this.sceneRenderer?this.sceneRenderer.webGLRenderer:null}},getWebGLContext:{value:function(){var e=this.getWebGLRenderer();return e?e.webGLContext:null}},getResourceManager:{value:function(){var e=this.getWebGLRenderer();return e?e.resourceManager:null}},getAnimationManager:{value:function(){return this.scene&&this.scene.glTFElement?this.scene.glTFElement.animationManager:null}},showBBOX:{get:function(){return this._showBBOX},set:function(e){e!=this._showBBOX&&(this._showBBOX=e,this.needsDraw=!0)}},showGradient:{get:function(){return this._showGradient},set:function(e){e!=this._showGradient&&(this._showGradient=e,this.needsDraw=!0)}},showReflection:{get:function(){return this._showReflection},set:function(e){this._showReflection=e,this.needsDraw=!0}},handleSceneNodeSelected:{value:function(e){this.selectedNode=e.detail,this.needsDraw=!0}},_displayBBOX:{value:function(e){if(this.scene&&this.scene.glTFElement&&null!=e.getBoundingBox){var i=this.sceneRenderer.technique.rootPass.scenePassRenderer._viewPointMatrix,t=p.getGLTFCamera(this.viewPoint);if(null!=t){var a=t.projection.matrix;this.getWebGLRenderer().drawBBOX(e.getBoundingBox(!0),i,mat4.identity(),a)}}}},_displayAllBBOX:{value:function(){if(this.scene&&this.scene.glTFElement){this.sceneRenderer.technique.rootPass.scenePassRenderer._viewPointMatrix;var e=mat4.identity(),i=this.scene.glTFElement.rootNode,t=this;i.apply(function(e){return t._displayBBOX(e),null},!0,e)}}},width:{get:function(){if(null==this._width){var e=window.getComputedStyle(this.element,null);return parseInt(e.width)*this.scaleFactor}return this._width},set:function(e){e*this.scaleFactor!=this._width&&(this._width=e*this.scaleFactor,this.needsDraw=!0)}},height:{get:function(){if(null==this._height){var e=window.getComputedStyle(this.element,null);return parseInt(e.height)*this.scaleFactor}return this._height},set:function(e){e*this.scaleFactor!=this._height&&(this._height=e*this.scaleFactor,this.needsDraw=!0)}},_forwardToNextAnimatedViewPointIfNeeded:{value:function(){var e=this.getAnimationManager();if(e){if(1==e.nodeHasAnimatedAncestor(this.viewPoint.glTFElement))return;var i=this._viewPointIndex,t=p.getViewPoints(this.scene);if(t.length>1){for(var a=this.viewPoint,s=0;t.length>s&&0==e.nodeHasAnimatedAncestor(a.glTFElement);)i=++i%t.length,a=t[i],s++;this.viewPoint=a}}}},draw:{value:function(){var e=this.getWebGLContext();if(!(null==e||this._disableRendering||(this.sceneRenderer.technique.rootPass.viewPoint=this._internalViewPoint,(this._shouldForceClear||null==this._contextAttributes.preserveDrawingBuffer||1==this._contextAttributes.preserveDrawingBuffer)&&(e.clearColor(0,0,0,0),e.clear(e.DEPTH_BUFFER_BIT|e.COLOR_BUFFER_BIT)),this.delegate&&this.delegate.sceneWillDraw&&this.delegate.sceneWillDraw(),this.allowsProgressiveSceneLoading===!1&&this._sceneResourcesLoaded===!1||null==this._scene||null==this.viewPoint||this._disableRendering))){var i=this.width,t=this.height;(i!=this.canvas.width||t!=this.canvas.height)&&(this.canvas.style.width=i/this.scaleFactor+"px",this.canvas.style.height=t/this.scaleFactor+"px",this.canvas.width=i,this.canvas.height=t,e.viewport(0,0,i,t));var a=this.viewPoint,s=Date.now();if(this.sceneRenderer&&this.scene){var u=this.getAnimationManager();if(this._state==this.PLAY&&u){this._forwardToNextAnimatedViewPointIfNeeded(),u.sceneTime+=s-this._lastTime;var n=this.scene.glTFElement.endTime;u.sceneTime/1e3>n&&(this.loops?u.sceneTime=0==n?0:u.sceneTime%n:this.stop()),u.updateTargetsAtTime(u.sceneTime,this.getResourceManager())}if(a.glTFElement){var r=p.getGLTFCamera(a);r.projection.aspectRatio=i/t,this._internalViewPoint.transform.matrix=a.glTFElement.worldMatrix,null!=this._internalViewPoint.cameras&&this._internalViewPoint.cameras.length>0&&(this._internalViewPoint.cameras[0]=r)}u.evaluateAtTime(s,this.getResourceManager()),u.hasActiveAnimations()&&(this.needsDraw=!0)}if(this._lastTime=s,this._state==this.PLAY&&(this.needsDraw=!0),this.scene&&(this.sceneRenderer.webGLRenderer,e)){null==this.__renderOptions&&(this.__renderOptions={});var l=this.showReflection;if(l){e.depthFunc(e.LESS),e.enable(e.DEPTH_TEST),e.frontFace(e.CW),e.depthMask(!0);var o=this.scene.glTFElement.rootNode,c=o.getBoundingBox(!0),m=mat4.create(o.transform.matrix),d=mat4.scale(mat4.identity(),[1,1,-1]);mat4.multiply(d,o.transform.matrix),o.transform.matrix=d;var v=o.getBoundingBox(!0),h=mat4.identity(),g=mat4.translate(mat4.identity(),[0,0,c[0][2]-v[1][2]]);mat4.multiply(h,g),mat4.multiply(h,d),o.transform.matrix=h,this.sceneRenderer.render(s,this.__renderOptions),o.transform.matrix=m,e.frontFace(e.CCW)}(this.showGradient||l)&&this.viewPoint===this._defaultViewPoint&&this.gradientRenderer&&(e.enable(e.BLEND),e.disable(e.DEPTH_TEST),e.disable(e.CULL_FACE),e.depthMask(!1),this.gradientRenderer.render(s,this.__renderOptions),e.depthMask(!0),e.enable(e.DEPTH_TEST),e.enable(e.CULL_FACE),e.disable(e.BLEND)),this.scene.shouldBeHitTested&&null!=this._mousePosition&&(this.__renderOptions.picking=!0,this.__renderOptions.coords=this._mousePosition,this.__renderOptions.delegate=this,this.sceneRenderer.render(s,this.__renderOptions)),this.__renderOptions.picking=!1,this.__renderOptions.coords=null,this.__renderOptions.delegate=null,this.sceneRenderer.render(s,this.__renderOptions),this.showBBOX&&this._displayAllBBOX(),this.delegate&&this.delegate.sceneDidDraw&&this.delegate.sceneDidDraw(),e.flush(),this._firstFrameDidRender===!1&&(this._firstFrameDidRender=!0,this.dispatchEventNamed("firstFrameDidRender",!0,!1,this))}}}},captureResize:{value:function(){this.needsDraw=!0;var e=this.element.offsetWidth,i=this.element.offsetHeight;this.width=e,this.height=i,this.needsDraw=!0}},templateDidLoad:{value:function(){this.parentComponent;var e=l.create();e.animateMomentum=!0,e.hasMomentum=!0,e.allowFloats=!0,e.pointerSpeedMultiplier=.15,this._internalViewPoint=p.createGLTFNodeIncludingCamera("__internal_viewPoint__"),this.translateComposer=e,this.needsDraw=!0}}})}}),montageDefine("3d2b056","runtime/webgl-renderer",{dependencies:["runtime/dependencies/gl-matrix","runtime/glsl-program","runtime/helpers/resource-manager"],factory:function(e,i){e("runtime/dependencies/gl-matrix");var t=e("runtime/glsl-program").GLSLProgram,a=e("runtime/helpers/resource-manager").WebGLTFResourceManager;i.WebGLRenderer=Object.create(Object.prototype,{MODEL:{value:"MODEL",writable:!1},VIEW:{value:"VIEW",writable:!1},PROJECTION:{value:"PROJECTION",writable:!1},MODELVIEW:{value:"MODELVIEW",writable:!1},VIEWPROJECTION:{value:"VIEWPROJECTION",writable:!1},MODELVIEWPROJECTION:{value:"MODELVIEWPROJECTION",writable:!1},MODELINVERSE:{value:"MODELINVERSE",writable:!1},VIEWINVERSE:{value:"VIEWINVERSE",writable:!1},PROJECTIONINVERSE:{value:"PROJECTIONINVERSE",writable:!1},MODELVIEWINVERSE:{value:"MODELVIEWINVERSE",writable:!1},VIEWPROJECTIONINVERSE:{value:"VIEWPROJECTIONINVERSE",writable:!1},MODELVIEWPROJECTIONINVERSE:{value:"MODELVIEWPROJECTIONINVERSE",writable:!1},MODELTRANSPOSE:{value:"MODELTRANSPOSE",writable:!1},VIEWTRANSPOSE:{value:"VIEWTRANSPOSE",writable:!1},PROJECTIONTRANSPOSE:{value:"PROJECTIONTRANSPOSE",writable:!1},MODELVIEWTRANSPOSE:{value:"MODELVIEWTRANSPOSE",writable:!1},VIEWPROJECTIONTRANSPOSE:{value:"VIEWPROJECTIONTRANSPOSE",writable:!1},MODELVIEWPROJECTIONTRANSPOSE:{value:"MODELVIEWPROJECTIONTRANSPOSE",writable:!1},MODELINVERSETRANSPOSE:{value:"MODELINVERSETRANSPOSE",writable:!1},VIEWINVERSETRANSPOSE:{value:"VIEWINVERSETRANSPOSE",writable:!1},PROJECTIONINVERSETRANSPOSE:{value:"PROJECTIONINVERSETRANSPOSE",writable:!1},MODELVIEWINVERSETRANSPOSE:{value:"MODELVIEWINVERSETRANSPOSE",writable:!1},VIEWPROJECTIONINVERSETRANSPOSE:{value:"VIEWPROJECTIONINVERSETRANSPOSE",writable:!1},MODELVIEWPROJECTIONINVERSETRANSPOSE:{value:"MODELVIEWPROJECTIONINVERSETRANSPOSE",writable:!1},_bindedProgram:{value:null,writable:!0},_debugProgram:{value:null,writable:!0},_resourceManager:{value:null,writable:!0},_webGLContext:{value:null,writable:!0},_projectionMatrix:{value:null,writable:!0},shininess:{value:200,writable:!0},light:{value:[0,0,-1],writable:!0},specularColor:{value:[1,1,1],writable:!0},GLContextDidChange:{value:function(){}},initWithWebGLContext:{value:function(e){return this.webGLContext=e,this._states={},this}},bindedProgram:{get:function(){return this._bindedProgram},set:function(e){this._bindedProgram!==e&&this._webGLContext&&(this._bindedProgram=e,this._bindedProgram&&this._bindedProgram.use(this._webGLContext,!1))}},projectionMatrix:{get:function(){return this._projectionMatrix},set:function(e){this._projectionMatrix=e}},debugProgram:{get:function(){if(!this._debugProgram){this._debugProgram=Object.create(t);var e="precision highp float;attribute vec3 vert;uniform mat4 u_mvMatrix; uniform mat4 u_projMatrix; void main(void) { gl_Position = u_projMatrix * u_mvMatrix * vec4(vert,1.0); }",i="precision highp float;void main(void) { gl_FragColor = vec4(1.,0.,0.,1.); }";this._debugProgram.initWithShaders({"x-shader/x-vertex":e,"x-shader/x-fragment":i}),this._debugProgram.build(this.webGLContext)||console.log(this._debugProgram.errorLogs)}return this._debugProgram}},webGLContext:{get:function(){return this._webGLContext},set:function(e){this._webGLContext=e,this.GLContextDidChange()}},resourceManager:{get:function(){return this._resourceManager||(this._resourceManager=Object.create(a),this._resourceManager.init()),this._resourceManager}},indicesDelegate:{value:{webGLContext:{value:null,writable:!0},handleError:function(e,i){console.log("ERROR:vertexAttributeBufferDelegate:"+e+" :"+i)},convert:function(e,i,t){var a=t,s=a.getParameter(a.ELEMENT_ARRAY_BUFFER_BINDING),u=a.createBuffer();return a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,u),a.bufferData(a.ELEMENT_ARRAY_BUFFER,i,a.STATIC_DRAW),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,s),u},resourceAvailable:function(){}}},setupCompressedMesh:{value:function(e,i,t){var a=e.primitives[0],s=this.webGLContext,u=s.getParameter(s.ELEMENT_ARRAY_BUFFER_BINDING),n=s.createBuffer();s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,n),s.bufferData(s.ELEMENT_ARRAY_BUFFER,t,s.STATIC_DRAW),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,u),n.count=t.length,this.resourceManager.setResource(a.indices.id,n),a.indices={id:a.indices.id,count:n.count};var r,l=i.length/8,o=new Float32Array(3*l),c=new Float32Array(3*l),m=new Float32Array(2*l);for(r=0;l>r;r++){var d=8*r;o[3*r+0]=i[d+0],o[3*r+1]=i[d+1],o[3*r+2]=i[d+2],c[3*r+0]=i[d+5],c[3*r+1]=i[d+6],c[3*r+2]=i[d+7],m[2*r+0]=i[d+3],m[2*r+1]=i[d+4]}u=s.getParameter(s.ARRAY_BUFFER_BINDING),n=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,n),s.bufferData(s.ARRAY_BUFFER,o,s.STATIC_DRAW),n.componentType=s.FLOAT,n.componentsPerAttribute=3,this.resourceManager.setResource(a.semantics.POSITION.id,n),a.semantics.POSITION={id:a.semantics.POSITION.id,count:l,byteStride:12},n=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,n),s.bufferData(s.ARRAY_BUFFER,c,s.STATIC_DRAW),n.componentType=s.FLOAT,n.componentsPerAttribute=3,this.resourceManager.setResource(a.semantics.NORMAL.id,n),a.semantics.NORMAL={id:a.semantics.NORMAL.id,count:l,byteStride:12},m.length>0&&(n=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,n),s.bufferData(s.ARRAY_BUFFER,m,s.STATIC_DRAW),n.componentType=s.FLOAT,n.componentsPerAttribute=2,this.resourceManager.setResource(a.semantics.TEXCOORD_0.id,n),a.semantics.TEXCOORD_0={id:a.semantics.TEXCOORD_0.id,count:l,byteStride:8}),s.bindBuffer(s.ARRAY_BUFFER,u)}},setupCompressedMesh2:{value:function(e,i,t,a,s,u,n){for(var r=this.webGLContext,l=0,o=0,c=e.primitives,m=0;c.length>m;m++){var d=e.primitives[m],p=d.indices.id;l=d.indices.count;var v=new Int16Array(n.subarray(o,o+l)),h=r.createBuffer();r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,h),r.bufferData(r.ELEMENT_ARRAY_BUFFER,v,r.STATIC_DRAW),this.resourceManager.setResource(p,h),h.count=l,d.indices={id:p,count:h.count},o+=l}for(var g,f={},m=0;c.length>m;m++){var d=e.primitives[m];for(g in d.semantics){var b=d.semantics[g];f[b.baseId]=g}}for(var q in f){var _=u[q];if(null!=_){var y=s.GetFloatAttribute(_),g=f[q];if("JOINT"===g)for(var S=0;y.length>S;S++)y[S]=Math.floor(y[S]+.5);var P=s.GetFloatAttributeDim(_);h=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,h),r.bufferData(r.ARRAY_BUFFER,y,r.STATIC_DRAW),h.componentType=r.FLOAT,h.componentsPerAttribute=P,this.resourceManager.setResource(d.semantics[g].id,h),d.semantics[g]={id:d.semantics[g].id,count:l,byteStride:4*P}}}l=i,previousBuffer=r.getParameter(r.ARRAY_BUFFER_BINDING),h=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,h),r.bufferData(r.ARRAY_BUFFER,t,r.STATIC_DRAW),h.componentType=r.FLOAT,h.componentsPerAttribute=3,this.resourceManager.setResource(d.semantics.POSITION.id,h),d.semantics.POSITION={id:d.semantics.POSITION.id,count:l,byteStride:12},null!=a&&(h=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,h),r.bufferData(r.ARRAY_BUFFER,a,r.STATIC_DRAW),h.componentType=r.FLOAT,h.componentsPerAttribute=3,this.resourceManager.setResource(d.semantics.NORMAL.id,h),d.semantics.NORMAL={id:d.semantics.NORMAL.id,count:l,byteStride:12}),r.bindBuffer(r.ARRAY_BUFFER,previousBuffer)}},vertexAttributeBufferDelegate:{value:{_componentTypeForGLType:function(e,i){switch(i){case e.FLOAT:case e.FLOAT_VEC2:case e.FLOAT_VEC3:case e.FLOAT_VEC4:return e.FLOAT;case e.UNSIGNED_BYTE:return e.UNSIGNED_BYTE;case e.UNSIGNED_SHORT:return e.UNSIGNED_SHORT;default:return null}},_componentsPerElementForGLType:function(e,i){switch(i){case e.FLOAT:case e.UNSIGNED_BYTE:case e.UNSIGNED_SHORT:return 1;case e.FLOAT_VEC2:return 2;case e.FLOAT_VEC3:return 3;case e.FLOAT_VEC4:return 4;default:return null}},webGLContext:{value:null,writable:!0},handleError:function(e,i){console.log("ERROR:vertexAttributeBufferDelegate:"+e+" :"+i)},convert:function(e,i,t){var a=e,s=t,u=s.getParameter(s.ARRAY_BUFFER_BINDING),n=s.createBuffer();return s.bindBuffer(s.ARRAY_BUFFER,n),s.bufferData(s.ARRAY_BUFFER,i,s.STATIC_DRAW),n.componentType=this._componentTypeForGLType(s,a.type),n.componentsPerAttribute=this._componentsPerElementForGLType(s,a.type),s.bindBuffer(s.ARRAY_BUFFER,u),n},resourceAvailable:function(){}}},textureDelegate:{value:{getGLFilter:function(e){return null==e?WebGLRenderingContext.prototype.LINEAR:e},getGLWrapMode:function(e){return null==e?WebGLRenderingContext.prototype.REPEAT:e},handleError:function(e,i){console.log("ERROR:textureDelegate:"+e+" :"+i)},nextHighestPowerOfTwo:function(e){--e;for(var i=1;32>i;i<<=1)e|=e>>i;return e+1},isPowerOfTwo:function(e){return 0==(e&e-1)},installCubemapSide:function(e,i,t,a){e.bindTexture(e.TEXTURE_CUBE_MAP,t),e.texImage2D(i,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,a),e.bindTexture(e.TEXTURE_CUBE_MAP,null)},createTextureFromImageAndSampler:function(e,i,t){var a=t.getParameter(t.ACTIVE_TEXTURE),s=t.getParameter(t.TEXTURE_BINDING_2D);t.activeTexture(t.TEXTURE0);var u=null,n=this.getGLFilter(i.minFilter),r=this.getGLFilter(i.magFilter),l=this.getGLWrapMode(i.wrapS),o=this.getGLWrapMode(i.wrapT),c=!1,m=n===t.NEAREST_MIPMAP_NEAREST||n===t.LINEAR_MIPMAP_NEAREST||n===t.NEAREST_MIPMAP_LINEAR||n===t.LINEAR_MIPMAP_LINEAR;if(m||l===t.REPEAT||o===t.REPEAT){var d=parseInt(e.width),p=parseInt(e.height);if(this.isPowerOfTwo(d)||(d=this.nextHighestPowerOfTwo(d),c=!0),this.isPowerOfTwo(p)||(p=this.nextHighestPowerOfTwo(p),c=!0),c){u=document.createElement("canvas"),u.width=d,u.height=p;var v=u.getContext("2d");v.drawImage(e,0,0,parseInt(u.width),parseInt(u.height)),u.id=e.id,e=u}}var h=t.createTexture();return h.contextID=t.contextID,t.bindTexture(t.TEXTURE_2D,h),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,l),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,o),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,r),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),m&&t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,s),t.activeTexture(a),h},convert:function(e,i,t){var a=t;if(e){if(6===e.length){var s=a.createTexture();return a.bindTexture(a.TEXTURE_CUBE_MAP,s),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),this.installCubemapSide(a,a.TEXTURE_CUBE_MAP_POSITIVE_X,s,e[0]),this.installCubemapSide(a,a.TEXTURE_CUBE_MAP_NEGATIVE_X,s,e[1]),this.installCubemapSide(a,a.TEXTURE_CUBE_MAP_POSITIVE_Y,s,e[2]),this.installCubemapSide(a,a.TEXTURE_CUBE_MAP_NEGATIVE_Y,s,e[3]),this.installCubemapSide(a,a.TEXTURE_CUBE_MAP_POSITIVE_Z,s,e[4]),this.installCubemapSide(a,a.TEXTURE_CUBE_MAP_NEGATIVE_Z,s,e[5]),s}}else if("video"==e.type){i.source.videoElement=e;var u=a.createTexture();return a.bindTexture(a.TEXTURE_2D,u),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,i.source.videoElement),a.bindTexture(a.TEXTURE_2D,null),u}return this.createTextureFromImageAndSampler(e,i.sampler,a)},resourceAvailable:function(){}}},_lastMaxEnabledArray:{value:0,writable:!0},_states:{value:null,writable:!0},setState:{value:function(e,i,t){var a=this.webGLContext;(null==this._states[e]||1==t||this._states[e]!==i)&&(this._states[e]=i,i?a.enable(e):a.disable(e))}},resetStates:{value:function(){var e=this.webGLContext;if(e&&-1!==this._lastMaxEnabledArray)for(var i=0;this._lastMaxEnabledArray>i;i++)e.disableVertexAttribArray(i);this._lastMaxEnabledArray=-1,this.bindedProgram=null,this.setState(e.BLEND,!1)}},renderPrimitive:{value:function(e,i,t,a){var s=!1,u=null,n=e.primitive;e.node&&e.node.instanceSkin&&e.node.instanceSkin.skin.process(e.node,this.resourceManager);var r,l=-1,o=this.webGLContext,c=this.bindedProgram,m=0;a||(a=n.material.parameters);var d=c.uniformSymbols;for(r=0;d.length>r;r++){var p=d[r],v=i.instanceProgram.uniforms[p];if(u=null,v=a[v],v&&null!=v.semantic){var h=e.nodeWrapper;v.source&&(h=e.nodeWrapper.scenePassRenderer._nodeWrappers[v.source.id]);var g=v.semantic;g===this.PROJECTION?u=this.projectionMatrix:g===this.MODELVIEW?u=h.worldViewMatrix:g===this.MODELVIEWINVERSETRANSPOSE?u=h.worldViewInverseTransposeMatrix:g===this.MODELVIEWINVERSE&&(u=h.worldViewInverseMatrix)}if(null==u&&null!=v)if(v.source&&null==g){var h=e.nodeWrapper.scenePassRenderer._nodeWrappers[v.source.id];u=h.worldViewMatrix}else u=v.value;var f=null;if(null!=u){var b=c.getTypeForSymbol(p),q=b===o.SAMPLER_CUBE,_=b===o.SAMPLER_2D;if(q){if(f=this.resourceManager.getResource(u,this.textureDelegate,this.webGLContext)){o.activeTexture(o.TEXTURE0+m),o.bindTexture(o.TEXTURE_CUBE_MAP,f);var y=c.getLocationForSymbol(p);void 0!==y&&(c.setValueForSymbol(p,m),m++)}}else if(_){if(f=this.resourceManager.getResource(u,this.textureDelegate,this.webGLContext),null!=f){o.activeTexture(o.TEXTURE0+m),o.bindTexture(o.TEXTURE_2D,f),v.value.source.videoElement&&v.value.source.timeStamp!=t&&(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,v.value.source.videoElement),v.value.source.timeStamp=t);var y=c.getLocationForSymbol(p);void 0!==y&&(c.setValueForSymbol(p,m),m++)}}else c.setValueForSymbol(p,u)}}c.commit(o);var S=0,P=i.instanceProgram.attributes,C=c.attributeSymbols;for(r=0;C.length>r;r++){var p=C[r],v=P[p];v=a[v];var g=v.semantic,N=n.semantics[g],D=null;if(D=e.compressed?this.resourceManager._getResource(N.id):this.resourceManager.getResource(N,this.vertexAttributeBufferDelegate,this.webGLContext)){o.bindBuffer(o.ARRAY_BUFFER,D);var M=c.getLocationForSymbol(p);void 0!==M&&(M>l&&(l=M),o.enableVertexAttribArray(M),o.vertexAttribPointer(M,D.componentsPerAttribute,D.componentType,!1,N.byteStride,0),s&&"POSITION"==g&&o.drawArrays(o.POINTS,0,N.count)),S++}else this._lastMaxEnabledArray=-1}var E=S===C.length;if(!s){if(E)for(var r=l+1;this._lastMaxEnabledArray>r;r++)o.disableVertexAttribArray(r);var A=null;A=e.compressed?this.resourceManager._getResource(n.indices.id):this.resourceManager.getResource(n.indices,this.indicesDelegate,this.webGLContext),A&&E&&(o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,A),o.drawElements(o.TRIANGLES,n.indices.count,o.UNSIGNED_SHORT,0))}return this._lastMaxEnabledArray=l,E}},programDelegate:{value:{handleError:function(e,i){console.log("ERROR:programDelegate:"+e+" :"+i)},convert:function(e,i,a){var s=a,u=Object.create(t);return u.initWithShaders(i),u.build(s)||(console.log(i),console.log(u.errorLogs)),u},resourceAvailable:function(){}}},bindRenderTarget:{value:function(e){var i=this.webGLContext,t=e.FBO?!1:!0;e.previousFBO=i.getParameter(i.FRAMEBUFFER_BINDING),e.FBO||(e.FBO=i.createFramebuffer(),t=!0),i.bindFramebuffer(i.FRAMEBUFFER,e.FBO);var a=e.extras,s=i.drawingBufferWidth!=e.width||i.drawingBufferHeight!=e.height,u=i.drawingBufferWidth,n=i.drawingBufferHeight;(t||s)&&e.attachments.forEach(function(e){if("COLOR_ATTACHMENT0"==e.semantic&&a.picking){var r=i.getParameter(i.TEXTURE_BINDING_2D);t&&(a.pickingTexture=i.createTexture()),s&&(i.bindTexture(i.TEXTURE_2D,a.pickingTexture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,u,n,0,i.RGBA,i.UNSIGNED_BYTE,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST)),t&&i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,a.pickingTexture,0),i.bindTexture(i.TEXTURE_2D,r)}if("DEPTH_ATTACHMENT"==e.semantic&&a.picking){var l=i.getParameter(i.RENDERBUFFER_BINDING);t&&(a.pickingRenderBuffer=i.createRenderbuffer()),s&&(i.bindRenderbuffer(i.RENDERBUFFER,a.pickingRenderBuffer),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,u,n)),t&&i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,a.pickingRenderBuffer),i.bindRenderbuffer(i.RENDERBUFFER,l)}},this),i.clearColor(0,0,0,1),i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT)}},unbindRenderTarget:{value:function(e){var i=this.webGLContext;e.extras.picking&&(e.extras.pickedPixel||(e.extras.pickedPixel=new Uint8Array(4)),i.finish(),i.readPixels(e.extras.coords[0],e.extras.coords[1],1,1,i.RGBA,i.UNSIGNED_BYTE,e.extras.pickedPixel)),i.bindFramebuffer(i.FRAMEBUFFER,e.previousFBO);var t=!1;t&&e.attachments.forEach(function(i){"COLOR_ATTACHMENT0"===i.semantic&&e.extras.picking&&this.drawTexture(e.extras.pickingTexture)},this)}},renderPrimitivesWithPass:{value:function(e,i,t,a){var s=e.length,u=this.webGLContext;if(i.instanceProgram){var n=u,r=this.resourceManager.getResource(i.instanceProgram.program,this.programDelegate,n);if(r){var l=0,o=1,c=1,m=1,d=i.states,p=u.FUNC_ADD,v=u.SRC_ALPHA,h=u.ONE_MINUS_SRC_ALPHA,g="__PickingPass"===i.id;if(d&&(null!=d.blendEnable&&(l=d.blendEnable),null!=d.depthTestEnable&&(o=d.depthTestEnable),null!=d.depthMask&&(c=d.depthMask),null!=d.cullFaceEnable&&(m=d.cullFaceEnable),null!=d.blendEquation)){var f=d.blendFunc;null!=f&&(null!=f.sfactor&&(v=f.sfactor),null!=f.dfactor&&(h=f.dfactor))}if(this.setState(u.DEPTH_TEST,o),this.setState(u.CULL_FACE,m),u.enable(u.SAMPLE_ALPHA_TO_COVERAGE),u.depthMask(c),this.setState(u.BLEND,l),1===l&&(u.blendEquation(p),u.blendFunc(v,h)),this.bindedProgram=r,g)for(var b=0;s>b;b++){var q=e[b];if(!q.node.hidden){if(!q.pickingColor){var _=q.node.baseId;if(_){var y=i.extras.nodeIDToColor[_];y||(y=vec4.createFrom(Math.random(),Math.random(),Math.random(),1),i.extras.nodeIDToColor[_]=y),q.pickingColor=y}}this.bindedProgram.setValueForSymbol("u_pickingColor",q.pickingColor),this.renderPrimitive(q,i,a,t)}}else for(var b=0;s>b;b++){var q=e[b];if(!q.node.hidden){var S=1;t=q.primitive.material.parameters;var P=t.transparency;P&&null!=P.value&&(S*=P.value);var C=t.filterColor;C&&null!=C.value&&(S*=C.value[3]),1e-5>S||(1>S&&!l?(this.setState(u.BLEND,!0),u.blendEquation(u.FUNC_ADD),u.blendFunc(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA),this.renderPrimitive(q,i,a),this.setState(u.BLEND,!1)):this.renderPrimitive(q,i,a))
}}}}}},_BBOXProgram:{value:null,writable:!0},drawBBOX:{value:function(e,i,a,s){if(null!=e){var u=this.webGLContext;if(this.bindedProgram=null,this.setState(u.CULL_FACE,!1),!this._BBOXProgram){this._BBOXProgram=Object.create(t);var n="precision highp float;attribute vec3 vert;uniform mat4 u_projMatrix; uniform mat4 u_vMatrix; uniform mat4 u_mMatrix; void main(void) { gl_Position = u_projMatrix * u_vMatrix * u_mMatrix * vec4(vert,1.0); }",r="precision highp float;uniform float u_transparency;  void main(void) {  gl_FragColor = vec4(vec3(1.,1.,1.) , u_transparency);}";this._BBOXProgram.initWithShaders({"x-shader/x-vertex":n,"x-shader/x-fragment":r}),this._BBOXProgram.build(u)||console.log(this._BBOXProgram.errorLogs)}var l=[e[0][0],e[0][1],e[0][2]],o=[e[1][0],e[1][1],e[1][2]],c=0,m=1,d=2;if(!this._BBOXIndices){var p=[0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,3,7,2,6,0,4,1,5];this._BBOXIndices=u.createBuffer(),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,this._BBOXIndices),u.bufferData(u.ELEMENT_ARRAY_BUFFER,new Uint16Array(p),u.STATIC_DRAW)}u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,this._BBOXIndices),this._BBOXVertexBuffer||(this._BBOXVertexBuffer=u.createBuffer(),u.bindBuffer(u.ARRAY_BUFFER,this._BBOXVertexBuffer)),u.bindBuffer(u.ARRAY_BUFFER,this._BBOXVertexBuffer);var v=[o[c],l[m],l[d],o[c],o[m],l[d],l[c],o[m],l[d],l[c],l[m],l[d],o[c],l[m],o[d],o[c],o[m],o[d],l[c],o[m],o[d],l[c],l[m],o[d]];u.bufferData(u.ARRAY_BUFFER,new Float32Array(v),u.STATIC_DRAW);var h=this._BBOXProgram.getLocationForSymbol("vert");null!=h&&(u.enableVertexAttribArray(h),u.vertexAttribPointer(h,3,u.FLOAT,!1,12,0)),this.bindedProgram=this._BBOXProgram;var g=this._BBOXProgram.getLocationForSymbol("u_projMatrix");g&&this._BBOXProgram.setValueForSymbol("u_projMatrix",s);var f=this._BBOXProgram.getLocationForSymbol("u_mMatrix");f&&this._BBOXProgram.setValueForSymbol("u_mMatrix",a);var b=this._BBOXProgram.getLocationForSymbol("u_vMatrix");b&&this._BBOXProgram.setValueForSymbol("u_vMatrix",i);var q=this._BBOXProgram.getLocationForSymbol("u_transparency");q&&this._BBOXProgram.setValueForSymbol("u_transparency",1),this._BBOXProgram.commit(u),u.drawElements(u.LINES,24,u.UNSIGNED_SHORT,0),u.disableVertexAttribArray(h),this.setState(u.BLEND,!1),this.setState(u.CULL_FACE,!0)}}},drawTexture:{value:function(e){var i=this.webGLContext,a=i.isEnabled(i.DEPTH_TEST),s=i.isEnabled(i.CULL_FACE),u=i.isEnabled(i.BLEND);if(this.setState(i.DEPTH_TEST,0),this.setState(i.CULL_FACE,0),this.setState(i.BLEND,0),!this.displayTexture){this.displayTexture={},this.displayTexture.program=Object.create(t);var n="precision highp float;attribute vec3 vert;attribute vec2 uv;uniform mat4 u_projMatrix; varying vec2 v_uv;void main(void) { v_uv = uv;gl_Position = u_projMatrix * vec4(vert,1.0); }",r="precision highp float;uniform sampler2D u_texture;varying vec2 v_uv; void main(void) {  vec4 color = texture2D(u_texture, v_uv);  gl_FragColor = color; }";this.displayTexture.program.initWithShaders({"x-shader/x-vertex":n,"x-shader/x-fragment":r}),this.displayTexture.program.build(i)||console.log(this.displayTexture.program.errorLogs);var l=[-1,-1,0,0,0,1,-1,0,1,0,-1,1,0,0,1,-1,1,0,0,1,1,-1,0,1,0,1,1,0,1,1];this.displayTexture.vertexBuffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.displayTexture.vertexBuffer),i.bufferData(i.ARRAY_BUFFER,new Float32Array(l),i.STATIC_DRAW)}var o=this.displayTexture.program,c=this.displayTexture.vertexBuffer;i.bindBuffer(i.ARRAY_BUFFER,c);var m=mat4.ortho(-1,1,-1,1,0,1e3),d=o.getLocationForSymbol("vert"),p=void 0!==d;p&&(i.enableVertexAttribArray(d),i.vertexAttribPointer(d,3,i.FLOAT,!1,20,0));var v=o.getLocationForSymbol("uv"),h=void 0!==v;h&&(i.enableVertexAttribArray(v),i.vertexAttribPointer(v,2,i.FLOAT,!1,20,12));var g=i.getParameter(i.TEXTURE_BINDING_2D);i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,e),this.bindedProgram=o;var f=o.getLocationForSymbol("u_projMatrix");f&&o.setValueForSymbol("u_projMatrix",m);var b=o.getLocationForSymbol("u_texture");b&&o.setValueForSymbol("u_texture",0),o.commit(i),i.drawArrays(i.TRIANGLES,0,6),i.bindTexture(i.TEXTURE_2D,g),p&&i.disableVertexAttribArray(d),h&&i.disableVertexAttribArray(v),this.setState(i.DEPTH_TEST,a),this.setState(i.CULL_FACE,s),this.setState(i.BLEND,u)}}})}}),montageDefine("d41c331","ui/repetition.reel/repetition",{dependencies:["../../core/core","../component","../../core/template","../../core/range-controller","../../core/promise","../../core/browser","../../composer/press-composer","collections/map","collections/set","../../core/deprecate","../../core/logger","frb/observers"],factory:function(e,i){var t=e("../../core/core").Montage,a=e("../component").Component;e("../../core/template").Template;var s=e("../../core/range-controller").RangeController,u=e("../../core/promise").Promise;e("../../core/browser").browser;var n=e("../../composer/press-composer").PressComposer,r=e("collections/map"),l=e("collections/set"),o=e("../../core/deprecate").deprecationWarning,c=e("../../core/logger").logger("repetition").color.magenta(),m=e("frb/observers"),d=m.observeProperty,p=m.observeKey,v=60,h=i.Iteration=t.specialize({repetition:{value:null},controller:{value:null},_object:{value:null},object:{get:function(){return this._object},set:function(e){var i;this._object!==e&&(this._object=e,i=-1!==this.repetition.contentController.selection.indexOf(e),this._selected!==i&&(this.selected=i))}},_fragment:{value:null},_childComponents:{value:null},index:{value:null},_drawnIndex:{value:null},active:{value:null},_noTransition:{value:null},_templateDocumentPart:{value:null},isDirty:{value:!1},_selected:{value:null},selected:{get:function(){return this._selected},set:function(e){e=!!e,this.object&&this.repetition&&this.repetition.contentController&&(e?this.repetition.contentController.selection.add(this.object):this.repetition.contentController.selection.delete(this.object)),this._selected!==e&&(this._selected=e,this.repetition._addDirtyClassListIteration(this),this.repetition.needsDraw=!0)}},constructor:{value:function h(){this.super(),c.isDebug&&c.debug("Iteration:%s create iteration %O",Object.hash(this),this),this.repetition=null,this.controller=null,this.object=null,this._fragment=null,this._childComponents=null,this.index=null,this._drawnIndex=null,this.active=!1,this.defineBinding("active",{"<->":"repetition.activeIterations.has(())"}),this._noTransition=!1,this.addOwnPropertyChangeListener("active",this),this.addOwnPropertyChangeListener("_noTransition",this),this.addPathChangeListener("index.defined() && _childComponents.defined()",this,"handleComponentModelChange"),this.cachedFirstElement=null}},_timeoutBecomeActiveID:{value:null},_shouldBecomeActive:{value:!1},shouldBecomeActive:{set:function(e){if(this._timeoutBecomeActiveID&&(clearTimeout(this._timeoutBecomeActiveID),this._timeoutBecomeActiveID=null),e){var i=this;this._shouldBecomeActive=!0,this._timeoutBecomeActiveID=setTimeout(function(){i._shouldBecomeActive&&(i.active=!0),i._shouldBecomeActive=!1},v)}else this._shouldBecomeActive=!1},get:function(){return this._shouldBecomeActive}},initWithRepetition:{value:function(e){return this.repetition=e,this}},recycle:{value:function(){this.index=null,this.object=null,this._noTransition=!0}},injectIntoDocument:{value:function(e){null!==this._drawnIndex?(c.isDebug&&c.debug("Iteration:%s retracting from index %s and injecting at %s",Object.hash(this),this._drawnIndex,e),this.retractFromDocument()):c.isDebug&&c.debug("Iteration:%s injecting at index %s",Object.hash(this),e);var i=this,t=this.repetition,a=t.element,s=t._boundaries,u=a.ownerDocument.createTextNode(""),n=s[e];if(s.splice(e,0,u),a.insertBefore(u,n),a.insertBefore(this._fragment,n),t._drawnIterations.splice(e,0,this),t._updateDrawnIndexes(e),t._addDirtyClassListIteration(this),!this._elementsWillBeAddedToMap){var r=this._childComponents.length,l=function(e){e.target.removeEventListener("firstDraw",l,!1),r--,r||i.forEachElement(function(e){t._iterationForElement.set(e,i)})};if(this._childComponents.length>0)for(var o=0;this._childComponents.length>o;o++){var m=this._childComponents[o];m.addEventListener("firstDraw",l,!1),m.needsDraw=!0,m._completedFirstDraw===!0&&console.error("Repetiton:%s child component %O has already drawn.",Object.hash(this),m)}else this.forEachElement(function(e){t._iterationForElement.set(e,i)});this._elementsWillBeAddedToMap=!0}}},_elementsWillBeAddedToMap:{value:!1},retractFromDocument:{value:function(){c.isDebug&&c.debug("Iteration:%s retractFromDocument drawnIndex: %s",Object.hash(this),this._drawnIndex);var e=this._drawnIndex,i=this.repetition,t=i.element,a=i._boundaries[e],s=i._boundaries[e+1];i._boundaries.splice(e,1);for(var u=this._fragment,n=a.nextSibling;n!=s;){var r=n.nextSibling;t.removeChild(n),u.appendChild(n),n=r}t.removeChild(a),this._drawnIndex=null,i._drawnIterations.splice(e,1),i._updateDrawnIndexes(e)}},handleComponentModelChange:{value:function(e){e?this._childComponents.forEach(this.repetition.addChildComponent,this.repetition):this._childComponents&&this._childComponents.forEach(this.repetition.removeChildComponent,this.repetition)}},handlePropertyChange:{value:function(){this.repetition&&(this.repetition._addDirtyClassListIteration(this),this.repetition.needsDraw=!0)}},forEachElement:{value:function(e,i){var t=this.repetition,a=this._drawnIndex;if(null!=a)for(var s=t._boundaries[a];s!==t._boundaries[a+1];s=s.nextSibling)1===s.nodeType&&e.call(i,s)}},firstElement:{get:function(){var e=this.repetition,i=this._drawnIndex;if(null!=i)for(var t=e._boundaries[i];t!==e._boundaries[i+1];t=t.nextSibling)if(1===t.nodeType)return this.cachedFirstElement=t,t}},isComponentTreeLoaded:{value:function(){return null!==this._fragment}},cachedFirstElement:{value:null}});i.Repetition=a.specialize({initWithContent:{value:function(e){return this.object=e,this}},initWithContentController:{value:function(e){return this.contentController=e,this}},content:{get:function(){return this.contentController?this.contentController.content:null},set:function(e){this.contentController=(new s).initWithContent(e)}},contentController:{value:null},isSelectionEnabled:{value:null},selectedIterations:{value:null},selectedIndexes:{value:null},activeIterations:{value:null},iterations:{value:null},currentIteration:{value:null},objectAtCurrentIteration:{value:null},hasTemplate:{value:!1},_iterationTemplate:{value:null},clonesChildComponents:{value:!0},__pressComposer:{value:null},_pressComposer:{get:function(){return this.__pressComposer||(this.__pressComposer=new n,this.__pressComposer.lazyLoad=!0,this.addComposerForElement(this.__pressComposer,this.element)),this.__pressComposer}},_cancelSelectionRangeChangeListener:{value:null},_selection:{value:null},selection:{get:function(){return this._selection},set:function(e){this.contentController?(this.contentController.selection!==e&&(this.contentController.selection=e),this._selection!==this.contentController.selection&&(this._selection=this.contentController.selection),this._cancelSelectionRangeChangeListener&&this._cancelSelectionRangeChangeListener(),e?(this._cancelSelectionRangeChangeListener=this.contentController.selection.addRangeChangeListener(this,"selection"),this.handleSelectionRangeChange(e,[])):this._cancelSelectionRangeChangeListener=null):this._selection=e}},handleSelectionRangeChange:{value:function(e,i){var t,a,s,u,n,l,o=this.iterations.length;if(1>=e.length&&1>=i.length){if(i.length)for(s=i[0],n=0;o>n;n++)this.iterations[n].object===s&&(this.iterations[n].selected=!1);if(e.length)for(s=e[0],n=0;o>n;n++)this.iterations[n].object===s&&(this.iterations[n].selected=!0)}else{for(t=new r,n=0;o>n;n++)u=this.iterations[n],s=u.object,(a=t.get(s))||(a=[],t.set(s,a)),a.push(u);for(n=0;i.length>n;n++)if(a=t.get(i[n]))for(l=0;a.length>l;l++)a[l].selected=!1;for(n=0;e.length>n;n++)if(a=t.get(e[n]))for(l=0;a.length>l;l++)a[l].selected=!0}}},_visibleIndexes:{value:null},visibleIndexes:{get:function(){return this._visibleIndexes},set:function(e){this._visibleIndexes!==e&&(this._visibleIndexes&&this._visibleIndexes.removeRangeChangeListener&&this._visibleIndexes.removeRangeChangeListener(this,"visibleIndexes"),this._visibleIndexes=e,this._visibleIndexes&&this._visibleIndexes.addRangeChangeListener&&this._visibleIndexes.addRangeChangeListener(this,"visibleIndexes"),this._updateOrganizedContent())}},handleVisibleIndexesRangeChange:{value:function(e,i,t){var a,s;if(this.__controllerOrganizedContent){for(a=[],s=0;e.length>s;s++)a.push(this.__controllerOrganizedContent[e[s]]);this.organizedContent.swap(t,i.length,a),this._isListeningToOrganizedContentChanges&&(this.handleOrganizedContentRangeChange(a.length,i.length,t),this.needsDraw=!0)}}},__controllerOrganizedContent:{value:null},_controllerOrganizedContent:{get:function(){return this.__controllerOrganizedContent},set:function(e){this.__controllerOrganizedContent!==e&&(this.__controllerOrganizedContent&&this.__controllerOrganizedContent.removeRangeChangeListener&&this.__controllerOrganizedContent.removeRangeChangeListener(this,"controllerOrganizedContent"),this.__controllerOrganizedContent=e,this.__controllerOrganizedContent&&this.__controllerOrganizedContent.addRangeChangeListener&&this.__controllerOrganizedContent.addRangeChangeListener(this,"controllerOrganizedContent"),this._updateOrganizedContent())}},handleControllerOrganizedContentRangeChange:{value:function(e,i,t){this._visibleIndexes?this._updateOrganizedContent():(this.organizedContent.swap(t,i.length,e),this._isListeningToOrganizedContentChanges&&(this.handleOrganizedContentRangeChange(e.length,i.length,t),this.needsDraw=!0))}},_updateOrganizedContent:{value:function(){var e,i;if(this.__controllerOrganizedContent)if(this._visibleIndexes){for(this.organizedContent.length>this._visibleIndexes.length&&(this.organizedContent.length=this._visibleIndexes.length,this._isListeningToOrganizedContentChanges&&this.handleOrganizedContentRangeChange(0,this.organizedContent.length-this._visibleIndexes.length,this._visibleIndexes.length)),e=this.organizedContent.length,i=0;this._visibleIndexes.length>i;i++)this.organizedContent[i]!==this.__controllerOrganizedContent[this._visibleIndexes[i]]&&(this.organizedContent[i]=this.__controllerOrganizedContent[this._visibleIndexes[i]],this._isListeningToOrganizedContentChanges&&this.handleOrganizedContentRangeChange(1,e>i?1:0,i));this._isListeningToOrganizedContentChanges&&(this.needsDraw=!0)}else e=this.organizedContent.length,this.organizedContent.swap(0,e,this.__controllerOrganizedContent),this._isListeningToOrganizedContentChanges&&(this.handleOrganizedContentRangeChange(this.__controllerOrganizedContent.length,e,0),this.needsDraw=!0);else e=this.organizedContent.length,this.organizedContent=[],this._isListeningToOrganizedContentChanges&&(this.handleOrganizedContentRangeChange(0,e,0),this.needsDraw=!0)}},constructor:{value:function(){this.super(),this.contentController=null,this.organizedContent=[],this.defineBinding("_controllerOrganizedContent",{"<-":"contentController.organizedContent"}),this.isSelectionEnabled=!1,this.defineBinding("selection",{"<-":"contentController.selection"}),this.defineBinding("selectedIterations",{"<-":"iterations.filter{selected}"}),this.defineBinding("selectedIndexes",{"<-":"selectedIterations.map{index}"}),this._iterationTemplate=null,this.addPathChangeListener(this._setupRequirements,this,"_handleSetupRequirementsChange"),this.addPathChangeListener("innerTemplate",this,"_handleInnerTemplateChange"),this.iterations=[],this._drawnIterations=[],this._freeIterations=[],this._contentForIteration=r(),this._iterationForElement=r(),this.currentIteration=null,this._templateId=null,this._iterationCreationPromise=u.resolve(),this._boundaries=[],this._dirtyClassListIterations=l(),this._requestedIterations=0,this._createdIterations=0,this._canDrawInitialContent=!1,this._initialContentDrawn=!1,this.addOwnPropertyChangeListener("isSelectionEnabled",this),this._selectionPointer=null,this.activeIterations=[]}},_setupRequirements:{value:"[!_iterationTemplate.defined(),!_newDomContent.defined(),!_shouldClearDomContentOnNextDraw,_isComponentExpanded,_ownerDocumentPart.defined()].every{}"},_handleSetupRequirementsChange:{value:function(e){e&&this._setupIterationTemplate()}},_handleInnerTemplateChange:{value:function(e){this._iterationTemplate&&this._teardownIterationTemplate(),e&&this.getPath(this._setupRequirements)&&this._setupIterationTemplate()}},cleanupDeletedComponentTree:{value:function(e){var i=this._innerTemplate;this._innerTemplate=null,i&&this._teardownIterationTemplate(),e&&this.cancelBindings()}},expandComponent:{value:function(){return this._isComponentExpanded=!0,u.resolve()}},_buildIterationTemplate:{value:function(){var e,i,a,s;return e=this.innerTemplate.clone(),i=e.getSerialization(),a=i.getSerializationObject(),s=t.getInfoForObject(this).label,this._iterationLabel=s+":iteration",a[this._iterationLabel]={},e.setObjects(a),this.innerTemplate.hasParameters()&&this._expandIterationTemplateParameters(e),window._montage_le_flag&&(e.refresher=this,this._leTagIterationTemplate(e)),e}},_rebuildIterationTemplate:{value:function(){var e,i=this._iterationTemplate,t=this.iterations;this._purgeFreeIterations();for(var a,s=0;a=t[s];s++)a.isDirty=!0;this._innerTemplate=null,e=this._buildIterationTemplate(),i.replaceContentsWithTemplate(e)}},refreshTemplate:{value:function(){this._rebuildIterationTemplate()}},_isListeningToOrganizedContentChanges:{value:!1},_setupIterationTemplate:{value:function(){this._iterationTemplate=this._buildIterationTemplate();for(var e,i=this.childComponents,t=i.length-1;e=i[t--];)e.detachFromParentComponent(),e.needsDraw=!1,e.cleanupDeletedComponentTree(!0);this.handleOrganizedContentRangeChange(this.organizedContent.length,0,0),this._isListeningToOrganizedContentChanges=!0,this._canDrawInitialContent=!0,this.needsDraw=!0}},_leTagIterationTemplate:{value:function(e){var i=e.document.body;if(i.children.length>0){var t=this.ownerComponent._montage_metadata.moduleId,a=this._montage_metadata.label;this._leTagStarArgument(t,a,i)}}},_teardownIterationTemplate:{value:function(){this._isListeningToOrganizedContentChanges=!1,this.handleOrganizedContentRangeChange(0,this.organizedContent.length,0),this._purgeFreeIterations(),this._iterationTemplate=null,this._contentForIteration.clear(),this._iterationForElement.clear(),this.currentIteration=null,this._templateId=null,this._requestedIterations=0,this._createdIterations=0,this._canDrawInitialContent=!1,this._selectionPointer=null,this.activeIterations.clear(),this._dirtyClassListIterations.clear()}},_purgeFreeIterations:{value:function(){for(var e=0;this._freeIterations.length>e;e++)for(var i=this._freeIterations[e],t=0;i._childComponents.length>t;t++){var a=i._childComponents[t];this.removeChildComponent(a),a.cleanupDeletedComponentTree(!0)}this._freeIterations.clear()}},_expandIterationTemplateParameters:{value:function(e){for(var i,t,a,s,u,n,r,l,o,c=this;e.hasParameters();){c=c.ownerComponent,i=c._ownerDocumentPart.template,s=c._ownerDocumentPart.objects,n=e.expandParameters(c),a=e.getSerialization().getExternalObjectLabels(),u=e.getInstances(),l=n.labels,t=n.labelsCollisions;for(var m,d=0;m=l[d];d++)r=t&&m in t?t[m]:m,a.indexOf(r)>=0?u[r]=s[m]:(o=i.getObjectMetadata(m),o.owner||(o.owner=s.owner),e.setObjectMetadata(r,o.require,o.label,o.owner))}}},_iterationLabel:{value:null},_iterationCreationPromise:{value:null},_createIteration:{value:function(){var e=this,i=(new this.Iteration).initWithRepetition(this);return this._iterationCreationPromise=this._iterationCreationPromise.then(function(){var t,a,s=e.element.ownerDocument;return e.currentIteration=i,t=e._iterationTemplate.getInstances(),t=Object.create(t),t[e._iterationLabel]=i,a=e._iterationTemplate.instantiateWithInstances(t,s).then(function(t){t.parentDocumentPart=e._ownerDocumentPart,i._templateDocumentPart=t,t.loadComponentTree().then(function(){c.isDebug&&c.debug("Iteration:%s component tree loaded.",Object.hash(i)),i._fragment=t.fragment,i._childComponents=t.childComponents,e.constructIteration(i)}).done(),e.currentIteration=null}),a.done(),a.then(null,function(){})}),this._requestedIterations++,i}},constructIteration:{value:function(){this._createdIterations++,this._createdIterations>=this._requestedIterations&&(this.needsDraw=!0,this._canDraw=!0)}},observeProperty:{value:function(e,i,t){return"contentAtCurrentIteration"===e||"objectAtCurrentIteration"===e?("contentAtCurrentIteration"===e?o("contentAtCurrentIteration",":iteration.object"):"objectAtCurrentIteration"===e&&o("objectAtCurrentIteration",":iteration.object"),p(this._contentForIteration,this.currentIteration,i,t)):"currentIteration"===e?(o("currentIteration",":iteration"),i(this.currentIteration)):d(this,e,i,t)}},makePropertyObservable:{value:function(e){return"currentIteration"!==e?t.makePropertyObservable.call(this,e):void 0}},_controllerIterations:{value:null},_drawnIterations:{value:null},_freeIterations:{value:null},_contentForIteration:{value:null},handleOrganizedContentRangeChange:{value:function(e,i,t){var a,s,u,n,r=t,l=this.iterations,o=this._contentForIteration,m=Math.min(e,i),d=i-m,p=e-m,v=this.organizedContent;for(c.isDebug&&(c.debug("Repetition:%s content changed +%s@%s %O -%s %O ",Object.hash(this),e?e:0,t,i?i:0),c.debug("Repetition:%s +%s -%s iterations",Object.hash(this),p,d)),this._iterationTemplate.isDirty&&this._iterationTemplate.refresh(),u=0;m>u;u++,t++)l[t].object=v[t],o.set(l[t],v[t]);if(d>0)for(a=l.splice(t,d),u=0;d>u;u++)s=a[u],s.recycle(),s.isDirty||this._freeIterations.push(s);if(p>0){if(c.isDebug)var h=[];for(;p>this._freeIterations.length;)this._freeIterations.push(this._createIteration()),c.isDebug&&h.push(this._freeIterations[this._freeIterations.length-1]);var g=Array(p);for(u=m,n=0;e>u;u++,n++){var f=this._freeIterations.pop();c.isDebug&&(h.has(f)||c.debug("Repetition:%s reusing %s",Object.hash(this),Object.hash(f)));var b=v[r+u];f.object=b,o.set(f,b),g[n]=f}l.swap(t,0,g)}(d>0||p>0)&&this._updateIndexes(t)}},_updateIndexes:{value:function(e){for(var i=this.iterations;i.length>e;e++)i[e].index=e}},_addDirtyClassListIteration:{value:function(e){e.forEachElement(function(i){var t;i&&(t=i.component)?(t.classList[e.active?"add":"remove"]("active"),t.classList[e.selected?"add":"remove"]("selected"),t.classList.remove("no-transition")):this._dirtyClassListIterations.add(e)},this)}},canDraw:{value:function(){var e=this.canDrawGate.value;return e=e&&this._requestedIterations<=this._createdIterations,e=e&&(this._initialContentDrawn||this._canDrawInitialContent)}},_boundaries:{value:null},_dirtyClassListIterations:{value:null},_requestedIterations:{value:null},_createdIterations:{value:null},_canDrawInitialContent:{value:null},_initialContentDrawn:{value:null},draw:{value:function(){this._initialContentDrawn||(this._drawInitialContent(),this._initialContentDrawn=!0);for(var e=this._drawnIterations.length-1;e>=0;e--)null===this._drawnIterations[e].index&&this._drawnIterations[e].retractFromDocument();for(var e=0;this.iterations.length>e;e++){var i=this.iterations[e];i._drawnIndex!==i.index&&i.isComponentTreeLoaded()&&i.injectIntoDocument(e)}var t=this._dirtyClassListIterations.toArray();this._dirtyClassListIterations.clear(),t.forEach(function(e){e.isComponentTreeLoaded()&&e.forEachElement(function(i){i.component||(i.classList[e.active?"add":"remove"]("active"),i.classList[e.selected?"add":"remove"]("selected"),i.classList.remove("no-transition"))},this)},this)}},_drawInitialContent:{value:function(){for(var e=this.element,i=e.childNodes.length,t=0;i>t;t++)e.removeChild(e.firstChild);var a=e.ownerDocument.createTextNode("");e.appendChild(a),this._boundaries.push(a)}},_updateDrawnIndexes:{value:function(e){for(var i=this._drawnIterations;i.length>e;e++)i[e]._drawnIndex=e}},_selectionPointer:{value:null},_startX:{value:0},_startY:{value:0},_currentActiveIteration:{value:null},handleIsSelectionEnabledChange:{value:function(e){e?this._enableSelectionTracking():this._disableSelectionTracking()}},_enableSelectionTracking:{value:function(){this._pressComposer.addEventListener("pressStart",this,!1)}},_disableSelectionTracking:{value:function(){this._pressComposer.removeEventListener("pressStart",this,!1)}},handlePressStart:{value:function(e){var i=this._findIterationContainingElement(e.targetElement);i&&(this._startX=e.clientX,this._startY=e.clientY,this.__pressComposer.addEventListener("press",this,!1),this.__pressComposer.addEventListener("pressCancel",this,!1),i.shouldBecomeActive=!0,this._currentActiveIteration=i)}},_ignoreSelection:{value:function(){this._currentActiveIteration&&(this._currentActiveIteration.shouldBecomeActive=!1,this._currentActiveIteration=null),this.activeIterations.clear(),this._startX=0,this._startY=0,this.__pressComposer.removeEventListener("press",this,!1),this.__pressComposer.removeEventListener("pressCancel",this,!1)}},handlePressCancel:{value:function(){this._ignoreSelection()}},handlePress:{value:function(e){var i=this._findIterationContainingElement(e.targetElement);i&&this._currentActiveIteration===i&&(i.active=!1,i.selected||(i.selected=!0)),this._ignoreSelection()}},_findIterationContainingElement:{value:function(e){for(var i;e;){if(e===this.element)return this._iterationForElement.get(i);i=e,e=e.parentNode}}},Iteration:{value:h,serializable:!1}})}}),montageDefine("d41c331","composer/translate-composer",{dependencies:["./composer","../core/event/event-manager"],factory:function(e,i){var t=e("./composer").Composer,a=e("../core/event/event-manager").defaultEventManager,s=i.TranslateComposer=t.specialize({constructor:{value:function s(){this.super()}},_NATIVE_ELEMENTS:{value:["A","IFRAME","EMBED","OBJECT","VIDEO","AUDIO","CANVAS","LABEL","INPUT","BUTTON","SELECT","TEXTAREA","KEYGEN","DETAILS","COMMAND"]},_WHEEL_POINTER:{value:"wheel",writable:!1},enabled:{value:!0},_externalUpdate:{value:!0},isAnimating:{value:!1},isMoving:{value:!1},frame:{value:function(){this.isAnimating&&this._animationInterval(),this._externalUpdate=!1}},_pointerSpeedMultiplier:{value:1},pointerSpeedMultiplier:{get:function(){return this._pointerSpeedMultiplier},set:function(e){this._pointerSpeedMultiplier=e}},pointerStartEventPosition:{value:null},_shouldDispatchTranslate:{value:!1},_isSelfUpdate:{value:!1},_allowFloats:{value:!1},allowFloats:{get:function(){return this._allowFloats},set:function(e){this._allowFloats!==e&&(this._allowFloats=e,this.translateX=this._translateX,this.translateY=this._translateY)}},allowTranslateOuterExtreme:{value:!1},_translateX:{value:0},translateX:{get:function(){return this._translateX},set:function(e){if("vertical"===this._axis)this._translateX=this._minTranslateX||0;else{var i=isNaN(e)?0:this._allowFloats?parseFloat(e):e>>0;null!==this._minTranslateX&&this._minTranslateX>i&&(i=this._minTranslateX),null!==this._maxTranslateX&&i>this._maxTranslateX&&(i=this._maxTranslateX),this._isSelfUpdate||(this.isAnimating=!1),this._translateX=i}}},_translateY:{value:0},translateY:{get:function(){return this._translateY},set:function(e){if("horizontal"===this._axis)this._translateY=this._minTranslateY||0;else{var i=isNaN(e)?0:this._allowFloats?parseFloat(e):e>>0;null!==this._minTranslateY&&this._minTranslateY>i&&(i=this._minTranslateY),null!==this._maxTranslateY&&i>this._maxTranslateY&&(i=this._maxTranslateY),this._isSelfUpdate||(this.isAnimating=!1),this._translateY=i}}},_minTranslateX:{value:null},minTranslateX:{get:function(){return this._minTranslateX},set:function(e){null!==e&&(e=parseFloat(e)),this._minTranslateX!==e&&(null!==e&&e>this._translateX&&(this.translateX=e),this._minTranslateX=e)}},_maxTranslateX:{value:null},maxTranslateX:{get:function(){return this._maxTranslateX},set:function(e){null!==e&&(e=parseFloat(e)),this._maxTranslateX!==e&&(null!==e&&this._translateX>e&&(this.translateX=e),this._maxTranslateX=e)}},_minTranslateY:{value:null},minTranslateY:{get:function(){return this._minTranslateY},set:function(e){null!==e&&(e=parseFloat(e)),this._minTranslateY!==e&&(null!==e&&e>this._translateY&&(this.translateY=e),this._minTranslateY=e)}},_maxTranslateY:{value:null},maxTranslateY:{get:function(){return this._maxTranslateY},set:function(e){null!==e&&(e=parseFloat(e)),this._maxTranslateY!==e&&(null!==e&&this._translateY>e&&(this.translateY=e),this._maxTranslateY=e)}},_axis:{value:"both"},axis:{get:function(){return this._axis},set:function(e){switch(e){case"vertical":case"horizontal":this._axis=e,this.translateX=this._translateX,this.translateY=this._translateY;break;default:this._axis="both"}}},invertAxis:{depends:["invertXAxis","invertYAxis"],get:function(){return this._invertXAxis===this._invertYAxis?this._invertXAxis:null},set:function(e){this.invertXAxis=e,this.invertYAxis=e}},_invertXAxis:{value:!1},invertXAxis:{get:function(){return this._invertXAxis},set:function(e){this._invertXAxis=!!e}},_invertYAxis:{value:!1},invertYAxis:{get:function(){return this._invertYAxis},set:function(e){this._invertYAxis=!!e}},_hasMomentum:{value:!0},hasMomentum:{get:function(){return this._hasMomentum},set:function(e){this._hasMomentum=e?!0:!1}},__momentumDuration:{value:650},_momentumDuration:{get:function(){return this.__momentumDuration},set:function(e){this.__momentumDuration=isNaN(e)?1:e>>0,1>this.__momentumDuration&&(this.__momentumDuration=1)}},_pointerX:{value:null},_pointerY:{value:null},_touchIdentifier:{value:null},_isFirstMove:{value:!1},_observedPointer:{value:null},eventManager:{get:function(){return a}},_mouseRadiusThreshold:{value:5},_touchRadiusThreshold:{value:12},_listenToWheelEvent:{value:!1},listenToWheelEvent:{set:function(e){e=!!e,this._listenToWheelEvent!==e&&(this._listenToWheelEvent=e,this._isLoaded&&(e?this._addWheelEventListener():this._removeWheelEventListener()))},get:function(){return this._listenToWheelEvent}},_claimPointerPolicy:{value:null},claimPointerPolicy:{set:function(e){(e===s.CLAIM_POINTER_POLICIES.DEFAULT||e===s.CLAIM_POINTER_POLICIES.MOVE)&&(this._claimPointerPolicy=e)},get:function(){return this._claimPointerPolicy||(this._claimPointerPolicy=s.CLAIM_POINTER_POLICIES.DEFAULT),this._claimPointerPolicy}},load:{value:function(){window.PointerEvent?this._element.addEventListener("pointerdown",this,!0):window.MSPointerEvent&&window.navigator.msPointerEnabled?this._element.addEventListener("MSPointerDown",this,!0):(this._element.addEventListener("touchstart",this,!0),this._element.addEventListener("mousedown",this,!0)),this._listenToWheelEvent&&this._addWheelEventListener(),this.eventManager.isStoringPointerEvents=!0}},unload:{value:function(){window.PointerEvent?this._element.removeEventListener("pointerdown",this,!0):window.MSPointerEvent&&window.navigator.msPointerEnabled?this._element.removeEventListener("MSPointerDown",this,!0):(this._element.removeEventListener("touchstart",this,!0),this._element.removeEventListener("mousedown",this,!0)),this._listenToWheelEvent&&this._removeWheelEventListener()}},surrenderPointer:{value:function(){var e=!0;return e&&this.isMoving&&this._releaseInterest(),e}},addEventListener:{value:function(e,i,a){t.addEventListener.call(this,e,i,a),"translate"===e&&(this._shouldDispatchTranslate=!0)}},capturePointerdown:{value:function(e){"mouse"===e.pointerType||window.MSPointerEvent&&e.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_MOUSE?this.captureMousedown(e):("touch"===e.pointerType||window.MSPointerEvent&&e.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_TOUCH)&&this.captureTouchstart(e)}},capturePointermove:{value:function(e){"mouse"===e.pointerType||window.MSPointerEvent&&e.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_MOUSE?this.captureMousemove(e):("touch"===e.pointerType||window.MSPointerEvent&&e.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_TOUCH)&&this.captureTouchmove(e)}},handlePointerup:{value:function(e){"mouse"===e.pointerType||window.MSPointerEvent&&e.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_MOUSE?this.handleMouseup(e):("touch"===e.pointerType||window.MSPointerEvent&&e.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_TOUCH)&&this.handleTouchend(e)
}},handlePointercancel:{value:function(e){("touch"===e.pointerType||window.MSPointerEvent&&e.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_TOUCH)&&this.handleTouchcancel(e)}},captureMousedown:{value:function(e){this.enabled&&0===e.button&&(this._observedPointer="mouse",this._start(e.clientX,e.clientY,e.target,e.timeStamp))}},captureMousemove:{value:function(e){this.enabled&&this._handleMove(e)}},handleMouseup:{value:function(e){this.enabled&&this._end(e)}},captureTouchstart:{value:function(e){if(this.enabled&&null===this._observedPointer)if(void 0!==e.pointerId)this._observedPointer=e.pointerId,this._start(e.clientX,e.clientY,e.target,e.timeStamp),this._preventDefaultIfNeeded(e);else{var i=e.targetTouches;if(i&&1===i.length){var t=i[0];this._preventDefaultIfNeeded(e),this._observedPointer=t.identifier,this._start(t.clientX,t.clientY,t.target,e.timeStamp)}}}},captureTouchmove:{value:function(e){if(this.enabled)if(void 0!==e.pointerId)this._handleMove(e);else{var i=this._findObservedTouch(e.changedTouches);i&&this._handleMove(e,i)}}},handleTouchend:{value:function(e){if(this.enabled)if(void 0!==e.pointerId)this._end(e);else{var i=this._findObservedTouch(e.changedTouches);i&&this._end(i)}}},handleTouchcancel:{value:function(e){if(this.enabled)if(void 0!==e.pointerId)this._cancel(e);else{var i=this._findObservedTouch(e.changedTouches);i&&this._cancel(i)}}},captureScroll:{value:function(e){e.target.contains(this.element)&&this._cancel(e)}},_shouldPreventDefault:{value:function(e){return!!e.target.tagName&&-1===s._NATIVE_ELEMENTS.indexOf(e.target.tagName)&&!e.target.isContentEditable}},_preventDefaultIfNeeded:{value:function(e){!e.defaultPrevented&&this._shouldPreventDefault(e)&&e.preventDefault()}},_addWheelEventListener:{value:function(){if(this._element){var e=void 0!==window.onwheel||void 0!==window.WheelEvent?"wheel":"mousewheel";this._element.addEventListener(e,this,!1),this._element.addEventListener(e,this,!0)}}},_removeWheelEventListener:{value:function(){if(this._element){var e=void 0!==window.onwheel||void 0!==window.WheelEvent?"wheel":"mousewheel";this._element.removeEventListener(e,this,!1),this._element.removeEventListener(e,this,!0)}}},_start:{value:function(e,i,t,a){this.pointerStartEventPosition={pageX:e,pageY:i,target:t,timeStamp:a},this._pointerX=e,this._pointerY=i,window.PointerEvent?(document.addEventListener("pointermove",this,!0),document.addEventListener("pointerup",this,!1),document.addEventListener("pointercancel",this,!1)):window.MSPointerEvent&&window.navigator.msPointerEnabled?(document.addEventListener("MSPointerMove",this,!0),document.addEventListener("MSPointerUp",this,!1),document.addEventListener("MSPointerCancel",this,!1)):"mouse"===this._observedPointer?(document.addEventListener("mousemove",this,!0),document.addEventListener("mouseup",this,!1)):(this._element.addEventListener("touchmove",this,!0),this._element.addEventListener("touchend",this,!1),this._element.addEventListener("touchcancel",this,!1)),document.addEventListener("scroll",this,!0),this.isAnimating&&(this.isAnimating=!1,this._dispatchTranslateEnd()),this._isFirstMove=!0}},_findObservedTouch:{value:function(e){for(var i,t=null,a=0,s=e.length;s>a&&null===t;a++)i=e[a],i.identifier===this._observedPointer&&(t=i);return t}},_handleMove:{value:function(e,i){if(i||(i=e),this._isFirstMove){var a=this.eventManager.componentClaimingPointer(this._observedPointer);if(a){var u=!0;if(this.claimPointerPolicy===s.CLAIM_POINTER_POLICIES.MOVE){var n="mouse"===this._observedPointer?this._mouseRadiusThreshold:this._touchRadiusThreshold,r=this.pointerStartEventPosition.pageX-i.clientX,l=this.pointerStartEventPosition.pageY-i.clientY;u=t.isCoordinateOutsideRadius(r,l,n)}if(!u)return e.preventDefault(),void 0}this.eventManager.claimPointer(this._observedPointer,this)}this.eventManager.isPointerClaimedByComponent(this._observedPointer,this)?(e.preventDefault(),(this.allowTranslateOuterExtreme||this._shouldMove(e,i.clientX,i.clientY))&&(this._isFirstMove?this._firstMove():this._move(i.clientX,i.clientY))):this._releaseInterest()}},_shouldMove:{value:function(e,i,t){var a,s,u,n,r=this._translateY,l=this._translateX,o=!0;return"wheel"===e.type?("vertical"!==this._axis&&(u=20*(e.wheelDeltaY||-e.deltaY||0)/120),"horizontal"!==this._axis&&(n=20*(e.wheelDeltaY||-e.deltaY||0)/120)):("vertical"!==this._axis&&(u=-(this._invertXAxis?this._pointerX-i:i-this._pointerX)),"horizontal"!==this._axis&&(n=-(this._invertYAxis?this._pointerY-t:t-this._pointerY))),n&&(a=this._isNegativeNumber(n),null!==this.minTranslateY&&(o=r!==this.minTranslateY||r===this.minTranslateY&&a),null!==this.maxTranslateY&&o&&(o=r!==this.maxTranslateY||r===this.maxTranslateY&&!a)),u&&(s=this._isNegativeNumber(u),null!==this.minTranslateX&&o&&(o=l!==this.minTranslateX||l===this.minTranslateX&&s),null!==this.maxTranslateX&&o&&(o=l!==this.maxTranslateX||l===this.maxTranslateX&&!s)),o}},_firstMove:{value:function(){this._isFirstMove&&(this._dispatchTranslateStart(this._translateX,this._translateY),this._isFirstMove=!1,this.isMoving=!0)}},_move:{value:function(e,i){var t;this._isSelfUpdate=!0,"vertical"!==this._axis&&(t=this._invertXAxis?this._pointerX-e:e-this._pointerX,this.translateX+=t*this._pointerSpeedMultiplier),"horizontal"!==this._axis&&(t=this._invertYAxis?this._pointerY-i:i-this._pointerY,this.translateY+=t*this._pointerSpeedMultiplier),this._isSelfUpdate=!1,this._pointerX=e,this._pointerY=i,this._shouldDispatchTranslate&&this._dispatchTranslate()}},_end:{value:function(e){this.startTime=Date.now(),this.endX=this.posX=this.startX=this._translateX,this.endY=this.posY=this.startY=this._translateY;var i=e.velocity;this._hasMomentum&&(i.speed>40||this.translateStrideX||this.translateStrideY)?(this.momentumX="vertical"!==this._axis?i.x*this._pointerSpeedMultiplier*(this._invertXAxis?1:-1):0,this.momentumY="horizontal"!==this._axis?i.y*this._pointerSpeedMultiplier*(this._invertYAxis?1:-1):0,this.endX=this.startX-this.momentumX*this.__momentumDuration/2e3,this.endY=this.startY-this.momentumY*this.__momentumDuration/2e3,this.startStrideXTime=null,this.startStrideYTime=null,this.animateMomentum=!0):this.animateMomentum=!1,this.animateMomentum?this._animationInterval():this._isFirstMove||(this.isMoving=!1,this._dispatchTranslateEnd()),this._releaseInterest()}},_cancel:{value:function(){this.startTime=Date.now(),this.endX=this.posX=this.startX=this._translateX,this.endY=this.posY=this.startY=this._translateY,this.animateMomentum=!1,this._isFirstMove||(this.isMoving=!1,this._dispatchTranslateCancel()),this._releaseInterest()}},_releaseInterest:{value:function(){window.PointerEvent?(document.removeEventListener("pointermove",this,!0),document.removeEventListener("pointerup",this,!1),document.removeEventListener("pointercancel",this,!1)):window.MSPointerEvent&&window.navigator.msPointerEnabled?(document.removeEventListener("MSPointerMove",this,!0),document.removeEventListener("MSPointerUp",this,!1),document.removeEventListener("MSPointerCancel",this,!1)):"mouse"===this._observedPointer?(document.removeEventListener("mousemove",this,!0),document.removeEventListener("mouseup",this,!1)):(this._element.removeEventListener("touchmove",this,!0),this._element.removeEventListener("touchend",this,!1),this._element.removeEventListener("touchcancel",this,!1)),document.removeEventListener("scroll",this,!0),this.eventManager.isPointerClaimedByComponent(this._observedPointer,this)&&this.eventManager.forfeitPointer(this._observedPointer,this),this._observedPointer=null,this._isFirstMove=!1,this.isMoving=!1}},_isAxisMovement:{value:function(e){var i,t,a,s,u,n,r,l=e.velocity,o=.7853981633974483,c=2.356194490192345,m=-2.356194490192345,d=-.7853981633974483;if("both"===this.axis)return!0;if(!l||0===l.speed||isNaN(l.speed)?(n=this.pointerStartEventPosition.pageX-e.clientX,r=this.pointerStartEventPosition.pageY-e.clientY,u=Math.atan2(r,n)):u=l.angle,"horizontal"===this.axis){if(a=o>=u&&u>=d,s=u>=c||m>=u,a||s)return!0}else if("vertical"===this.axis&&(i=d>=u&&u>=m,t=u>=o&&c>=u,i||t))return!0;return!1}},_translateEndTimeout:{value:null},_handleWheelTimeout:{value:null},_isNegativeNumber:{value:function(e){return e=+e,isNaN(e)||(e=1/e),0>e}},captureWheel:{value:function(e){this._shouldMove(e)?this.eventManager.isPointerClaimedByComponent(this._WHEEL_POINTER,this)||this.eventManager.claimPointer(this._WHEEL_POINTER,this):this.eventManager.isPointerClaimedByComponent(this._WHEEL_POINTER,this)&&this.eventManager.forfeitPointer(this._WHEEL_POINTER,this)}},handleWheel:{value:function(e){if(this.enabled&&this.eventManager.isPointerClaimedByComponent(this._WHEEL_POINTER,this)){if(this._translateEndTimeout?window.clearTimeout(this._translateEndTimeout):this._dispatchTranslateStart(),this.translateY=this._translateY-20*(e.wheelDeltaY||-e.deltaY||0)/120,this.isMoving=!0,this._dispatchTranslate(),"function"!=typeof this._handleWheelTimeout){var i=function(){this._translateEndTimeout=null,this._dispatchTranslateEnd(),this.isMoving=!1,this.eventManager.isPointerClaimedByComponent(this._WHEEL_POINTER,this)&&this.eventManager.forfeitPointer(this._WHEEL_POINTER,this)};this._handleWheelTimeout=i.bind(this)}this._translateEndTimeout=window.setTimeout(this._handleWheelTimeout,400),e.preventDefault()}}},_bezierTValue:{value:function(e,i,t,a,s){var u,n,r,l,o=1-3*a+3*i,c=3*a-6*i,m=3*i,d=.5;for(n=0;10>n;n++)l=d*d,u=3*o*l+2*c*d+m,r=1-d,d-=(3*(r*r*d*i+r*l*a)+l*d-e)/u;return l=d*d,r=1-d,3*(r*r*d*t+r*l*s)+l*d}},_dispatchTranslateStart:{value:function(e,i){var t=document.createEvent("CustomEvent");t.initCustomEvent("translateStart",!0,!0,null),t.translateX=e,t.translateY=i,t.scroll=0,t.pointer=this._observedPointer,this.dispatchEvent(t)}},_dispatchTranslateEnd:{value:function(){var e=document.createEvent("CustomEvent");e.initCustomEvent("translateEnd",!0,!0,null),e.translateX=this._translateX,e.translateY=this._translateY,e.scroll=0,this.dispatchEvent(e)}},_dispatchTranslateCancel:{value:function(){var e=document.createEvent("CustomEvent");e.initCustomEvent("translateCancel",!0,!0,null),e.translateX=this._translateX,e.translateY=this._translateY,e.scroll=0,this.dispatchEvent(e)}},_dispatchTranslate:{value:function(){var e=document.createEvent("CustomEvent");e.initCustomEvent("translate",!0,!0,null),e.translateX=this._translateX,e.translateY=this._translateY,e.scroll=0,e.pointer=this._observedPointer,this.dispatchEvent(e)}},animateBouncingX:{value:!1,enumerable:!1},startTimeBounceX:{value:!1,enumerable:!1},animateBouncingY:{value:!1,enumerable:!1},startTimeBounceY:{value:!1,enumerable:!1},animateMomentum:{value:!1,enumerable:!1},startTime:{value:null,enumerable:!1},startX:{value:null,enumerable:!1},posX:{value:null,enumerable:!1},endX:{value:null,enumerable:!1},startY:{value:null,enumerable:!1},posY:{value:null,enumerable:!1},endY:{value:null,enumerable:!1},translateStrideX:{value:null},translateStrideY:{value:null},translateStrideDuration:{value:330},_animationInterval:{value:function(){var e,i,t,a,s=Date.now(),u=!1;this.animateMomentum&&(e=s-this.startTime,this.__momentumDuration>e?(this.posX=this.startX-(this.momentumX+this.momentumX*(this.__momentumDuration-e)/this.__momentumDuration)*e/1e3/2,this.posY=this.startY-(this.momentumY+this.momentumY*(this.__momentumDuration-e)/this.__momentumDuration)*e/1e3/2,this.translateStrideX&&null===this.startStrideXTime&&(this.__momentumDuration-e<this.translateStrideDuration||Math.abs(this.posX-this.endX)<.75*this.translateStrideX)&&(this.startStrideXTime=s),this.translateStrideY&&null===this.startStrideYTime&&(this.__momentumDuration-e<this.translateStrideDuration||Math.abs(this.posY-this.endY)<.75*this.translateStrideY)&&(this.startStrideYTime=s)):this.animateMomentum=!1),i=Math.round(this.endX/this.translateStrideX),this.startStrideXTime&&s-this.startStrideXTime>0&&(s-this.startStrideXTime<this.translateStrideDuration?(e=this._bezierTValue((s-this.startStrideXTime)/this.translateStrideDuration,.275,0,.275,1),this.posX=this.posX*(1-e)+i*this.translateStrideX*e,u=!0):this.posX=i*this.translateStrideX),i=Math.round(this.endY/this.translateStrideY),this.startStrideYTime&&s-this.startStrideYTime>0&&(s-this.startStrideYTime<this.translateStrideDuration?(e=this._bezierTValue((s-this.startStrideYTime)/this.translateStrideDuration,.275,0,.275,1),this.posY=this.posY*(1-e)+i*this.translateStrideY*e,u=!0):this.posY=i*this.translateStrideY),t=this.posX,a=this.posY,this._isSelfUpdate=!0,this.translateX=t,this.translateY=a,this._shouldDispatchTranslate&&this._dispatchTranslate(),this._isSelfUpdate=!1,this.isAnimating=this.animateMomentum||u,this.isAnimating?this.needsFrame=!0:this._dispatchTranslateEnd()}}},{CLAIM_POINTER_POLICIES:{value:{DEFAULT:"default",MOVE:"move"}}});s.prototype.captureMSPointerDown=s.prototype.capturePointerdown,s.prototype.captureMSPointerMove=s.prototype.capturePointermove,s.prototype.handleMSPointerUp=s.prototype.handlePointerup,s.prototype.handleMSPointerCancel=s.prototype.handlePointercancel,s.prototype.handleMousewheel=s.prototype.handleWheel}}),montageDefine("3d2b056","runtime/helpers/resource-manager",{dependencies:[],factory:function(e,i){var t=Object.create(Object,{kind:{value:"multi-parts",writable:!0},range:{value:null,writable:!0},_requests:{value:null,writable:!0},requests:{get:function(){return this._requests},set:function(e){this._requests=e}},canMergeRequest:{value:function(e,i){var t=e.range[1]-e.range[0],a=this.range[1]-this.range[0];return t+a>i?!1:(e.range[0]===this.range[1]||e.range[1]===this.range[0])&&e.type===this.type}},mergeRequest:{value:function(e){0===this.requests.length?(this.requests.push(e),this.range=[e.range[0],e.range[1]]):e.range[0]===this.range[1]?(this.requests.push(e),this.range[1]=e.range[1]):e.range[1]===this.range[0]?(this.requests.unshift(e),this.range[0]=e.range[0]):console.log("ERROR: should not reach")}},mergeRequests:{value:function(e){if(this.range)if(e[0].range[1]<this.range[0])for(var i=e.length-1;i>=0;i--)this.mergeRequest(e[i]);else for(var i=0;e.length>i;i++)this.mergeRequest(e[i]);else e.forEach(function(e){this.mergeRequest(e)},this)}},id:{value:null,writable:!0},initWithRequests:{value:function(e){return this.requests=[],this.mergeRequests(e),this.id=e[0].id,this}}}),a=Object.create(Object,{_content:{value:null,writable:!0},content:{get:function(){return this._content},set:function(e){this._content=e}},_parent:{value:null,writable:!0},parent:{get:function(){return this._parent},set:function(e){this._parent=e}},_left:{value:null,writable:!0},left:{get:function(){return this._left},set:function(e){this._left=e}},_right:{value:null,writable:!0},right:{get:function(){return this._right},set:function(e){this._right=e}},_checkConsistency:{value:function(e){e.length>=50||(this.left&&this.left._checkConsistency(e),e.push(this.content.range),this.right&&this.right._checkConsistency(e))}},checkConsistency:{value:function(){var e=[];if(this._checkConsistency(e),e.length>1)for(var i=0;e.length-1>i;i++){var t=e[0],a=e[1];t[1]<=a[0]||console("ERROR: INCONSISTENCY CHECK Failed, ranges are not ordered in btree")}}},_collect:{value:function(e,i){this.left&&this.left._collect(e,i),e.length>=i||(e.push(this),this.right&&this.right._collect(e,i))}},collect:{value:function(e){var i=[];return this._collect(i,e),i}},insert:{value:function(e,i){if(e.range[1]<=this.content.range[0]){if(e.range[1]===this.content.range[0])return"multi-parts"===e.kind?this.content.mergeRequests(e.requests):this.content.mergeRequests(e),this.left&&this.content.canMergeRequest(this.left.content,i)&&(this.content.mergeRequests(this.left.content._requests),this.left.remove(this.left.content)),this.parent&&this.parent.content.canMergeRequest(this.content,i)&&(this.parent.content.mergeRequests(this.content._requests),this.remove(this.content)),null;if(this.left)return this.left.insert(e,i);var t=Object.create(a);return t.parent=this,t.content=e,this.left=t,t}if(e.range[0]>=this.content.range[1]){if(e.range[0]===this.content.range[1])return"multi-parts"===e.kind?this.content.mergeRequests(e.requests):this.content.mergeRequests(e),this.right&&this.content.canMergeRequest(this.right.content,i)&&(this.content.mergeRequests(this.right.content._requests),this.right.remove(this.right.content)),this.parent&&this.parent.content.canMergeRequest(this.content,i)&&(this.parent.content.mergeRequests(this.content._requests),this.remove(this.content)),null;if(this.right)return this.right.insert(e,i);var t=Object.create(a);return t.parent=this,t.content=e,this.right=t,t}console.log("ERROR: should not reach")}},contains:{value:function(e){return this.node===e?!0:this.left&&this.left.contains(e)?!0:this.right&&this.right.contains(e)?!0:!1}},min:{value:function(){for(var e=this;e.left;)e=e.left;return e}},_updateParentWithNode:{value:function(e){this.parent&&(this===this.parent.left?this.parent.left=e:this.parent.right=e),e&&(e.parent=this.parent)}},removeMin:{value:function(){this.parent;for(var e=this;e.left||e.right;)e.left&&(e=e.min()),e.right&&(e=e.right.min());return e._updateParentWithNode(null),e}},remove:{value:function(e){if(e.range[1]<=this.content.range[0])this.left.remove(e);else if(e.range[0]>=this.content.range[1])this.right.remove(e);else if(e===this.content)if(this.left&&this.right){var i=this.right.min();this.content=i.content,i._updateParentWithNode(i.right)}else this.left||this.right?this.left?this._updateParentWithNode(this.left):this._updateParentWithNode(this.right):this._updateParentWithNode(null)}}});i.WebGLTFResourceManager=Object.create(Object,{MISSING_DESCRIPTION:{value:"MISSING_DESCRIPTION"},INVALID_PATH:{value:"INVALID_PATH"},INVALID_TYPE:{value:"INVALID_TYPE"},XMLHTTPREQUEST_STATUS_ERROR:{value:"XMLHTTPREQUEST_STATUS_ERROR"},NOT_FOUND:{value:"NOT_FOUND"},_resources:{value:null,writable:!0},_requestTrees:{value:null,writable:!0},requestTrees:{get:function(){return this._requestTrees}},_resourcesStatus:{value:null,writable:!0},_resourcesBeingProcessedCount:{value:0,writable:!0},_observers:{value:null,writable:!0},_maxConcurrentRequests:{value:1,writable:!0},observers:{get:function(){return this._observers},set:function(e){this._observers=e}},maxConcurrentRequests:{get:function(){return this._maxConcurrentRequests},set:function(e){this._maxConcurrentRequests=e}},reset:{value:function(){if(this._resourcesStatus){var e=Object.keys(this._resourcesStatus);e.forEach(function(e){var i=this._resourcesStatus[e];i&&i.xhr&&i.xhr.abort()},this)}var i=Object.keys(this._resources);i.forEach(function(e){var i=this._resources[e];i&&"VIDEO"===i.nodeName&&i.pause()},this),this._resources={},this._requestTrees={},this._resourcesStatus={},this._resourcesBeingProcessedCount=0,this._wholeBuffers={}}},_bytesLimit:{value:5e5,writable:!0},bytesLimit:{get:function(){return this._bytesLimit},set:function(e){this._bytesLimit!==e&&(this._bytesLimit=e)}},_containsResource:{enumerable:!1,value:function(e){return this._resources[e]?!0:!1}},init:{value:function(){this._requestTrees={},this._resources={},this._resourcesStatus={},this._observers=[],this._resourcesBeingProcessedCount=0}},_storeResource:{enumerable:!1,value:function(e,i){return e?(this._containsResource[e]&&console.log("WARNING: resource:"+e+" is already stored, overriding"),this._resources[e]=i,void 0):(console.log("ERROR: entry does not contain id, cannot store"),void 0)}},_getResource:{enumerable:!1,value:function(e){return this._resources[e]}},_loadResource:{value:function(e,i){var t,a=this,s=e.path;if("multi-parts"===e.kind?(t=e.requests[0].type,s=e.requests[0].path):(t=e.type,s=e.path),!t)return i.handleError(WebGLTFResourceManager.INVALID_TYPE,null),void 0;if(!s)return i.handleError(WebGLTFResourceManager.INVALID_PATH),void 0;var u=new XMLHttpRequest;if(u.open("GET",s,!0),u.responseType=t,e.range){var n="bytes="+e.range[0]+"-"+(e.range[1]-1);u.setRequestHeader("Range",n)}u.onload=function(){200==this.status||206==this.status?(a._resourcesBeingProcessedCount--,"multi-parts"===e.kind?e.requests.forEach(function(t){var s=this.response.slice(t.range[0]-e.range[0],t.range[1]-e.range[0]);i.resourceAvailable(a,t,s)},this):i.resourceAvailable(a,e,this.response)):i.handleError(WebGLTFResourceManager.XMLHTTPREQUEST_STATUS_ERROR,this.status)},u.send(null);var r=this._resourcesStatus[e.id];r&&(r.xhr=u)}},_processNextResource:{value:function(e){if(e){var i=!e.left&&!e.right;if(i)return this._handleRequest(e.content),!1;var t=e.removeMin();this._handleRequest(t.content)}return!0}},_observingEnabled:{value:!1,writable:!0},isObserving:{value:function(){return this._observingEnabled}},startObserving:{value:function(){this._observingEnabled=!0}},stopObserving:{value:function(){this._observingEnabled=!1}},fireResourceAvailable:{value:function(e){this._observingEnabled&&this.observers&&this.observers.forEach(function(i){i.resourceAvailable&&i.resourceAvailable(e)},this)}},send:{value:0,writable:!0},requested:{value:0,writable:!0},_handleRequest:{value:function(e){var i=this._resourcesStatus[e.id],s=null,u=null,n=this.requestTrees?this.requestTrees[e.path]:null;if(i){if("loading"===i.status)return;s=i.node,u=i.status}if("arraybuffer"!==e.type){var r=this,l={};"multi-parts"===e.kind?e.requests.forEach(function(e){this._resourcesStatus[e.id]={status:"loading"}},this):this._resourcesStatus[e.id]={status:"loading"},l.resourceAvailable=function(e,i,t){var a=i.delegate.convert(i,t,i.ctx);if(r._storeResource(i.id,a),i.delegate.resourceAvailable(a,i.ctx),delete r._resourcesStatus[i.id],r.fireResourceAvailable.call(r,i.id),r._resourcesBeingProcessedCount<r.maxConcurrentRequests){var s=e.requestTrees?e.requestTrees[i.path]:null;r._processNextResource(s)||s&&delete e.requestTrees[i.path]}},l.handleError=function(i,t){e.delegate.handleError(i,t)},r._resourcesBeingProcessedCount++,this._loadResource(e,l)}else if(!u){var o,c=null;if(o="multi-parts"===e.kind?Object.create(t).initWithRequests(e.requests):Object.create(t).initWithRequests([e]),n)c=n.insert(o,this.bytesLimit);else{var m=Object.create(a);m.content=o,this._requestTrees[e.path]=m,n=m,c=m}"multi-parts"===e.kind?e.requests.forEach(function(e){this._resourcesStatus[e.id]={status:"queued",node:c}},this):this._resourcesStatus[e.id]={status:"queued",node:c}}}},_elementSizeForGLType:{value:function(e){var i=WebGLRenderingContext.prototype;switch(e){case i.FLOAT:return Float32Array.BYTES_PER_ELEMENT;case i.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case i.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case i.FLOAT_VEC2:return 2*Float32Array.BYTES_PER_ELEMENT;case i.FLOAT_VEC3:return 3*Float32Array.BYTES_PER_ELEMENT;case i.FLOAT_VEC4:return 4*Float32Array.BYTES_PER_ELEMENT;case i.FLOAT_MAT4:return 16*Float32Array.BYTES_PER_ELEMENT;case i.FLOAT_MAT3:return 9*Float32Array.BYTES_PER_ELEMENT;default:return null}}},_allowRangedRequests:{value:!1,writable:!1},_wholeBuffers:{value:null,writable:!0},_handleWrappedBufferViewResourceLoading:{value:function(e,i,t){var a="arraybuffer",s=e.bufferView;if(s){var u=s.buffer,n=e.byteOffset+s.description.byteOffset,r=[n,this._elementSizeForGLType(e.type)*e.count+n];u.description&&u.description.type&&(a=u.description.type);var l={source:e,id:e.id,range:r,type:a,path:u.description.path,delegate:i,ctx:t,kind:"single-part"}}if(this._allowRangedRequests)this._handleRequest(l,null);else{this._wholeBuffers||(this._wholeBuffers={});var s=e.bufferView;if(s){var o=this,u=s.buffer,c=this._wholeBuffers[u.id];if(null==c){var m={};m.resourceAvailable=function(e,i,t){var a=o._wholeBuffers[i.id];e._storeResource(i.id,t),a.pendingRequests&&(a.pendingRequests.forEach(function(i){delete o._resourcesStatus[i.id];var a=t.slice(i.range[0],i.range[1]),s=i.delegate;if(null==this._resources[i.id]){var u=s.convert(i.source,a,i.ctx);e._storeResource(i.id,u),s.resourceAvailable(u,i.ctx)}o.fireResourceAvailable.call(o,i.id)},o),a.pendingRequests=[])},m.handleError=function(){};var d={id:u.id,type:a,path:u.description.path,delegate:i,ctx:t,kind:"single-part"};o._resourcesBeingProcessedCount++,this._loadResource(d,m),c={activeRequest:"bufferRequest",pendingRequests:[]},this._wholeBuffers[u.id]=c}else{var p=this._getResource(u.id);if(p){var v=p.slice(l.range[0],l.range[1]),i=l.delegate,h=i.convert(e,v,l.ctx);return o._storeResource(l.id,h),i.resourceAvailable(h,l.ctx),o.fireResourceAvailable.call(o,l.id),void 0}}var g=this._resourcesStatus[l.id];if(g&&"loading"===g.status)return;c.pendingRequests.push(l),this._resourcesStatus[l.id]={status:"loading"}}}}},shaderDelegate:{value:{handleError:function(e,i){console.log("ERROR:shaderDelegate:"+e+" :"+i)},convert:function(e,i){return i},resourceAvailable:function(e,i){if(i.sources[i.stage]=e,i.sources["x-shader/x-fragment"]&&i.sources["x-shader/x-vertex"]){var t=i.programCtx.delegate,a=t.convert(null,i.sources,i.programCtx.ctx);i.programCtx.resourceManager._storeResource(i.programCtx.id,a),t.resourceAvailable(a,i.programCtx.ctx),i.programCtx.resourceManager.fireResourceAvailable.call(i.programCtx.resourceManager,i.programCtx.id)}}}},_handleProgramLoading:{value:function(e,i,t){var a={delegate:i,ctx:t,resourceManager:this,id:e.id},s={},u={stage:"x-shader/x-fragment",sources:s,programCtx:a},n={stage:"x-shader/x-vertex",sources:s,programCtx:a};this.getResource(e["x-shader/x-fragment"],this.shaderDelegate,u),this.getResource(e["x-shader/x-vertex"],this.shaderDelegate,n)}},_handleShaderLoading:{value:function(e,i,t){this._handleRequest({id:e.id,type:"text",path:e.description.path,delegate:i,ctx:t,kind:"single-part"},null)}},_handleVideoLoading:{value:function(e,i,t){var a=this._resourcesStatus[e.id];if(!a||"loading"!==a.status){this._resourcesStatus[e.id]={status:"loading"};var s=this;if(e.description.path){this._resourcesBeingProcessedCount++;var u=document.createElement("video");u.preload="auto",u.loop="loop",u.addEventListener("canplaythrough",function(){s._resourcesBeingProcessedCount--,u.play(),delete s._resourcesStatus[e.id],s._storeResource(e.id,u),i(u,e.id,t)}),u.src=e.description.path}}}},_handleImageLoading:{value:function(e,i,t,a){var s=this._resourcesStatus[e.id];if(!s||"loading"!==s.status){this._resourcesStatus[e.id]={status:"loading"};var u=this;if(e.description.path){this._resourcesBeingProcessedCount++;var n=new Image;n.onload=function(){u._resourcesBeingProcessedCount--,delete u._resourcesStatus[e.id],u._storeResource(e.id,n),i(n,e.id,t,a)},n.src=e.description.path}else e.description.image&&i(e.description.image,e.id,t,a)}}},_handleTextureLoading:{value:function(e,i,t){var a=this._resourcesStatus[e.id];if(!a||"loading"!==a.status){this._resourcesStatus[e.id]={status:"loading"};var s=this;if(e.source)"image"===e.source.type&&this._handleImageLoading(e.source,function(t,a,u){var n=i.convert(t,e,u);delete s._resourcesStatus[e.id],s._storeResource(e.id,n),i.resourceAvailable(n,u),s.fireResourceAvailable.call(s,e.id)},t),"video"===e.source.type&&this._handleVideoLoading(e.source,function(t,a,u){var n=i.convert(t,e,u);delete s._resourcesStatus[e.id],s._storeResource(e.id,n),i.resourceAvailable(n,u),s.fireResourceAvailable.call(s,e.id)},t);else if(e.sources){var u=0,n=[null,null,null,null,null,null],r=0;e.sources.forEach(function(a){"image"===a.type&&this._handleImageLoading(a,function(t,a,r,l){if(u++,n[l]=t,u==e.sources.length){var o=i.convert(n,e,r);delete s._resourcesStatus[e.id],s._storeResource(e.id,o),i.resourceAvailable(o,r),s.fireResourceAvailable.call(s,e.id)}},t,r++),"video"===a.type&&this._handleVideoLoading(a,function(t,a,l){if(u++,n[r]=t,u==e.sources.length){var o=i.convert(n,e,l);delete s._resourcesStatus[e.id],s._storeResource(e.id,o),i.resourceAvailable(o,l),s.fireResourceAvailable.call(s,e.id)}},t,r++)},this)}}}},setResource:{value:function(e,i){this._resources[e],this._resources[e]=i}},getResource:{value:function(e,i,t){var a=this._getResource(e.id);return a?a:("program"===e.type?this._handleProgramLoading(e,i,t):"shader"===e.type?this._handleShaderLoading(e,i,t):"image"===e.type?this._handleImageLoading(e,i,t):"texture"===e.type?this._handleTextureLoading(e,i,t):this._handleWrappedBufferViewResourceLoading(e,i,t),null)}},hasPendingRequests:{value:function(){return this._resourcesBeingProcessedCount>0}},removeAllResources:{value:function(){this._resources={}}}})}}),montageDefine("3d2b056","runtime/component-3d",{dependencies:["montage","runtime/glTF-node","runtime/transform","montage/core/target","collections/set","cssom","runtime/dependencies/gl-matrix"],factory:function(e,i){e("montage").Montage,e("runtime/glTF-node").glTFNode;var t=e("runtime/transform").Transform,a=e("montage/core/target").Target,s=e("collections/set");e("cssom"),e("runtime/dependencies/gl-matrix"),i.Component3D=a.specialize({_ENTER:{value:"COMPONENT_ENTER"},_EXIT:{value:"COMPONENT_EXIT"},_TOUCH_DOWN:{value:"_TOUCH_DOWN"},_TOUCH_UP:{value:"_TOUCH_UP"},self:{get:function(){return this}},constructor:{value:function(){this._hasUnresolvedId=!0,this._state=this.__STYLE_DEFAULT__,this.super()}},handleEnteredDocument:{value:function(){}},shouldPerformHitTest:{value:!1},addEventListener:{value:function(e,i,t){this.scene&&(this.scene.shouldBeHitTested=!0),this.shouldPerformHitHest=!0,this.super(e,i,t)}},_glTFElement:{value:null,writable:!0},glTFElement:{get:function(){return this._glTFElement},set:function(e){this._glTFElement=e}},_scene:{value:null,writable:!0},scene:{get:function(){return this._scene},set:function(e){this._scene=e,this._sceneDidChange()}},baseURL:{get:function(){return this.scene?this.scene.glTFElement.baseURL:null}},_isAbsolutePath:{value:function(e){var i=RegExp("^"+window.location.protocol,"i");return e.match(i)?!0:!1}},resolvePathIfNeeded:{value:function(e){return this._isAbsolutePath(e)?e:this.baseURL+e}},name:{get:function(){return this.glTFElement?this.glTFElement.name:void 0},set:function(e){this.glTFElement&&(this.glTFElement.name=e)}},_hasUnresolvedId:{value:!1,writable:!0},handleStatusChange:{value:function(e){"loaded"===e&&this._id&&(this.glTFElement=this.scene.glTFElement.ids[this._id],null==this.glTFElement&&this.scene.glTFElement.rootNode.id==this._id&&(this.glTFElement=this.scene.glTFElement.rootNode),this.glTFElement&&(this._hasUnresolvedId=!1,this.glTFElement.component3D=this,this.classListDidChange(),this.shouldPerformHitHest&&(this.scene.shouldBeHitTested=!0)))}},resolveIdIfNeeded:{value:function(){if(this._hasUnresolvedId&&null!=this.scene){if("loaded"!==this.scene.status)return this.scene.addOwnPropertyChangeListener("status",this),void 0;this._id&&this.handleStatusChange(this.scene.status,"status",this.scene)}}},_idDidChange:{value:function(){this.resolveIdIfNeeded()}},_sceneDidChange:{value:function(){this.resolveIdIfNeeded(),this.scene&&(this.scene.addEventListener("enteredDocument",this),this.scene.addEventListener("styleSheetsDidLoad",this))}},__STYLE_DEFAULT__:{value:"__default__"},_state:{value:this.__STYLE_DEFAULT__,writable:!0},_stateForSelectorName:{value:function(e){return-1!==e.indexOf(":active")?(this.scene&&(this.scene.shouldBeHitTested=!0),"active"):-1!==e.indexOf(":hover")?(this.scene&&(this.scene.shouldBeHitTested=!0),"hover"):-1!==e.indexOf(":")?null:this.__STYLE_DEFAULT__}},_style:{value:null,writable:!0},_defaultTransition:{value:{duration:0,timingFunction:"ease",delay:0}},_createDefaultStyleIfNeeded:{value:function(){return null==this._style&&(this._style={}),null==this._style.transitions&&(this._style.transitions={}),this._style}},_createStyleStateAndPropertyIfNeeded:{value:function(e,i){var t=this._createDefaultStyleIfNeeded();null==t[e]&&(t[e]={});var a=t[e];return null==a[i]&&(a[i]={}),a[i]}},_getStylePropertyObject:{value:function(e,i){return this._createStyleStateAndPropertyIfNeeded(e,i)}},_checkTransformConsistency:{value:function(e,i){return e.length!=i?(console.log("Component3D: CSS transform ignored got:"+e.length+" but expecting:"+i),!1):!0}},_createVectorFromCSSTransformOriginDeclaration:{value:function(e){var i,t=e.split(" ");return t.length>=2?(i=vec2.create(),i[0]=parseFloat(t[0]),i[1]=parseFloat(t[1]),i):vec2.createFrom(50,50)}},_createTransformFromCSS:{value:function(e){var i,a,s,u=3.1415926535,n=u/180,r=Object.create(t).init(),l=mat4.identity(),o=0;
e=e.trim();for(var c,m=0,d=0,p=0,v=0,h=0;-1!==m&&(m=e.indexOf("(",o),-1!==m)&&(c=e.substring(o,m),o=m+1,m=e.indexOf(")",o),-1!==m);){for(var g=e.substring(o,m),f=-1!==g.indexOf(",")?g.split(","):[g],b=new Float32Array(f.length),q=0;f.length>q;q++)b[q]=parseFloat(f[q]);switch(o=m+1,c.trim()){case"matrix3d":if(this._checkTransformConsistency(b,16)){var _=b,y=mat4.createFrom(_[0],_[1],_[2],_[3],_[4],_[5],_[6],_[7],_[8],_[9],_[10],_[11],_[12],_[13],_[14],_[15]);mat4.multiply(l,y),h++}break;case"translate3d":this._checkTransformConsistency(b,3)&&(0===v&&(r.translation=vec3.create(b)),mat4.translate(l,b),v++);break;case"translateX":this._checkTransformConsistency(b,1)&&(a=[b[0],0,0],0===v&&(r.translation=vec3.create(a)),mat4.translate(l,a),v++);break;case"translateY":this._checkTransformConsistency(b,1)&&(a=[0,b[0],0],0===v&&(r.translation=vec3.create(a)),mat4.translate(l,a),v++);break;case"translateZ":this._checkTransformConsistency(b,1)&&(a=[0,0,b[0]],0===v&&(r.translation=vec3.create(a)),mat4.translate(l,a),v++);break;case"scale3d":this._checkTransformConsistency(b,3)&&(0===d&&(r.scale=vec3.create(b)),mat4.scale(l,b),v++);break;case"scaleX":this._checkTransformConsistency(b,1)&&(s=[b[0],1,1],0===d&&(r.scale=vec3.create(s)),mat4.scale(l,s),d++);break;case"scaleY":this._checkTransformConsistency(b,1)&&(s=[1,b[0],1],0===d&&(r.scale=vec3.create(s)),mat4.scale(l,s),d++);break;case"scaleZ":this._checkTransformConsistency(b,1)&&(s=[1,1,b[0]],0===d&&(r.scale=vec3.create(s)),mat4.scale(l,s),d++);break;case"rotate3d":this._checkTransformConsistency(b,4)&&(b[3]*=n,0===p&&(r.rotation=b),mat4.rotate(l,b[3],b),p++);break;case"rotateX":this._checkTransformConsistency(b,1)&&(i=[1,0,0,b[0]],i[3]*=n,0===p&&(r.rotation=i),mat4.rotate(l,i[3],i),p++);break;case"rotateY":this._checkTransformConsistency(b,1)&&(i=[0,1,0,b[0]],i[3]*=n,0===p&&(r.rotation=i),mat4.rotate(l,i[3],i),p++);break;case"rotateZ":this._checkTransformConsistency(b,1)&&(i=[0,0,1,b[0]],i[3]*=n,0===p&&(r.rotation=i),mat4.rotate(l,i[3],i),p++);break;case"perspective":m=-1;break;default:m=-1}}return(d>1||p>1||v>1||h>0)&&(r.matrix=l),r}},_createTransitionFromComponents:{value:function(e){var i={},t=["duration","timing-function","delay"],a=["ease","linear","ease-in","ease-out","ease-in-out","step-start"],s=0;return e.forEach(function(u){var n=!1,r=s;do"duration"===t[r]?-1===a.indexOf(u)&&(n=!0,i.duration=parseFloat(u),s=r):"timing-function"===t[r]?-1!==a.indexOf(u)&&(n=!0,i.timingFunction=u,s=r):"delay"===t[r]&&r==e.length-1&&(n=!0,i.delay=parseFloat(u)),r++;while(t.length>s&&0==n)},this),null==i.duration&&(i.duration=0),null==i.timingFunction&&(i.timingFunction="ease"),null==i.delay&&(i.delay=0),i}},_applyCSSPropertyWithValueForState:{value:function(e,i,t){if(null==t||null==i)return!1;if("transition"!==i&&-1===this.styleableProperties.indexOf(i))return!1;var a=this._getStylePropertyObject(e,i);switch(i){case"transition":var s=t.split(" ");if(s.length>0){var u=s.shift();if(u=this.propertyNameFromCSS(u),-1!==this.styleableProperties.indexOf(u)&&s.length>0){var n=this._createTransitionFromComponents(s);if(null!=n){var r=this._createDefaultStyleIfNeeded();r.transitions[u]=n}}}break;case"offsetTransform":a.value="string"==typeof t?this._createTransformFromCSS(t):t;break;case"transformOrigin":a.value="string"==typeof t?this._createVectorFromCSSTransformOriginDeclaration(t):t;break;case"transformZOrigin":a.value="string"==typeof t?parseFloat(t):t;break;case"visibility":a.value=t;break;case"opacity":a.value="string"==typeof t?parseFloat(t):t;break;case"cursor":a.value=t;break;default:return!1}return!0}},propertyNameFromCSS:{value:function(e){return"-webkit-transform"===e&&(e="transform"),"-webkit-transform-origin"===e&&(e="transform-origin"),"-montage-transform-z-origin"===e&&(e="transformZOrigin"),"transform"===e&&(e="offsetTransform"),"transform-origin"===e&&(e="transformOrigin"),e}},_dumpStyle:{value:function(e){console.log("**dump style:"+e);var i=this._style[e];for(var t in i){var a=i[t];if(null!=a.value)switch(t){case"offsetTransform":console.log("property:"+t+" value:"+mat4.str(a.value.matrix));break;default:console.log("property:"+t+" value:"+a.value)}}}},_dumpAllStyles:{value:function(){console.log("******** dump styles ********");for(var e in this._style)this._dumpStyle(e)}},_applyStyleRule:{value:function(e,i){var t=this._stateForSelectorName(e),a=null;if(i.style){t===this.__STYLE_DEFAULT__&&this.styleableProperties.forEach(function(e){a=this._getStylePropertyObject(t,e),null==a.value&&this._applyCSSPropertyWithValueForState(t,e,this.initialValueForStyleableProperty(e))},this);var s=i.style.length;if(s>0){for(var u=null,n=0;s>n;n++){var r=i.style[n],l=i.style[r];r=this.propertyNameFromCSS(r),-1!=r.indexOf("transition-")?(null==u&&(u={}),u[r]=l):this._applyCSSPropertyWithValueForState(t,r,l)}if(null!=u){r="transition";var o="";null!=u["transition-property"]&&(o+=u["transition-property"],null!=u["transition-duration"]&&(o+=" ",o+=u["transition-duration"]),null!=u["transition-timing-function"]&&(o+=" ",o+=u["transition-timing-function"]),null!=u["transition-timing-delay"]&&(o+=" ",o+=u["transition-timing-delay"]),this._applyCSSPropertyWithValueForState(t,r,o))}}}}},_removeStyleRule:{value:function(e,i){if(i.style){var t=i.style.length;if(t>0)for(var a=0;t>a;a++){var s=i.style[a];i.style[s],s=this.propertyNameFromCSS(s);var u=this._stateForSelectorName(e);if(null!=u){var n=this._getStylePropertyObject(u,s);n.value=this.initialValueForStyleableProperty(s)}}}}},appliedProperties:{value:null,writable:!0},_executeStylesForState:{value:function(e){null==this.appliedProperties&&(this.appliedProperties={}),null!=this.styleableProperties&&this.styleableProperties.forEach(function(i){var t=this._getStylePropertyObject(e,i),a=!1;t&&(null!=t.value&&(a=!0,this.appliedProperties[i]!==t.value&&(this[i]=t.value,this.appliedProperties[i]=t.value)),0==a&&(t=this._getStylePropertyObject(this.__STYLE_DEFAULT__,i),null!=t.value&&(a=!0,this.appliedProperties[i]!==t.value&&(this[i]=t.value,this.appliedProperties[i]=t.value))))},this)}},_applySelectorNamed:{value:function(e){var i=this.retrieveCSSRule(e);i&&this._applyStyleRule(e,i)}},_applyClassNamed:{value:function(e){this._applySelectorNamed("."+e),this._applySelectorNamed("."+e+":hover"),this._applySelectorNamed("."+e+":active")}},_removeSelectorNamed:{value:function(e){var i=this.retrieveCSSRule(e);i&&this._removeStyleRule(e,i)}},_removeClassNamed:{value:function(e){this._removeSelectorNamed("."+e+":hover"),this._removeSelectorNamed("."+e+":active"),this._removeSelectorNamed("."+e)}},_removeSelectorsForState:{value:function(e){for(var i=this.classList.enumerate(),t=0;i.length>t;t++){var a=i[t][1];this._removeClassNamed(a,e)}}},classListDidChange:{value:function(){if(this.classList){for(var e=this.classList.enumerate(),i=0;e.length>i;i++){var t=e[i][1];this._applyClassNamed(t)}this._executeStylesForState(this._state)}}},_id:{value:null,writable:!0},id:{get:function(){return this._id},set:function(e){e!=this._id&&(this._id=e,this._idDidChange())}},initWithScene:{value:function(e){return this.scene=e,this}},_classList:{value:null},classList:{get:function(){return null==this._classList&&(this._classList=new s,this._classList.addRangeChangeListener(this,"classList")),this._classList},set:function(e){if(this._classList!==e){if(null!=this._classList&&this._classList.removeRangeChangeListener(this,"classList"),null!=e){var i=this;e instanceof Array?(this._classList=new s,e.forEach(function(e){i._classList.add(e)},this),e=this._classList):this._classList=e}this._classList.addRangeChangeListener(this,"classList"),this.classListDidChange()}}},handleClassListRangeChange:{value:function(e,i){return null!=e&&e.forEach(function(e){this._applyClassNamed(e)},this),null!=i?(i.forEach(function(e){this._removeClassNamed(e)},this),this.classListDidChange(),void 0):(this._executeStylesForState(this._state),void 0)}},cssDescriptions:{value:null,writable:!0},handleStyleSheetsDidLoad:{value:function(){this.scene.removeEventListener("styleSheetsDidLoad",this),this.classListDidChange()}},retrieveCSSRule:{value:function(e){for(var i in this.scene.styleSheets)for(var t=this.scene.styleSheets[i],a=t.cssRules,s=0;a.length>s;s++){var u=a[s];if(null!=u.selectorText&&u.selectorText===e)return u}}},handleActionOnGlTFElement:{value:function(e,i){var t=this.__STYLE_DEFAULT__;switch(i){case this._ENTER:t="hover";var a=document.createEvent("CustomEvent");a.initCustomEvent("hover",!0,!0,{glTFElement:e}),this.dispatchEvent(a);break;case this._EXIT:t=this.__STYLE_DEFAULT__;break;case this._TOUCH_DOWN:t="active";var s=document.createEvent("CustomEvent");s.initCustomEvent("action",!0,!0,{glTFElement:e}),this.dispatchEvent(s);break;case this._TOUCH_UP:t=this.__STYLE_DEFAULT__}t!==this._state&&(this._state=t,this._executeStylesForState(t))}},deserializedFromTemplate:{value:function(e,i){this.nextTarget=e,this.identifier=i}},blueprintModuleId:e("montage")._blueprintModuleIdDescriptor,blueprint:e("montage")._blueprintDescriptor})}}),montageDefine("d41c331","composer/press-composer",{dependencies:["../core/core","./composer","../core/event/mutable-event"],factory:function(e,i){var t=e("../core/core").Montage,a=e("./composer").Composer,s=e("../core/event/mutable-event").MutableEvent,u=i.PressComposer=a.specialize({load:{value:function(){window.PointerEvent?this._element.addEventListener("pointerdown",this,!0):window.MSPointerEvent&&window.navigator.msPointerEnabled?this._element.addEventListener("MSPointerDown",this,!0):(this._element.addEventListener("touchstart",this,!0),this._element.addEventListener("mousedown",this,!0))}},unload:{value:function(){window.PointerEvent?this._element.removeEventListener("pointerdown",this,!0):window.MSPointerEvent&&window.navigator.msPointerEnabled?this._element.removeEventListener("MSPointerDown",this,!0):(this._element.removeEventListener("touchstart",this,!0),this._element.removeEventListener("mousedown",this,!0))}},delegate:{value:null},cancelPress:{value:function(){return this._state===u.PRESSED?(this._cancelPress(),!0):!1}},_cancelPress:{value:function(e){this._dispatchPressCancel(e),this._endInteraction()}},addEventListener:{value:function(e,i,t){a.addEventListener.call(this,e,i,t),"longPress"===e&&(this._shouldDispatchLongPress=!0)}},UNPRESSED:{value:0},PRESSED:{value:1},CANCELLED:{value:2},_state:{value:0},state:{get:function(){return this._state}},_shouldDispatchLongPress:{value:!1},_longPressThreshold:{value:1e3},longPressThreshold:{get:function(){return this._longPressThreshold},set:function(e){this._longPressThreshold!==e&&(this._longPressThreshold=e)}},_longPressTimeout:{value:null},_observedPointer:{value:null},_initialCenterPositionX:{value:0},_initialCenterPositionY:{value:0},_shouldSaveInitialCenterPosition:{value:!1},_endInteraction:{value:function(){this._element&&(this._removeEventListeners(),this.component.eventManager.isPointerClaimedByComponent(this._observedPointer,this)&&this.component.eventManager.forfeitPointer(this._observedPointer,this),this._observedPointer=null,this._state=u.UNPRESSED,this._initialCenterPositionX=0,this._initialCenterPositionY=0,this._shouldSaveInitialCenterPosition=!1)}},_changedTouchisObserved:{value:function(e){if(null===this._observedPointer)return!1;for(var i=0,t=e.length;t>i;i++)if(e[i].identifier===this._observedPointer)return i;return!1}},surrenderPointer:{value:function(e,i){var t=this.callDelegateMethod("surrenderPointer",e,i);return void 0!==t&&t===!1?!1:(this._cancelPress(),!0)}},_shouldPerformPress:{value:function(){return!("enabled"in this.component&&!this.component.enabled||null!==this._observedPointer)}},capturePointerdown:{value:function(e){"touch"===e.pointerType||window.MSPointerEvent&&e.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_TOUCH?this.captureTouchstart(e):("mouse"===e.pointerType||window.MSPointerEvent&&e.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_MOUSE)&&this.captureMousedown(e)}},handlePointerup:{value:function(e){"touch"===e.pointerType||window.MSPointerEvent&&e.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_TOUCH?this.handleTouchend(e):("mouse"===e.pointerType||window.MSPointerEvent&&e.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_MOUSE)&&this.handleMouseup(e)}},handlePointercancel:{value:function(e){("touch"===e.pointerType||window.MSPointerEvent&&e.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_TOUCH)&&this.handleTouchcancel(e)}},captureTouchstart:{value:function(e){this._shouldPerformPress()&&(void 0!==e.pointerId?this._observedPointer=e.pointerId:e.changedTouches&&1===e.changedTouches.length&&(this._observedPointer=e.changedTouches[0].identifier),null!==this._observedPointer&&this.component.eventManager.claimPointer(this._observedPointer,this)?(this._shouldSaveInitialCenterPosition=!0,this._addEventListeners(),this._dispatchPressStart(e)):this._observedPointer=null)}},handleTouchend:{value:function(e){if(null===this._observedPointer)return this._endInteraction(e),void 0;var i;if(e.pointerId===this._observedPointer)i=e.target;else if(this._changedTouchisObserved(e.changedTouches)!==!1){var t=e.changedTouches[0];i=document.elementFromPoint(t.clientX,t.clientY)}i&&this.component.eventManager.isPointerClaimedByComponent(this._observedPointer,this)&&(this.element===i||this.element.contains(i)?this._dispatchPress(e):this._dispatchPressCancel(e),this._endInteraction(e))}},_saveInitialCenterPositionIfNeeded:{value:function(){this._shouldSaveInitialCenterPosition&&(this._saveInitialCenterPosition(),this._shouldSaveInitialCenterPosition=!1)}},_handleMove:{value:function(e){return null===this._observedPointer?(this._endInteraction(e),void 0):(("mouse"===this._observedPointer||e.pointerId===this._observedPointer||e.changedTouches&&this._changedTouchisObserved(e.changedTouches)!==!1)&&this.component.eventManager.isPointerClaimedByComponent(this._observedPointer,this)&&(this._saveInitialCenterPositionIfNeeded(),this._positionChanged&&this._cancelPress(e)),void 0)}},captureWheel:{value:function(e){return null===this._observedPointer?(this._endInteraction(e),void 0):((e.target===this.element||e.target===window||"function"==typeof e.target.contains&&e.target.contains(this.element)||this.element.contains(e.target))&&(this._saveInitialCenterPositionIfNeeded(),this._positionChanged&&this._cancelPress(e)),void 0)}},handleTouchcancel:{value:function(e){(null===this._observedPointer||e.pointerId===this._observedPointer||this._changedTouchisObserved(e.changedTouches)!==!1)&&(this.component.eventManager.isPointerClaimedByComponent(this._observedPointer,this)&&this._dispatchPressCancel(e),this._endInteraction(e))}},captureMousedown:{value:function(e){0===e.button&&this._shouldPerformPress()&&(this._observedPointer="mouse",this.component.eventManager.claimPointer(this._observedPointer,this),this.component.eventManager.isPointerClaimedByComponent(this._observedPointer,this)?(this._shouldSaveInitialCenterPosition=!0,this._addEventListeners(),this._dispatchPressStart(e)):this._observedPointer=null)}},captureScroll:{value:function(e){(e.target===this.element||e.target===window||"function"==typeof e.target.contains&&e.target.contains(this.element)||this.element.contains(e.target))&&this._cancelPress(e)}},handleMouseup:{value:function(e){if(null===this._observedPointer)return this._endInteraction(e),void 0;if(this.component.eventManager.isPointerClaimedByComponent(this._observedPointer,this)){for(var i=e.target;i!==this._element&&i&&i.parentNode;)i=i.parentNode;if(i===this._element)return this._dispatchPress(e),this._endInteraction(e),void 0}this._cancelPress(e)}},handleDragstart:{value:function(e){this._cancelPress(e)}},_saveInitialCenterPosition:{value:function(){var e=this.element.getBoundingClientRect();this._initialCenterPositionX=e.left+e.width/2,this._initialCenterPositionY=e.top+e.height/2}},_positionChanged:{get:function(){var e=this.element.getBoundingClientRect(),i=e.left+e.width/2,t=e.top+e.height/2;return this._initialCenterPositionX!==i||this._initialCenterPositionY!==t}},_addEventListeners:{value:function(){window.PointerEvent?(document.addEventListener("pointerup",this,!1),document.addEventListener("pointermove",this,!1),document.addEventListener("pointercancel",this,!1)):window.MSPointerEvent&&window.navigator.msPointerEnabled?(document.addEventListener("MSPointerUp",this,!1),document.addEventListener("MSPointerMove",this,!1),document.addEventListener("MSPointerCancel",this,!1)):"mouse"===this._observedPointer?(document.addEventListener("mouseup",this,!1),document.addEventListener("mousemove",this,!1),this._element.addEventListener("dragstart",this,!1)):(document.addEventListener("touchend",this,!1),document.addEventListener("touchcancel",this,!1),document.addEventListener("touchmove",this,!1));var e=void 0!==window.onwheel||void 0!==window.WheelEvent?"wheel":"mousewheel";document.addEventListener(e,this,!0),document.addEventListener("scroll",this,!0)}},_removeEventListeners:{value:function(){window.PointerEvent?(document.removeEventListener("pointerup",this,!1),document.removeEventListener("pointermove",this,!1),document.removeEventListener("pointercancel",this,!1)):window.MSPointerEvent&&window.navigator.msPointerEnabled?(document.removeEventListener("MSPointerUp",this,!1),document.removeEventListener("MSPointerMove",this,!1),document.removeEventListener("MSPointerCancel",this,!1)):"mouse"===this._observedPointer?(document.removeEventListener("mouseup",this,!1),document.removeEventListener("mousemove",this,!1),this._element.removeEventListener("dragstart",this,!1)):(document.removeEventListener("touchend",this,!1),document.removeEventListener("touchcancel",this,!1),document.removeEventListener("touchmove",this,!1));var e=void 0!==window.onwheel||void 0!==window.WheelEvent?"wheel":"mousewheel";document.removeEventListener(e,this,!0),document.removeEventListener("scroll",this,!0)}},_createPressEvent:{enumerable:!1,value:function(e,i){var t,a,s=i;return i||(i=document.createEvent("CustomEvent"),i.initCustomEvent(e,!0,!0,null)),t=new n,t.event=i,t.type=e,t.pointer=this._observedPointer,t.targetElement=i.target,i.changedTouches&&(a=this._changedTouchisObserved(i.changedTouches))!==!1&&(s=t.touch=i.changedTouches[a]),s&&(t.clientX=s.clientX,t.clientY=s.clientY,t.pageX=s.pageX,t.pageY=s.pageY),t}},_dispatchPressStart:{enumerable:!1,value:function(e){if(this._state=u.PRESSED,this.dispatchEvent(this._createPressEvent("pressStart",e)),this._shouldDispatchLongPress){var i=this;this._longPressTimeout=setTimeout(function(){i._dispatchLongPress()},this._longPressThreshold)}}},_dispatchPress:{enumerable:!1,value:function(e){this._shouldDispatchLongPress&&(clearTimeout(this._longPressTimeout),this._longPressTimeout=null),this.dispatchEvent(this._createPressEvent("press",e)),this._state=u.UNPRESSED}},_dispatchLongPress:{enumerable:!1,value:function(e){this._shouldDispatchLongPress&&(this.dispatchEvent(this._createPressEvent("longPress",e)),this._longPressTimeout=null)}},_dispatchPressCancel:{enumerable:!1,value:function(e){this._shouldDispatchLongPress&&(clearTimeout(this._longPressTimeout),this._longPressTimeout=null),this._state=u.CANCELLED,this.dispatchEvent(this._createPressEvent("pressCancel",e))}}});u.prototype.captureMSPointerDown=u.prototype.capturePointerdown,u.prototype.handleMSPointerUp=u.prototype.handlePointerup,u.prototype.handleMSPointerCancel=u.prototype.handlePointercancel,u.prototype.handleMSPointerMove=u.prototype._handleMove,u.prototype.handlePointermove=u.prototype._handleMove,u.prototype.handleTouchmove=u.prototype._handleMove,u.prototype.handleMousemove=u.prototype._handleMove,u.prototype.handleMousewheel=u.prototype.handleWheel;var n=function(){var e,i,a,u,n,r;for(e=s.specialize({type:{value:"press"},_event:{enumerable:!1,value:null},event:{get:function(){return this._event},set:function(e){this._event=e}},_touch:{enumerable:!1,value:null},touch:{get:function(){return this._touch},set:function(e){this._touch=e}}}),i=["altKey","ctrlKey","metaKey","shiftKey","cancelBubble","currentTarget","defaultPrevented","eventPhase","timeStamp","preventDefault","stopImmediatePropagation","stopPropagation"],a=["clientX","clientY","pageX","pageY","screenX","screenY","target"],u=function(e){return{get:function(){return this._event[e]}}},n=function(e){return{get:function(){return this._touch?this._touch[e]:this._event[e]}}},r=i.length-1;r>=0;r--)t.defineProperty(e,i[r],u(i[r]));for(r=a.length-1;r>=0;r--)t.defineProperty(e,a[r],n(a[r]));return e}()}}),montageDefine("3d2b056","runtime/runtime-tf-loader",{dependencies:["runtime/dependencies/gl-matrix","runtime/glTF-parser","runtime/resource-description","runtime/technique","runtime/pass","runtime/glsl-program","runtime/glTF-material","runtime/mesh","runtime/glTF-node","runtime/primitive","runtime/projection","runtime/camera","runtime/skin","runtime/glTF-scene","runtime/transform","runtime/animation","runtime/animation-manager"],factory:function(e,i){e("runtime/dependencies/gl-matrix");var t=e("runtime/glTF-parser").glTFParser,a=e("runtime/resource-description").ResourceDescription,s=e("runtime/technique").Technique,u=e("runtime/pass").ProgramPass;e("runtime/pass").Pass,e("runtime/pass").ScenePass;var n=e("runtime/glsl-program").GLSLProgram,r=e("runtime/glTF-material").glTFMaterial,l=e("runtime/mesh").Mesh,o=e("runtime/glTF-node").glTFNode,c=e("runtime/primitive").Primitive,m=e("runtime/projection").Projection,d=e("runtime/camera").Camera,p=e("runtime/skin").Skin,v=e("runtime/glTF-scene").glTFScene,h=e("runtime/transform").Transform,g=e("runtime/animation").KeyframeAnimation,f=e("runtime/animation-manager").AnimationManager;i.RuntimeTFLoader=Object.create(t,{_materials:{writable:!0,value:null},_scenes:{writable:!0,value:null},_animations:{writable:!0,value:null},totalBufferSize:{value:0,writable:!0},handleBuffer:{value:function(e,i){var t=Object.create(a).init(e,i);return t.id=e,this.storeEntry(e,t,i),this.totalBufferSize+=i.byteLength,!0}},handleBufferView:{value:function(e,i){var t=Object.create(a).init(e,i);t.id=e;var s=this.getEntry(t.description.buffer);return i.type="ArrayBufferView",t.buffer=s,this.storeEntry(e,t,i),!0}},handleShader:{value:function(e,i){var t=Object.create(a).init(e,i);return t.id=e,t.type="shader",this.storeEntry(e,t,i),!0}},handleProgram:{value:function(e,i){var t=Object.create(a).init(e,i);t.id=e,t.type="program";var s=this.getEntry(t.description.vertexShader),u=this.getEntry(t.description.fragmentShader);return t[n.VERTEX_SHADER]=s.entry,t[n.FRAGMENT_SHADER]=u.entry,this.storeEntry(e,t,i),!0}},handleImage:{value:function(e,i){var t=i.path,s=Object.create(a).init(t,{path:t});return s.type="image",this.storeEntry(e,s,i),!0}},handleVideo:{value:function(e,i){var t=i.path,s=Object.create(a).init(t,{path:t});return s.type="video",this.storeEntry(e,s,i),!0}},handleTechnique:{value:function(e,i){var t=Object.create(s);t.id=e;var a=this.storeEntry(e,t,i),n=i.pass;t.passName=n;var r=i.passes;if(!r)return console.log("ERROR: technique does not contain pass"),!1;var l={},o=Object.keys(i.passes);return o.forEach(function(e){var i=r[e],t=i.instanceProgram;if(!t)return console.log("ERROR: A Pass with type=program must have a program property"),!1;var s=Object.create(u).init();s.id=a+"_"+n,s.instanceProgram=i.instanceProgram,s.instanceProgram.program=this.getEntry(t.program).entry,s.states=i.states,l[e]=s},this),t.parameters=i.parameters,t.passes=l,!0}},handleMaterial:{value:function(e,i){var t=Object.create(r).init(e);this.storeEntry(e,t,i);var a=i.instanceTechnique,s=a.values;t.name=i.name;var u=this.getEntry(a.technique);if(!u)return console.log("ERROR: invalid file, cannot find referenced technique:"+i.technique),!1;t.technique=u.entry;var n=t.technique.parameters;if(t.parameters=JSON.parse(JSON.stringify(n)),s){var l;for(l in s){var o=t.parameters[l];if(o)switch(o.value=s[l],o.type){case WebGLRenderingContext.prototype.SAMPLER_CUBE:case WebGLRenderingContext.prototype.SAMPLER_2D:var c=this.getEntry(o.value);c&&(o.value=c.entry);break;default:}}}return this._materials||(this._materials=[]),this._materials.push(t),!0}},handleLight:{value:function(){return!0}},handleAccessor:{value:function(e,i){i.id=e;var t=this.getEntry(i.bufferView);i.bufferView=t.entry,i.byteOffset||(i.byteOffset=0),this.storeEntry(e,i,i)}},handleMesh:{value:function(e,i){var t=Object.create(l).init();t.id=e,t.name=i.name;var a=!1,s=i.extensions;s&&(s["won-compression"]&&(a=!0,t.compression=s["won-compression"],t.compression.type="won-compression",t.compression.compressedData.bufferView=this.getEntry(t.compression.compressedData.bufferView).entry,t.compression.compressedData.id=e+"_compressedData"),s["Open3DGC-compression"]&&(a=!0,t.compression=s["Open3DGC-compression"],t.compression.type="Open3DGC-compression",t.compression.compressedData.bufferView=this.getEntry(t.compression.compressedData.bufferView).entry,t.compression.compressedData.id=e+"_compressedData")),this.storeEntry(e,t,i);var u=i[l.PRIMITIVES];if(!u)return console.log("MISSING_PRIMITIVES for mesh:"+e),!1;for(var n=0;u.length>n;n++){var r=u[n];if(r.primitive===WebGLRenderingContext.prototype.TRIANGLES){var o=Object.create(c).init(),m=this.getEntry(r.material);o.material=m.entry,t.primitives.push(o);var d=r.attributes,p=Object.keys(d);p.forEach(function(e){var i=d[e],t=this.getEntry(i);o.addVertexAttribute({semantic:e,attribute:t.entry})},this);var v=r.indices,h=this.getEntry(v);o.indices=h.entry}}return!0}},handleCamera:{value:function(e,i){var t=Object.create(d).init();t.id=e,this.storeEntry(e,t,i);var a=Object.create(m);return a.initWithDescription(i),t.projection=a,!0}},handleLight:{value:function(){return!0}},buildNodeHirerachy:{value:function(e){var i=e.entry,t=e.description.children;t&&t.forEach(function(e){var t=this.getEntry(e),a=t.entry;null==a.parent?i.children.push(a):i.children.push(a.copy()),this.buildNodeHirerachy(t)},this)}},resolveParameterSources:{value:function(){this._materials&&this._materials.forEach(function(e){if(e.parameters){var i=Object.keys(e.parameters);i.forEach(function(i){var t=e.parameters[i];t&&t.source&&(t.source=this.getEntry(t.source).entry)},this)}},this)}},buildSkeletons:{value:function(e){if(e.instanceSkin){var i=e.instanceSkin.skin;if(i){e.instanceSkin.skeletons.forEach(function(e){var t=this.getEntry(e);if(t){var a=t.entry,s=i.jointsIds,u=[];s.forEach(function(i){var t=a.nodeWithJointID(i);t?u.push(t):console.log("WARNING: jointId:"+i+" cannot be found in skeleton:"+e)},this),i.nodesForSkeleton[e]=u}},this);var t=[];e.instanceSkin.sources.forEach(function(e){var i=this.getEntry(e);i&&t.push(i.entry)},this),i.sources=t}}var a=e.children;a&&a.forEach(function(e){this.buildSkeletons(e)},this)}},handleScene:{value:function(e,i){if(this._scenes||(this._scenes=[]),!i.nodes)return console.log("ERROR: invalid file required nodes property is missing from scene"),!1;var t=Object.create(v).init();t.ids=this._ids,t.id=e,t.name=i.name,t.baseURL=this.baseURL,this.storeEntry(e,t,i);var a=Object.create(o).initWithID();return i.nodes&&i.nodes.forEach(function(e){var i=this.getEntry(e);a.children.push(i.entry),this.buildNodeHirerachy(i)},this),this.resolveParameterSources(),this.buildSkeletons(a),t.rootNode=a,this._scenes.push(t),!0}},handleSkin:{value:function(e,i){var t=Object.create(p).init();t.bindShapeMatrix=mat4.create(i.bindShapeMatrix),t.jointsIds=i.joints,t.inverseBindMatricesDescription=i.inverseBindMatrices,t.inverseBindMatricesDescription.id=e+"_inverseBindMatrices",t.inverseBindMatricesDescription.bufferView=this.getEntry(t.inverseBindMatricesDescription.bufferView).entry,this.storeEntry(e,t,i)}},handleNode:{value:function(e,i){var t=Object.create(o).init();t.id=e,t.jointId=i.jointId,t.name=i.name,this.storeEntry(e,t,i),t.transform=Object.create(h).initWithDescription(i);var a;if(i.mesh&&(a=this.getEntry(i.mesh),t.meshes.push(a.entry)),i.meshes&&i.meshes.forEach(function(e){a=this.getEntry(e),a&&t.meshes.push(a.entry)},this),i.camera){var s=this.getEntry(i.camera);s&&t.cameras.push(s.entry)}if(i.instanceSkin){i.instanceSkin.skin=this.getEntry(i.instanceSkin.skin).entry,t.instanceSkin=i.instanceSkin;var u=t.instanceSkin.sources;u&&u.forEach(function(e){a=this.getEntry(e),a&&t.meshes.push(a.entry)},this)}return!0}},handleLoadCompleted:{value:function(){if(this.delegate){var e=null;if(this._state.options&&(e=this._state.options.ids),e)e.forEach(function(e){var i=this.getEntry(e);i&&this.delegate.loadCompleted(i.entry)},this);else if(this._scenes&&this.delegate&&this._scenes.length>0){var i=Object.create(f).init();i.animations=this._animations,this._scenes[0].animationManager=i,this.delegate.loadCompleted(this._scenes[0])}}}},handleAnimation:{value:function(e,i){this._animations||(this._animations=[]);var t=WebGLRenderingContext.prototype,a=Object.create(g).initWithDescription(i);a.id=e,this.storeEntry(e,a,i);var s={};Object.keys(i.parameters).forEach(function(u){var n=i.parameters[u];switch(parameterDescription=this.getEntry(n).entry,parameterDescription.type){case t.FLOAT_VEC4:componentsPerAttribute=4;break;case t.FLOAT_VEC3:componentsPerAttribute=3;break;case t.FLOAT_VEC2:componentsPerAttribute=2;break;case t.FLOAT:componentsPerAttribute=1;break;default:console.log("type:"+parameterDescription.type+" byteStride not handled")}if(parameterDescription.extensions){var r=parameterDescription.extensions;if(r){var l=r["Open3DGC-compression"];if(l){var o=l.compressedData;o&&"object"!=typeof o.bufferView&&(o.bufferView=this.getEntry(o.bufferView).entry,o.id=e+u+"_compressedData")}}}parameterDescription.byteStride=4*componentsPerAttribute,parameterDescription.componentsPerAttribute=componentsPerAttribute,parameterDescription.id=a.id+u,s[u]=parameterDescription},this),a.parameters=s,a.channels.forEach(function(e){var i=e.target.id;e.path=e.target.path,e.target=this.getEntry(i).entry},this),Object.keys(a.samplers).forEach(function(e){var t=i.samplers[e],u=a.samplers[e],n=t.input,r=t.output;u.input=s[n],u.output=s[r]},this),this._animations.push(a)}},handleTexture:{value:function(e,i){if(i.source&&i.sampler)i.type="texture",i.source=this.getEntry(i.source).entry,i.sampler=this.getEntry(i.sampler).entry,i.id=e,this.storeEntry(e,i,i);else if(i.sources&&i.sampler){i.type="texture";for(var t=0;i.sources.length>t;t++)i.sources[t]=this.getEntry(i.sources[t]).entry;i.sampler=this.getEntry(i.sampler).entry,i.id=e,this.storeEntry(e,i,i)}else console.log("ERROR: texture"+e+" must contain both source and sampler properties")}},handleSampler:{value:function(e,i){i.id=i,this.storeEntry(e,i,i)}},handleError:{value:function(){}},_delegate:{value:null,writable:!0},delegate:{enumerable:!0,get:function(){return this._delegate},set:function(e){this._delegate=e}},_entries:{enumerable:!1,value:null,writable:!0},removeAllEntries:{value:function(){this._entries={}}},containsEntry:{enumerable:!1,value:function(e){return this._entries?this._entries[e]?!0:!1:!1}},storeEntry:{enumerable:!1,value:function(e,i,t){return null==this._entries&&(this._entries={}),null==this._ids&&(this._ids={}),i.baseId=e,this._ids[e]=i,(e+=this.loaderContext())?(i.id=e,this.containsEntry[e]&&console.log("WARNING: entry:"+e+" is already stored, overriding"),this._entries[e]={id:e,entry:i,description:t},e):(console.log("ERROR: not id provided, cannot store"),void 0)}},getEntry:{enumerable:!1,value:function(e){return e+=this.loaderContext(),this._entries?this._entries[e]:null}}})}}),montageDefine("3d2b056","runtime/animation",{dependencies:["runtime/dependencies/gl-matrix","runtime/base","runtime/transform","runtime/utilities","runtime/dependencies/o3dgc"],factory:function(e,i){function t(e){function i(e,i){return 1-3*i+3*e}function t(e,i){return 3*i-6*e}function a(e){return 3*e}function s(e,s,u){return((i(s,u)*e+t(s,u))*e+a(s))*e}function u(e,s,u){return 3*i(s,u)*e*e+2*t(s,u)*e+a(s)}function n(e){for(var i=e,t=0;4>t;++t){var a=u(i,r,o);if(0==a)return i;var n=s(i,r,o)-e;i-=n/a}return i}var r=e[0],l=e[1],o=e[2],c=e[3];this.get=function(e){return r==l&&o==c?e:s(n(e),l,c)}}function a(e,i,t){var a=Object.create(n).init();
return e.interpolateToTransform(i,t,a),a}function s(e,i,t){return e+(i-e)*t}e("runtime/dependencies/gl-matrix");var u=e("runtime/base").Base,n=e("runtime/transform").Transform;e("runtime/utilities").Utilities;var r=e("runtime/dependencies/o3dgc").o3dgc,l={ease:[.25,.1,.25,1],linear:[0,0,1,1],"ease-in":[.42,0,1,1],"ease-out":[0,0,.58,1],"ease-in-out":[.42,0,.58,1]},o=i.Channel=Object.create(u,{startTime:{value:0,writable:!0},endTime:{value:-1,writable:!0},_sampler:{value:null,writable:!0},sampler:{get:function(){return this._sampler},set:function(e){this._sampler=e}},_target:{value:null,writable:!0},target:{get:function(){return this._target},set:function(e){this._target=e}},_path:{value:null,writable:!0},path:{get:function(){return this._path},set:function(e){this._path=e}},parameterDelegate:{value:{handleError:function(e,i){console.log("ERROR:parameterDelegate:"+e+" :"+i)},decode:function(e,i){function t(e){for(var i=new ArrayBuffer(e.length),t=new Uint8Array(i),a=0,s=e.length;s>a;a++)t[a]=e.charCodeAt(a);return i}if(i){var a="ascii"==i.extensions["Open3DGC-compression"].compressedData.mode?"text":"arraybuffer";if("text"===a)var s=new r.BinaryStream(t(e)),u=e.length;else var s=new r.BinaryStream(e),u=e.byteLength;var n=new r.DynamicVectorDecoder,l=new r.DynamicVector,o=new r.Timer;return o.Tic(),n.DecodeHeader(l,s),o.Toc(),console.log("DecodeHeader time (ms) "+o.GetElapsedTime()),l.GetNVector()>0&&l.GetDimVector()&&(l.SetVectors(new Float32Array(l.GetNVector()*l.GetDimVector())),l.SetMinArray(new Float32Array(l.GetDimVector())),l.SetMaxArray(new Float32Array(l.GetDimVector())),l.SetStride(l.GetDimVector())),console.log("Dynamic vector info:"+i.id),console.log("	# vectors   "+l.GetNVector()),console.log("	dim         "+l.GetDimVector()),o.Tic(),n.DecodePlayload(l,s),o.Toc(),console.log("DecodePlayload time "+o.GetElapsedTime()+" ms, "+u+" bytes ("+8*u/l.GetNVector()+" bpv)"),l.GetVectors()}},convert:function(e,i,t){var a=t;if(a.extensions){var s=a.extensions,u=s["Open3DGC-compression"];if(u){var n=u.compressedData;if(n)return this.decode(i,t)}}return new Float32Array(i)},resourceAvailable:function(){}}},getParameterArray:{value:function(e,i){if(e.extensions){var t=e.extensions,a=t["Open3DGC-compression"];if(a){var s=a.compressedData;if(s)return i.getResource(s,this.parameterDelegate,e)}}return i.getResource(e,this.parameterDelegate,e)}},updateTargetsAtTime:{value:function(e,i){var t=this.sampler.input,a=this.sampler.output,s=this.getParameterArray(t,i),u=this.getParameterArray(a,i);if(s&&u){e/=1e3;var n=t.count;this.endTime=s[n-1],this.startTime=s[0];var r,l=0,o=0,c=0;if(n>0){if(this.startTime>e)o=0,l=0;else if(e>=this.endTime)o=1,l=n-2;else for(r=l;n-1>r;r++)if(e>=s[r]&&s[r+1]>e){l=r,c=s[r+1]-s[r],o=(e-s[r])/c;break}null==this.__vec4&&(this.__vec4=vec4.create()),null==this.__vec3&&(this.__vec3=vec3.create()),null==this.__vec2&&(this.__vec2=vec2.create());var m=null;switch(a.componentsPerAttribute){case 4:m=this.__vec4;break;case 3:m=this.__vec3;break;case 2:m=this.__vec2;break;case 1:console.log("float interpolation not handled yet");break;default:}this.index=l;var d=l*a.componentsPerAttribute,p=d+a.componentsPerAttribute,v=this.path;if("rotation"===v){v="orientation";var h=0,g=1,f=2,b=f;if(b==h){var q=vec4.createFrom(u[d+0],u[d+1],u[d+2],u[d+3]),_=vec4.createFrom(u[p+0],u[p+1],u[p+2],u[p+3]);vec3.normalize(q),vec3.normalize(_);var y=vec3.create();vec3.cross(q,_,y),Math.sqrt(vec3.dot(q,q)),Math.sqrt(vec3.dot(_,_));var S=Math.acos(vec3.dot(q,_)),P=mat4.identity();mat4.rotate(P,S*o,y),mat4.multiplyVec3(P,q,y),vec3.normalize(y);var C=q[3]+(_[3]-q[3])*o;quat4.fromAngleAxis(C,y,m)}else if(b==g){var q=vec4.createFrom(u[d+0],u[d+1],u[d+2],u[d+3]),_=vec4.createFrom(u[p+0],u[p+1],u[p+2],u[p+3]);for(r=0;m.length>r;r++){var N=q[r],D=_[r];_[r]=N+(D-N)*o}quat4.fromAngleAxis(_[3],_,m)}else if(b==f){null==this._quats&&(this._quats=[],this._quats.push(quat4.create()),this._quats.push(quat4.create())),null==this._vecs&&(this._vecs=[],this._vecs.push(vec3.create()),this._vecs.push(vec3.create())),this._vecs[0][0]=u[d+0],this._vecs[0][1]=u[d+1],this._vecs[0][2]=u[d+2],this._vecs[1][0]=u[p+0],this._vecs[1][1]=u[p+1],this._vecs[1][2]=u[p+2];var M=this._quats[0],E=this._quats[1];quat4.fromAngleAxis(u[d+3],this._vecs[0],M),quat4.fromAngleAxis(u[p+3],this._vecs[1],E),quat4.slerp(M,E,o,m)}}else for(r=0;m.length>r;r++){var N=u[d+r],D=u[p+r];m[r]=N+(D-N)*o}this.target.transform[v]=m}}}},initWithDescription:{value:function(e){return this.init(),this.index=0,this.target=e.target,this}},init:{value:function(){return this.__Base_init(),this}}}),c=Object.create(u,{_input:{value:null,writable:!0},input:{get:function(){return this._input},set:function(e){this._input=e}},_output:{value:null,writable:!0},output:{get:function(){return this._output},set:function(e){this._output=e}},initWithDescription:{value:function(){return this.init(),this}},init:{value:function(){return this.__Base_init(),this}}}),m=i.Animation=Object.create(Object.prototype,{KEYFRAME:{value:"KEYFRAME",writable:!0},BASIC:{value:"BASIC",writable:!0},_type:{value:null,writable:!0},type:{set:function(e){this._type=e},get:function(){return this._type}},_delegate:{value:null,writable:!0},delegate:{set:function(e){this._delegate=e},get:function(){return this._delegate}}});i.BasicAnimation=Object.create(m,{_startTime:{value:0,writable:!0},_from:{value:null,writable:!0},_to:{value:null,writable:!0},_duration:{value:0,writable:!0},path:{value:null,writable:!0},target:{value:null,writable:!0},_interpolator:{value:null,writable:!0},extras:{value:null,writable:!0},_timingFunction:{value:null,writable:!0},_bezier:{value:null,writable:!0},timingFunction:{set:function(e){this._timingFunction=e},get:function(){return this._timingFunction||"ease"}},_inferInterpolatorFromValue:{value:function(e){return isNaN(e-0)||null==e?e instanceof Object?a:nil:s}},to:{set:function(e){this._interpolator=this._inferInterpolatorFromValue(e),this._to=e},get:function(){return this._to}},from:{set:function(e){this._from=e},get:function(){return this._from}},duration:{set:function(e){this._duration=e},get:function(){return this._duration}},_evaluateAtTime:{value:function(e){var i=(e-this._startTime)/this.duration;if(i>1&&(i=1),0>i&&(i=0),null==this._bezier){var a=l[this.timingFunction]||"ease";this._bezier=new t(a)}i=this._bezier.get(i);var s=this._interpolator(this._from,this._to,i);this.target&&this.path&&(this.target[this.path]=s,this.delegate.animationDidUpdate(this))}},animationWasAddedToTarget:{value:function(){this._startTime=Date.now()}},animationWasRemovedFromTarget:{value:function(){this._startTime=0}},init:{value:function(){return this.type=m.BASIC,this.extras={},this}}}),i.KeyframeAnimation=Object.create(m,{_count:{value:0,writable:!0},_parameters:{value:null,writable:!0},_channels:{value:null,writable:!0},_samplers:{value:null,writable:!0},_startTime:{value:0,writable:!0},_endTime:{value:-1,writable:!0},channels:{get:function(){return this._channels},set:function(e){this._channels=e}},samplers:{get:function(){return this._samplers},set:function(e){this._samplers=e}},parameters:{get:function(){return this._parameters},set:function(e){this._parameters=e}},count:{get:function(){return this._count},set:function(e){this._count=e}},startTime:{get:function(){if(this.channels){if(this.channels.length>0){for(var e=this.channels[0].startTime,i=1;this.channels.length>i;i++)e>this.channels[i].startTime&&(e=this.channels[i].startTime);return e}return 0}}},endTime:{get:function(){if(this.channels){if(this.channels.length>0){for(var e=this.channels[0].endTime,i=1;this.channels.length>i;i++)this.channels[i].endTime>e&&(e=this.channels[i].endTime);return e}return-1}}},updateTargetsAtTime:{value:function(e,i){this.channels.forEach(function(t){t.updateTargetsAtTime(e,i)},this)}},initWithDescription:{value:function(e){return this.init(),this.count=e.count,Object.keys(e.samplers).forEach(function(i){var t=e.samplers[i],a=Object.create(c).initWithDescription(t);this.samplers[i]=a},this),e.channels.forEach(function(e){var i=Object.create(o).initWithDescription(e);i.sampler=this.samplers[e.sampler],i.target=e.target,this.channels.push(i)},this),this}},init:{value:function(){return this.channels=[],this.samplers={},this.type=m.KEYFRAME,this}}})}}),montageDefine("3d2b056","runtime/pass",{dependencies:["runtime/dependencies/gl-matrix","montage","runtime/glTF-node","runtime/node-wrapper","runtime/projection","runtime/camera","runtime/utilities","runtime/webgl-renderer","runtime/transform","runtime/resource-description"],factory:function(e,i){e("runtime/dependencies/gl-matrix");var t=e("montage").Montage;e("runtime/glTF-node").glTFNode;var a=e("runtime/node-wrapper").NodeWrapper;e("runtime/projection").Projection,e("runtime/camera").Camera,e("runtime/utilities").Utilities,e("runtime/webgl-renderer").WebGLRenderer,e("runtime/transform").Transform,e("runtime/resource-description").ResourceDescription,Object.create(Object.prototype,{_content:{value:null,writable:!0},content:{get:function(){return this._content},set:function(e){this._content=e}},_previous:{value:null,writable:!0},previous:{get:function(){return this._previous},set:function(e){this._previous=e}},_next:{value:null,writable:!0},next:{get:function(){return this._next},set:function(e){this._next=e}},init:{value:function(e){this.content=e,this.previous=null,this.next=null}},removeFromList:{value:function(){this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous),this.next=null,this.previous=null}}}),Object.create(Object.prototype,{_tail:{value:null,writable:!0},tail:{get:function(){return this._tail},set:function(e){this._tail=e}},_head:{value:null,writable:!0},head:{get:function(){return this._head},set:function(e){this._head=e}},append:{value:function(e){this.head||(this.head=e),this.tail&&(e.previous=this.tail,this.tail.next=e),this.tail=e}},remove:{value:function(e){e.content.id;var i=!1,t=!1;this.tail===e&&(i=!0,this.tail=e.previous),this.head===e&&(t=!0,this.head=e.next)}}});var s=i.RenderTarget=Object.create(Object.prototype,{_extras:{value:null,writable:!0},_width:{value:0,writable:!0},_height:{value:0,writable:!0},_attachments:{value:null,writable:!0},attachments:{get:function(){return this._attachments},set:function(e){this._attachments=e}},init:{value:function(){return this.attachments=[],this.extras={},this}},width:{get:function(){return this._width},set:function(e){this._width=e}},height:{get:function(){return this._height},set:function(e){this._height=e}},extras:{get:function(){return this._extras},set:function(e){this._extras=e}}}),u=Object.create(Object.prototype,{_extras:{value:null,writable:!0},PROGRAM:{value:"program",writable:!1},SCENE:{value:"scene",writable:!1},_type:{value:null,writable:!0},type:{get:function(){return this._type}},extras:{get:function(){return this._extras},set:function(e){this._extras=e}}});i.ProgramPass=t.create(u,{_attributes:{value:null,writable:!0},_uniforms:{value:null,writable:!0},_states:{value:null,writable:!0},_program:{value:null,writable:!0},states:{get:function(){return this._states},set:function(e){this._states=e}},program:{get:function(){return this._program},set:function(e){this._program=e}},init:{value:function(){return this.attributes={},this.uniforms={},this.states={},this._type=u.PROGRAM,this.extras={},this}}});var n=Object.create(Object.prototype,{_nodeWrappers:{value:null,writable:!0},_pathIDsForNodeID:{value:null,writable:!0},_primitivesPerPass:{value:null,writable:!0},_viewPoint:{value:null,writable:!0},_scene:{value:null,writable:!0},_observers:{value:null,writable:!0},_viewPointMatrix:{value:null,writable:!0},addObserver:{value:function(e){null==this._observers&&(this._observers=[]),-1===this._observers.indexOf(e)?this._observers.push(e):console.log("WARNING attempt to add 2 times the same observer in sceneRenderer")}},removeObserver:{value:function(e){if(this._observers){var i=this._observers.indexOf(e);-1!==i&&this._observers.splice(i,1)}}},viewPoint:{get:function(){return this._viewPoint},set:function(e){if(this._observers)for(var i=0;this._observers.length>i;i++)this._observers[i].viewPointWillChange(this,this._viewPoint,e);if(this._viewPoint!=e&&(this._viewPoint=e),this._observers)for(var i=0;this._observers.length>i;i++)this._observers[i].viewPointMatrixDidUpdate(this),this._observers[i].viewPointDidChange(this)}},setupNodeAtPath:{value:function(e){var i=this._nodeWrappers[e.id];null==i&&(i=Object.create(a).init(e),this._nodeWrappers[e.id]=i,i.scenePassRenderer=this),e.meshes&&e.meshes.forEach(function(t){t.primitives&&t.primitives.forEach(function(a){if(a.material){var s=a.material.technique;if(s&&s.rootPass){var u,n=s.rootPass.id,r=null;for(u=0;this._primitivesPerPass.length>u;u++)this._primitivesPerPass[u].pass===n&&(r=this._primitivesPerPass[u]);null==r&&(r=this._primitivesPerPass[n]={pass:s.rootPass,primitives:[]},this._primitivesPerPass.push(r));var l={};t.compression&&(l.compressed=!0),l.primitive=a,l.node=e,l.nodeWrapper=i,r.primitives.push(l)}}},this)},this)}},sceneWillChange:{value:function(){this._viewPointMatrix=mat4.identity()}},sceneDidChange:{value:function(){this._primitivesPerPass=[],this._nodeWrappers={};var e=this;this.scene&&this.scene.rootNode.apply(function(i){return e.setupNodeAtPath(i),null},!0,null)}},render:{value:function(e,i,t){if(this.scene&&this.viewPoint){if(null==this.__matrix&&(this.__matrix=mat4.create()),this.viewPoint&&(mat4.set(this.viewPoint.worldMatrix,this.__matrix),mat4.inverse(this.__matrix),mat4.equal(this._viewPointMatrix,this.__matrix)===!1&&(mat4.set(this.__matrix,this._viewPointMatrix),this._observers)))for(var a=0;this._observers.length>a;a++)this._observers[a].viewPointMatrixDidUpdate(this);var s,u=t?t.picking===!0&&null!=t.coords:!1;for(u&&(this.pickingRenderTarget.extras.coords=t.coords,e.bindRenderTarget(this.pickingRenderTarget)),e.projectionMatrix=this.viewPoint.cameras[0].projection.matrix,null==this.__nonOpaquePassesWithPrimitives&&(this.__nonOpaquePassesWithPrimitives=[]),this.__nonOpaquePassesWithPrimitives.length=0,s=0;this._primitivesPerPass.length>s;s++){var n=this._primitivesPerPass[s],r=u?this.pickingPass:n.pass,l=r.states;l.blendEnable&&!u?this.__nonOpaquePassesWithPrimitives.push(n):u&&this.pickingTechnique?e.renderPrimitivesWithPass(n.primitives,r,this.pickingTechnique.parameters,i):e.renderPrimitivesWithPass(n.primitives,r,null,i)}if(u){e.unbindRenderTarget(this.pickingRenderTarget);var o=this.pickingRenderTarget.extras.pickedPixel,c=null,m=Object.keys(this.pickingPass.extras.nodeIDToColor);m.forEach(function(e){var i=this.pickingPass.extras.nodeIDToColor[e];1>=Math.abs(Math.round(255*i[0])-o[0])&&1>=Math.abs(Math.round(255*i[1])-o[1])&&1>=Math.abs(Math.round(255*i[2])-o[2])&&(c=e)},this),t.delegate.handleSelectedNode(c)}else for(s=0;this.__nonOpaquePassesWithPrimitives.length>s;s++){var n=this.__nonOpaquePassesWithPrimitives[s];e.renderPrimitivesWithPass(n.primitives,n.pass,null,i)}}}},scene:{get:function(){return this._scene},set:function(e){this._scene!=e&&(this.sceneWillChange(this._scene,e),this._scene=e,this.sceneDidChange())}},_pickingPass:{value:null,writable:!0},pickingPass:{get:function(){return this._pickingPass},set:function(e){this._pickingPass=e,this._pickingPass.id="__PickingPass",this._pickingPass.extras.nodeIDToColor={}}},_pickingTechnique:{value:null,writable:!0},pickingTechnique:{get:function(){return this._pickingTechnique},set:function(e){this._pickingTechnique=e,this.pickingPass=this._pickingTechnique.rootPass}},_pickingRenderTarget:{value:null,writable:!0},pickingRenderTarget:{get:function(){return this._pickingRenderTarget},set:function(e){this._pickingRenderTarget=e}},createPickingRenderTargetIfNeeded:{value:function(){return this._pickingRenderTarget||(this._pickingRenderTarget=Object.create(s).init(),this._pickingRenderTarget.attachments.push({semantic:"COLOR_ATTACHMENT0",parameter:"__pickingTexture"}),this._pickingRenderTarget.attachments.push({semantic:"DEPTH_ATTACHMENT",parameter:"__pickingRenderBuffer"}),this.pickingRenderTarget.extras.picking=!0),this._pickingRenderTarget}},init:{value:function(){return this.pickingRenderTarget=this.createPickingRenderTargetIfNeeded(),this.pickingRenderTarget.width=512,this.pickingRenderTarget.height=512,this._nodeWrappers={},this}}});i.ScenePass=Object.create(u,{_scenePassRenderer:{value:null,writable:!0},createScenePassRendererIfNeeded:{value:function(){this._scenePassRenderer||(this._scenePassRenderer=Object.create(n).init())}},scenePassRenderer:{get:function(){return this.createScenePassRendererIfNeeded(),this._scenePassRenderer},set:function(e){this.createScenePassRendererIfNeeded(),this._scenePassRenderer!=e&&(this._scenePassRenderer=e)}},viewPoint:{get:function(){return this.scenePassRenderer?this.scenePassRenderer.viewPoint:null},set:function(e){this.scenePassRenderer&&(this.scenePassRenderer.viewPoint=e)}},scene:{get:function(){return this.scenePassRenderer.scene},set:function(e){this.scenePassRenderer.scene=e}},execute:{value:function(e,i,t){this.scenePassRenderer.render(e,i,t)}},init:{value:function(){return this._type=u.SCENE,this.extras={},this}}})}}),montageDefine("3d2b056","runtime/dependencies/webgl-debug",{dependencies:[],factory:function(){WebGLDebugUtils=function(){function e(e){if(null==p){p={};for(var i in e)"number"==typeof e[i]&&(p[e[i]]=i)}}function i(){if(null==p)throw"WebGLDebugUtils.init(ctx) not called"}function t(e){return i(),void 0!==p[e]}function a(e){i();var t=p[e];return void 0!==t?"gl."+t:"/*UNKNOWN WebGL ENUM*/ 0x"+e.toString(16)}function s(e,i,t,s){var u=d[e];if(void 0!==u){var u=u[i];if(void 0!==u&&u[t])return a(s)}return null===s?"null":void 0===s?"undefined":""+s}function u(e,i){for(var t="",a=i.length,u=0;a>u;++u)t+=(0==u?"":", ")+s(e,a,u,i[u]);return t}function n(e,i,t){e.__defineGetter__(t,function(){return i[t]}),e.__defineSetter__(t,function(e){i[t]=e})}function r(i,t,u){function r(e,i){return function(){u&&u(i,arguments);var a=e[i].apply(e,arguments),s=e.getError();return 0!=s&&(l[s]=!0,t(s,i,arguments)),a}}e(i),t=t||function(e,i,t){for(var u="",n=t.length,r=0;n>r;++r)u+=(0==r?"":", ")+s(i,n,r,t[r]);m("WebGL error "+a(e)+" in "+i+"("+u+")")};var l={},o={};for(var c in i)"function"==typeof i[c]?o[c]=r(i,c):n(o,i,c);return o.getError=function(){for(var e in l)if(l.hasOwnProperty(e)&&l[e])return l[e]=!1,e;return i.NO_ERROR},o}function l(e){var i=e.getParameter(e.MAX_VERTEX_ATTRIBS),t=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,t);for(var a=0;i>a;++a)e.disableVertexAttribArray(a),e.vertexAttribPointer(a,4,e.FLOAT,!1,0,0),e.vertexAttrib1f(a,0);e.deleteBuffer(t);for(var s=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),a=0;s>a;++a)e.activeTexture(e.TEXTURE0+a),e.bindTexture(e.TEXTURE_CUBE_MAP,null),e.bindTexture(e.TEXTURE_2D,null);for(e.activeTexture(e.TEXTURE0),e.useProgram(null),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.DITHER),e.disable(e.SCISSOR_TEST),e.blendColor(0,0,0,0),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.clearColor(0,0,0,0),e.clearDepth(1),e.clearStencil(-1),e.colorMask(!0,!0,!0,!0),e.cullFace(e.BACK),e.depthFunc(e.LESS),e.depthMask(!0),e.depthRange(0,1),e.frontFace(e.CCW),e.hint(e.GENERATE_MIPMAP_HINT,e.DONT_CARE),e.lineWidth(1),e.pixelStorei(e.PACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.UNPACK_COLORSPACE_CONVERSION_WEBGL&&e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.BROWSER_DEFAULT_WEBGL),e.polygonOffset(0,0),e.sampleCoverage(1,!1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilMask(4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT);e.getError(););}function o(e){function i(e){return"function"==typeof e?e:function(i){e.handleEvent(i)}}function t(e){var i=e.addEventListener;e.addEventListener=function(t,a){switch(t){case"webglcontextlost":P(a);break;case"webglcontextrestored":C(a);break;default:i.apply(e,arguments)}}}function a(){for(var e=Object.keys(S),i=0;e.length>i;++i)delete S[e]}function s(){++q,g||b==q&&e.loseContext()}function u(e,i){var t=e[i];return function(){if(s(),!g){var i=t.apply(e,arguments);return i}}}function r(){for(var e=0;f.length>e;++e){var i=f[e];i instanceof WebGLBuffer?m.deleteBuffer(i):i instanceof WebGLFramebuffer?m.deleteFramebuffer(i):i instanceof WebGLProgram?m.deleteProgram(i):i instanceof WebGLRenderbuffer?m.deleteRenderbuffer(i):i instanceof WebGLShader?m.deleteShader(i):i instanceof WebGLTexture&&m.deleteTexture(i)}}function o(e){return{statusMessage:e,preventDefault:function(){_=!0}}}function c(e){for(var i in e)"function"==typeof e[i]?d[i]=u(e,i):n(d,e,i);d.getError=function(){if(s(),!g)for(var e;e=m.getError();)S[e]=!0;for(var e in S)if(S[e])return delete S[e],e;return d.NO_ERROR};for(var t=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],a=0;t.length>a;++a){var r=t[a];d[r]=function(i){return function(){if(s(),g)return null;var t=i.apply(e,arguments);return t.__webglDebugContextLostId__=h,f.push(t),t}}(e[r])}for(var l=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"],a=0;l.length>a;++a){var r=l[a];d[r]=function(i){return function(){return s(),g?null:i.apply(e,arguments)}}(d[r])}for(var o=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"],a=0;o.length>a;++a){var r=o[a];d[r]=function(i){return function(){return s(),g?!1:i.apply(e,arguments)}}(d[r])}return d.checkFramebufferStatus=function(i){return function(){return s(),g?d.FRAMEBUFFER_UNSUPPORTED:i.apply(e,arguments)}}(d.checkFramebufferStatus),d.getAttribLocation=function(i){return function(){return s(),g?-1:i.apply(e,arguments)}}(d.getAttribLocation),d.getVertexAttribOffset=function(i){return function(){return s(),g?0:i.apply(e,arguments)}}(d.getVertexAttribOffset),d.isContextLost=function(){return g},d}var m,d,p=[],v=[],d={},h=1,g=!1,f=[],b=0,q=0,_=!1,y=0,S={};e.getContext=function(i){return function(){var t=i.apply(e,arguments);if(t instanceof WebGLRenderingContext){if(t!=m){if(m)throw"got different context";m=t,d=c(m)}return d}return t}}(e.getContext);var P=function(e){p.push(i(e))},C=function(e){v.push(i(e))};return t(e),e.loseContext=function(){if(!g){for(g=!0,b=0,++h;m.getError(););a(),S[m.CONTEXT_LOST_WEBGL]=!0;var i=o("context lost"),t=p.slice();setTimeout(function(){for(var a=0;t.length>a;++a)t[a](i);y>=0&&setTimeout(function(){e.restoreContext()},y)},0)}},e.restoreContext=function(){g&&v.length&&setTimeout(function(){if(!_)throw"can not restore. webglcontestlost listener did not call event.preventDefault";r(),l(m),g=!1,q=0,_=!1;for(var e=v.slice(),i=o("context restored"),t=0;e.length>t;++t)e[t](i)},0)},e.loseContextInNCalls=function(e){if(g)throw"You can not ask a lost contet to be lost";b=q+e},e.getNumCalls=function(){return q},e.setRestoreTimeout=function(e){y=e},e}var c=function(e){window.console&&window.console.log&&window.console.log(e)},m=function(e){window.console&&window.console.error?window.console.error(e):c(e)},d={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:!0}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}}},p=null;return{init:e,mightBeEnum:t,glEnumToString:a,glFunctionArgToString:s,glFunctionArgsToString:u,makeDebugContext:r,makeLostContextSimulatingCanvas:o,resetToInitialState:l}}()}}),montageDefine("47be41b","ui/beachplanet.reel/beachplanet.html",{text:'<html><head>\n    <link rel=stylesheet href=beachplanet.css>\n    <script type=text/montage-serialization>{"owner":{"properties":{"element":{"#":"beachplanet"}},"bindings":{"status":{"<-":"@scene.status"}}},"scene":{"prototype":"mjs-volume/runtime/scene","properties":{"path":"/assets/3d/beachplanet/beachplanet.json"}},"cameraRideViewPoint":{"prototype":"mjs-volume/runtime/node","properties":{"id":"node-Camera_ride","scene":{"@":"scene"}}},"sceneView":{"prototype":"mjs-volume/ui/scene-view.reel","properties":{"element":{"#":"sceneView"},"scene":{"@":"scene"},"viewPoint":{"@":"cameraRideViewPoint"}}},"score":{"prototype":"montage/ui/text.reel","properties":{"element":{"#":"score"},"value":"0"},"bindings":{"value":{"<-":"@owner.score"}}},"maxScoreCount":{"prototype":"montage/ui/text.reel","properties":{"element":{"#":"maxScoreCount"}},"bindings":{"value":{"<-":"@owner.MAX_SCORE"}}},"logoCount":{"prototype":"montage/ui/text.reel","properties":{"element":{"#":"logoCount"}},"bindings":{"value":{"<-":"@owner.MAX_SCORE"}}},"seaGullVP":{"prototype":"mjs-volume/runtime/node","properties":{"id":"node-Camera_SeaGull","scene":{"@":"scene"}}},"buoyVP":{"prototype":"mjs-volume/runtime/node","properties":{"id":"node-Camera_buoy","scene":{"@":"scene"}}},"cabinVP":{"prototype":"mjs-volume/runtime/node","properties":{"id":"node-Camera_cabin","scene":{"@":"scene"}}},"dolphinsVP":{"prototype":"mjs-volume/runtime/node","properties":{"id":"node-Camera_dolphins","scene":{"@":"scene"}}},"flowersVP":{"prototype":"mjs-volume/runtime/node","properties":{"id":"node-Camera_flowers","scene":{"@":"scene"}}},"planetVP":{"prototype":"mjs-volume/runtime/node","properties":{"id":"node-Camera-planet","scene":{"@":"scene"}}},"starLogoVP":{"prototype":"mjs-volume/runtime/node","properties":{"id":"node-Camera-star-logo","scene":{"@":"scene"}}},"cabinLogoVP":{"prototype":"mjs-volume/runtime/node","properties":{"id":"node-Camera-cabin-logo","scene":{"@":"scene"}}},"rockLogoVP":{"prototype":"mjs-volume/runtime/node","properties":{"id":"node-Camera-rock-logo","scene":{"@":"scene"}}},"nav":{"prototype":"montage/ui/repetition.reel","properties":{"element":{"#":"nav"},"content":[{"name":"Planet","value":{"@":"planetVP"}},{"name":"SeaGull","value":{"@":"seaGullVP"}},{"name":"Buoy","value":{"@":"buoyVP"}},{"name":"Cabin","value":{"@":"cabinVP"}},{"name":"Dolphins","value":{"@":"dolphinsVP"}}]}},"logoStar":{"prototype":"mjs-volume/runtime/node","properties":{"id":"node_36","scene":{"@":"scene"}},"bindings":{"classList.has(\'BeachPlanet-star-logo-animate\')":{"<-":"true"},"classList.has(\'BeachPlanet-star-logo-reveal\')":{"<-":"@owner.starRevealed"}}},"star":{"prototype":"mjs-volume/runtime/node","properties":{"id":"node_23","scene":{"@":"scene"}},"bindings":{"classList.has(\'BeachPlanet-star-animate\')":{"<-":"true"},"classList.has(\'BeachPlanet-star-reveal\')":{"<-":"@owner.starRevealed"}},"listeners":[{"type":"action","listener":{"@":"owner"}}]},"rock":{"prototype":"mjs-volume/runtime/node","properties":{"id":"node_25","scene":{"@":"scene"}},"bindings":{"classList.has(\'BeachPlanet-rock-animate\')":{"<-":"true"},"classList.has(\'BeachPlanet-rock-reveal\')":{"<-":"@owner.rockRevealed"}},"listeners":[{"type":"action","listener":{"@":"owner"}}]},"logoRock":{"prototype":"mjs-volume/runtime/node","properties":{"id":"node_38","scene":{"@":"scene"}},"bindings":{"classList.has(\'BeachPlanet-rock-logo-animate\')":{"<-":"true"},"classList.has(\'BeachPlanet-rock-logo-reveal\')":{"<-":"@owner.rockRevealed"}}},"door":{"prototype":"mjs-volume/runtime/node","properties":{"id":"node_6","scene":{"@":"scene"}},"bindings":{"classList.has(\'BeachPlanet-door-animate\')":{"<-":"true"},"classList.has(\'BeachPlanet-door-open\')":{"<-":"@owner.doorOpen"}},"listeners":[{"type":"action","listener":{"@":"owner"}}]},"buoy":{"prototype":"mjs-volume/runtime/node","properties":{"id":"node_31","scene":{"@":"scene"}},"bindings":{"classList.has(\'BeachPlanet-buoy-animate\')":{"<-":"true"}}},"dolphin":{"prototype":"mjs-volume/runtime/node","properties":{"id":"node_11","scene":{"@":"scene"}},"bindings":{"classList.has(\'BeachPlanet-dolphin-animate\')":{"<-":"true"}}},"dolphin2":{"prototype":"mjs-volume/runtime/node","properties":{"id":"node_20","scene":{"@":"scene"}},"bindings":{"classList.has(\'BeachPlanet-dolphin-animate\')":{"<-":"true"}}},"logoDolphin":{"prototype":"mjs-volume/runtime/node","properties":{"id":"node_13","scene":{"@":"scene"}},"bindings":{"classList.has(\'BeachPlanet-dolphin-logo-animate\')":{"<-":"true"}},"listeners":[{"type":"action","listener":{"@":"owner"}}]},"navItem":{"prototype":"digit/ui/button.reel","properties":{"element":{"#":"navItem"}},"bindings":{"label":{"<-":"@nav:iteration.object.name"},"viewPoint":{"<-":"@nav:iteration.object.value"},"classList.has(\'is-selected\')":{"<-":"@sceneView.viewPoint == viewPoint"}},"listeners":[{"type":"action","listener":{"@":"owner"}}]},"playButton":{"prototype":"digit/ui/button.reel","properties":{"element":{"#":"playButton"}},"listeners":[{"type":"action","listener":{"@":"owner"}}]},"playAgainButton":{"prototype":"digit/ui/button.reel","properties":{"element":{"#":"playAgainButton"}},"listeners":[{"type":"action","listener":{"@":"owner"}}]}}</script>\n</head>\n\n<body>\n    <div data-montage-id=beachplanet class="BeachPlanet isIntro">\n        <div data-montage-id=sceneView></div>\n        <aside class=BeachPlanet-panel>\n            <img class=BeachPlanet-panel-logo src=logo.png title=BeachPlanet>\n            <div class=BeachPlanet-score>\n                <label class=BeachPlanet-score-label>Score</label>\n                <span class=BeachPlanet-score-value>\n                    <span data-montage-id=score></span>/<span data-montage-id=maxScoreCount></span>\n                </span>\n            </div>\n            <div class=BeachPlanet-cams>\n                <label class=BeachPlanet-cams-label>View</label>\n                <nav data-montage-id=nav class=BeachPlanet-nav>\n                    <button data-montage-id=navItem class=BeachPlanet-nav-item></button>\n                </nav>\n            </div>\n        </aside>\n        <div class="BeachPlanet-overlay BeachPlanet-overlay--intro">\n            <img class=BeachPlanet-logo src=logo.png title=BeachPlanet>\n            <button data-montage-id=playButton class="BeachPlanet-button BeachPlanet-button--play">Play</button>\n                <h1 class=BeachPlanet-play-title><span data-montage-id=logoCount></span> Montage logos are hidden, let\'s find them!</h1>\n                <h2 class=BeachPlanet-play-subtitle>Learn how to <a class=BeachPlanet-play-link href=http://montagejs.org/docs/tutorial-3d-applications-with-montagejs.html>build this with MontageJS</a></h2>\n\n        </div>\n        <div class="BeachPlanet-overlay BeachPlanet-overlay--winner">\n            <img class=BeachPlanet-logo src=winner.png title="You won!">\n            <button data-montage-id=playAgainButton class="BeachPlanet-button BeachPlanet-button--play">Play again</button>\n        </div>\n    </div>\n\n\n\n</body></html>'}),montageDefine("d41c331","core/range-controller",{dependencies:["./core","collections/generic-collection","collections/listen/array-changes"],factory:function(e,i){var t=e("./core").Montage,a=e("collections/generic-collection"),s=e("collections/listen/array-changes").observableArrayProperties,u=Object.freeze([]),n=function(e,i){var t=e;
return t.__proto__=n.prototype,t.rangeController=i,t.contentEquals=e&&e.contentEquals||Object.is,t};n.prototype=Object.create(Array.prototype,s),Object.defineProperty(n.prototype,"clone",{value:function(){return this.slice()}}),self.swap,Object.defineProperty(n.prototype,"oldSwap",{configurable:!1,value:s.swap.value}),Object.defineProperty(n.prototype,"swap",{configurable:!1,value:function(e,i,t){return this.swap_or_push(e,i,t)}}),n.prototype.oldPush=s.push.value,Object.defineProperty(n.prototype,"push",{configurable:!1,value:function(){for(var e=-1,i=arguments.length,t=Array(i);i>++e;)t[e]=arguments[e];this.swap_or_push(this.length,0,t)}}),Object.defineProperty(n.prototype,"swap_or_push",{configurable:!1,value:function(e,i,t){var a=this.rangeController.content;this.contentEquals=a&&a.contentEquals||Object.is,e=e>=0?e:this.length+e;var s=this.length,n=Math.min(i,s-e);if(t){t.contentEquals=this.contentEquals;var r=t.filter(function(i,s){if(a&&!a.has(i))return!1;if(t.findLast(i)>s)return!1;var u=this.find(i);return 0>u||u>=e&&e+n>u},this)}else r=u;var l;l=0===n?u:Array.prototype.slice.call(this,e,e+n);var o=r.length-l.length,c=Math.max(this.length+o,e+r.length);if(!this.rangeController.multiSelect&&c>1){var m=r.length?r[r.length-1]:this.one();return 0===s?(this.oldPush(m),u):this.oldSwap(0,s,[m])}return this.rangeController.avoidsEmptySelection&&0===c?a.has(this[0])?0===this.length-1?u:this.oldSwap(1,this.length-1):0===this.length?(this.oldPush(a.one()),u):this.oldSwap(0,this.length,[a.one()]):this.oldSwap(e,i,r)}}),i.RangeController=t.specialize({constructor:{value:function(e){this.content=null,this._selection=new n([],this),this.sortPath=null,this.filterPath=null,this.reversed=!1,this.selectAddedContent=!1,this.deselectInvisibleContent=!1,this.clearSelectionOnOrderChange=!1,this.avoidsEmptySelection=!1,this.multiSelect=!1,this.organizedContent=[],this.organizedContent.addRangeChangeListener(this,"organizedContent"),this.defineBinding("_filteredContent",{"<-":"$filterPath.defined() ? content.filter{path($filterPath)} : content"}),this.defineBinding("_sortedContent",{"<-":"$sortPath.defined() ? _filteredContent.sorted{path($sortPath)} : _filteredContent"}),this.defineBinding("organizedContent.rangeContent()",{"<-":"$reversed ?? 0 ? _sortedContent.reversed() : _sortedContent"}),this.addRangeAtPathChangeListener("content",this,"handleContentRangeChange"),this.addPathChangeListener("sortPath",this,"handleOrderChange"),this.addPathChangeListener("reversed",this,"handleOrderChange"),this.addOwnPropertyChangeListener("multiSelect",this),this.iterations=[],e&&this.initWithContent(e)}},initWithContent:{value:function(e){return this.content=e,this}},sortPath:{value:null},reversed:{value:null},filterPath:{value:null},selectAddedContent:{value:!1},deselectInvisibleContent:{value:!1},clearSelectionOnOrderChange:{value:!1},avoidsEmptySelection:{value:!1},multiSelect:{value:!1},organizedContent:{value:null},iterations:{value:null},_selection:{value:null},selection:{get:function(){return this._selection},set:function(e){var i=[0,this._selection.length];e&&e.toArray&&(i=i.concat(e.toArray())),this._selection.splice.apply(this._selection,i)}},select:{value:function(e){!this.multiSelect&&this.selection.length>=1&&this.selection.clear(),this.selection.add(e)}},deselect:{value:function(e){(!this.avoidsEmptySelection||this.selection.length>1)&&this.selection["delete"](e)}},clearSelection:{value:function(){(!this.avoidsEmptySelection||this.selection.length>1)&&this.selection.clear()}},add:{value:function(e){var i;return this.content||(this.content=[]),i=this.content.add(e),i&&this.handleAdd(e),i}},push:{value:function(){for(var e=this.content.push.apply(this.content,arguments),i=0;arguments.length>i;i++)this.handleAdd(arguments[i]);return e}},pop:{value:function(){return this.content.pop()}},shift:{value:function(){return this.content.shift()}},unshift:{value:function(){for(var e=this.content.unshift.apply(this.content,arguments),i=0;arguments.length>i;i++)this.handleAdd(arguments[i]);return e}},splice:{value:function(){for(var e=this.content.splice.apply(this.content,arguments),i=2;arguments.length>i;i++)this.handleAdd(arguments[i]);return e}},swap:{value:function(e,i,t){var a=this.content.swap.apply(this.content,arguments);if(t)for(var e=2;t.length>e;e++)this.handleAdd(t[e]);return a}},"delete":{value:function(e){return this.content["delete"](e)}},has:{value:function(e){return this.content?this.content.has(e):!1}},addEach:{value:a.prototype.addEach},deleteEach:{value:a.prototype.deleteEach},clear:{value:function(){this.content.clear()}},addContent:{value:function(){var e=new this.contentConstructor;return this.add(e),e}},_contentConstructor:{value:null},contentConstructor:{get:function(){return this._contentConstructor?this._contentConstructor:this.content&&this.content.contentConstructor?this.content.contentConstructor:Object},set:function(e){this._contentConstructor=e}},handleContentRangeChange:{value:function(e,i){if(this.selection.length>0){var t=this.content&&this.content.contentEquals||Object.is;i.deleteEach(e,t),this.selection&&this.selection.deleteEach(i)}}},handleSelectionRangeChange:{value:function(e,i){if(this.selection)if(this.content){for(var t=[],a=0;e.length>a;a++)this.content.has(e[a])||t.push(e[a]);if(this._selection.deleteEach(t),!this.multiSelect&&this._selection.length>1){var s=this._selection.pop();this._selection.clear(),this._selection.add(s)}this.avoidsEmptySelection&&0==this._selection.length&&this._selection.add(i[0])}else this._selection.clear()}},handleOrganizedContentRangeChange:{value:function(e,i){if(this.deselectInvisibleContent&&this.selection){var t=i.clone(1);t.deleteEach(e),this.selection.deleteEach(i)}}},handleOrderChange:{value:function(){this.clearSelectionOnOrderChange&&this.selection&&this.selection.clear()}},handleAdd:{value:function(e){this.selectAddedContent&&this.selection&&(!this.multiSelect&&this.selection.length>=1&&this.selection.clear(),this.selection.add(e))}},handleMultiSelectChange:{value:function(){if(this.selection){var e=this.selection.length;if(!this.multiSelect&&e>1){var i=this._selection.pop();this._selection.clear(),this._selection.add(i)}}}}},{blueprintModuleId:e("./core")._blueprintModuleIdDescriptor,blueprint:e("./core")._blueprintDescriptor})}}),montageDefine("3d2b056","runtime/glsl-program",{dependencies:["runtime/dependencies/gl-matrix"],factory:function(e,i){e("runtime/dependencies/gl-matrix");var t=i.GLSLProgram=Object.create(Object.prototype,{VERTEX_SHADER:{value:"x-shader/x-vertex"},FRAGMENT_SHADER:{value:"x-shader/x-fragment"},_shaders:{enumerable:!1,value:null,writable:!0},shaders:{enumerable:!1,get:function(){return this._shaders},set:function(e){this._shaders=e}},_errorLogs:{enumerable:!1,value:null,writable:!0},errorLogs:{enumerable:!1,get:function(){return this._errorLogs},set:function(e){this._errorLogs=e}},_pendingCommits:{value:null,writable:!0},pendingCommits:{get:function(){return this._pendingCommits},set:function(e){this._pendingCommits=e}},_symbolToLocation:{value:null,writable:!0},symbolToLocation:{enumerable:!1,get:function(){return this._symbolToLocation},set:function(e){this._symbolToLocation=e}},_symbolToActiveInfo:{enumerable:!1,value:null,writable:!0},symbolToActiveInfo:{get:function(){return this._symbolToActiveInfo},set:function(e){this._symbolToActiveInfo=e}},_semanticToSymbol:{value:null,writable:!0},semanticToSymbol:{enumerable:!1,get:function(){return this._semanticToSymbol},set:function(e){this._semanticToSymbol=e}},_symbolToSemantic:{value:null,writable:!0},symbolToSemantic:{get:function(){return this._symbolToSemantic},set:function(e){this._symbolToSemantic=e}},_symbolToValue:{value:null,writable:!0},symbolToValue:{get:function(){return this._symbolToValue},set:function(e){this._symbolToValue=e}},_uniformSymbols:{value:null,writable:!0},uniformSymbols:{enumerable:!1,get:function(){return this._uniformSymbols},set:function(e){this._uniformSymbols=e}},_attributeSymbols:{value:null,writable:!0},attributeSymbols:{enumerable:!1,get:function(){return this._attributeSymbols},set:function(e){this._attributeSymbols=e}},_GLProgram:{enumerable:!1,value:null,writable:!0},GLProgram:{enumerable:!1,get:function(){return this._GLProgram},set:function(e){this._GLProgram=e}},getTypeForSymbol:{value:function(e){var i=null,t=this.symbolToActiveInfo[e];return t&&(i=t.type),i}},getLocationForSymbol:{value:function(e){return this.symbolToLocation[e]}},getSymbolForSemantic:{value:function(e){return this.semanticToSymbol[e]}},setSymbolForSemantic:{value:function(e,i){if("none"===e&&(e=null),"none"===i&&(i=null),!this.symbolToActiveInfo[e])return!1;if(i&&this.semanticToSymbol[i])return!1;if(e){var t=this.symbolToSemantic[e];t&&t!==i&&(this.semanticToSymbol[t]=null),this.symbolToSemantic[e]=i}return i&&(this.semanticToSymbol[i]=e),!0}},setSemanticForSymbol:{value:function(e,i){this.setSymbolForSemantic(e,i)}},getSemanticForSymbol:{value:function(e){return this.symbolToSemantic[e]}},setValueForSymbol:{value:function(e,i){var t=this.symbolToValue[e],a=this.getTypeForSymbol(e),s=WebGLRenderingContext.prototype;if(null!=i&&null!=t){if(a===s.FLOAT){if(i===t)return}else if(a===s.FLOAT_MAT4){if(16==i.length&&mat4.equal(t,i))return}else if(a===s.FLOAT_MAT3){if(9==i.length&&mat3.equal(t,i))return}else if(a===s.FLOAT_VEC3){if(3==i.length&&vec3.equal(t,i))return}else if(a===s.FLOAT_VEC4){if(4==i.length&&vec4.equal(t,i))return}else if(a===s.FLOAT_VEC2&&2==i.length&&vec4.equal(t,i))return}else a===s.FLOAT_MAT4?16===i.length&&(t=mat4.create()):a===s.FLOAT_MAT3?t=mat3.create():a===s.FLOAT_VEC3?t=vec3.create():a===s.FLOAT_VEC4?t=vec4.create():a===s.FLOAT_VEC2&&(t=vec2.create());null!==this.symbolToActiveInfo[e]&&-1===this.pendingCommits.indexOf(e)&&this.pendingCommits.push(e),null!=i&&(a===s.FLOAT_MAT4?16===i.length&&(i=mat4.set(i,t)):a===s.FLOAT_MAT3?i=mat3.set(i,t):a===s.FLOAT_VEC3?i=vec3.set(i,t):a===s.FLOAT_VEC4?i=vec4.set(i,t):a===s.FLOAT_VEC2&&(i=vec2.set(i,t))),this.symbolToValue[e]=i}},getValueForSymbol:{value:function(e){return this.symbolToValue[e]}},_commitSwitch:{value:function(){var e=WebGLRenderingContext.prototype,i=[];return i[e.FLOAT_MAT2]=function(e,i,t,a){e.uniformMatrix2fv(i,t,a)},i[e.FLOAT_MAT3]=function(e,i,t,a){e.uniformMatrix3fv(i,t,a)},i[e.FLOAT_MAT4]=function(e,i,t,a){e.uniformMatrix4fv(i,t,a)},i[e.FLOAT]=function(e,i,t,a){e.uniform1f(i,a)},i[e.FLOAT_VEC2]=function(e,i,t,a){e.uniform2fv(i,a)},i[e.FLOAT_VEC3]=function(e,i,t,a){e.uniform3fv(i,a)},i[e.FLOAT_VEC4]=function(e,i,t,a){e.uniform4fv(i,a)},i[e.INT]=function(e,i,t,a){e.uniform1i(i,a)},i[e.SAMPLER_2D]=function(e,i,t,a){e.uniform1i(i,a)},i[e.SAMPLER_CUBE]=function(e,i,t,a){e.uniform1i(i,a)},i}()},commit:{value:function(e){if(this.pendingCommits.length){for(var i,t=this.pendingCommits.length-1;i=this.pendingCommits[t--];)this._commitSwitch[this.getTypeForSymbol(i)](e,this.symbolToLocation[i],!1,this.getValueForSymbol(i));this.pendingCommits.length=0}}},use:{value:function(e,i){e.useProgram(this.GLProgram),i&&this.commit(e)}},createShaderWithSourceAndType:{value:function(e,i,t){var a;if("x-shader/x-fragment"===t)a=e.createShader(e.FRAGMENT_SHADER);else{if("x-shader/x-vertex"!==t)return null;a=e.createShader(e.VERTEX_SHADER)}return e.shaderSource(a,i),e.compileShader(a),e.getShaderParameter(a,e.COMPILE_STATUS)?a:(this.errorLogs=e.getShaderInfoLog(a),null)}},build:{value:function(e){var i,a,s=this.shaders[t.VERTEX_SHADER],u=this.shaders[t.FRAGMENT_SHADER],n=!1,r=this.createShaderWithSourceAndType(e,s,t.VERTEX_SHADER);if(null==r)return!1;var l=this.createShaderWithSourceAndType(e,u,t.FRAGMENT_SHADER);if(null==l)return!1;if(this.GLProgram=e.createProgram(),e.attachShader(this.GLProgram,r),e.attachShader(this.GLProgram,l),e.linkProgram(this.GLProgram),e.getProgramParameter(this.GLProgram,e.LINK_STATUS)){this.pendingCommits=[],this.symbolToActiveInfo={},this.symbolToValue={},this.symbolToLocation={},this.uniformSymbols=[],this.attributeSymbols=[],this.symbolToSemantic={},this.semanticToSymbol={};var o=e.getParameter(e.CURRENT_PROGRAM);e.useProgram(this.GLProgram);var c=e.getProgramParameter(this.GLProgram,e.ACTIVE_UNIFORMS);for(i=0;c>i;i++){a=e.getActiveUniform(this.GLProgram,i);var m=a.name,d=m.indexOf("[0]");-1!=d&&(m=m.substring(0,d)),this.symbolToActiveInfo[m]=a,this.symbolToLocation[m]=e.getUniformLocation(this.GLProgram,m),this.uniformSymbols.push(m)}var p=e.getProgramParameter(this.GLProgram,e.ACTIVE_ATTRIBUTES);for(i=0;p>i;i++)a=e.getActiveAttrib(this.GLProgram,i),this.symbolToActiveInfo[a.name]=a,this.symbolToLocation[a.name]=e.getAttribLocation(this.GLProgram,a.name),this.attributeSymbols.push(a.name);n=!0,e.useProgram(o)}return this.errorLogs=e.getProgramInfoLog(this.GLProgram),n}},initWithShaders:{value:function(e){this.shaders=e}},initWithProgram:{value:function(e){this.shaders=e.shaders,this.semanticToSymbol=e.semanticToSymbol,this.symbolToSemantic=e.symbolToSemantic}}})}}),montageDefine("4ab363f","url",{dependencies:["punycode","querystring"],factory:function(e,i){(function(){"use strict";function t(e,i,t){if(e&&"object"==typeof e&&e.href)return e;if("string"!=typeof e)throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var s={},u=e;u=u.trim();var o=l.exec(u);if(o){o=o[0];var c=o.toLowerCase();s.protocol=c,u=u.substr(o.length)}if(t||o||u.match(/^\/\/[^@\/]+@[^@\/]+/)){var m="//"===u.substr(0,2);!m||o&&q[o]||(u=u.substr(2),s.slashes=!0)}if(!q[o]&&(m||o&&!_[o])){var S=u.indexOf("@");if(-1!==S){for(var P=u.slice(0,S),C=!0,N=0,D=v.length;D>N;N++)if(-1!==P.indexOf(v[N])){C=!1;break}C&&(s.auth=decodeURIComponent(P),u=u.substr(S+1))}for(var M=-1,N=0,D=p.length;D>N;N++){var E=u.indexOf(p[N]);-1!==E&&(0>M||M>E)&&(M=E)}-1!==M?(s.host=u.substr(0,M),u=u.substr(M)):(s.host=u,u="");for(var A=n(s.host),w=Object.keys(A),N=0,D=w.length;D>N;N++){var x=w[N];s[x]=A[x]}s.hostname=s.hostname||"";var I="["===s.hostname[0]&&"]"===s.hostname[s.hostname.length-1];if(s.hostname.length>h)s.hostname="";else if(!I)for(var T=s.hostname.split(/\./),N=0,D=T.length;D>N;N++){var L=T[N];if(L&&!L.match(g)){for(var V="",j=0,O=L.length;O>j;j++)V+=L.charCodeAt(j)>127?"x":L[j];if(!V.match(g)){var F=T.slice(0,N),R=T.slice(N+1),k=L.match(f);k&&(F.push(k[1]),R.unshift(k[2])),R.length&&(u="/"+R.join(".")+u),s.hostname=F.join(".");break}}}if(s.hostname=s.hostname.toLowerCase(),!I){for(var U=s.hostname.split("."),z=[],N=0;U.length>N;++N){var B=U[N];z.push(B.match(/[^A-Za-z0-9_-]/)?"xn--"+r.encode(B):B)}s.hostname=z.join(".")}s.host=(s.hostname||"")+(s.port?":"+s.port:""),s.href+=s.host,I&&(s.hostname=s.hostname.substr(1,s.hostname.length-2),"/"!==u[0]&&(u="/"+u))}if(!b[c])for(var N=0,D=d.length;D>N;N++){var Q=d[N],G=encodeURIComponent(Q);G===Q&&(G=escape(Q)),u=u.split(Q).join(G)}var W=u.indexOf("#");-1!==W&&(s.hash=u.substr(W),u=u.slice(0,W));var H=u.indexOf("?");return-1!==H?(s.search=u.substr(H),s.query=u.substr(H+1),i&&(s.query=y.parse(s.query)),u=u.slice(0,H)):i&&(s.search="",s.query={}),u&&(s.pathname=u),_[o]&&s.hostname&&!s.pathname&&(s.pathname="/"),(s.pathname||s.search)&&(s.path=(s.pathname?s.pathname:"")+(s.search?s.search:"")),s.href=a(s),s}function a(e){"string"==typeof e&&(e=t(e));var i=e.auth||"";i&&(i=encodeURIComponent(i),i=i.replace(/%3A/i,":"),i+="@");var a=e.protocol||"",s=e.pathname||"",u=e.hash||"",n=!1,r="";void 0!==e.host?n=i+e.host:void 0!==e.hostname&&(n=i+(-1===e.hostname.indexOf(":")?e.hostname:"["+e.hostname+"]"),e.port&&(n+=":"+e.port)),e.query&&"object"==typeof e.query&&Object.keys(e.query).length&&(r=y.stringify(e.query));var l=e.search||r&&"?"+r||"";return a&&":"!==a.substr(-1)&&(a+=":"),e.slashes||(!a||_[a])&&n!==!1?(n="//"+(n||""),s&&"/"!==s.charAt(0)&&(s="/"+s)):n||(n=""),u&&"#"!==u.charAt(0)&&(u="#"+u),l&&"?"!==l.charAt(0)&&(l="?"+l),a+n+s+l+u}function s(e,i){return a(u(e,i))}function u(e,i){if(!e)return i;if(e=t(a(e),!1,!0),i=t(a(i),!1,!0),e.hash=i.hash,""===i.href)return e.href=a(e),e;if(i.slashes&&!i.protocol)return i.protocol=e.protocol,_[i.protocol]&&i.hostname&&!i.pathname&&(i.path=i.pathname="/"),i.href=a(i),i;if(i.protocol&&i.protocol!==e.protocol){if(!_[i.protocol])return i.href=a(i),i;if(e.protocol=i.protocol,!i.host&&!q[i.protocol]){for(var s=(i.pathname||"").split("/");s.length&&!(i.host=s.shift()););i.host||(i.host=""),i.hostname||(i.hostname=""),""!==s[0]&&s.unshift(""),2>s.length&&s.unshift(""),i.pathname=s.join("/")}return e.pathname=i.pathname,e.search=i.search,e.query=i.query,e.host=i.host||"",e.auth=i.auth,e.hostname=i.hostname||i.host,e.port=i.port,(void 0!==e.pathname||void 0!==e.search)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.slashes=e.slashes||i.slashes,e.href=a(e),e}var u=e.pathname&&"/"===e.pathname.charAt(0),n=void 0!==i.host||i.pathname&&"/"===i.pathname.charAt(0),r=n||u||e.host&&i.pathname,l=r,o=e.pathname&&e.pathname.split("/")||[],s=i.pathname&&i.pathname.split("/")||[],c=e.protocol&&!_[e.protocol];if(c&&(delete e.hostname,delete e.port,e.host&&(""===o[0]?o[0]=e.host:o.unshift(e.host)),delete e.host,i.protocol&&(delete i.hostname,delete i.port,i.host&&(""===s[0]?s[0]=i.host:s.unshift(i.host)),delete i.host),r=r&&(""===s[0]||""===o[0])),n)e.host=i.host||""===i.host?i.host:e.host,e.hostname=i.hostname||""===i.hostname?i.hostname:e.hostname,e.search=i.search,e.query=i.query,o=s;else if(s.length)o||(o=[]),o.pop(),o=o.concat(s),e.search=i.search,e.query=i.query;else if("search"in i){if(c){e.hostname=e.host=o.shift();var m=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;m&&(e.auth=m.shift(),e.host=e.hostname=m.shift())}return e.search=i.search,e.query=i.query,(void 0!==e.pathname||void 0!==e.search)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.href=a(e),e}if(!o.length)return delete e.pathname,e.search?delete e.path:e.path="/"+e.search,e.href=a(e),e;for(var d=o.slice(-1)[0],p=(e.host||i.host)&&("."===d||".."===d)||""===d,v=0,h=o.length;h>=0;h--)d=o[h],"."==d?o.splice(h,1):".."===d?(o.splice(h,1),v++):v&&(o.splice(h,1),v--);if(!r&&!l)for(;v--;v)o.unshift("..");!r||""===o[0]||o[0]&&"/"===o[0].charAt(0)||o.unshift(""),p&&"/"!==o.join("/").substr(-1)&&o.push("");var g=""===o[0]||o[0]&&"/"===o[0].charAt(0);if(c){e.hostname=e.host=g?"":o.length?o.shift():"";var m=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;m&&(e.auth=m.shift(),e.host=e.hostname=m.shift())}return r=r||e.host&&o.length,r&&!g&&o.unshift(""),e.pathname=o.join("/"),(void 0!==e.pathname||void 0!==e.search)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.auth=i.auth||e.auth,e.slashes=e.slashes||i.slashes,e.href=a(e),e}function n(e){var i={},t=o.exec(e);return t&&(t=t[0],":"!==t&&(i.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(i.hostname=e),i}var r=e("punycode");i.parse=t,i.resolve=s,i.resolveObject=u,i.format=a;var l=/^([a-z0-9.+-]+:)/i,o=/:[0-9]*$/,c=["<",">",'"',"`"," ","\r","\n","	"],m=["{","}","|","\\","^","~","`"].concat(c),d=["'"].concat(c),p=["%","/","?",";","#"].concat(m).concat(d),v=["/","@","?","#"].concat(c),h=255,g=/^[a-zA-Z0-9][a-z0-9A-Z_-]{0,62}$/,f=/^([a-zA-Z0-9][a-z0-9A-Z_-]{0,62})(.*)$/,b={javascript:!0,"javascript:":!0},q={javascript:!0,"javascript:":!0},_={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},y=e("querystring")})()}}),montageDefine("3d2b056","runtime/transform",{dependencies:["runtime/dependencies/gl-matrix","runtime/base","runtime/utilities"],factory:function(e,i){e("runtime/dependencies/gl-matrix");var t=e("runtime/base").Base,a=e("runtime/utilities").Utilities,s=i.Transform=Object.create(t,{_matrix:{value:null,writable:!0},_dirty:{value:!0,writable:!0},_dirtyTranslation:{value:!1,writable:!0},_dirtyRotation:{value:!1,writable:!0},_dirtyScale:{value:!1,writable:!0},_translation:{value:null,writable:!0},_orientation:{value:null,writable:!0},_rotation:{value:null,writable:!0},_scale:{value:null,writable:!0},_id:{value:0,writable:!0},_AXIS_ANGLE:{value:1,writable:!0},_QUATERNION:{value:2,writable:!0},_rotationMode:{value:1,writable:!0},_fireTransformDidUpdate:{value:function(){if(this._observers)for(var e=0;this._observers.length>e;e++)this._observers[e].transformDidUpdate(this)}},_updateDirtyFlag:{value:function(e){this._dirty=e,this._fireTransformDidUpdate()}},interpolateToTransform:{value:function(e,i,t){if(this._rebuildAffinesIfNeeded(),e._rebuildAffinesIfNeeded(),a.interpolateVec(this._translation,e._translation,i,t._translation),a.interpolateVec(this._scale,e._scale,i,t._scale),e._rotationMode===s._AXIS_ANGLE){var u=vec4.create();this._rotationMode==s._QUATERNION&&(this.rotation=vec4.createFrom(e._rotation[0],e._rotation[1],e._rotation[2],-this.rotation[3])),a.interpolateVec(this.rotation,e._rotation,i,u),t.rotation=u}else{var n=vec4.create();quat4.slerp(this.orientation,e.orientation,i,n),t.orientation=n}t._updateDirtyFlag(!0)}},matrix:{get:function(){return this._dirty&&(null==this._matrix&&(this._matrix=mat4.create()),null==this._intermediateMatrices&&(this._intermediateMatrices=[],this._intermediateMatrices.push(mat4.identity()),this._intermediateMatrices.push(mat4.identity()),this._intermediateMatrices.push(mat4.identity()),this._intermediateMatrices.push(mat4.identity())),mat4.identity(this._matrix),mat4.identity(this._intermediateMatrices[0]),mat4.set(this._intermediateMatrices[0],this._intermediateMatrices[1]),mat4.set(this._intermediateMatrices[0],this._intermediateMatrices[2]),mat4.set(this._intermediateMatrices[0],this._intermediateMatrices[3]),mat4.translate(this._intermediateMatrices[1],this._translation),mat4.scale(this._intermediateMatrices[2],this._scale),this._rotationMode===s._AXIS_ANGLE?(mat4.identity(this._intermediateMatrices[3]),mat4.rotate(this._intermediateMatrices[3],this._rotation[3],this._rotation)):quat4.toMat4(this._orientation,this._intermediateMatrices[3]),mat4.multiply(this._matrix,this._intermediateMatrices[1]),mat4.multiply(this._matrix,this._intermediateMatrices[2]),mat4.multiply(this._matrix,this._intermediateMatrices[3]),this._dirty=!1),this._matrix},set:function(e){null==this._matrix&&(this._matrix=mat4.create()),mat4.set(e,this._matrix),this._updateDirtyFlag(!1),this._dirtyTranslation=this._dirtyRotation=this._dirtyScale=!0,this._rotationMode=this._QUATERNION}},_rebuildAffinesIfNeeded:{value:function(){(this._dirtyTranslation||this._dirtyRotation||this._dirtyScale)&&(a.decomposeMat4(this.matrix,this._dirtyTranslation?this._translation:null,this._dirtyRotation?this._orientation:null,this._dirtyScale?this._scale:null),this._dirtyTranslation=this._dirtyRotation=this._dirtyScale=!1,this._rotationMode==s._AXIS_ANGLE?this.rotation=vec4.create(this.rotation):this.orientation=vec4.create(this.orientation))}},translation:{set:function(e){this._translation=e,this._dirtyTranslation=!1,this._updateDirtyFlag(!0)},get:function(){return this._dirtyTranslation&&this._rebuildAffinesIfNeeded(),this._translation}},orientation:{set:function(e){this._dirtyRotation=!1,this._rotationMode=s._QUATERNION,this._orientation=e,this._updateDirtyFlag(!0)},get:function(){return this._dirtyRotation&&this._rebuildAffinesIfNeeded(),this._rotationMode!==s._QUATERNION&&quat4.fromAngleAxis(this._rotation[3],this._rotation,this._orientation),this._orientation}},rotation:{set:function(e){this._dirtyRotation=!1,this._rotationMode=s._AXIS_ANGLE,this._rotation=e,this._updateDirtyFlag(!0)},get:function(){return this._dirtyRotation&&this._rebuildAffinesIfNeeded(),this._rotationMode!==s._AXIS_ANGLE&&quat4.toAngleAxis(this._orientation,this._rotation),this._rotation}},scale:{set:function(e){this._dirtyScale=!1,this._scale=e,this._updateDirtyFlag(!0)},get:function(){return this._dirtyScale&&this._rebuildAffinesIfNeeded(),this._scale}},_commonInit:{value:function(){this.translation=vec3.createFrom(0,0,0),this.rotation=vec4.createFrom(0,0,0,0),this.orientation=vec4.createFrom(0,0,0,0),this.scale=vec3.createFrom(1,1,1),this.matrix=mat4.identity(),this._id=s.bumpId()}},initWithDescription:{value:function(e){return this._commonInit(),e.matrix?this.matrix=mat4.create(e.matrix):e.translation||e.rotation||e.scale?(this.translation=e.translation?vec3.create(e.translation):vec3.createFrom(0,0,0),e.rotation?this.orientation=quat4.fromAngleAxis(e.rotation[3],vec3.createFrom(e.rotation[0],e.rotation[1],e.rotation[2])):e.orientation&&(this.orientation=quat4.create(e.orientation)),this.scale=e.scale?vec3.create(e.scale):vec3.createFrom(1,1,1)):this.matrix=mat4.identity(),this}},init:{value:function(){return this._commonInit(),this}},bumpId:{value:function(){return s._id++,s._id}},copy:{value:function(){var e=Object.create(s).init();return null!=this._translation&&(e.translation=vec3.create(this._translation)),null!=this._scale&&(e.scale=vec3.create(this._scale)),null!=this._orientation&&(e.orientation=quat4.create(this._orientation)),null!=this._rotation&&(e.rotation=vec4.create(this._rotation)),e.matrix=mat4.create(this.matrix),e}},_observers:{value:null,writable:!0},addObserver:{value:function(e){null==this._observers&&(this._observers=[]),-1===this._observers.indexOf(e)?this._observers.push(e):console.log("WARNING attempt to add 2 times the same observer in transform")}},removeObserver:{value:function(e){if(this._observers){var i=this._observers.indexOf(e);-1!==i&&this._observers.splice(i,1)}}}})}}),montageDefine("3d2b056","runtime/utilities",{dependencies:["runtime/dependencies/gl-matrix"],factory:function(e,t){e("runtime/dependencies/gl-matrix"),t.BBox=Object.create(Object.prototype,{_dirty:{value:!0,writable:!0},_size:{value:null,writable:!0},_min:{value:null,writable:!0},_max:{value:null,writable:!0},min:{get:function(){return this._min},set:function(e){this._min=e,this._dirty=!0}},max:{get:function(){return this._max},set:function(e){this._max=e,this._dirty=!0}},init:{value:function(e,i){return this.min=e,this.max=i,this}},size:{get:function(){if(this._dirty){var e=this.min,i=this.max;this._size=[i[0]-e[0],i[1]-e[1],i[2]-e[2]],this._dirty=!1}return this._size}},computeScaleFactor:{value:function(){var e=this.size,i=e[0]>e[1]?e[0]:e[1];return i=e[2]>i?e[2]:i,i=1/i}},computeUnitMatrix:{value:function(e){var i=this.size,t=this.min;null==e&&(e=[0,0,0]);var a=this.computeScaleFactor(),s=mat4.scale(mat4.identity(),[a,a,a]),u=vec3.createFrom(e[0]-(i[0]/2+t[0]),e[1]-(i[1]/2+t[1]),e[2]-(i[2]/2+t[2])),n=mat4.translate(s,[u[0],u[1],u[2]]);return n}}}),t.Utilities=Object.create(Object.prototype,{vec3Min:{value:function(e,i){i[0]<e[0]&&(e[0]=i[0]),i[1]<e[1]&&(e[1]=i[1]),i[2]<e[2]&&(e[2]=i[2])}},vec3Max:{value:function(e,i){i[0]>e[0]&&(e[0]=i[0]),i[1]>e[1]&&(e[1]=i[1]),i[2]>e[2]&&(e[2]=i[2])}},mergeBBox:{value:function(e,i){var t=e[0],a=e[1],s=i[0],u=i[1],n=[t[0]<s[0]?t[0]:s[0],t[1]<s[1]?t[1]:s[1],t[2]<s[2]?t[2]:s[2]],r=[a[0]>u[0]?a[0]:u[0],a[1]>u[1]?a[1]:u[1],a[2]>u[2]?a[2]:u[2]];return[n,r]}},computeBBOXFromVec3Array:{value:function(e){if(0===e.length)return null;for(var i=[e[0][0],e[0][1],e[0][2]],t=[e[0][0],e[0][1],e[0][2]],a=0;8>a;a++)e[a][0]<i[0]&&(i[0]=e[a][0]),e[a][1]<i[1]&&(i[1]=e[a][1]),e[a][2]<i[2]&&(i[2]=e[a][2]),e[a][0]>t[0]&&(t[0]=e[a][0]),e[a][1]>t[1]&&(t[1]=e[a][1]),e[a][2]>t[2]&&(t[2]=e[a][2]);return[i,t]}},transformBBox:{value:function(e,i){var t=e[0],a=e[1],s=0,u=1,n=2,r=mat4.multiplyVec3(i,vec3.createFrom(t[s],t[u],t[n])),l=mat4.multiplyVec3(i,vec3.createFrom(a[s],t[u],t[n])),o=mat4.multiplyVec3(i,vec3.createFrom(t[s],a[u],t[n])),c=mat4.multiplyVec3(i,vec3.createFrom(a[s],a[u],t[n])),m=mat4.multiplyVec3(i,vec3.createFrom(t[s],t[u],a[n])),d=mat4.multiplyVec3(i,vec3.createFrom(a[s],t[u],a[n])),p=mat4.multiplyVec3(i,vec3.createFrom(t[s],a[u],a[n])),v=mat4.multiplyVec3(i,vec3.createFrom(a[s],a[u],a[n]));return this.computeBBOXFromVec3Array([r,l,o,c,m,d,p,v])}},rayIntersectsMesh:{value:function(e,i,t,a,s){var u=i.verticesBuffer;if(null===u)return!1;var n=!1,r=i.primitives.length;vec3.create(),vec3.create(),vec3.create();for(var l=0;r>l;l++){var o=i.primitives[l];if(s){var c=s.materials;if(c&&-1==c.indexOf(o.material.name))continue}if(!(null!==o.material.inputs.transparency&&void 0!==o.material.inputs.transparency&&1>o.material.inputs.transparency)){var m=o.boundingBox;if(this.intersectsBBOX(m,e))return!0}}return n}},intersectsBBOX:{value:function(e,i){var t,a,s,u,n,r,l=0,o=1,c=2,m=i[1],d=i[0],p=e[0],v=e[1];return m[l]>=0?(t=(p[l]-d[l])/m[l],a=(v[l]-d[l])/m[l]):(t=(v[l]-d[l])/m[l],a=(p[l]-d[l])/m[l]),m[o]>=0?(s=(p[o]-d[o])/m[o],u=(v[o]-d[o])/m[o]):(s=(v[o]-d[o])/m[o],u=(p[o]-d[o])/m[o]),t>u||s>a?!1:(s>t&&(t=s),a>u&&(a=u),m[c]>=0?(n=(p[c]-d[c])/m[c],r=(v[c]-d[c])/m[c]):(n=(v[c]-d[c])/m[c],r=(p[c]-d[c])/m[c]),t>r||n>a?!1:(n>t&&(t=n),a>r&&(a=r),!0))}},inverpolateAxisAngle:{value:function(e,t,a,s){var u=0,n=1,r=2,l=n,o=e,c=t;if(l==u){vec3.normalize(o),vec3.normalize(c);var m=vec3.create();vec3.cross(o,c,m),Math.sqrt(vec3.dot(o,o)),Math.sqrt(vec3.dot(c,c));var d=Math.acos(vec3.dot(o,c)),p=mat4.identity();mat4.rotate(p,d*a,m),mat4.multiplyVec3(p,o,m),vec3.normalize(m);var v=o[3]+(c[3]-o[3])*a;quat4.fromAngleAxis(v,m,s)}else if(l==n){for(i=0;s.length>i;i++){var h=o[i],g=c[i];c[i]=h+(g-h)*a}quat4.fromAngleAxis(c[3],c,s)}else l==r&&quat4.slerp(e,t,a,s)}},interpolateVec:{value:function(e,t,a,s){for(i=0;s.length>i;i++){var u=e[i],n=t[i];s[i]=u+(n-u)*a}}},idx:{value:function(e,i){return 4*e+i}},decomposeMat4:{value:function(e,i,t,a){var s,u,n=mat4.create(),r=mat4.create();mat4.create(),mat4.create();var l=[vec3.create(),vec3.create(),vec3.create()];mat4.set(e,n);var o,c;for(s=0;4>s;s++)for(u=0;4>u;u++)o=this.idx(s,u),c=this.idx(3,3),n[o]/=n[c];for(mat4.set(n,r),s=0;3>s;s++)o=this.idx(s,3),r[o]=0;for(o=this.idx(3,3),r[o]=1,(0!=n[this.idx(0,3)]||0!=n[this.idx(1,3)]||0!=n[this.idx(2,3)])&&(n[this.idx(0,3)]=0,n[this.idx(1,3)]=0,n[this.idx(2,3)]=0,n[this.idx(3,3)]=1),i&&(i[0]=n[this.idx(3,0)],i[1]=n[this.idx(3,1)],i[2]=n[this.idx(3,2)]),n[this.idx(3,0)]=0,n[this.idx(3,1)]=0,n[this.idx(3,2)]=0,s=0;3>s;s++)l[s][0]=n[this.idx(s,0)],l[s][1]=n[this.idx(s,1)],l[s][2]=n[this.idx(s,2)];null!=a&&(a[0]=vec3.length(l[0]),a[1]=vec3.length(l[1]),a[2]=vec3.length(l[2])),vec3.normalize(l[0]),vec3.normalize(l[1]),vec3.normalize(l[2]);var m=vec3.create();if(vec3.cross(l[1],l[2],m),0>vec3.dot(l[0],m))for(s=0;3>s;s++)null!=a&&(a[s]*=-1),l[s][0]*=-1,l[s][1]*=-1,l[s][2]*=-1;null!=t&&(t[0]=.5*Math.sqrt(Math.max(1+l[0][0]-l[1][1]-l[2][2],0)),t[1]=.5*Math.sqrt(Math.max(1-l[0][0]+l[1][1]-l[2][2],0)),t[2]=.5*Math.sqrt(Math.max(1-l[0][0]-l[1][1]+l[2][2],0)),t[3]=.5*Math.sqrt(Math.max(1+l[0][0]+l[1][1]+l[2][2],0)),l[2][1]>l[1][2]&&(t[0]=-t[0]),l[0][2]>l[2][0]&&(t[1]=-t[1]),l[1][0]>l[0][1]&&(t[2]=-t[2]))}}})}}),montageDefine("3d2b056","runtime/node",{dependencies:["montage","runtime/component-3d","runtime/transform","runtime/animation","runtime/dependencies/gl-matrix"],factory:function(e,i){e("montage").Montage;var t=e("runtime/component-3d").Component3D,a=e("runtime/transform").Transform,s=e("runtime/animation").BasicAnimation;e("runtime/dependencies/gl-matrix"),i.Node=t.specialize({constructor:{value:function(){this.super(),this._hidden=!1,this._visibility="visible",this._offsetTransform=Object.create(a).init(),this.addOwnPropertyChangeListener("hidden",this),this.addOwnPropertyChangeListener("visibility",this),this.addOwnPropertyChangeListener("offsetTransform",this),this.addOwnPropertyChangeListener("originVector",this),this.addOwnPropertyChangeListener("glTFElement",this),this.addOwnPropertyChangeListener("transformOrigin",this),this.addOwnPropertyChangeListener("transformZOrigin",this),this.addOwnPropertyChangeListener("cursor",this)}},animationDidStart:{value:function(){}},animationDidStop:{value:function(){}},animationDidUpdate:{value:function(){}},handleGlTFElementChange:{value:function(){this.handleHiddenChange(),this.handleVisibilityChange(),this.handleOffsetTransformChange(),this.handleOriginVectorChange(),this.handleTransformOriginChange(),this.handleTransformZOriginChange(),this._applyCSSPropertyWithValueForState(this.__STYLE_DEFAULT__,"offsetTransform",this._offsetTransform)}},handleHiddenChange:{value:function(){null!=this.glTFElement&&(this.glTFElement.hidden=this._hidden,this.scene.dispatchEventNamed("materialUpdate",!0,!1,this))
}},handleVisibilityChange:{value:function(){null!=this.glTFElement&&(this.glTFElement.hidden=this.visibility?"hidden"===this.visibility:!1,this.scene.dispatchEventNamed("materialUpdate",!0,!1,this))}},offsetTransform_animationSetter:{set:function(e){this._offsetTransform=e,this.handleOffsetTransformChange()}},handleCursorChange:{value:function(){this.scene.dispatchEventNamed("cursorUpdate",!0,!1,this.cursor)}},handleTransformOriginChange:{value:function(){var e=this.transformOrigin;null==e&&(e=this.initialValueForStyleableProperty("transformOrigin")),this.originVector=vec3.createFrom(e[0],e[1],this.transformZOrigin)}},handleTransformZOriginChange:{value:function(){var e=this.transformOrigin;null==e&&(e=this.initialValueForStyleableProperty("transformOrigin")),this.originVector=vec3.createFrom(e[0],e[1],this.transformZOrigin)}},handleOffsetTransformChange:{value:function(){null!=this.glTFElement&&(this.glTFElement._offsetTransform=this._offsetTransform,this.scene.dispatchEventNamed("materialUpdate",!0,!1,this))}},handleOriginVectorChange:{value:function(){null!=this.glTFElement&&(this.glTFElement._originVector=this._originVector,this.scene.dispatchEventNamed("materialUpdate",!0,!1,this))}},_hidden:{value:!1,writable:!0},hidden:{set:function(e){this._hidden!=e&&(this.visibility=e===!0?"hidden":"visible",this._hidden=e)},get:function(){return this._hidden}},_visibility:{value:!1,writable:!0},visibility:{set:function(e){this._visibility=e},get:function(){return this._visibility}},_transform:{value:null,writable:!0},transform:{set:function(e){this._transform=e},get:function(){return this._transform}},_offsetTransform:{value:null,writable:!0},offsetTransform:{set:function(e){if(this.glTFElement){var i=this.scene.glTFElement.animationManager;if(i.removeAnimationWithTargetAndPath(this,"offsetTransform_animationSetter"),this._style&&this._style.transitions){var t=this._style.transitions.offsetTransform;if(null!=t&&t.duration>0){this._offsetTransform.matrix=this._offsetTransform.matrix,fromTr=this._offsetTransform,toTr=e;var a=Object.create(s).init();return a.path="offsetTransform_animationSetter",a.target=this,a.delegate=this,a.from=fromTr,a.to=toTr,a.duration=1e3*t.duration,i.playAnimation(a),a.animationWasAddedToTarget(),i.evaluateAtTime(Date.now()),void 0}}}this._offsetTransform=e},get:function(){return this._offsetTransform}},_originVector:{value:null,writable:!0},originVector:{set:function(e){this._originVector=e},get:function(){return this._originVector}},_transformOrigin:{value:null,writable:!0},transformOrigin:{set:function(e){this._transformOrigin=e},get:function(){return this._transformOrigin}},_transformZOrigin:{value:50,writable:!0},transformZOrigin:{set:function(e){this._transformZOrigin=e},get:function(){return this._transformZOrigin}},_observers:{value:null,writable:!0},addObserver:{value:function(e){null==this._observers&&(this._observers=[]),-1===this._observers.indexOf(e)?this._observers.push(e):console.log("WARNING attempt to add 2 times the same observer in glTFNode")}},removeObserver:{value:function(e){if(this._observers){var i=this._observers.indexOf(e);-1!==i&&this._observers.splice(i,1)}}},_stylableProperties:{value:["visibility","offsetTransform","transformOrigin","transformZOrigin","cursor"]},styleableProperties:{get:function(){return this._stylableProperties}},initialValueForStyleableProperty:{value:function(e){return"visibility"===e?"visible":"offsetTransform"===e?Object.create(a).init():"originVector"===e?vec3.createFrom(50,50,50):"offsetMatrix"===e?mat4.identity():"transformOrigin"===e?vec2.createFrom(50,50):"transformZOrigin"===e?50:"cursor"===e?"auto":void 0}}})}}),montageDefine("4676c7d","lib/parse",{dependencies:["./CSSStyleSheet","./CSSStyleRule","./CSSImportRule","./CSSMediaRule","./CSSFontFaceRule","./CSSStyleDeclaration","./CSSKeyframeRule","./CSSKeyframesRule","./CSSValueExpression","./CSSDocumentRule"],factory:function(e,i){var t={};t.parse=function(e){for(var i,a,s,u,n,r,l,o,c,m,d=0,p="before-selector",v="",h={selector:!0,value:!0,atRule:!0,"importRule-begin":!0,importRule:!0,atBlock:!0,"documentRule-begin":!0},g=new t.CSSStyleSheet,f=g,b="",q=/@(-(?:\w+-)+)?keyframes/g,_=function(i){var t=e.substring(0,d).split("\n"),a=t.length,s=t.pop().length+1,u=Error(i+" (line "+a+", char "+s+")");throw u.line=a,u.char=s,u.styleSheet=g,u};m=e.charAt(d);d++)switch(m){case" ":case"	":case"\r":case"\n":case"\f":h[p]&&(v+=m);break;case'"':i=d+1;do i=e.indexOf('"',i)+1,i||_('Unmatched "');while("\\"===e[i-2]);switch(v+=e.slice(d,i),d=i-1,p){case"before-value":p="value";break;case"importRule-begin":p="importRule"}break;case"'":i=d+1;do i=e.indexOf("'",i)+1,i||_("Unmatched '");while("\\"===e[i-2]);switch(v+=e.slice(d,i),d=i-1,p){case"before-value":p="value";break;case"importRule-begin":p="importRule"}break;case"/":"*"===e.charAt(d+1)?(d+=2,i=e.indexOf("*/",d),-1===i?_("Missing */"):d=i+1):v+=m,"importRule-begin"===p&&(v+=" ",p="importRule");break;case"@":if(e.indexOf("@-moz-document",d)===d){p="documentRule-begin",c=new t.CSSDocumentRule,c.__starts=d,d+="-moz-document".length,v="";break}if(e.indexOf("@media",d)===d){p="atBlock",n=new t.CSSMediaRule,n.__starts=d,d+="media".length,v="";break}if(e.indexOf("@import",d)===d){p="importRule-begin",d+="import".length,v+="@import";break}if(e.indexOf("@font-face",d)===d){p="fontFaceRule-begin",d+="font-face".length,l=new t.CSSFontFaceRule,l.__starts=d,v="";break}q.lastIndex=d;var y=q.exec(e);if(y&&y.index===d){p="keyframesRule-begin",o=new t.CSSKeyframesRule,o.__starts=d,o._vendorPrefix=y[1],d+=y[0].length-1,v="";break}"selector"==p&&(p="atRule"),v+=m;break;case"{":"selector"===p||"atRule"===p?(u.selectorText=v.trim(),u.style.__starts=d,v="",p="before-name"):"atBlock"===p?(n.media.mediaText=v.trim(),f=a=n,n.parentStyleSheet=g,v="",p="before-selector"):"fontFaceRule-begin"===p?(a&&(l.parentRule=a),l.parentStyleSheet=g,u=l,v="",p="before-name"):"keyframesRule-begin"===p?(o.name=v.trim(),a&&(o.parentRule=a),o.parentStyleSheet=g,f=a=o,v="",p="keyframeRule-begin"):"keyframeRule-begin"===p?(u=new t.CSSKeyframeRule,u.keyText=v.trim(),u.__starts=d,v="",p="before-name"):"documentRule-begin"===p&&(c.matcher.matcherText=v.trim(),a&&(c.parentRule=a),f=a=c,c.parentStyleSheet=g,v="",p="before-selector");break;case":":"name"===p?(s=v.trim(),v="",p="before-value"):v+=m;break;case"(":if("value"===p)if("expression"==v.trim()){var S=new t.CSSValueExpression(e,d).parse();S.error?_(S.error):(v+=S.expression,d=S.idx)}else i=e.indexOf(")",d+1),-1===i&&_('Unmatched "("'),v+=e.slice(d,i+1),d=i;else v+=m;break;case"!":"value"===p&&e.indexOf("!important",d)===d?(b="important",d+="important".length):v+=m;break;case";":switch(p){case"value":u.style.setProperty(s,v.trim(),b),b="",v="",p="before-name";break;case"atRule":v="",p="before-selector";break;case"importRule":r=new t.CSSImportRule,r.parentStyleSheet=r.styleSheet.parentStyleSheet=g,r.cssText=v+m,g.cssRules.push(r),v="",p="before-selector";break;default:v+=m}break;case"}":switch(p){case"value":u.style.setProperty(s,v.trim(),b),b="";case"before-name":case"name":u.__ends=d+1,a&&(u.parentRule=a),u.parentStyleSheet=g,f.cssRules.push(u),v="",p=f.constructor===t.CSSKeyframesRule?"keyframeRule-begin":"before-selector";break;case"keyframeRule-begin":case"before-selector":case"selector":a||_("Unexpected }"),f.__ends=d+1,g.cssRules.push(f),f=g,a=null,v="",p="before-selector"}break;default:switch(p){case"before-selector":p="selector",u=new t.CSSStyleRule,u.__starts=d;break;case"before-name":p="name";break;case"before-value":p="value";break;case"importRule-begin":p="importRule"}v+=m}return g},i.parse=t.parse,t.CSSStyleSheet=e("./CSSStyleSheet").CSSStyleSheet,t.CSSStyleRule=e("./CSSStyleRule").CSSStyleRule,t.CSSImportRule=e("./CSSImportRule").CSSImportRule,t.CSSMediaRule=e("./CSSMediaRule").CSSMediaRule,t.CSSFontFaceRule=e("./CSSFontFaceRule").CSSFontFaceRule,t.CSSStyleDeclaration=e("./CSSStyleDeclaration").CSSStyleDeclaration,t.CSSKeyframeRule=e("./CSSKeyframeRule").CSSKeyframeRule,t.CSSKeyframesRule=e("./CSSKeyframesRule").CSSKeyframesRule,t.CSSValueExpression=e("./CSSValueExpression").CSSValueExpression,t.CSSDocumentRule=e("./CSSDocumentRule").CSSDocumentRule}}),montageDefine("3d2b056","runtime/scene-renderer",{dependencies:["runtime/dependencies/gl-matrix","runtime/technique","runtime/pass","runtime/builtin-assets","runtime/dependencies/o3dgc"],factory:function(e,i){e("runtime/dependencies/gl-matrix");var t=e("runtime/technique").Technique,a=e("runtime/pass").ScenePass,s=e("runtime/builtin-assets").BuiltInAssets,u=e("runtime/dependencies/o3dgc").o3dgc;i.SceneRenderer=Object.create(Object.prototype,{loadPickingTechnique:{value:function(){var e=this,i=s.assetWithName("pickingTechnique");i.then(function(i){e.technique.rootPass.scenePassRenderer.pickingTechnique=i},function(){},function(){})}},createTechniqueIfNeeded:{value:function(){if(!this._technique){this._technique=Object.create(t).init();var e=Object.create(a).init();this._technique.passes={defaultPass:e}}}},_webGLRenderer:{value:null,writable:!0},_technique:{value:null,writable:!0},technique:{get:function(){return this._technique},set:function(e){this._technique=e}},compressedMeshDelegate:{value:{str2ab:function(e){for(var i=new ArrayBuffer(e.length),t=new Uint8Array(i),a=0,s=e.length;s>a;a++)t[a]=e.charCodeAt(a);return i},decode:function(e,i){if(e){if(i)var t=new u.BinaryStream(this.str2ab(e));else var t=new u.BinaryStream(e);var a=new u.SC3DMCDecoder,s=new u.Timer,n=new u.IndexedFaceSet;s.Tic(),a.DecodeHeader(n,t),s.Toc(),console.log("DecodeHeader time (ms) "+s.GetElapsedTime());var r=12*n.GetNCoord()+12*n.GetNNormal(),l=new ArrayBuffer(r),o=new ArrayBuffer(6*n.GetNCoordIndex()),c=0;n.GetNCoordIndex()>0&&n.SetCoordIndex(new Uint16Array(o,0,3*n.GetNCoordIndex())),n.GetNCoord()>0&&(n.SetCoord(new Float32Array(l,c,3*n.GetNCoord())),c+=12*n.GetNCoord()),n.GetNNormal()>0&&(n.SetNormal(new Float32Array(l,c,3*n.GetNNormal())),c+=12*n.GetNNormal());for(var m=n.GetNumFloatAttributes(),d=0;m>d;++d)n.GetNFloatAttribute(d)>0&&n.SetFloatAttribute(d,new Float32Array(n.GetFloatAttributeDim(d)*n.GetNFloatAttribute(d)));return s.Tic(),a.DecodePlayload(n,t),s.Toc(),n}},handleError:function(e,i){console.log("ERROR:vertexAttributeBufferDelegate:"+e+" :"+i)},decompressAttribsInner_:function(e,i,t,a,s,u,n,r){for(var l=0,o=i;t>o;o++){var c=e.charCodeAt(o);l+=c>>1^-(1&c),a[s]=r*(l+n),s+=u}},decompressIndices_:function(e,i,t,a,s){for(var u=0,n=0;t>n;n++){var r=e.charCodeAt(i++);a[s++]=u-r,0==r&&u++}},decompressMesh:function(e,i,t,a){for(var s=t.decodeScales.length,u=t.decodeOffsets,n=t.decodeScales,r=i.attribRange[0],l=i.attribRange[1],o=r,c=new Float32Array(s*l),m=0;s>m;m++){var d=o+l,p=n[m];p&&this.decompressAttribsInner_(e,o,d,c,m,s,u[m],p),o=d}i.indexRange[0];var v=3*i.indexRange[1],h=new Uint16Array(v);this.decompressIndices_(e,o,v,h,0),a(c,h,null,i)},convert:function(e,i,t){var a=t.mesh.compression;if("won-compression"==a.type){var s=a.indexRange;s&&(s[0]+3*s[1],this.decompressMesh(i,a,a,function(e,i){t.renderer.setupCompressedMesh(t.mesh,e,i)}))}else{var u=0;if(t.mesh,a.compressedData){var n=a.compressedData;u=n.verticesCount;var r=this.decode(i,"ascii"===n.mode),l=r.GetCoordIndex(),o=r.GetCoord(),c=r.GetNNormal()>0?r.GetNormal():null;t.renderer.setupCompressedMesh2(t.mesh,u,o,c,r,n.floatAttributesIndexes,l)}}return i},resourceAvailable:function(){}}},scene:{get:function(){return this.technique.rootPass.scene},set:function(e){var i=this,t=this.technique.rootPass.scene;t!=e&&(this.technique.rootPass.scene=e,this.scene.rootNode.apply(function(e){e.meshes&&e.meshes.forEach(function(e){if(e.compression){var t="text";e.compression.compressedData.mode&&"binary"==e.compression.compressedData.mode&&(t="arraybuffer"),e.compression.compressedData.requestType=t,i.webGLRenderer.resourceManager.getResource(e.compression.compressedData,i.compressedMeshDelegate,{mesh:e,renderer:i.webGLRenderer})}},this)},!0,null))}},webGLRenderer:{get:function(){return this._webGLRenderer},set:function(e){this._webGLRenderer=e}},init:{value:function(e){return this.webGLRenderer=e,this.createTechniqueIfNeeded(),this.loadPickingTechnique(),this}},render:{value:function(e,i){this.technique&&this.technique.execute(this.webGLRenderer,e,i)}}})}}),montageDefine("47be41b","ui/beachplanet.reel/beachplanet",{dependencies:["montage/ui/component"],factory:function(e,i){var t=e("montage/ui/component").Component;i.Beachplanet=t.specialize({MAX_SCORE:{value:4},audios:{value:null},backgroundMusicEnabled:{value:!0},dolphinLogoFound:{value:!1},rockRevealed:{value:!1},doorOpen:{value:!1},starRevealed:{value:!1},_score:{value:0},score:{get:function(){return this._score},set:function(e){this.score!==e&&(this._score=e,this.scoreDidChange())}},scoreDidChange:{value:function(){if(this.playSound("assets/sound/getruby.mp3"),this.score===this.MAX_SCORE){var e=this;return setTimeout(function(){e.gameWon()},3e3),void 0}this.returnExploringPlanet()}},playSound:{value:function(e,i){null==this.audios&&(this.audios={});var t=this.audios[e];null==t?(t=new Audio(e),this.audios[e]=t,i===!0&&(t.loop="loop"),t.addEventListener("canplay",function(){t.play()},!1)):(t.currentTime=0,t.play())}},templateDidLoad:{value:function(){this.templateObjects.sceneView.play(),this.backgroundMusicEnabled&&this.playSound("assets/sound/WhiteSands.mp3",!0),this.animateDolphins()}},prepareForPlay:{value:function(){this.playSound("assets/sound/getruby.mp3"),this.dolphinLogoFound=!1,this.score=0,this.templateObjects.sceneView.stop(),this.templateObjects.sceneView.viewPoint=this.templateObjects.planetVP}},handlePlayButtonAction:{value:function(){this.classList.remove("isIntro"),this.classList.add("isPlaying"),this.prepareForPlay()}},handlePlayAgainButtonAction:{value:function(){this.classList.remove("isWinner"),this.classList.add("isPlaying"),this.prepareForPlay()}},handleNavItemAction:{value:function(e){this.cancelPendingReturnToExploring(),this.templateObjects.sceneView.stop(),this.templateObjects.sceneView.viewPoint=e.target.viewPoint,this.templateObjects.sceneView.allowsViewPointControl=e.target.viewPoint===this.templateObjects.planetVP}},gameWon:{value:function(){this.playSound("assets/sound/getruby.mp3"),this.classList.add("isWinner"),this.classList.remove("isPlaying"),this.templateObjects.sceneView.viewPoint=this.templateObjects.cameraRideViewPoint,this.templateObjects.sceneView.play(),this.starRevealed=this.doorOpen=this.rockRevealed=!1}},_exploringTimeout:{value:null},cancelPendingReturnToExploring:{value:function(){null!=this._exploringTimeout&&(clearTimeout(this._exploringTimeout),this._exploringTimeout=null)}},returnExploringPlanet:{value:function(){if(this.score<this.MAX_SCORE){var e=this;this.cancelPendingReturnToExploring(),this._exploringTimeout=setTimeout(function(){e._exploringTimeout=null,e.templateObjects.sceneView.viewPoint=e.templateObjects.planetVP,e.templateObjects.sceneView.allowsViewPointControl=!0},4e3)}}},checkAndApplyGameActionIfNeeded:{value:function(e,i){this[e]===!1&&(this.templateObjects.sceneView.viewPoint=i,this[e]=!0,this.score++)}},handleRockAction:{value:function(){this.checkAndApplyGameActionIfNeeded("rockRevealed",this.templateObjects.rockLogoVP)}},handleDoorAction:{value:function(){this.checkAndApplyGameActionIfNeeded("doorOpen",this.templateObjects.cabinLogoVP)}},handleStarAction:{value:function(){this.checkAndApplyGameActionIfNeeded("starRevealed",this.templateObjects.starLogoVP)}},handleLogoDolphinAction:{value:function(){this.checkAndApplyGameActionIfNeeded("dolphinLogoFound",this.templateObjects.dolphinsVP)}},animateDolphins:{value:function(){this.templateObjects.logoDolphin.classList.remove("BeachPlanet-dolphin-logo-jump"),this.templateObjects.dolphin.classList.remove("BeachPlanet-dolphin-jump"),this.templateObjects.dolphin2.classList.remove("BeachPlanet-dolphin-jump"),this.dolphinLogoFound===!1&&this.templateObjects.logoDolphin.classList.add("BeachPlanet-dolphin-logo-jump"),this.templateObjects.dolphin.classList.add("BeachPlanet-dolphin-jump"),this.templateObjects.dolphin2.classList.add("BeachPlanet-dolphin-jump");var e=this;setTimeout(function(){e.animateDolphins()},4e3)}}})}}),montageDefine("3d2b056","controllers/camera-controller",{dependencies:["runtime/dependencies/gl-matrix","runtime/utilities","runtime/transform","montage"],factory:function(e,i){e("runtime/dependencies/gl-matrix"),e("runtime/utilities").Utilities;var t=e("runtime/transform").Transform,a=e("montage").Montage;i.CameraController=a.specialize({constructor:{value:function(){this.super(),this._lastPosition=[0,0]}},_deltaForEvent:{value:function(e){return null!=e.wheelDeltaY?e.wheelDeltaY:-e.deltaY}},_minimalDistance:{value:0,writable:!0},_computeInitialDistance:{value:function(){if(this.sceneBBox){var e=this.sceneBBox,i=vec3.createFrom((e[1][0]-e[0][0])/2,(e[1][1]-e[0][1])/2,(e[1][2]-e[0][2])/2),t=vec3.length(i),a=[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2,(e[0][2]+e[1][2])/2],s=vec3.create(this.viewPoint.glTFElement.transform.translation),u=vec3.create();u[0]=a[0]-s[0],u[1]=a[1]-s[1],u[2]=a[2]-s[2];var n=vec3.length(u);this._minimalDistance=t>n?n:t,this.zoomStep=1e-4*t}}},viewPointDidChange:{value:function(){this._computeInitialDistance()}},_viewPoint:{value:null,writable:!0},viewPoint:{get:function(){return this._viewPoint},set:function(e){this._viewPoint!=e&&(this._viewPoint=e,this.viewPointDidChange())}},_node:{value:null,writable:!0},zoomStep:{value:0,writable:!0},sceneBBox:{value:null,writable:!0},nodeDidChange:{value:function(){var e=this.node.glTFElement;this.sceneBBox=e.getBoundingBox(!0),this._computeInitialDistance()}},node:{get:function(){return this._node},set:function(e){this._node!=e&&(this._node=e,this.nodeDidChange())}},_lastPosition:{value:null,writable:!0},_transform:{value:null,writable:!0},_axisUp:{value:null,writable:!0},zoom:{value:function(e){if(!this.moving){var i,t=vec3.create(),a=vec3.create(this.viewPoint.glTFElement.transform.translation);this.node.glTFElement;var s=this.sceneBBox;i=[(s[0][0]+s[1][0])/2,(s[0][1]+s[1][1])/2,(s[0][2]+s[1][2])/2],t[0]=i[0]-a[0],t[1]=i[1]-a[1],t[2]=i[2]-a[2],vec3.normalize(t);var u=this._deltaForEvent(e),n=this.zoomStep*u;a[0]+=n*t[0],a[1]+=n*t[1],a[2]+=n*t[2];var r=vec3.create();r[0]=i[0]-a[0],r[1]=i[1]-a[1],r[2]=i[2]-a[2];var l=vec3.length(r);if(l>this._minimalDistance)this.viewPoint.glTFElement.transform.translation=a;else{var o=u>0?-this._minimalDistance:this._minimalDistance;a[0]=i[0]+t[0]*o,a[1]=i[1]+t[1]*o,a[2]=i[2]+t[2]*o,this.viewPoint.glTFElement.transform.translation=a}}}},translate:{value:function(e){if(this._transform.matrix=this.viewPoint.glTFElement.worldMatrix,0!=this.moving){var i=e.translateX-this._lastPosition[0],t=e.translateY-this._lastPosition[1];this._lastPosition[0]=e.translateX,this._lastPosition[1]=e.translateY,i*=.05,t*=-.05,this._axisUp=vec3.createFrom(0,1,0),mat4.rotateVec3(this._transform.matrix,this._axisUp);var a,s=!1;if(0==s){this.node.glTFElement;var u=this.sceneBBox;a=[(u[0][0]+u[1][0])/2,(u[0][1]+u[1][1])/2,(u[0][2]+u[1][2])/2]}var n=vec3.create(),r=vec3.create(this._transform.translation);n[0]=a[0]-r[0],n[1]=a[1]-r[1],n[2]=a[2]-r[2];var l=vec3.create(this._axisUp),o=vec3.create();vec3.normalize(n),vec3.cross(n,this._axisUp,o),vec3.normalize(o),vec3.cross(n,o,l),vec3.normalize(l);var c=mat4.identity(),m=0;m=Math.abs(t)>Math.abs(i)?Math.abs(t)/Math.abs(i):Math.abs(i)/Math.abs(t),m>.5?(mat4.rotate(c,i,l),mat4.rotate(c,t,o)):Math.abs(t)>Math.abs(i)?mat4.rotate(c,t,o):mat4.rotate(c,i,l),r[0]-=a[0],r[1]-=a[1],r[2]-=a[2],mat4.rotateVec3(c,r),r[0]+=a[0],r[1]+=a[1],r[2]+=a[2];var d=mat4.identity();mat4.multiply3(c,this._transform.matrix,d);var p=mat4.identity();mat4.translate(p,r);var v=mat4.identity();mat4.multiply(p,d,v),this.viewPoint.glTFElement.transform.matrix=v}}},beginTranslate:{value:function(){this.moving=!0,null==this._transform&&(this._transform=Object.create(t).init()),this._transform.matrix=this.viewPoint.glTFElement.worldMatrix}},endTranslate:{value:function(){this.moving=!1,this._axisUp=null}}})}}),montageDefine("3d2b056","runtime/scene",{dependencies:["montage","runtime/node","montage/core/uuid","runtime/runtime-tf-loader","url","runtime/scene-resource-loader","q","montage/core/target","cssom"],factory:function(e,i){var t=e("montage").Montage,a=e("runtime/node").Node,s=e("montage/core/uuid"),u=e("runtime/runtime-tf-loader").RuntimeTFLoader,n=e("url"),r=e("runtime/scene-resource-loader").SceneResourceLoader,l=e("q"),o=e("montage/core/target").Target,c=e("cssom");i.Scene=o.specialize({constructor:{value:function(){this.super()}},_resourcesLoaded:{value:!1,writable:!0},_glTFElement:{value:null,writable:!0},shouldBeHitTested:{value:!1,writable:!0},glTFElement:{get:function(){return this._glTFElement},set:function(e){this._glTFElement=e}},_rootNode:{value:null,writable:!0},rootNode:{get:function(){return"loaded"===this.status&&null==this._rootNode&&(this._rootNode=t.create(a),this._rootNode.scene=this,this._rootNode.id=this.glTFElement.rootNode.id),this._rootNode}},sceneResourcesDidPrepare:{value:function(){this._resourcesLoaded||(this._prepareToRenderDefer&&this._prepareToRenderDefer.resolve(),this._resourcesLoaded=!0,this.dispatchEventNamed("resourcesDidLoad",!0,!1,this),this.status="loaded")}},isLoaded:{value:function(){return"loaded"==this.status}},status:{value:0,writable:!0},styleSheetsLoaded:{value:!1,writable:!0},styleSheets:{value:null,writable:!0},loadCSSStyles:{value:function(){if(null!=document.styleSheets){var i,t,a=Object.keys(e.packages),s=0,u=document.styleSheets.length,n=[];for(this.styleSheets={},i=0;u>i;i++)t=document.styleSheets[i],null!=t.href?-1!=t.href.indexOf(a[0])&&-1==t.href.indexOf(a[0]+"node_modules")&&n.push(t):t.ownerNode&&t.ownerNode.innerText&&this._addStyleSheets(t.ownerNode.innerText);return u=n.length,0===u?(this.styleSheetsLoaded=!0,void 0):(n.forEach(function(e){var i=this,t=e.href,a=new XMLHttpRequest;a.open("GET",t,!0),a.onreadystatechange=function(){4==a.readyState&&200==a.status&&(i._addStyleSheets(a.responseText,e.href),s++,s===u&&i.dispatchEventNamed("styleSheetsDidLoad",!0,!1,i))},a.send(null)},this),!1)}}},_addStyleSheets:{value:function(e,i){i||(i=s.generate()),this.styleSheets[i]=c.parse(e)}},deserializedFromTemplate:{value:function(e,i,t){this._ownerDocumentPart=t}},_pendingLoading:{value:!1},_loadScene:{value:function(){var i={};if(i.loadCompleted=function(e){this.totalBufferSize=r.totalBufferSize,this.glTFElement=e,this.status="loaded",console.log("scene loaded:"+this._path)}.bind(this),null!=this._path){var t=this._path,a=n.parse(t);if("/"===t[0])t=t.substr(1),t=n.resolve(e.packages[0],t);else if(!a.scheme){if(null==this._ownerDocumentPart)return;var s=this._ownerDocumentPart.template.getBaseUrl();t=n.resolve(s,t)}var r=Object.create(u);this.status="loading",r.initWithPath(t),r.delegate=i,r.load(null,null)}1==this._pendingLoading&&(this.removePathChangeListener("_ownerDocumentPart",this),this._pendingLoading=!1)}},path:{set:function(e){if((!e||-1!==e.indexOf(".json"))&&e!==this._path)if(this._path=e,null==e)this.scene=null;else{var i=e.length>0&&"/"===e[0];0==i&&null==this._ownerDocumentPart?0==this._pendingLoading&&(this.addPathChangeListener("_ownerDocumentPart",this,"_loadScene"),this._pendingLoading=!0):this._loadScene()}},get:function(){return this._path}},_prepareToRenderDefer:{value:null,writable:!0},prepareToRender:{value:function(e){if(null==this._prepareToRenderDefer){this._prepareToRenderDefer=l.defer();var i=Object.create(r).init(this.glTFElement,e,this);i.loadScene()}return this._prepareToRenderDefer.promise}},init:{value:function(e){return e&&(this.glTFElement=e,this.status="loaded"),this}},blueprintModuleId:e("montage")._blueprintModuleIdDescriptor,blueprint:e("montage")._blueprintDescriptor})}}),montageDefine("d41c331","ui/base/abstract-button",{dependencies:["./abstract-control","../../composer/press-composer"],factory:function(e,i){var t=e("./abstract-control").AbstractControl,a=e("../../composer/press-composer").PressComposer,s=i.AbstractButton=t.specialize({constructor:{value:function s(){if(this.constructor===s)throw Error("AbstractButton cannot be instantiated.");this.super(),this._pressComposer=new a,this.addComposer(this._pressComposer),this._pressComposer.defineBinding("longPressThreshold ",{"<-":"holdThreshold",source:this}),this.defineBinding("classList.has('montage--disabled')",{"<-":"!enabled"}),this.defineBinding("classList.has('montage--active')",{"<-":"active"})}},enabled:{value:!0},_preventFocus:{value:!1},preventFocus:{get:function(){return this._preventFocus},set:function(e){this._preventFocus=!!e,this.needsDraw=!0}},acceptsActiveTarget:{value:function(){return!this._preventFocus}},willBecomeActiveTarget:{value:function(){}},_labelNode:{value:void 0,enumerable:!1},_label:{value:void 0,enumerable:!1},label:{get:function(){return this._label},set:function(e){if(void 0!==e&&this.converter)try{e=this.converter.convert(e),this.error&&(this.error=null)}catch(i){this.error=i}this._label=""+e,this.needsDraw=!0}},holdThreshold:{value:1e3},_pressComposer:{value:null},_active:{value:!1},active:{get:function(){return this._active},set:function(e){this._active=e,this.needsDraw=!0}},prepareForActivationEvents:{value:function(){this._pressComposer.addEventListener("pressStart",this,!1),this._pressComposer.addEventListener("press",this,!1),this._pressComposer.addEventListener("pressCancel",this,!1)}},addEventListener:{value:function(e,i,a){t.addEventListener.call(this,e,i,a),"longAction"===e&&this._pressComposer.addEventListener("longPress",this,!1)}},handlePressStart:{value:function(e){this.active=!0,e.touch&&document.addEventListener("touchmove",this,!1),this._preventFocus||this._element.focus()}},handlePress:{value:function(){this.active=!1,this.dispatchActionEvent(),document.removeEventListener("touchmove",this,!1)}},handleKeyup:{value:function(e){32===e.keyCode&&(this.active=!1,this.dispatchActionEvent())}},handleLongPress:{value:function(){this._pressComposer.cancelPress();var e=document.createEvent("CustomEvent");e.initCustomEvent("longAction",!0,!0,null),this.dispatchEvent(e)}},handlePressCancel:{value:function(){this.active=!1,document.removeEventListener("touchmove",this,!1)}},handleTouchmove:{value:function(e){e.preventDefault()}},isInputElement:{value:!1},enterDocument:{value:function(e){e&&(this.isInputElement="INPUT"===this.originalElement.tagName,this.isInputElement?void 0===this._label&&(this.label=this.originalElement.value):(this.originalElement.firstChild||this.originalElement.appendChild(document.createTextNode("")),this._labelNode=this.originalElement.firstChild,void 0===this._label&&(this.label=this._labelNode.data)),this.element.setAttribute("role","button"),this.element.addEventListener("keyup",this,!1))}},_drawLabel:{enumerable:!1,value:function(e){this.isInputElement?this._element.value=e:this._labelNode&&(this._labelNode.data=e)}},draw:{value:function(){this._elementNeedsTabIndex()&&(this._preventFocus?this.element.removeAttribute("tabindex"):this.element.setAttribute("tabindex","-1")),this.isInputElement&&(this.element.disabled=!this.enabled),this._drawLabel(this.label)}},_elementNeedsTabIndexRegex:{value:/INPUT|TEXTAREA|A|SELECT|BUTTON|LABEL/},_elementNeedsTabIndex:{value:function(){return null===this.element.tagName.match(this._elementNeedsTabIndexRegex)}}})}}),montageDefine("3d2b056","runtime/material",{dependencies:["montage","runtime/component-3d","runtime/animation"],factory:function(e,i){e("montage").Montage;var t=e("runtime/component-3d").Component3D,a=e("runtime/animation").BasicAnimation;i.Material=t.specialize({constructor:{value:function(){this.super(),this.addRangeAtPathChangeListener("filterColor",this,"handleFilterColorChange"),this.addOwnPropertyChangeListener("glTFElement",this),this.addOwnPropertyChangeListener("image",this),this.addOwnPropertyChangeListener("opacity",this)}},filterColor:{value:[1,1,1,1]},_originalOpacity:{value:1,writable:!0},handleGlTFElementChange:{value:function(){this.handleFilterColorChange(),this.handleImageChange(),this._originalOpacity=this._opacity,null==this._opacity?null!=this.glTFElement.parameters.transparency&&(this._originalOpacity=this._opacity=this.glTFElement.parameters.transparency.value):this.handleOpacityChange()}},initialValueForStyleableProperty:{value:function(e){return"opacity"==e?this._originalOpacity:void 0}},handleFilterColorChange:{value:function(){null!=this.glTFElement&&this.glTFElement.parameters.filterColor&&(this.glTFElement.parameters.filterColor.value=this.filterColor,this.scene&&this.scene.dispatchEventNamed("materialUpdate",!0,!1,this))}},handleOpacityChange:{value:function(){null!=this.glTFElement&&this.glTFElement.parameters.transparency&&(this.glTFElement.parameters.transparency.value=this._opacity,this.scene&&this.scene.dispatchEventNamed("materialUpdate",!0,!1,this))}},handleImageChange:{value:function(){if(null!=this.glTFElement&&this.glTFElement.parameters.diffuse&&this._image){var e=this.resolvePathIfNeeded(this._image),i=this.parameterForImagePath(e);this.glTFElement.parameters.diffuse=i,this.scene&&this.scene.dispatchEventNamed("textureUpdate",!0,!1,i)}}},parameterForImagePath:{value:function(e){var i=WebGLRenderingContext.prototype,t={magFilter:i.LINEAR,minFilter:i.LINEAR,type:"sampler",wrapS:i.REPEAT,wrapT:i.REPEAT},a={id:"source-"+e,type:"image",baseId:"source-"+e,description:{path:e}},s={baseId:"texture-"+e,id:"texture-"+e,format:i.RGBA,internalFormat:i.RGBA,sampler:t,source:a,type:"texture",target:i.TEXTURE_2D},u={parameter:"diffuse",value:s};return u}},_image:{value:null,writable:!0},image:{set:function(e){if(e&&0!=e.length){var i=e.toLowerCase();(-1!=i.indexOf(".jpg")||-1!=i.indexOf(".jpeg")||-1!=i.indexOf(".png"))&&this._image!=e&&(this._image=e)}},get:function(){return this._image}},_opacity:{value:null,writable:!0},animationDidStart:{value:function(){}},animationDidStop:{value:function(){}},animationDidUpdate:{value:function(){}},opacity_animationSetter:{set:function(e){this._opacity!=e&&(this._opacity=e,this.handleOpacityChange())}},opacity:{set:function(e){if(this._opacity!=e){if(this.glTFElement){var i=this.scene.glTFElement.animationManager;if(i.removeAnimationWithTargetAndPath(this,"opacity_animationSetter"),this._style&&this._style.transitions){var t=this._style.transitions.opacity;if(null!=t&&t.duration>0){var s=Object.create(a).init();return s.path="opacity_animationSetter",s.target=this,s.delegate=this,s.from=Number(this._opacity),s.to=Number(e),s.duration=1e3*t.duration,i.playAnimation(s),s.animationWasAddedToTarget(),i.evaluateAtTime(Date.now()),void 0}}}this._opacity=e}},get:function(){return this._opacity}},_stylableProperties:{value:["opacity"]},styleableProperties:{get:function(){return this._stylableProperties}}})}}),montageDefine("3d2b056","runtime/animation-manager",{dependencies:["runtime/dependencies/gl-matrix","runtime/base","runtime/animation"],factory:function(e,i){e("runtime/dependencies/gl-matrix");var t=e("runtime/base").Base;e("runtime/animation").KeyframeAnimation,e("runtime/animation").BasicAnimation;var a=e("runtime/animation").Animation;i.AnimationManager=Object.create(t,{startTime:{get:function(){if(this.animations){if(this.animations.length>0){for(var e=this.animations[0].startTime,i=1;this.animations.length>i;i++)e>this.animations[i].startTime&&(e=this.animations[i].startTime);return e}return 0}}},endTime:{get:function(){if(this.animations){if(this.animations.length>0){for(var e=this.animations[0].endTime,i=1;this.animations.length>i;i++)this.animations[i].endTime>e&&(e=this.animations[i].endTime);return e}return-1}}},_animations:{value:null,writable:!0},animations:{get:function(){return this._animations},set:function(e){this._animations!=e&&(this._animations=e)}},_sceneTime:{value:0,writable:!0},sceneTime:{get:function(){return this._sceneTime},set:function(e){this._delegate&&this._delegate.sceneTimeWillChange&&this._delegate.sceneTimeWillChange(this,e),this._sceneTime=e,this._delegate&&this._delegate.sceneTimeDidChange&&this._delegate.sceneTimeDidChange(this)
}},_delegate:{value:0,writable:!0},delegate:{get:function(){return this._delegate},set:function(e){this._delegate=e}},targets:{get:function(){var e=[];return null!=this._animations&&this._animations.forEach(function(i){i.type==a.KEYFRAME?i.channels.forEach(function(i){e.push(i.target.id)},this):i.type==a.BASIC},this),e}},hasAnimation:{value:function(e,i){return null==this._animations?!1:(null==i&&(i=this.targets),-1!==i.indexOf(e))}},nodeHasAnimatedAncestor:{value:function(e){do{if(this.hasAnimation(e.id))return!0;e=e.parent}while(null!=e);return!1}},updateTargetsAtTime:{value:function(e,i){this.animations&&this.animations.forEach(function(t){t.type==a.KEYFRAME?t.updateTargetsAtTime(e,i):t.type==a.BASIC},this)}},evaluateAtTime:{value:function(e){this._activeAnimations&&this._activeAnimations.forEach(function(i){i.type==a.KEYFRAME||i.type==a.BASIC&&i._evaluateAtTime(e)},this)}},hasActiveAnimations:{value:function(){return this._activeAnimations.length>0}},_activeAnimations:{value:0,writable:!0},_removeAnimationAtIndex:{value:function(e){var i=this._activeAnimations[e];i.delegate&&i.delegate.animationDidStop(i),this._activeAnimations.splice(e,1)}},playAnimation:{value:function(e){var i=this;this._activeAnimations.push(e),e.delegate&&e.delegate.animationDidStart(e),setTimeout(function(){var t=i._activeAnimations.indexOf(e);-1!==t&&i._removeAnimationAtIndex(t)},e.duration)}},init:{value:function(){return this.__Base_init(),this.animations=[],this._activeAnimations=[],this}},removeAnimationWithTargetAndPath:{value:function(e,i){if(this._activeAnimations)for(var t=0;this._activeAnimations.length>t;t++){var a=this._activeAnimations[t];if(a.target===e&&a.path==i)return this._removeAnimationAtIndex(t),void 0}}}})}}),montageDefine("3d2b056","runtime/projection",{dependencies:["runtime/dependencies/gl-matrix","runtime/base"],factory:function(e,i){e("runtime/dependencies/gl-matrix");var t=e("runtime/base").Base;i.Projection=Object.create(t,{_matrix:{value:null,writable:!0},_type:{value:null,writable:!0},_xfov:{value:0,writable:!0},_yfov:{value:0,writable:!0},_xmag:{value:0,writable:!0},_ymag:{value:0,writable:!0},_znear:{value:0,writable:!0},_zfar:{value:0,writable:!0},_aspectRatio:{value:0,writable:!0},_dirtyFlag:{value:!1,writable:!0},projection:{get:function(){return this._type},set:function(e){this._type!==e&&(this._type=e,this._dirtyFlag=!0)}},xfov:{get:function(){return this._xfov},set:function(e){this._xfov!==e&&(this._xfov=e,this._dirtyFlag=!0)}},yfov:{get:function(){return this._yfov},set:function(e){this._yfov!==e&&(this._yfov=e,this._dirtyFlag=!0)}},xmag:{get:function(){return this._xmag},set:function(e){this._xmag!==e&&(this._xmag=e,this._dirtyFlag=!0)}},ymag:{get:function(){return this._ymag},set:function(e){this._ymag!==e&&(this._ymag=e,this._dirtyFlag=!0)}},znear:{get:function(){return this._znear},set:function(e){this._znear!==e&&(this._znear=e,this._dirtyFlag=!0)}},zfar:{get:function(){return this._zfar},set:function(e){this._zfar!==e&&(this._zfar=e,this._dirtyFlag=!0)}},aspectRatio:{get:function(){return this._aspectRatio},set:function(e){var i=this.matrix;i&&(this.yfov?i[0]=this._scaleX/e:this.xfov&&(i[5]=this._scaleY*e)),this._aspectRatio=e}},_scaleX:{value:0,writable:!0},_scaleY:{value:0,writable:!0},matrix:{get:function(){if(this._dirtyFlag){if("perspective"===this.projection){var e=3.14159265359/360,i=0,t=0;this.yfov&&(t=1/Math.tan(this.yfov*e)),i=this.xfov?1/Math.tan(this.xfov*e):t,0==t&&(t=i),this._scaleX=i,this._scaleY=t,this._matrix=mat4.create(),this._matrix[0]=i,this._matrix[1]=0,this._matrix[2]=0,this._matrix[3]=0,this._matrix[4]=0,this._matrix[5]=t,this._matrix[6]=0,this._matrix[7]=0,this._matrix[8]=0,this._matrix[9]=0,this._matrix[10]=(this.zfar+this.znear)/(this.znear-this.zfar),this._matrix[11]=-1,this._matrix[12]=0,this._matrix[13]=0,this._matrix[14]=2*this.zfar*this.znear/(this.znear-this.zfar),this._matrix[15]=0}else"orthographic"===this.projection?this._matrix=mat4.ortho(-this.xmag,this.xmag,-this.ymag,this.ymag,this.znear,this.zfar):console.log("WARNING: unhandled camera type:"+type);this._dirtyFlag=!1}return this._matrix},set:function(e){this._matrix=e}},initWithDescription:{value:function(e){this.__Base_init(),this.projection=e.type,e=e[this.projection],this.xfov=e.xfov?e.xfov:0,this.yfov=e.yfov?e.yfov:0,this.xmag=e.xmag?e.xmag:1,this.ymag=e.ymag?e.ymag:1,this.znear=null!=e.znear?e.znear:1,this.zfar=null!=e.zfar?e.zfar:100,this.aspectRatio=e.aspect_ratio?e.aspect_ratio:0,this.aspectRatio||(this.aspectRatio=e.aspectRatio?e.aspectRatio:0),this._dirtyFlag=!0}},init:{value:function(){this.__Base_init(),this.projection=null,this.xfov=0,this.yfov=0,this.xmag=1,this.ymag=1,this.znear=1,this.zfar=100,this.aspectRatio=4/3,this._dirtyFlag=!0}}})}}),montageDefine("d41c331","ui/substitution.reel/substitution",{dependencies:["../slot.reel","../../core/promise","../../core/logger"],factory:function(e,i){var t=e("../slot.reel").Slot,a=e("../../core/promise").Promise;e("../../core/logger").logger("substitution"),i.Substitution=t.specialize({hasTemplate:{enumerable:!1,value:!1},constructor:{value:function(){this._switchElements=Object.create(null),this._switchComponentTreeLoaded=Object.create(null)}},_allChildComponents:{value:null},deserializedFromTemplate:{value:function(){this._allChildComponents=this.childComponents.slice(0),this.switchValue&&this._loadSwitchComponentTree(this.switchValue)}},_switchElements:{value:null},_switchComponentTreeLoaded:{value:null},addSwitchElement:{value:function(e,i){if(i.parentNode)throw Error("Can't handle elements inside the DOM.");this._switchElements[e]=i,this._findFringeComponents(i,this._allChildComponents)}},_findFringeComponents:{value:function(e,i){var t;if(i=i||[],e.component)i.push(e.component);else{t=e.children;for(var a,s=0;a=t[s];s++)this._findFringeComponents(a,i)}return i}},_drawnSwitchValue:{value:null},_switchValue:{value:null},switchValue:{get:function(){return this._switchValue},set:function(e){this._switchValue===e||this._isSwitchingContent||(this._switchValue=e,this._firstDraw||this.isDeserializing||this._loadContent(e))}},enterDocument:{value:function(e){var i;if(t.enterDocument.apply(this,arguments),e){i=this.getDomArgumentNames();for(var a,s=0;a=i[s];s++)this._switchElements[a]=this.extractDomArgument(a);this._loadContent(this.switchValue),this._updateComponentDom()}}},_loadContent:{value:function(e){this.content=e===this._drawnSwitchValue?this.element.children[0]:this._switchElements[e]||null,this._switchComponentTreeLoaded[e]||this._loadSwitchComponentTree(e)}},contentDidChange:{value:function(e,i){this.super(),this._drawnSwitchValue&&(this._switchElements[this._drawnSwitchValue]=i),this._drawnSwitchValue=this._switchValue}},_loadSwitchComponentTree:{value:function(e){var i,t,s=this,u=this._allChildComponents,n=this._switchElements[e],r=this.element,l=this.canDrawGate,o=[];n||(n=this._getSubstitutionDomArgument(e));for(var c=0;u.length>c;c++){for(i=u[c],t=i.element;t!==n&&t!==r&&t.parentNode;)t=t.parentNode;t===n&&o.push(i.loadComponentTree())}o.length>0?(l.setField(e+"ComponentTreeLoaded",!1),a.all(o).then(function(){s._switchComponentTreeLoaded[e]=!0,l.setField(e+"ComponentTreeLoaded",!0),s._canDraw=!0,s.needsDraw=!0}).done()):(this._switchComponentTreeLoaded[e]=!0,this.needsDraw=!0)}},_getSubstitutionDomArgument:{value:function(e){var i,t,a,s,u,n,r=this._ownerDocumentPart.template;a=this.element,i=a.querySelectorAll("*["+this.DOM_ARG_ATTRIBUTE+"='"+e+"']");e:for(var l,o=0;l=i[o];o++){for(t=l;(t=t.parentNode)!==a;)if(s=r.getElementId(t),s&&(u=r.getSerialization(),n=u.getSerializationLabelsWithElements(s),n.length>0))continue e;return l}}},shouldLoadComponentTree:{value:!1},transition:{value:null}})}}),montageDefine("845cab0","punycode",{dependencies:[],factory:function(e,i,t){(function(e){function a(e){throw RangeError(x[e])}function s(e,i){for(var t=e.length;t--;)e[t]=i(e[t]);return e}function u(e,i){var t=".";return s(e.split(t),i).join(t)}function n(e){for(var i,t,s=[],u=0,n=e.length;n>u;)i=e.charCodeAt(u++),55296==(63488&i)&&(t=e.charCodeAt(u++),(55296!=(64512&i)||56320!=(64512&t))&&a("ucs2decode"),i=((1023&i)<<10)+(1023&t)+65536),s.push(i);return s}function r(e){return s(e,function(e){var i="";return 55296==(63488&e)&&a("ucs2encode"),e>65535&&(e-=65536,i+=L(55296|1023&e>>>10),e=56320|1023&e),i+=L(e)}).join("")}function l(e){return 10>e-48?e-22:26>e-65?e-65:26>e-97?e-97:y}function o(e,i){return e+22+75*(26>e)-((0!=i)<<5)}function c(e,i,t){var a=0;for(e=t?T(e/N):e>>1,e+=T(e/i);e>I*P>>1;a+=y)e=T(e/I);return T(a+(I+1)*e/(e+C))}function m(e){var i,t,s,u,n,o,m,d,p,v,h=[],g=e.length,f=0,b=M,q=D;for(t=e.lastIndexOf(E),0>t&&(t=0),s=0;t>s;++s)e.charCodeAt(s)>=128&&a("not-basic"),h.push(e.charCodeAt(s));for(u=t>0?t+1:0;g>u;){for(n=f,o=1,m=y;u>=g&&a("invalid-input"),d=l(e.charCodeAt(u++)),(d>=y||d>T((_-f)/o))&&a("overflow"),f+=d*o,p=q>=m?S:m>=q+P?P:m-q,!(p>d);m+=y)v=y-p,o>T(_/v)&&a("overflow"),o*=v;i=h.length+1,q=c(f-n,i,0==n),T(f/i)>_-b&&a("overflow"),b+=T(f/i),f%=i,h.splice(f++,0,b)}return r(h)}function d(e){var i,t,s,u,r,l,m,d,p,v,h,g,f,b,q,C=[];for(e=n(e),g=e.length,i=M,t=0,r=D,l=0;g>l;++l)h=e[l],128>h&&C.push(L(h));for(s=u=C.length,u&&C.push(E);g>s;){for(m=_,l=0;g>l;++l)h=e[l],h>=i&&m>h&&(m=h);for(f=s+1,m-i>T((_-t)/f)&&a("overflow"),t+=(m-i)*f,i=m,l=0;g>l;++l)if(h=e[l],i>h&&++t>_&&a("overflow"),h==i){for(d=t,p=y;v=r>=p?S:p>=r+P?P:p-r,!(v>d);p+=y)q=d-v,b=y-v,C.push(L(o(v+q%b,0))),d=T(q/b);C.push(L(o(d,0))),r=c(t,f,s==u),t=0,++s}++t,++i}return C.join("")}function p(e){return u(e,function(e){return w.test(e)?m(e.slice(4).toLowerCase()):e})}function v(e){return u(e,function(e){return A.test(e)?"xn--"+d(e):e})}var h,g,f="function"==typeof define&&"object"==typeof define.amd&&define.amd&&define,b="object"==typeof i&&i,q="object"==typeof t&&t,_=2147483647,y=36,S=1,P=26,C=38,N=700,D=72,M=128,E="-",A=/[^ -~]/,w=/^xn--/,x={overflow:"Overflow: input needs wider integers to process.",ucs2decode:"UCS-2(decode): illegal sequence",ucs2encode:"UCS-2(encode): illegal value","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},I=y-S,T=Math.floor,L=String.fromCharCode;if(h={version:"1.0.0",ucs2:{decode:n,encode:r},decode:m,encode:d,toASCII:v,toUnicode:p},b)if(q&&q.exports==b)q.exports=h;else for(g in h)h.hasOwnProperty(g)&&(b[g]=h[g]);else f?define("punycode",h):e.punycode=h})(this)}}),montageDefine("3d2b056","runtime/mesh-resource-loader",{dependencies:["runtime/resource-loader"],factory:function(e,i){var t=e("runtime/resource-loader").ResourceLoader;i.MeshResourceLoader=Object.create(t,{meshes:{value:null,writable:!0},fireMeshesDidLoadIfNeeded:{value:function(){var e=Object.keys(this._trackedIds);e&&0==e.length&&this.delegate&&this.delegate.meshesDidLoad&&this.delegate.meshesDidLoad(this.meshes)}},resourceAvailable:{value:function(e){this._removeTrackedId(e),this.fireMeshesDidLoadIfNeeded()}},_fetchResources:{value:function(e,i){var t=this.webGLRenderer.webGLContext,a=Object.keys(i);a.forEach(function(a){var s=this.webGLRenderer.resourceManager.getResource(i[a],e,t);null==s&&this._addTrackedId(a)},this)}},_fetchAllResources:{value:function(e){this.webGLRenderer.webGLContext,this._fetchResources(this.webGLRenderer.vertexAttributeBufferDelegate,e.vertexBuffers,!0),this._fetchResources(this.webGLRenderer.indicesDelegate,e.allIndices),this._fetchResources(this.webGLRenderer.textureDelegate,e.textures),this._fetchResources(this.webGLRenderer.programDelegate,e.programs),this.fireMeshesDidLoadIfNeeded()}},_trackProgramsFromMaterial:{value:function(e,i){var t=e.technique;if(t)for(var a in t.passes){var s=t.passes[a],u=s.instanceProgram;u&&(i[u.program.id]=u.program,this._addTrackedId(u.program.id))}}},_trackTexturesFromMaterial:{value:function(e,i){var t=e.parameters;if(t){var a=Object.keys(t);a.length>0&&a.forEach(function(e){var a=t[e];if(a&&a.value){var s=a.value;"texture"===s.type&&(i[s.id]=s,this._addTrackedId(s.id))}},this)}}},_trackIndicesFromPrimitive:{value:function(e,i){var t=e.indices;i[t.id]=t,this._addTrackedId(t.id)}},_trackVertexBuffersFromPrimitive:{value:function(e,i){for(var t in e.semantics){var a=e.semantics[t];i[a.id]=a,this._addTrackedId(a.id)}}},_trackMesh:{value:function(e,i){e.primitives.forEach(function(e){this._trackTexturesFromMaterial(e.material,i.textures),this._trackIndicesFromPrimitive(e,i.allIndices),this._trackVertexBuffersFromPrimitive(e,i.vertexBuffers),this._trackProgramsFromMaterial(e.material,i.programs)},this)}},_trackMeshes:{value:function(e){this.meshes.forEach(function(i){this._trackMesh(i,e,this.webGLRenderer)},this)}},loadMeshes:{value:function(){var e={};e.textures={},e.allIndices={},e.vertexBuffers={},e.programs={},this._trackMeshes(e),this._fetchAllResources(e,this.webGLRenderer)}},init:{value:function(e,i,t){return this.delegate=t,this.webGLRenderer=i,this.meshes=e,i.resourceManager.observers.push(this),this}}})}}),montageDefine("3d2b056","runtime/scene-helper",{dependencies:["runtime/dependencies/gl-matrix","montage","montage/core/uuid","runtime/glTF-scene","runtime/glTF-node","runtime/scene","runtime/node","runtime/scene-renderer","runtime/glTF-material","runtime/utilities","runtime/projection","runtime/camera","collections/set","runtime/material"],factory:function(e,i){e("runtime/dependencies/gl-matrix");var t=e("montage").Montage,a=e("montage/core/uuid").Uuid;e("runtime/glTF-scene").glTFScene;var s=e("runtime/glTF-node").glTFNode;e("runtime/scene").Scene;var u=e("runtime/node").Node;e("runtime/scene-renderer").SceneRenderer,e("runtime/glTF-material").glTFMaterial,e("runtime/utilities").Utilities;var n=e("runtime/projection").Projection,r=e("runtime/camera").Camera;e("runtime/utilities").BBox;var l=e("collections/set"),o=e("runtime/material").Material,c=i.SceneHelper=Object.create(Object.prototype,{getGLTFViewPoints:{value:function(e){var i=[],t=e.glTFElement.rootNode;return t.apply(function(e){return e.cameras&&e.cameras.length&&(i=i.concat(e)),null},!0,null),i}},getViewPoints:{value:function(e){var i=this.getGLTFViewPoints(e),a=[];return i.forEach(function(i){var s=t.create(u);s.scene=e,s.id=i.baseId,a.push(s)},this),a}},createGLTFNodeIncludingCamera:{value:function(e){var i=Object.create(n);i.initWithDescription({type:"perspective",perspective:{yfov:45,aspectRatio:1,znear:.1,zfar:100}});var t=Object.create(r).init();t.projection=i;var u=Object.create(s).init();return t.name=u.name=e,u.id=a.generate(),u.baseId=u.id,u.cameras.push(t),u}},createNodeIncludingCamera:{value:function(e,i){var a=c.createGLTFNodeIncludingCamera(e),s=i.glTFElement;s.ids[a.baseId]=a;var n=t.create(u);return n.scene=i,n.id=a.baseId,n}},getMaterialsFromNode:{value:function(e){var i=e.glTFElement,a=new l,s=e.scene;return null!=i.meshes&&i.meshes.forEach(function(e){e.primitives&&e.primitives.forEach(function(e){var i,u=e.material;null==u.component3D?(i=t.create(o),i.scene=s,i.id=u.baseId,s.glTFElement.ids[u.baseId]=u,u.component3D=i):i=u.component3D,a.add(i)},this)},this),a}},createNodeFromGlTFElementIfNeeded:{value:function(e,i){if(null!=e.component3D)return e.component3D;var t=new u;return i.glTFElement.ids[e.baseId]=e,t.scene=i,t.id=e.baseId,e.component3D=t,t}},getGLTFCamera:{value:function(e){var i=null;if(e.glTFElement){var t=e.glTFElement;null!=t.cameras&&t.cameras.length>0&&(i=t.cameras[0])}return i}}})}}),montageDefine("3d2b056","runtime/transform-helper",{dependencies:["runtime/dependencies/gl-matrix","runtime/base","runtime/utilities"],factory:function(e,i){e("runtime/dependencies/gl-matrix"),e("runtime/base").Base,e("runtime/utilities").Utilities,i.TransformHelper=Object.create(Object.prototype,{_viewMatrix:{value:null,writable:!0},_worldViewMatrix:{value:null,writable:!0},_worldViewInverseTransposeMatrix:{value:null,writable:!0},_worldViewInverseMatrix:{value:null,writable:!0},_dirty:{value:!0,writable:!0},_id:{value:0,writable:!0},transformWillChange:{value:function(){this._dirty=!0}},transformDidChange:{value:function(){}},_node:{value:null,writable:!0},node:{set:function(e){this._node!=e&&(this._node&&this._node.transform.removeObserver(this),this._node=e,this._node&&this._node.transform.addObserver(this),this._dirty=!0)},get:function(){return this._node}},_viewMatrix:{value:null,writable:!0},viewMatrix:{set:function(e){this._viewMatrix=e,this._dirty=!0},get:function(){return this._viewMatrix}},transformDidUpdate:{value:function(){this._dirty=!0}},updateMatricesIfNeeded:{value:function(){this._dirty&&(mat4.multiply(this._viewMatrix,this._node.worldMatrix,this._worldViewMatrix),mat4.toInverseMat3(this._worldViewMatrix,this._worldViewInverseTransposeMatrix),mat3.transpose(this._worldViewInverseTransposeMatrix),mat4.inverse(this._worldViewMatrix,this._worldViewInverseMatrix),this._dirty=!1)}},worldViewMatrix:{get:function(){return this._dirty&&this.updateMatricesIfNeeded(),this._worldViewMatrix}},worldViewInverseTransposeMatrix:{get:function(){return this._dirty&&this.updateMatricesIfNeeded(),this._worldViewInverseTransposeMatrix}},worldViewInverseMatrix:{get:function(){return this._dirty&&this.updateMatricesIfNeeded(),this._worldViewInverseMatrix}},init:{value:function(){return this._viewMatrix=mat4.identity(),this._worldViewMatrix=mat4.identity(),this._worldViewInverseTransposeMatrix=mat3.identity(),this._worldViewInverseMatrix=mat4.identity(),this}}})}}),montageDefine("3d2b056","runtime/skin",{dependencies:["runtime/dependencies/gl-matrix","runtime/base","runtime/transform","runtime/utilities"],factory:function(e,i){e("runtime/dependencies/gl-matrix"),e("runtime/base").Base,e("runtime/transform").Transform,e("runtime/utilities").Utilities,i.Skin=Object.create(Object.prototype,{jointsIds:{value:null,writable:!0},nodesForSkeleton:{value:null,writable:!0},bindShapeMatrix:{value:null,writable:!0},inverseBindMatricesDescription:{value:null,writable:!0},matricesForSkeleton:{value:null,writable:!0},sources:{value:null,writable:!0},init:{value:function(){return this.jointsIds=[],this.nodesForSkeleton={},this.matricesForSkeleton={},this.sources=[],this}},inverseBindMatricesDelegate:{value:{handleError:function(e,i){console.log("ERROR:vertexAttributeBufferDelegate:"+e+" :"+i)},convert:function(e,i){return new Float32Array(i)},resourceAvailable:function(){}}},process:{value:function(e,i){var t=e.instanceSkin.skeletons,a=mat4.create();mat4.inverse(e.worldMatrix,a),t.forEach(function(e){var t=this.nodesForSkeleton[e],s=this.matricesForSkeleton[e];if(!s){var u=16*this.jointsIds.length;s=new Float32Array(u),this.matricesForSkeleton[e]=s;for(var n=mat4.identity(),r=0;u>r;r++)s[r]=n[r%16]}var l=i.getResource(this.inverseBindMatricesDescription,this.inverseBindMatricesDelegate);l&&this.sources.forEach(function(e){for(var i=e,u=this.bindShapeMatrix,n=this.jointsIds.length,r=mat4.create(),o=0;n>o;o++){for(var c=0;16>c;c++)r[c]=l[16*o+c];var m=t[o].worldMatrix,d=mat4.identity();mat4.multiply(d,a),mat4.multiply(d,m),mat4.multiply(d,r),mat4.multiply(d,u);for(var c=0;16>c;c++)s[16*o+c]=d[c]}i.primitives.forEach(function(e){e.material.parameters&&(e.material.parameters.jointMat.value=s)},this)},this)},this)}}})}}),montageDefine("3d2b056","runtime/node-wrapper",{dependencies:["runtime/dependencies/gl-matrix","runtime/utilities","runtime/transform-helper"],factory:function(e,i){e("runtime/dependencies/gl-matrix"),e("runtime/utilities").Utilities;var t=e("runtime/transform-helper").TransformHelper;i.NodeWrapper=Object.create(Object.prototype,{_transformHelper:{value:null,writable:!0},node:{get:function(){return this._transformHelper.node}},init:{value:function(e){return this._transformHelper=Object.create(t).init(),this._transformHelper.node=e,this}},viewPointWillChange:{value:function(){}},viewPointDidChange:{value:function(){this._transformHelper.viewPoint=this._scenePassRenderer.viewPoint}},viewPointMatrixDidUpdate:{value:function(){this._transformHelper.transformDidUpdate()}},scenePassRenderer:{get:function(){return this._scenePassRenderer},set:function(e){this._scenePassRenderer!=e&&(this._scenePassRenderer&&this._scenePassRenderer.removeObserver(this),this._scenePassRenderer=e,this._transformHelper.viewMatrix=e._viewPointMatrix,this._scenePassRenderer&&this._scenePassRenderer.addObserver(this))}},worldMatrix:{get:function(){return this.node.worldMatrix}},worldViewMatrix:{get:function(){return this._transformHelper.worldViewMatrix}},viewMatrix:{get:function(){return this._transformHelper.viewMatrix}},worldViewInverseMatrix:{get:function(){return this._transformHelper.worldViewInverseMatrix}},worldViewInverseTransposeMatrix:{get:function(){return this._transformHelper.worldViewInverseTransposeMatrix}}})}}),montageDefine("3d2b056","runtime/mesh",{dependencies:["runtime/dependencies/gl-matrix","runtime/base","runtime/utilities"],factory:function(e,i){e("runtime/dependencies/gl-matrix");var t=e("runtime/base").Base,a=e("runtime/utilities").Utilities;i.Mesh=Object.create(t,{PRIMITIVES:{value:"primitives"},_primitives:{value:null,writable:!0},primitives:{enumerable:!0,get:function(){return this._primitives},set:function(e){this._primitives=e}},step:{value:0,writable:!0},loadedPrimitivesCount:{value:0,writable:!0},loaded:{get:function(){return this.loadedPrimitivesCount===this.primitives.length}},_id:{value:null,writable:!0},id:{enumerable:!0,get:function(){return this._id},set:function(e){this._id=e}},_name:{value:null,writable:!0},name:{enumerable:!0,get:function(){return this._name},set:function(e){this._name=e}},_computeBBOXIfNeeded:{enumerable:!1,value:function(){if(!this._boundingBox&&this.primitives){var e=this.primitives.length;if(e>0){var i=this.primitives[0].boundingBox;if(i){var t;for(t=1;e>t;t++)this.primitives[t].boundingBox&&(i=a.mergeBBox(i,this.primitives[t].boundingBox));this._boundingBox=i}}}}},_boundingBox:{value:null,writable:!0},boundingBox:{enumerable:!0,get:function(){return this._computeBBOXIfNeeded(),this._boundingBox},set:function(e){this._boundingBox=e}},init:{value:function(){return this.__Base_init(),this._primitives=[],this}}})}}),montageDefine("3d2b056","package.json",{exports:{name:"mjs-volume",version:"0.1.0",dependencies:{montage:"~0.14.0",digit:"~0.5.0",matte:"~0.2.0",q:"0.9.6","native":"~0.2.0",collections:"~0.2.1",cssom:"0.3.0",url:"0.7.9"},repository:{type:"git",url:"git+https://github.com/fabrobinet/mjs-volume.git"},gitHead:"ab464514d68d8fe2b0cbfb5f0e8eb51ec6c46936",readmeFilename:"README.md",description:"mjs-volume\r ==========",bugs:{url:"https://github.com/fabrobinet/mjs-volume/issues"},homepage:"https://github.com/fabrobinet/mjs-volume#readme",_id:"mjs-volume@0.1.0",_shasum:"389b2c7eaf4acb2c3f89c9bdb8fc41fddf9d387b",_from:"git://github.com/montagestudio/mjs-volume.git#beachplanet",_resolved:"git://github.com/montagestudio/mjs-volume.git#ab464514d68d8fe2b0cbfb5f0e8eb51ec6c46936",hash:"3d2b056",mappings:{montage:{name:"montage",hash:"d41c331",location:"../montage@d41c331/"},digit:{name:"digit",hash:"88d5464",location:"../digit@88d5464/"},matte:{name:"matte",hash:"03aabfe",location:"../matte@03aabfe/"},q:{name:"q",hash:"d2f6328",location:"../q@d2f6328/"},"native":{name:"native",hash:"ce14dd3",location:"../native@ce14dd3/"},collections:{name:"collections",hash:"e3ee536",location:"../collections@e3ee536/"},cssom:{name:"cssom",hash:"4676c7d",location:"../cssom@4676c7d/"},url:{name:"url",hash:"4ab363f",location:"../url@4ab363f/"}},production:!0,useScriptInjection:!0}}),montageDefine("3d2b056","runtime/primitive",{dependencies:["runtime/dependencies/gl-matrix","runtime/utilities"],factory:function(e,i){e("runtime/dependencies/gl-matrix"),e("runtime/utilities").Utilities,i.Primitive=Object.create(Object.prototype,{_attributesCount:{enumerable:!1,value:0,writable:!0},attributesCount:{enumerable:!1,get:function(){return this._attributesCount}},init:{value:function(){return this.step=0,this.semantics={},this}},_semantics:{enumerable:!1,value:null,writable:!0},semantics:{enumerable:!0,get:function(){return this._semantics},set:function(e){this._semantics=e}},addVertexAttribute:{enumerable:!1,value:function(e){if("POSITION"===e.semantic){var i=null,t=e.attribute;t.min&&t.max&&(i=[t.min,t.max]),this.boundingBox=i}this.semantics[e.semantics]||(this.semantics[e.semantic]=e.attribute,this._attributesCount++)}},_computeBBOXIfNeeded:{enumerable:!1,value:function(){}},_boundingBox:{value:null,writable:!0},boundingBox:{enumerable:!0,get:function(){return this._computeBBOXIfNeeded(),this._boundingBox},set:function(e){this._boundingBox=e}},_indices:{enumerable:!1,value:null,writable:!0},indices:{get:function(){return this._indices},set:function(e){this._indices=e}},_material:{enumerable:!1,value:null,writable:!0},material:{get:function(){return this._material},set:function(e){this._material=e}}})}}),montageDefine("845cab0","package.json",{exports:{name:"punycode",version:"1.0.0",description:"A robust Punycode converter that fully complies to RFC 3492 and RFC 5891, and works on nearly all JavaScript platforms.",homepage:"http://mths.be/punycode",main:"punycode.js",keywords:["punycode","unicode","idn","url","domain"],licenses:[{type:"MIT",url:"http://mths.be/mit"},{type:"GPL",url:"http://mths.be/gpl"}],author:{name:"Mathias Bynens",email:"mathias@qiwi.be",url:"http://mathiasbynens.be/"},maintainers:[{name:"wizard",email:"wizard@roborooter.com"},{name:"mathias",email:"mathias@qiwi.be"}],bugs:{url:"https://github.com/bestiejs/punycode.js/issues"},repository:{type:"git",url:"git://github.com/bestiejs/punycode.js.git"},engines:["node","rhino"],directories:{doc:"docs",test:"tests"},_npmUser:{name:"mathias",email:"mathias@qiwi.be"},_id:"punycode@1.0.0",dependencies:{},devDependencies:{},_engineSupported:!0,_npmVersion:"1.0.106",_nodeVersion:"v0.6.8",_defaultsLoaded:!0,dist:{shasum:"ce9e6c6e9c1db5827174fceb12ff4938700a1bd3",tarball:"http://registry.npmjs.org/punycode/-/punycode-1.0.0.tgz"},_shasum:"ce9e6c6e9c1db5827174fceb12ff4938700a1bd3",_resolved:"https://registry.npmjs.org/punycode/-/punycode-1.0.0.tgz",_from:"punycode@>=1.0.0 <1.1.0",hash:"845cab0",mappings:{},production:!0,useScriptInjection:!0}}),montageDefine("3d2b056","runtime/action-dispatcher",{dependencies:["montage/core/event/event-manager","montage"],factory:function(e,i){var t=e("montage/core/event/event-manager").defaultEventManager,a=e("montage").Montage,s={COMPONENT_ENTER:"hover",_TOUCH_DOWN:"action"};i.ActionDispatcher=a.specialize({constructor:{value:function(){this.super()}},_scene:{value:null},initWithScene:{value:function(e){return this._scene=e,this}},_findPathToParentsForGlTFElement:{value:function(e,i){if(Array.isArray(i)||(i=[e]),e&&e.parent){var t=e.parent;return i.push(t),this._findPathToParentsForGlTFElement(t,i)}return i}},_isRegisteredListenersForEventTypeOnComponent:{value:function(e,i){var a=s[e];if(t&&a&&i.uuid){var u=t.registeredEventListeners[a];if(u)return!!u[i.uuid]}return!1}},_isComponentStyleRespondToAction:{value:function(e,i){var t=s[e],a=i._style;return t&&t!==s._TOUCH_DOWN&&a&&"object"==typeof a&&a.hasOwnProperty(t)}},dispatchActionOnGlTFElement:{value:function(e,i){if("string"==typeof e&&i&&"object"==typeof i){var t=this._findPathToParentsForGlTFElement(i),a=this;t.some(function(t){var s=t.component3D;return s&&(a._isRegisteredListenersForEventTypeOnComponent(e,s)||a._isComponentStyleRespondToAction(e,s))?(s.handleActionOnGlTFElement(i,e),!0):!1})}}}})}}),montageDefine("47be41b","ui/main.reel/main.html",{text:'<html><head>\n    <link rel=stylesheet type=text/css href=main.css>\n    <script type=text/montage-serialization>{"owner":{"properties":{"element":{"#":"fallback"}}},"substitution":{"prototype":"montage/ui/substitution.reel","properties":{"element":{"#":"substitution"},"switchValue":"webgl"},"bindings":{"switchValue":{"<-":"@owner.viewKey"}}},"beachplanet":{"prototype":"ui/beachplanet.reel","properties":{"element":{"#":"beachplanet"}}}}</script>\n</head>\n\n<body>\n    <div data-montage-id=fallback class=Main>\n        <div data-montage-id=substitution class=Main-substitution>\n            <div data-arg=webgl data-montage-id=beachplanet></div>\n            <div data-arg=static class=Main-wrapper>\n                <img class=Main-logo src=planet.png title=BeachPlanet>\n                <h1 class=Main-title>This demo requires WebGL.</h1>\n                <h2 class=Main-subtitle>Please check your browser has WebGL supported and enabled.<br>Learn how to <a class=Main-link href="http://montagejs.org/blog/2014/01/22/build-3d-applications-with-montagejs/">build this with MontageJS</a></h2>\n                <p></p>\n            </div>\n        </div>\n    </div>\n\n\n\n</body></html>'}),montageDefine("4676c7d","lib/index",{dependencies:["./CSSStyleDeclaration","./CSSRule","./CSSStyleRule","./MediaList","./CSSMediaRule","./CSSImportRule","./CSSFontFaceRule","./StyleSheet","./CSSStyleSheet","./CSSKeyframesRule","./CSSKeyframeRule","./MatcherList","./CSSDocumentRule","./CSSValue","./CSSValueExpression","./parse","./clone"],factory:function(e,i){"use strict";i.CSSStyleDeclaration=e("./CSSStyleDeclaration").CSSStyleDeclaration,i.CSSRule=e("./CSSRule").CSSRule,i.CSSStyleRule=e("./CSSStyleRule").CSSStyleRule,i.MediaList=e("./MediaList").MediaList,i.CSSMediaRule=e("./CSSMediaRule").CSSMediaRule,i.CSSImportRule=e("./CSSImportRule").CSSImportRule,i.CSSFontFaceRule=e("./CSSFontFaceRule").CSSFontFaceRule,i.StyleSheet=e("./StyleSheet").StyleSheet,i.CSSStyleSheet=e("./CSSStyleSheet").CSSStyleSheet,i.CSSKeyframesRule=e("./CSSKeyframesRule").CSSKeyframesRule,i.CSSKeyframeRule=e("./CSSKeyframeRule").CSSKeyframeRule,i.MatcherList=e("./MatcherList").MatcherList,i.CSSDocumentRule=e("./CSSDocumentRule").CSSDocumentRule,i.CSSValue=e("./CSSValue").CSSValue,i.CSSValueExpression=e("./CSSValueExpression").CSSValueExpression,i.parse=e("./parse").parse,i.clone=e("./clone").clone}}),montageDefine("4676c7d","lib/clone",{dependencies:["./CSSStyleSheet","./CSSStyleRule","./CSSMediaRule","./CSSStyleDeclaration","./CSSKeyframeRule","./CSSKeyframesRule"],factory:function(e,i){var t={CSSStyleSheet:e("./CSSStyleSheet").CSSStyleSheet,CSSStyleRule:e("./CSSStyleRule").CSSStyleRule,CSSMediaRule:e("./CSSMediaRule").CSSMediaRule,CSSStyleDeclaration:e("./CSSStyleDeclaration").CSSStyleDeclaration,CSSKeyframeRule:e("./CSSKeyframeRule").CSSKeyframeRule,CSSKeyframesRule:e("./CSSKeyframesRule").CSSKeyframesRule};t.clone=function a(e){var i=new t.CSSStyleSheet,s=e.cssRules;if(!s)return i;for(var u={1:t.CSSStyleRule,4:t.CSSMediaRule,8:t.CSSKeyframesRule,9:t.CSSKeyframeRule},n=0,r=s.length;r>n;n++){var l=s[n],o=i.cssRules[n]=new u[l.type],c=l.style;if(c){for(var m=o.style=new t.CSSStyleDeclaration,d=0,p=c.length;p>d;d++){var v=m[d]=c[d];m[v]=c[v],m._importants[v]=c.getPropertyPriority(v)}m.length=c.length}l.hasOwnProperty("keyText")&&(o.keyText=l.keyText),l.hasOwnProperty("selectorText")&&(o.selectorText=l.selectorText),l.hasOwnProperty("mediaText")&&(o.mediaText=l.mediaText),l.hasOwnProperty("cssRules")&&(o.cssRules=a(l).cssRules)}return i},i.clone=t.clone}}),montageDefine("b001380","package.json",{exports:{name:"querystring",id:"querystring",version:"0.1.0",description:"Node's querystring module for all engines.",keywords:["commonjs","query","querystring"],author:{name:"Irakli Gozalishvili",email:"rfobic@gmail.com"},repository:{type:"git",url:"git://github.com/Gozala/querystring.git",web:"https://github.com/Gozala/querystring"},bugs:{url:"http://github.com/Gozala/querystring/issues/"},devDependencies:{test:">=0.4.3"},main:"./querystring.js",engines:{node:">=0.4.x"},scripts:{test:"node tests/test-querystring.js"},_npmUser:{name:"gozala",email:"rfobic@gmail.com"},_id:"querystring@0.1.0",dependencies:{},_engineSupported:!0,_npmVersion:"1.0.101",_nodeVersion:"v0.5.9",_defaultsLoaded:!0,dist:{shasum:"cb76a26cda0a10a94163fcdb3e132827f04b7b10",tarball:"http://registry.npmjs.org/querystring/-/querystring-0.1.0.tgz"},maintainers:[{name:"gozala",email:"rfobic@gmail.com"}],directories:{},_shasum:"cb76a26cda0a10a94163fcdb3e132827f04b7b10",_resolved:"https://registry.npmjs.org/querystring/-/querystring-0.1.0.tgz",_from:"querystring@>=0.1.0 <0.2.0",hash:"b001380",mappings:{},production:!0,useScriptInjection:!0}}),montageDefine("d41c331","ui/slot.reel/slot",{dependencies:["../component"],factory:function(e,i){var t=e("../component").Component;
i.Slot=t.specialize({hasTemplate:{enumerable:!1,value:!1},constructor:{value:function(){this.super(),this.content=null}},delegate:{value:null},_content:{value:null},enterDocument:{value:function(e){e&&this.element.classList.add("montage-Slot")}},content:{get:function(){return this._content},set:function(e){var i,a;e&&void 0!==e.needsDraw?(a=this._content,a&&void 0!==a.needsDraw&&a.detachFromParentComponent(),e.element?i=e.element:(i=document.createElement("div"),i.id="appendDiv",this.delegate&&"function"==typeof this.delegate.slotElementForComponent&&(i=this.delegate.slotElementForComponent(this,e,i)),e.element=i),Object.getPropertyDescriptor(t,"domContent").set.call(this,i),this.addChildComponent(e),e.needsDraw=!0):Object.getPropertyDescriptor(t,"domContent").set.call(this,e),this._content=e,this.needsDraw=!0}},contentDidChange:{value:function(e,i){this.delegate&&"function"==typeof this.delegate.slotDidSwitchContent&&this.delegate.slotDidSwitchContent(this,e,e?e.component:null,i,i?i.component:null)}}})}}),montageDefine("4676c7d","package.json",{exports:{name:"cssom",description:"CSS Object Model implementation and CSS parser",keywords:["CSS","CSSOM","parser","styleSheet"],version:"0.3.0",homepage:"https://github.com/NV/CSSOM",author:{name:"Nikita Vasilyev",email:"me@elv1s.ru"},repository:{type:"git",url:"git://github.com/NV/CSSOM.git"},bugs:{url:"https://github.com/NV/CSSOM/issues"},main:"./lib/index.js",devDependencies:{jake:"~0.7.3"},license:{type:"MIT",url:"http://creativecommons.org/licenses/MIT/"},scripts:{prepublish:"jake lib/index.js"},readmeFilename:"README.mdown",_id:"cssom@0.3.0",dist:{shasum:"386d5135528fe65c1ee1bc7c4e55a38854dbcf7a",tarball:"http://registry.npmjs.org/cssom/-/cssom-0.3.0.tgz"},_resolved:"https://registry.npmjs.org/cssom/-/cssom-0.3.0.tgz",_from:"cssom@0.3.0",_npmVersion:"1.3.8",_npmUser:{name:"domenic",email:"domenic@domenicdenicola.com"},maintainers:[{name:"nv",email:"me@elv1s.ru"},{name:"domenic",email:"domenic@domenicdenicola.com"}],directories:{},_shasum:"386d5135528fe65c1ee1bc7c4e55a38854dbcf7a",hash:"4676c7d",mappings:{},production:!0,useScriptInjection:!0}}),montageDefine("4ab363f","package.json",{exports:{author:{name:"Joyent",url:"http://www.joyent.com"},name:"url",description:"Node.JS url module",keywords:["ender","pakmanager","url"],publishConfig:{registry:"http://registry.npmjs.org"},version:"0.7.9",homepage:"http://nodejs.org/api/url.html",repository:{type:"git",url:"git://github.com/coolaj86/node.git"},main:"./url.js",directories:{lib:"."},engines:{node:">= 0.2.0",ender:">= 0.5.0"},dependencies:{querystring:">=0.1.0 <0.2.0",punycode:">=1.0.0 <1.1.0"},devDependencies:{},_id:"url@0.7.9",dist:{shasum:"1959b1a8b361fc017b59513a7c7fa9827f5e4ed0",tarball:"http://registry.npmjs.org/url/-/url-0.7.9.tgz"},maintainers:[{name:"coolaj86",email:"coolaj86@gmail.com"}],_shasum:"1959b1a8b361fc017b59513a7c7fa9827f5e4ed0",_resolved:"https://registry.npmjs.org/url/-/url-0.7.9.tgz",_from:"url@0.7.9",hash:"4ab363f",mappings:{querystring:{name:"querystring",hash:"b001380",location:"../querystring@b001380/"},punycode:{name:"punycode",hash:"845cab0",location:"../punycode@845cab0/"}},production:!0,useScriptInjection:!0}}),montageDefine("3d2b056","runtime/builtin-assets",{dependencies:["q","runtime/runtime-tf-loader"],factory:function(e,i){var t=e("q"),a=e("runtime/runtime-tf-loader").RuntimeTFLoader;i.BuiltInAssets=Object.create(Object.prototype,{_deferredForName:{value:{},writable:!0},_assetInfos:{value:{},writable:!0},registerBuiltinAssetsIfNeeded:{value:function(){var i=e.location+"assets/picking/picking.json",t=e.location+"assets/gradient/gradient.json";this._assetInfos.pickingTechnique={location:i,options:{ids:["pickingTechnique"]}},this._assetInfos.gradient={location:t}}},assetInfosForName:{value:function(e){return this.registerBuiltinAssetsIfNeeded(),this._assetInfos[e]}},assetWithName:{value:function(e){var i=this._deferredForName[e];if(!i){i=t.defer(),this._deferredForName[e]=i;var s={};s.loadCompleted=function(e){i.resolve(e)}.bind(this);var u=Object.create(a),n=this.assetInfosForName(e);n?(u.initWithPath(n.location),u.delegate=s,u.load(null,n.options)):i.reject("ERROR:"+e+" isn't registered as a built-in asset")}return i.promise}}})}}),montageDefine("d41c331","composer/composer",{dependencies:["../core/target"],factory:function(e,i){var t=e("../core/target").Target;i.Composer=t.specialize({_component:{value:null},component:{get:function(){return this._component},set:function(e){this._component=e}},_element:{value:null},element:{get:function(){return this._element},set:function(e){this._element=e}},lazyLoad:{value:!0},_needsFrame:{value:!1},needsFrame:{set:function(e){this._needsFrame!==e&&(this._needsFrame=e,this._component&&e&&this._component.scheduleComposer(this))},get:function(){return this._needsFrame}},frame:{value:Function.noop},_resolveDefaults:{value:function(){this.element||null!=this.element||null==this.component||(this.element=this.component.element)}},_isLoaded:{value:!1},isLoaded:{get:function(){return this._isLoaded}},load:{value:Function.noop},unload:{value:Function.noop},deserializedFromTemplate:{value:function(){this.component&&this.component.addComposer(this)}}},{isCoordinateOutsideRadius:{value:function(e,i,t){return e*e+i*i>t*t}}})}}),montageDefine("b001380","querystring",{dependencies:[],factory:function(e,i,t){("undefined"==typeof define?function(a){a(e,i,t)}:define)(function(e,i,t,a){"use strict";var s=i;s.unescape=decodeURIComponent,s.escape=encodeURIComponent;var u=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};s.stringify=s.encode=function(e,i,t,n){switch(i=i||"&",t=t||"=",e=null===e?a:e,typeof e){case"object":return Object.keys(e).map(function(a){return Array.isArray(e[a])?e[a].map(function(e){return s.escape(u(a))+t+s.escape(u(e))}).join(i):s.escape(u(a))+t+s.escape(u(e[a]))}).join(i);default:return n?s.escape(u(n))+t+s.escape(u(e)):""}},s.parse=s.decode=function(e,i,t){i=i||"&",t=t||"=";var a={};return"string"!=typeof e||0===e.length?a:(e.split(i).forEach(function(e){var i=e.split(t),u=s.unescape(i[0],!0),n=s.unescape(i.slice(1).join(t),!0);u in a?Array.isArray(a[u])?a[u].push(n):a[u]=[a[u],n]:a[u]=n}),a)}})}}),montageDefine("3d2b056","runtime/scene-resource-loader",{dependencies:["runtime/resource-loader","runtime/mesh-resource-loader"],factory:function(e,i){var t=e("runtime/resource-loader").ResourceLoader,a=e("runtime/mesh-resource-loader").MeshResourceLoader;i.SceneResourceLoader=Object.create(t,{_scene:{value:null,writable:!0},scene:{get:function(){return this._scene},set:function(e){this._scene=e}},meshesDidLoad:{value:function(){this.delegate&&this.delegate.sceneResourcesDidPrepare(this.scene)}},loadScene:{value:function(){var e=this;if(this.scene){var i=this.scene.rootNode,t={},s=[];i.apply(function(e){return e.meshes&&e.meshes.length&&e.meshes.forEach(function(e){null==t[e.id]&&(s.push(e),t[e.id]=e)},this),null},!0,null);var u=Object.create(a).init(s,e.webGLRenderer,this);u.loadMeshes()}}},init:{value:function(e,i,t){return t&&(this.delegate=t),this.webGLRenderer=i,this.scene=e,i.resourceManager.observers.push(this),this}}})}}),montageDefine("3d2b056","runtime/technique",{dependencies:["runtime/base"],factory:function(e,i){var t=e("runtime/base").Base;i.Technique=Object.create(t,{_parameters:{value:null,writable:!0},_passName:{value:null,writable:!0},_passes:{value:null,writable:!0},init:{value:function(){return this.__Base_init(),this.passes={},this}},parameters:{get:function(){return this._parameters},set:function(e){this._parameters=e}},passName:{get:function(){return this._passName},set:function(e){this._passName!=e&&(this._passName=e)}},rootPass:{get:function(){return this._passes[this.passName]}},passesDidChange:{value:function(){var e=Object.keys(this.passes);this.passName=1==e.length?e[0]:null}},passes:{get:function(){return this._passes},set:function(e){this._passes!=e&&(this._passes=e,this.passesDidChange())}},execute:{value:function(e,i,t){e.resetStates(),this.rootPass.execute(e,i,t)}}})}}),montageDefine("d41c331","ui/text.reel/text",{dependencies:["../component"],factory:function(e,i){var t=e("../component").Component;i.Text=t.specialize({constructor:{value:function(){this.super()}},hasTemplate:{value:!1},_value:{value:null},value:{get:function(){return this._value},set:function(e){this._value!==e&&(this._value=e,this.needsDraw=!0)}},converter:{value:null},defaultValue:{value:""},_valueNode:{value:null},_RANGE:{value:document.createRange()},enterDocument:{value:function(e){if(e){var i=this._RANGE;i.selectNodeContents(this.element),i.deleteContents(),this._valueNode=document.createTextNode(""),i.insertNode(this._valueNode),this.element.classList.add("montage-Text")}}},draw:{value:function(){var e=this._value,i=e||0===e?e:this.defaultValue;this.converter&&(i=this.converter.convert(i)),this._valueNode.data=i}}})}}),montageDefine("3d2b056","runtime/resource-description",{dependencies:[],factory:function(e,i,t){(function(e,a){"object"==typeof i?a(t.exports):"function"==typeof define&&define.amd?define([],function(){return a(e)}):a(e)})(this,function(e){var i=Object.create(Object.prototype,{_description:{value:null,writable:!0},_id:{value:null,writable:!0},_type:{value:null,writable:!0},init:{enumerable:!0,value:function(e,i){return this._id=e,this._description=i,this}},description:{enumerable:!0,get:function(){return this._description}},id:{enumerable:!0,get:function(){return this._id},set:function(e){this._id=e}},type:{enumerable:!0,get:function(){return this._type},set:function(e){this._type=e}}});return e&&(e.ResourceDescription=i),i})}}),montageDefine("88d5464","package.json",{exports:{name:"digit",version:"0.5.1",repository:{type:"git",url:"git+https://github.com/montagejs/digit.git"},dependencies:{montage:"~0.14.0",matte:"~0.2.0"},devDependencies:{"montage-testing":"~0.4.0"},exclude:["overview.html","overview","run-tests.html","test"],readmeFilename:"README.md",description:"![digit](overview/assets/images/icon.png)",bugs:{url:"https://github.com/montagejs/digit/issues"},homepage:"https://github.com/montagejs/digit",_id:"digit@0.5.1",_from:"digit@>=0.5.1 <0.6.0",hash:"88d5464",mappings:{montage:{name:"montage",hash:"d41c331",location:"../montage@d41c331/"},matte:{name:"matte",hash:"03aabfe",location:"../matte@03aabfe/"}},production:!0,useScriptInjection:!0}}),montageDefine("d41c331","core/browser",{dependencies:["montage"],factory:function(e,i){var t=e("montage").Montage,a=RegExp(/AppleWebKit\/([\d.]+)/),s=t.specialize({constructor:{value:function s(e){this.super(),this._userAgent=e,this._analyze(e)}},_analyze:{value:function(e){if(e.indexOf("Android")>-1&&e.indexOf("Mozilla/5.0")>-1&&e.indexOf("AppleWebKit")>-1){this.android={};var i=a.exec(e),t=null===i?null:parseFloat(a.exec(e)[1]);this.android.androidBrowser=null!==t&&537>t}}},_userAgent:{value:null}}),u=null;t.defineProperties(i,{browser:{get:function(){return null===u&&(u=new s(navigator.userAgent)),u}},Browser:{value:s}})}}),montageDefine("47be41b","ui/main.reel/main",{dependencies:["montage/ui/component"],factory:function(e,i){var t;t=e("montage/ui/component").Component,i.Main=t.specialize({_supportsWebGL:{value:null},supportsWebGL:{get:function(){if(null===this._supportsWebGL){var e={premultipliedAlpha:!1,antialias:!0,preserveDrawingBuffer:!1},i=document.createElement("canvas"),t=i.getContext("experimental-webgl",e)||i.getContext("webgl",e);this._supportsWebGL=!!t}return this._supportsWebGL}},viewKey:{value:null},templateDidLoad:{value:function(){this.viewKey=this.supportsWebGL?"webgl":"static"}}})}}),montageDefine("d41c331","ui/base/abstract-control",{dependencies:["../component","collections/dict"],factory:function(e,i){var t=e("../component").Component,a=e("collections/dict");i.AbstractControl=t.specialize({dispatchActionEvent:{value:function(){return this.dispatchEvent(this.createActionEvent())}},_detail:{value:null},detail:{get:function(){return null==this._detail&&(this._detail=new a),this._detail}},createActionEvent:{value:function(){var e,i=document.createEvent("CustomEvent");return e=this._detail,i.initCustomEvent("action",!0,!0,e),i}}})}}),montageDefine("3d2b056","ui/scene-view.reel/scene-view.html",{text:'<!DOCTYPE html><html><head>\n    <title></title>\n    <link rel=stylesheet type=text/css href=scene-view.css>\n\n    <script type=text/montage-serialization>{"owner":{"prototype":"ui/scene-view.reel","properties":{"element":{"#":"component"}}},"canvas":{"value":{"#":"canvas"}}}</script>\n\n</head>\n<body>\n    <div data-montage-id=component class=View>\n        <canvas data-montage-id=canvas class=View-canvas></canvas>\n    </div>\n\n\n</body></html>'}),montageDefine("3d2b056","runtime/resource-loader",{dependencies:[],factory:function(e,i){i.ResourceLoader=Object.create(Object.prototype,{webGLRenderer:{value:null,writable:!0},delegate:{value:null,writable:!0},_trackedIds:{value:null,writable:!0},_addTrackedId:{value:function(e){null==this._trackedIds&&(this._trackedIds={}),this._trackedIds[e]=!0}},_removeTrackedId:{value:function(e){null==this._trackedIds[e]||delete this._trackedIds[e]}}})}}),montageDefine("3d2b056","runtime/camera",{dependencies:["runtime/base"],factory:function(e,i){var t=e("runtime/base").Base;i.Camera=Object.create(t,{_projection:{value:null,writable:!0},projection:{get:function(){return this._projection},set:function(e){this._projection=e}},init:{value:function(){return this.__Base_init(),this}}})}}),montageDefine("88d5464","ui/button.reel/button",{dependencies:["montage/ui/base/abstract-button"],factory:function(e,i){var t=e("montage/ui/base/abstract-button").AbstractButton;i.Button=t.specialize({hasTemplate:{value:!0},constructor:{value:function(){this.super(),this.classList.add("digit-Button")}}})}}),montageDefine("3d2b056","runtime/base",{dependencies:[],factory:function(e,i){i.Base=Object.create(Object.prototype,{_properties:{value:null,writable:!0},properties:{get:function(){return this._properties},set:function(e){this._properties=e}},__Base_init:{value:function(){this._properties={}}}})}}),montageDefine("88d5464","ui/button.reel/button.html",{text:"<!DOCTYPE html><html><head>\n    <meta charset=utf-8>\n    <link rel=stylesheet href=button.css>\n</head>\n<body>\n\n\n</body></html>"});
bundleLoaded("02buoy.html.bundle-1-0.js")